/*
* COPYRIGHT AND ITAR: This work, authored and owned by Commonwealth Computer
* Research, Inc. (CCRi), was funded in whole or in part by a U.S. Government
* contract and is subject to a license granting the Government rights to the
* work. All other rights are reserved by CCRi as the copyright owner, copyright
* 2014-2018.  Information included herein is controlled under the International
* Traffic in Arms Regulations (ITAR).  ITAR protections, laws, and regulations
* must be observed by any users of this work.
*/
Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(a){if(null===this)throw new TypeError('"this" is null or not defined');var b=Object(this),c=b.length>>>0;if("function"!=typeof a)throw new TypeError("predicate must be a function");for(var d=arguments[1],e=0;e<c;){var f=b[e];if(a.call(d,f,e,b))return f;e++}}}),Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(a){if(null===this)throw new TypeError('"this" is null or not defined');var b=Object(this),c=b.length>>>0;if("function"!=typeof a)throw new TypeError("predicate must be a function");for(var d=arguments[1],e=0;e<c;){var f=b[e];if(a.call(d,f,e,b))return e;e++}return-1}}),window.CanvasPixelArray&&(CanvasPixelArray.prototype.set=function(a){for(var b=this.length,c=0;c<b;c++)this[c]=a[c]}),function(){function a(a,b){var c,d=this.length,e=a||0;e=e>=0?e:Math.max(0,d+e),b=b||d;var f="number"==typeof b?Math.min(b,d):d;b<0&&(f=d+b),c=f-e,c<=0&&(c=0);for(var g=this.constructor,h=new g(c),i=0;i<c;i++)h[i]=this[e+i];return h}Int8Array.prototype.slice||Object.defineProperty(Int8Array.prototype,"slice",{value:a}),Uint8Array.prototype.slice||Object.defineProperty(Uint8Array.prototype,"slice",{value:a}),Uint8ClampedArray.prototype.slice||Object.defineProperty(Uint8ClampedArray.prototype,"slice",{value:a}),Int16Array.prototype.slice||Object.defineProperty(Int16Array.prototype,"slice",{value:a}),Uint16Array.prototype.slice||Object.defineProperty(Uint16Array.prototype,"slice",{value:a}),Int32Array.prototype.slice||Object.defineProperty(Int32Array.prototype,"slice",{value:a}),Uint32Array.prototype.slice||Object.defineProperty(Uint32Array.prototype,"slice",{value:a}),Float32Array.prototype.slice||Object.defineProperty(Float32Array.prototype,"slice",{value:a}),Float64Array.prototype.slice||Object.defineProperty(Float64Array.prototype,"slice",{value:a})}(),window.requestAnimationFrame||window.mozRequestAnimationFrame&&(window.requestAnimationFrame=window.mozRequestAnimationFrame),function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}(),angular.module("stealth.config",[]).constant("CONFIG",angular.copy(_.get(window,"STEALTH.config",{}))),angular.module("stealth.app",["$q-race","ngAnimate","ngCookies","truncate","ui.bootstrap","ui.utils","ccri.angular-utils","ccri.bars","templates-app","stealth.config","stealth.core","stealth.display","stealth.display-dock","stealth.mediator.bars-wizard","stealth.mediator.sidebar-wizard","stealth.plugins","isteven-multi-select"]).config(["$compileProvider","$httpProvider","$logProvider","CONFIG","toastrConfig",function(a,b,c,d,e){var f=!!_.get(d,"app.debugBuild");a.debugInfoEnabled(f),c.debugEnabled(f),b.defaults.withCredentials=!0,angular.extend(e,{allowHtml:!0,target:".primaryDisplay",positionClass:"toast-bottom-right",closeButton:!0,progressBar:!0,timeOut:5e3,extendedTimeOut:5e3})}]).controller("AppController",["$log","$scope","$timeout","$document","CONFIG",function(a,b,c,d,e){a.debug("stealth.app.AppController: controller started");var f=!1,g=!1,h={timeOut:0,extendedTimeOut:0,tapToDismiss:!1},i={timeOut:0,extendedTimeOut:0,tapToDismiss:!1,toastClass:"waitingToast",iconClass:"waitingToastIcon",onShown:function(){g=!0,f&&ccriCorealerter.alerter.clearMsg(j)}};b.app={loadTime:moment().format("YYYYMMDDHHmmss"),title:_.get(e,"app.title",""),classification:e.classification,userCn:e.userCn,customModes:e.app.customModes},b.showSplash=!!e.app.showSplash,b.splashUrl=e.app.splashUrl,e.app.showSplash&&(b.dismissSplash=function(){$("#splash").remove(),d.off("keydown",b.dismissSplash),delete b.splashDismissButton,delete b.dismissSplash},c(function(){b.splashDismissButton={opacity:1}},2e3),d.one("keydown",b.dismissSplash));var j=ccriCorealerter.alerter.infoMsg("Waiting for capabilities from server(s).","",i);DataSourceManager.loadDataSources().catch(function(){ccriCorealerter.alerter.errorMsg("Failed to get capabilities from server(s). Application may not function properly.","",h)}).then(function(){f=!0,g&&ccriCorealerter.alerter.clearMsg(j)}),b.getCustomMode=function(){return ccriUtils.storage.session.getItem("customMode")}}]),angular.module("$q-race",[]).config(["$provide",function(a){a.decorator("$q",["$delegate",function(a){return a.race=function(b){var c=a.defer();return angular.forEach(b,function(b){a.when(b).then(c.resolve,c.reject)}),c.promise},a}])}]),angular.module("stealth.core.clock",["ccri.bars","ui.bootstrap"]).run(["ccri.angular-utils.WidgetDef","ccri.bars.mgr","ccri.bars.Widget",function(a,b,c){b.insert("top",new c({widget:new a({tag:"st-clock-widget"})}),ccriBars.Position[ccriBars.Position.Last],820)}]).directive("stClock",["$interval",function(a){return{restrict:"E",templateUrl:"core/clock/clock.tpl.html",scope:{},controller:["$scope","CONFIG",function(b,c){var d,e=c.clock.dateFormat,f=c.clock.timeFormat,g=f.indexOf("[Z]")>-1,h=1e3;b.tickClock=function(){var a=g?moment.utc():moment();b.formattedDate=a.format(e),b.formattedTime=a.format(f)},b.startClock=function(){b.hasActiveClock()||(b.tickClock(),d=a(b.tickClock,h))},b.stopClock=function(){if(b.hasActiveClock()){var c=a.cancel(d);return d=c?void 0:d,c}},b.hasActiveClock=function(){return void 0!==d},b.$on("$destroy",function(){b.stopClock()}),b.startClock()}]}}]).directive("stClockWidget",[function(){return{restrict:"E",templateUrl:"core/clock/clockWidget.tpl.html",scope:{},controller:["$scope","ccri.angular-utils.WidgetDef","ccri.popup.manager","CONFIG",function(a,b,c,d){function e(){var d=angular.element(".primaryDisplay > ccri-popup-container"),e=d.data("ccri.popup.containerId"),f=c.getViewportDim(e);f[1]=0,a.clockPopup=c.displayPopup(e,"Time","clock","fa-clock-o",new b({tag:"st-clock"}),{resizable:!1,positioning:Popup.Positioning.TopRight,offsets:f,onClose:function(){a.currentState===a.ClockStates.POPUP&&a.changeState()},contentMinWidth:90})}a.ClockStates={OFF:0,HEADER:1,POPUP:2},a.currentState=a.ClockStates[d.clock.initialState],a.currentState===a.ClockStates.POPUP&&e(),a.changeState=function(){return a.currentState++,a.currentState>=Object.keys(a.ClockStates).length&&(a.currentState=0),a.currentState===a.ClockStates.POPUP?e():c.closePopup(a.clockPopup),a.currentState}}]}}]),angular.module("stealth.core",["ccri.angular-utils","ccri.popup","stealth.context","stealth.core.clock","stealth.core.elements","stealth.core.measure","stealth.core.geo.analysis.category","stealth.core.geo.import","stealth.core.geo.ol3","stealth.core.geo.ol3.zoom","stealth.core.geo.ows","stealth.core.header","stealth.core.interaction","stealth.core.manager","stealth.core.mapTooltips","stealth.core.popup","stealth.core.save","stealth.core.sidebar","stealth.core.startmenu","stealth.core.utils","stealth.core.wizard"]),angular.module("stealth.core.elements",[]).directive("stDateRange",[function(){return{restrict:"E",replace:!0,templateUrl:"core/elements/dateRange.tpl.html",scope:{startDate:"=",endDate:"=",utc:"=?",sep:"@?",datetimeSep:"@?",momentDateFormat:"@?",momentTimeFormat:"@?",valuePlaceholder:"@?",bothPlaceholder:"@?"},controller:["$scope","CONFIG",function(a,b){function c(b,c){return function(d){if(b[c]=null,d)if("innerEnd"===c&&"NOW"===d)a.maxTimePlaceholder="present";else{var e;if(e=moment(d),!e.isValid())return;b[c]=e}}}a.momentDateFormat||(a.momentDateFormat=_.get(b,"app.datetimeFormat.date","YYYY-MM-DD")),a.momentTimeFormat||(a.momentTimeFormat=_.get(b,"app.datetimeFormat.time","HH:mm:ss[Z]")),a.datetimeSep||(a.datetimeSep=_.get(b,"app.datetimeFormat.separator"," ")),a.valuePlaceholder||(a.valuePlaceholder="(no date)"),a.sep||(a.sep="to"),a.maxTimePlaceholder=a.valuePlaceholder,a.innerStart=null,a.innerEnd=null,a.$watch("startDate",c(a,"innerStart")),a.$watch("endDate",c(a,"innerEnd"))}]}}]),angular.module("stealth.core.elements",["ngSanitize","stealth.config"]).directive("stDatetime",[function(){return{restrict:"E",replace:!0,templateUrl:"core/elements/datetime.tpl.html",scope:{date:"=",momentDateFormat:"@?",momentTimeFormat:"@?",valuePlaceholder:"@?",utc:"=?",sep:"@?"},controller:["$scope","CONFIG",function(a,b){var c=_.get(b,"app.datetimeFormat.separator"," "),d=_.get(b,"app.datetimeFormat.date","YYYY-MM-DD"),e=_.get(b,"app.datetimeFormat.time","HH:mm:ss[Z]"),f=_.get(b,"app.datetimeFormat.utc",void 0);void 0===a.momentDateFormat&&(a.momentDateFormat=d),void 0===a.momentTimeFormat&&(a.momentTimeFormat=e),void 0===a.sep&&(a.sep=c),void 0===a.utc&&(a.utc=f),a.hasValue=!1,a.datePart=null,a.timePart=null,a.$watch(function(){if(!a.date||"string"==typeof a.date||"number"==typeof a.date)return a.date;var b=null;try{b=a.date.toISOString()}catch(a){}return a.date.isUtc&&a.date.isUtc()&&(b+="UTC"),b},function(){if(a.hasValue=!1,a.datePart=null,a.timePart=null,a.date){var b;b=moment(a.date),b.isValid()&&(a.utc===!1?b.local():a.utc===!0&&b.utc(),a.hasValue=!0,a.datePart=a.momentDateFormat?b.format(a.momentDateFormat):"",a.timePart=a.momentTimeFormat?b.format(a.momentTimeFormat):"")}})}]}}]),angular.module("stealth.core.geo.analysis.category",["stealth.core.geo.ol3.manager","stealth.core.geo.ol3.map","ccri.angular-utils"]).factory("stealth.core.geo.analysis.category.AnalysisCategory",["$rootScope","$timeout","categoryManager","ol3Map","stealth.core.geo.ol3.manager.Category","ccri.angular-utils.WidgetDef",function(a,b,c,d,e,f){var g=function(g,h,i,j){var k=a.$new();k.layers=[],this.toggleVisibility=function(a){var b=a.getOl3Layer();b.setVisible(!b.getVisible())},this.addLayer=function(a){a.viewState=_.merge(_.get(a,"viewState",{}),{toggledOn:!0}),k.layers.push(a),d.addLayer(a);var c=a.getOl3Layer();return c.on("change:visible",function(){b(function(){a.viewState.toggledOn=c.getVisible()})}),a},this.removeLayer=function(a){k.layers=_.without(k.layers,a),d.removeLayer(a),_.isEmpty(k.layers)&&c.removeCategory(this.id),_.isFunction(j)&&j(a)},this.getLayers=function(){return k.layers};var l=function(){_.each(k.layers,function(a){d.removeLayer(a)}),k.$destroy(),_.isFunction(i)&&i()};k.toggleVisibility=this.toggleVisibility,k.removeLayer=this.removeLayer,e.apply(this,[0,g,h,new f({tag:"st-analysis-category",scope:k,attrs:'layers="layers" toggle-visibility="toggleVisibility(layer)" remove-layer="removeLayer(layer)"'}),null,!0,!0,l])};return g.prototype=Object.create(e.prototype),g}]).directive("stAnalysisCategory",[function(){return{restrict:"E",scope:{layers:"=",toggleVisibility:"&",removeLayer:"&"},templateUrl:"core/geo/analysis/analysisCategory.tpl.html"}}]),angular.module("stealth.core.geo.controls",["stealth.core.geo.controls.mapMode","stealth.core.geo.controls.mapRef","stealth.core.geo.controls.mousePosition","stealth.core.geo.controls.rotate","stealth.core.geo.controls.scaleLine"]),angular.module("stealth.core.geo.controls.mapMode",["stealth.core.interaction.mapclick"]).run(["$rootScope","ccri.angular-utils.WidgetDef","ccri.bars.mgr","ccri.bars.Widget","stealth.core.geo.controls.mapMode.modeManager","stealth.display.registry","CONFIG",function(a,b,c,d,e,f,g){var h=[new d({widget:new b({tag:"st-inspect-toggle",scope:a.$new()})}),new d({widget:new b({tag:"stealth-live-select-tool",scope:a.$new()})}),new d({widget:new b({tag:"stealth-live-select-clear",scope:a.$new()})}),new d({widget:new b({tag:"ccri-bars-separator",scope:a.$new()})}),new d({widget:new b({tag:"ccri-bars-separator",scope:a.$new()})}),new d({widget:new b({tag:"st-mode-indicator",scope:a.$new()})})];c.insert("top",h[0],ccriBars.Position[ccriBars.Position.Last],700),g.select&&g.select.selectToolsEnabled&&(c.insert("top",h[1],ccriBars.Position[ccriBars.Position.Last],700),c.insert("top",h[2],ccriBars.Position[ccriBars.Position.Last],700)),c.insert("top",h[3],ccriBars.Position[ccriBars.Position.Last],701),c.insert("bottom",h[4],ccriBars.Position[ccriBars.Position.Last],700),c.insert("bottom",h[5],ccriBars.Position[ccriBars.Position.Last],700),_.each(h,function(b){f.on("display.selected",function(c){"map"===c.type&&a.$evalAsync(function(){b.hidden=!c.selected})})});var i=null,j=function(){i=e.getMode(),e.activate(e.noMode.name)},k=function(){if("map"===f.selected.type){var a=e.getMode();a.name===e.noMode.name&&(i?(e.activate(i.name),i=null):e.activate(e.defaultMode.name))}};a.$on("wizard:launchWizard",j),a.$on("wizard:closeWizard",k),f.on("display.selected",function(b){"map"===b.type&&a.$evalAsync(function(){b.selected?k():j()})})}]).service("stealth.core.geo.controls.mapMode.modeManager",["$rootScope",function(a){var b=this;b.noMode={name:"None",iconClass:"fa-ban",active:!0},b.inspectMode={name:"Inspect",iconClass:"fa-crosshairs",active:!1},b.defaultMode=b.inspectMode;var c=b.noMode,d=[b.noMode,b.defaultMode];b.addMode=function(a){d.push(_.defaults(a,_.remove(d,"name",a.name)))},b.removeMode=function(a){_.remove(d,"name",a)},b.activate=function(b){if(c.name!==b){var e=_.find(d,"name",b);e&&(c.active=!1,a.$emit("map.mode.deactivated",c),c=e,c.active=!0,a.$emit("map.mode.activated",e))}},b.deactivate=function(e){if(c.name===e&&e!==b.defaultMode.name){var f=_.find(d,"name",e);f&&(f.active=!1,c=b.defaultMode,c.active=!0,a.$emit("map.mode.deactivated",f),a.$emit("map.mode.activated",b.defaultMode))}},b.getMode=function(){return c},b.toggle=function(a){var c=_.find(d,"name",a);if(c){var e=c.active?b.deactivate:b.activate;e(c.name)}}}]).directive("stModeIndicator",["stealth.core.geo.controls.mapMode.modeManager",function(a){return{restrict:"E",scope:{},templateUrl:"core/geo/controls/modeIndicator.tpl.html",controller:["$scope",function(b){b.getName=function(){return a.getMode().name},b.getIcon=function(){return a.getMode().iconClass}}]}}]).directive("stInspectToggle",["$rootScope","stealth.core.geo.controls.mapMode.modeManager","stealth.core.interaction.mapclick.manager",function(a,b,c){return{restrict:"E",scope:{},templateUrl:"core/geo/controls/inspectToggle.tpl.html",controller:["$scope",function(d){var e=b.inspectMode;d.isToggledOn=e.name===b.getMode().name,c.enableClicks(d.isToggledOn),a.$on("map.mode.activated",function(a,b){e.name!==b.name||d.isToggledOn||(d.isToggledOn=!0,c.enableClicks(!0))}),a.$on("map.mode.deactivated",function(a,b){e.name===b.name&&d.isToggledOn&&(d.isToggledOn=!1,c.enableClicks(!1))}),d.toggle=function(){d.isToggledOn||b.activate(e.name)},b.getMode().name===b.noMode.name&&e.name===b.defaultMode.name&&d.toggle()}]}}]),angular.module("stealth.core.geo.controls.mapRef",[]).service("mapRef",["$q",function(a){function b(b){a.when(b).then(function(a){d.resolve(a)})}function c(){return d.promise}this.setMap=b,this.getMap=c;var d=a.defer()}]),angular.module("stealth.core.geo.controls.mousePosition",["stealth.core.geo.ol3.map"]).factory("mousePosition",["ol3Map",function(a){function b(){var b=this;this.coordinates=[null,null],this.pixel=[null,null],this.isOverMap=!1;var c,d,e=function(a){b.emit("mousemove",a)},f=_.throttle(function(a){b.emit("mousemove.throttled",a)},100),g=a.getMap(),h=g.getViewport();h.addEventListener("mousemove",function(a){b.isOverMap=!0,c=g.getEventPixel(a),b.pixel[0]=c[0],b.pixel[1]=c[1],d=g.getCoordinateFromPixel(c),d&&(b.coordinates[0]=d[0],b.coordinates[1]=d[1],e(a),f(a))}),h.addEventListener("mouseout",function(){b.isOverMap=!1,b.pixel[0]=null,b.pixel[1]=null,b.coordinates[0]=null,b.coordinates[1]=null,b.emit("mouseout")}),h.addEventListener("mouseover",function(){b.isOverMap=!0,b.emit("mouseover")})}return b.prototype=new EventEmitter,new b}]).directive("stMousePosition",["$filter","mousePosition",function(a,b){return{restrict:"EA",scope:{},templateUrl:"core/geo/controls/mousePosition.tpl.html",link:function(c,d){function e(){h=d.find(".stmousepos_dmsh_0").get(0),i=d.find(".stmousepos_dmsh_1").get(0),j=d.find(".stmousepos_lat").get(0),k=d.find(".stmousepos_lon").get(0),l=!0}function f(){m=b.coordinates,m&&(n=a("coordToDMSH")(m),n&&(l||e(),(m[0]>180||m[0]<-180)&&(o=m[0]%180,m[0]=m[0]>180?-180+o:180+o),h.textContent=n[0],i.textContent=n[1],b.isOverMap&&!_.isEmpty(m)?(k.textContent=m[0].toFixed(4),j.textContent=m[1].toFixed(4)):(k.textContent="",j.textContent="")))}function g(){b.off("mousemove",f),h=i=j=k=l=null,m=n=o=null,c.$destroy(),c=null}d.on("$destroy",g),b.on("mousemove.throttled",f);var h,i,j,k,l,m,n,o}}}]),angular.module("stealth.core.geo.controls.rotate",["stealth.core.geo.controls.mapRef"]).directive("stRotateControl",["mapRef",function(a){function b(b,c){var d=new ol.control.Rotate({autoHide:!1,label:"⬆"});d.setTarget(c[0]),a.getMap().then(function(a){d.setMap(a),c.append('<div class="rotateControlText bar-color2">N</div>')})}var c={link:b,template:"",restrict:"EA"};return c}]),angular.module("stealth.core.geo.controls.scaleLine",["stealth.core.geo.controls.mapRef","stealth.core.utils.cookies"]).directive("stScaleLine",["mapRef","stealth.core.measureService",function(a,b){function c(c,d,e){var f=new ol.control.ScaleLine;f.setTarget(d[0]),a.getMap().then(function(a){f.setMap(a),f.setUnits(b.getCurrentScaleLineUnit(!0))}),b.onScaleLineChange(function(){f.setUnits(b.getCurrentScaleLineUnit(!0))}),d.on("click",function(){b.advanceToNextScaleLineUnit()})}var d={link:c,template:"",restrict:"EA"};return d}]),angular.module("stealth.core.geo.import",["stealth.core.geo.import.category","stealth.import.wizard"]),angular.module("stealth.core.geo.import.category",["stealth.core.geo.ol3.map"]).service("ImportCache",["$rootScope","ol3Map",function(a,b){var c=0,d=[];this.addLayer=function(a){d.push(a)},this.addPlaceholderLayer=function(a){var b={_importId:++c,name:a,processing:!0};return d.push(b),b},this.completeLayer=function(e,f){_.forEach(d,function(a,b){if(a===f)return d[b]=e,e._importId=f._importId,!1}),e._importId=e._importId||++c,e.error||(e.hidden=!1,b.addLayer(e)),a.$emit("ImportCache-layerAdded")},this.removeLayer=function(c){b.getLayerById(c.id)&&b.removeLayer(c),d.indexOf(c)!==-1&&d.splice(d.indexOf(c),1),c.onDestroy&&c.onDestroy(),a.$emit("ImportCache-layerRemoved")},this.getLayers=function(){return d}}]),angular.module("stealth.core.geo.import.category",["stealth.import.wizard","stealth.core.geo.ol3.manager","stealth.core.wizard","stealth.wizard","ccri.angular-utils"]).run(["$rootScope","categoryManager","stealth.core.geo.ol3.manager.Category","ccri.angular-utils.WidgetDef","stealth.import.wizard.WizFactory","ImportCache",function(a,b,c,d,e,f){var g=a.$new();g.layers=f.getLayers(),g.removeLayer=function(a){f.removeLayer(a)},g.launchImportWiz=function(){e.launchWizard()},g.toggleVisibility=function(a){a.hidden=!a.hidden,a.getOl3Layer().setVisible(!a.hidden)};var h=new d({tag:"st-imp-category",scope:g,isolateScope:!0}),i=new c(2,"Imported Features","fa-map-o",h,null,(!0));b.addCategory(1,i)}]).directive("stImpCategory",function(){return{templateUrl:"core/geo/import/templates/impcat.tpl.html"}}),angular.module("stealth.core.geo.ol3.follow",["stealth.core.geo.ol3.map"]).service("mapFollowManager",["ol3Map",function(a){function b(a){u=a}function c(a){v=a}function d(a){w=a}function e(a){q=a.frameState.extent,r=ol.extent.getCenter(q),s=n(q,v)}function f(a){ol.extent.equals(a.oldValue.getExtent(),a.target.get(a.key).getExtent())||(i(),z())}function g(a){a.on("change:geometry",f),t.push(a),i(),k()}function h(a){for(var b=!1,c=t.length;c--;)t[c]===a&&(a.un("change:geometry",f),t.splice(c,1),b=!0);b&&i()}function i(){o=ol.extent.createEmpty();for(var a=t.length;a--;)ol.extent.extend(o,t[a].getGeometry().getExtent());p=ol.extent.getCenter(o)}function j(b){a.fit(b,!1,w,x)}function k(){var a=ol.extent.buffer(o,u/y),b=n(o,1/v),c=ol.extent.containsExtent(a,b)?a:b;ol.extent.getWidth(q)>ol.extent.getWidth(c)?j(c):z(!0)}function l(a){0!==t.length&&(ol.extent.getWidth(o)>ol.extent.getWidth(s)||ol.extent.getHeight(o)>ol.extent.getHeight(s)?j(n(o,1/v)):!a&&ol.extent.containsExtent(s,o)||m())}function m(){var a=p[0]-r[0],b=p[1]-r[1];(a||b)&&j([q[0]+a,q[1]+b,q[2]+a,q[3]+b])}function n(a,b){var c=ol.extent.getCenter(a),d=ol.extent.getWidth(a)/2,e=ol.extent.getHeight(a)/2;return[c[0]-d*b,c[1]-e*b,c[0]+d*b,c[1]+e*b]}this.followFeature=g,this.unFollowFeature=h,this.setBuffer=b,this.setLooseness=c,this.setAnimSpeed=d;var o,p,q,r,s,t=[],u=37040,v=.8,w=500,x={padding:[0,0,0,0],constrainResolution:!1},y=a.getView().getProjection().getMetersPerUnit(),z=_.debounce(l,250,{maxWait:1e3});a.on("moveend",e)}]),angular.module("stealth.core.geo.ol3.format").service("csvFormat",["stealth.core.geo.ol3.format.GeoJson",function(a){function b(a,b,c,d){var e=a;return b+=c/60,e+=b/60,d=d.toUpperCase(),"S"!==d&&"W"!==d||(e*=-1),e}function c(a,b,c){a=(a+540)%360-180;var d=Math.abs(a),e=Math.floor(d),f=(d-e)/(1/60),g=f;f=Math.floor(f);var h=(g-f)/(1/60);h=Math.round(100*h),h/=100,h>=60&&(h-=60,f+=1,f>=60&&(f-=60,e+=1)),"lon"===b?e<10?e="00"+e:e<100&&(e="0"+e):e<10&&(e="0"+e);var i=e+"°";return c.indexOf("dm")>=0&&(f<10&&(f="0"+f),i+=f+"'",c.indexOf("dms")>=0&&(h<10&&(h="0"+h),i+=h+'"')),i+="lon"===b?a<0?"W":"E":a<0?"S":"N"}function d(a,b){switch(b){case g.dmshCombined:var d=c(a[1],"lat","dms").replace(/[^0-9\.NnSs]/g,""),e=c(a[0],"lon","dms").replace(/[^0-9\.EeWw]/g,"");return[d.toUpperCase()+" "+e.toUpperCase()]}}function e(a,c){switch(c){case g.dmshCombined:var d=a[0].split(" ");d[1].search(/\D/)<7&&(d[1]="0"+d[1]);var e=d[1].length-1,f=d[0].length-1,h=b(parseInt(d[1].substr(0,3),10),parseInt(d[1].substr(3,2),10),parseFloat(d[1].substring(5,e)),d[1].substr(e,1)),i=b(parseInt(d[0].substr(0,2),10),parseInt(d[0].substr(2,2),10),parseFloat(d[0].substring(4,f)),d[0].substr(f,1));return[h,i];case g.ddCombined:var j=a[0].split(" ");return h=parseFloat(j[0]),i=parseFloat(j[1]),[h,i]}}function f(a,b,c,d){switch(b){case"LineString":var f={type:"Feature",properties:{pointData:{type:"FeatureCollection",features:[]}},geometry:{type:"LineString",coordinates:[]}};return _.each(d3.csv.parse(a),function(a,b){var g=[];_.each(d,function(b){g.push(a[b])}),g=e(g,c),f.geometry.coordinates.push(g),f.properties.pointData.features.push(new ol.Feature(_.merge(a,{id:_.now()+"_"+b,geometry:new ol.geom.Point(g)})))}),f;default:throw new Error("CSV parser cannot handle "+b)}}var g={dmshCombined:0,ddCombined:1};this.coordFormat=g,this.geoJsonToCsv=function(a,b,c){var e=[],f="";return _.each(a.properties.pointData.features,function(a){var f=d(a.getGeometry().getCoordinates(),b);_.each(c,function(b,c){a.set(b,f[c])}),e=_.union(e,_.keys(a.getProperties()))}),_.each(a.properties.pointData.features,function(a){var b=[];_.each(e,function(c){moment.isMoment(a.get(c))&&a.get(c).isValid()&&a.set(c,a.get(c).toISOString()),b.push(a.get(c))}),f+=b.join()+"\n"}),e.join()+"\n"+f},this.csvToFeatures=function(b,c,d,e){var g=new a,h=g.readFeatures(f(b.replace(/\r/g,""),c,d,e));return h}}]).factory("stealth.core.geo.ol3.format.GeoJson",[function(){var a=function(){ol.format.GeoJSON.apply(this,arguments)};return a.prototype=Object.create(ol.format.GeoJSON.prototype),a.prototype.writeFeatureObject=function(){var a=ol.format.GeoJSON.prototype.writeFeatureObject.apply(this,arguments);return null===a.properties&&(a.properties={}),a},a.prototype.writeFeaturesObject=function(){var a=ol.format.GeoJSON.prototype.writeFeaturesObject.apply(this,arguments);return _.isUndefined(a.crs)&&(a.crs={type:"name",properties:{name:this.defaultDataProjection.getCode()}}),a},a}]),angular.module("stealth.core.geo.ol3.geodetics").service("ol3Geodetics",["stealth.core.geo.ol3.geodetics.Ellipsoid",function(a){var b=function(a,b,c){var d=0;if(_.isArray(c)&&c.length>1)for(var e=1;e<c.length;e++)d+=a[b](c[e-1],c[e]);return d},c=function(a,b,c){var d=[];if(_.isArray(c)&&c.length>1)for(var e=1;e<c.length;e++)d.push(a[b].call(a,c[e-1],c[e]));return d},d=new a(6378137,1/298.257223563);this.ellipsoid=d;var e=new ol.Sphere(6371009);this.sphere=e,this.distanceVincenty=_.partial(b,d,"vincentyDistance"),this.distanceHaversine=_.partial(b,e,"haversineDistance"),this.vincentyInitialBearing=_.partial(c,d,"vincentyInitialBearing")}]).factory("stealth.core.geo.ol3.geodetics.Ellipsoid",[function(){var a=function(a,b){this.a=a,this.flattening=b,this.b=this.a*(1-this.flattening),this.eSquared=2*b-b*b,this.e=Math.sqrt(this.eSquared)};return a.prototype.vincenty=function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n=_.isUndefined(c)?1e-12:c,o=_.isUndefined(d)?100:d,p=this.flattening,q=math.unit(a[1],"deg").toNumber("rad"),r=math.unit(b[1],"deg").toNumber("rad"),s=math.unit(b[0]-a[0],"deg").toNumber("rad"),t=Math.atan((1-p)*Math.tan(q)),u=Math.cos(t),v=Math.sin(t),w=Math.atan((1-p)*Math.tan(r)),x=Math.cos(w),y=Math.sin(w),z=s,A=1/0;for(m=o;m>0;--m){g=Math.cos(z),h=Math.sin(z);var B=x*h,C=u*y-v*x*g;if(l=Math.sqrt(B*B+C*C),0===l)return{distance:0,initialBearing:0,finalBearing:0};j=v*y+u*x*g,k=Math.atan2(l,j),f=u*x*h/l,e=1-f*f,i=j-2*v*y/e,isNaN(i)&&(i=0);var D=p/16*e*(4+p*(4-3*e)),E=s+(1-D)*p*f*(k+D*l*(i+D*j*(2*i*i-1)));if(A=Math.abs(E-z),z=E,A<n)break}if(0===m)return{distance:NaN,finalBearing:NaN,initialBearing:NaN};var F=this.a*this.a,G=this.b*this.b,H=e*(F-G)/G,I=1+H/16384*(4096+H*(H*(320-175*H)-768)),J=H/1024*(256+H*(H*(74-47*H)-128)),K=J*l*(i+J/4*(j*(2*i*i-1)-J/6*i*(4*l*l-3)*(4*i*i-3)));g=Math.cos(z),h=Math.sin(z);var L=Math.atan2(x*h,u*y-v*x*g),M=Math.atan2(u*h,u*y*g-v*x);return{distance:this.b*I*(k-K),initialBearing:math.unit(L,"rad").toNumber("deg"),finalBearing:math.unit(M,"rad").toNumber("deg")}},a.prototype.vincentyDistance=function(a,b,c,d){var e=this.vincenty(a,b,c,d);return e.distance},a.prototype.vincentyFinalBearing=function(a,b,c,d){var e=this.vincenty(a,b,c,d);return e.finalBearing},a.prototype.vincentyInitialBearing=function(a,b,c,d){var e=this.vincenty(a,b,c,d);return e.initialBearing},a}]),angular.module("stealth.core.geo.ol3.interaction").service("stealth.core.geo.ol3.interaction.standard",["stealth.core.utils.keyboard",function(a){this.getModify=function(b){var c=new ol.interaction.Modify({features:b,deleteCondition:function(b){return a.isDown([46],!0)&&ol.events.condition.singleClick(b)}});return c.on("change:active",function(){c.getActive()?a.listen():a.unlisten()}),c}}]),angular.module("stealth.core.geo.ol3.layers",["stealth.core.utils"]).factory("stealth.core.geo.ol3.layers.KMLLayer",["$log","stylepicker","ol3Map","colors","stealth.core.geo.ol3.layers.MapLayer","ImportCache",function(a,b,c,d,e,f){var g="stealth.core.geo.ol3.layers.KMLLayer: ";a.debug(g+"factory started");var h=function(h){var i=h||{},j=this,k=i.queryable||!1,l=i.zIndexHint||20,m=i.dataURL,n=i.name,o={toggledOn:!0,isError:!1,errorMsg:"",fillColor:d.getColor(),size:4};j.olSourceParameters={url:m,format:new ol.format.KML};var p=new ol.source.Vector(j.olSourceParameters);j.olLayerParameters={source:p,style:b.styleFunction(o)};var q=new ol.layer.Vector(j.olLayerParameters);a.debug(g+"new Dropped Layer("+arguments[0]+")"),e.apply(j,[n,q,k,l]),j.styleDirectiveScope.styleVars.iconClass="fa fa-fw fa-lg fa-file-o",j.styleDirectiveScope.removeLayer=function(a){c.removeLayerById(a.get("id")),f.removeLayer(j)}};return h.prototype=Object.create(e.prototype),h}]),angular.module("stealth.core.geo.ol3.layers",["stealth.core.geo.ol3.format","stealth.core.geo.ol3.style","stealth.core.geo.ows","stealth.core.utils"]).constant("stealth.core.geo.ol3.layers.FeatureConstant",{removeEvent:"core.layer.feature.remove"}).run(["$rootScope","categoryManager","ImportCache","ol3Map","stealth.core.geo.ol3.layers.FeatureConstant",function(a,b,c,d,e){a.$on(e.removeEvent,function(a,e){c.removeLayer(d.getLayerById(e.layerId)),d.removeLayerById(e.layerId),e.categoryId&&b.removeCategory(e.categoryId)})}]).factory("stealth.core.geo.ol3.layers.FeatureLayer",["$log","$q","$rootScope","colors","clickSearchHelper","stealth.core.geo.ol3.layers.MapLayer","stealth.core.geo.ol3.layers.FeatureConstant","stealth.core.popup.components.fieldFormat","stylepicker",function(a,b,c,d,e,f,g,h,i){var j="stealth.core.geo.ol3.layers.FeatureLayer: ";a.debug(j+"factory started");var k=function(a){var j=this,k=a||{},l=!_.isBoolean(k.queryable)||k.queryable,m=k.zIndexHint||20,n=k.features||[],o=k.id,p=k.name,q=k.extraStyleBuilder,r=k.iconClass,s=a.featureFilterFunc||function(a){return _.pick(a.getProperties(),["id","name"])},t=k.layerThisBelongsTo;j.layerThisBelongsTo=t;var u=k.categoryId,v=k.removeEvent||g.removeEvent,w=_.merge({toggledOn:!0,isError:!1,errorMsg:"",fillColor:d.getColor(),size:4,colorById:!1},k.viewState),x=a.styleFn||function(a){var b=i.defaultStyleMatcher(a,w);return _.isFunction(q)&&Array.prototype.push.apply(b,q(w.size,w.fillColor)),b};j.olSourceParameters={features:n};var y=new ol.source.Vector(j.olSourceParameters);j.olLayerParameters={source:y};var z=new ol.layer.Vector(j.olLayerParameters);f.apply(j,[o,p,z,l,m]),j.viewState=w,j.getViewState=function(){return j.viewState};var A=a.styleFnViewState;_.isFunction(A)?j.ol3Layer.setStyle(A(j.viewState)):j.ol3Layer.setStyle(x),j.styleDirective=k.styleDirective||"st-feature-layer-style-view";var B=k.onStyleDirectiveRemoved;j.styleDirectiveScope.styleVars.iconClass="fa fa-fw fa-lg "+r,j.styleDirectiveScope.removeLayer=function(){c.$emit(v,{layerId:j.id,categoryId:u}),B&&B(j)},j.styleDirectiveScope.getViewState=function(){return j.getViewState()},j.updateMap=function(){j.ol3Layer.changed()},j.styleDirectiveScope.updateMap=function(){j.updateMap()},j.styleDirectiveScope.sizeChanged=function(a){angular.isNumber(a)||(a=1),j.ol3Layer.changed()},j.styleDirectiveScope.fillColorChanged=function(){j.ol3Layer.changed()};var C=this.getBaseCapabilities;j.getBaseCapabilities=function(){return _.merge(_.cloneDeep(C()),_.get(t,"KeywordConfig.capability"))},j.getExtent=function(){return j.ol3Layer.getSource().getExtent()},j.getSource=function(){return j.ol3Layer.getSource()},j.getOl3Layer=function(){return j.ol3Layer},j.searchPoint=function(a,c){var d,f=_.merge(j.getEmptySearchPointResult(),{getLayerLegendStyle:function(){return w.colorById?{display:"none"}:{color:w.fillColor}}}),g=e.getLayerOverrides(_.get(t,"KeywordConfig",{})),i=e.getSearchExtent(a,c,g),k=[],l=function(a){return _.omit(a.getProperties(),a.getGeometryName())};if(!w.toggledOn||w.isError)return b.when(f);y.forEachFeatureIntersectingExtent(i,function(a){var b;j.viewState.filterField&&(b=a.get(j.viewState.filterField)),(!b||b>=j.viewState.filterFieldCutoff)&&k.push(a)});var m=e.sortAndTrimFeatures(a,k);return d=_.map(m,t?l:s),b.when(_.merge(f,{isError:!1,features:d,metadata:m,dataSource:t},h.formatFromKeywords(d,t?t.KeywordConfig:{}),t?{popupOptionsOverrides:_.get(t.KeywordConfig,"click.search.customPopup")}:{}))}};return k.prototype=Object.create(f.prototype),k}]).factory("stealth.core.geo.ol3.layers.UpdatableFeatureLayer",["$log","wfs","stealth.core.geo.ol3.layers.FeatureLayer","stealth.core.geo.ol3.format.GeoJson",function(a,b,c,d){var e="stealth.core.geo.ol3.layers.UpdatableFeatureLayer: ";a.debug(e+"factory started");var f=!1,g=function(g){var h=this,i=g||{},j={};h.typeName=i.layerThisBelongsTo?i.layerThisBelongsTo.Name:"",h.geoserverUrl=i.geoserverUrl||i.layerThisBelongsTo.wfsUrl,h.query=function(c,f){j=_.merge({},j,c);var g=f||new d;_.isFunction(g.readFeatures)||a.error(e+"featureReader must be a parser having a readFeatures() function."),h.loadStart(),b.getFeature(h.geoserverUrl,h.typeName,j,void 0,!0).then(function(b){var c=b.headers("content-type");if(c.indexOf("xml")>-1)h.getViewState().isError=!0,h.getViewState().errorMsg="ows.ExceptionReport returned";else if(b.data.totalFeatures<1)a.error(e+"(2 "+h.name+") No results"),h.getViewState().isError=!0,h.getViewState().errorMsg="No results";else{var d=g.readFeatures(b.data);h.loadFeatures(d)}},function(b){var c="HTTP status "+b.status+": "+b.statusText;a.error(e+"(3 "+h.name+") "+c),h.getViewState().isError=!0,h.getViewState().errorMsg=b.statusText}).finally(h.loadEnd())},h.loadFeatures=function(a){
var b=h.ol3Layer.getSource().getFeatures();_.each(a,function(a){var c=a.getGeometry();if(c instanceof ol.geom.LineString){var d=c.getCoordinates();c.setCoordinates(_.reduce(d,function(a,b){if(_.isEmpty(a))return a.push(b),a;var c=a[a.length-1],d=c[0]-b[0];return Math.abs(d)>180?(a.push([b[0]+360*(d>=0?1:-1),b[1]]),a):(a.push(b),a)},[]))}var e=a.getId(),f=_.find(b,function(a){return a.getId()===e});_.isUndefined(f)?h.ol3Layer.getSource().addFeature(a):(_.pull(b,f),f.setGeometry(a.getGeometry()),f.setProperties(a.getProperties()))}),_.each(b,function(a){h.ol3Layer.getSource().removeFeature(a)})},h.loadStart=function(){h.styleDirectiveScope.$evalAsync(function(){f=!0,h.styleDirectiveScope.$emit(h.id+":isLoading")})},h.loadEnd=function(){h.styleDirectiveScope.$evalAsync(function(){f=!1,h.styleDirectiveScope.$emit(h.id+":finishedLoading"),_.isFunction(i.onLoad)&&i.onLoad.call(this)})},h.isLoading=function(){return f},c.call(this,g)};return g.prototype=Object.create(c.prototype),g}]).directive("stFeatureLayerStyleView",["$log",function(a){var b="stealth.core.geo.ol3.layers.stFeatureLayerStyleView: ";return a.debug(b+"directive defined"),{templateUrl:"core/geo/ol3/layers/feature-layerstyleview.tpl.html"}}]),angular.module("stealth.core.geo.ol3.layers",["ui.include","stealth.core.utils"]),angular.module("stealth.core.geo.ol3.layers",["ccri.angular-utils","stealth.core.popup.capabilities","stealth.core.utils"]).constant("stealth.core.geo.ol3.layers.defaultPopup",{table:"ccri-popup-components-paged-table",tabs:"ccri-popup-components-single-record-table"}).factory("stealth.core.geo.ol3.layers.MapLayer",["$log","$rootScope","$q","coreCapabilitiesExtender","ccri.angular-utils.WidgetDef","stealth.core.geo.ol3.layers.defaultPopup","stealth.core.geo.ol3.layers.mapLayerPopup",function(a,b,c,d,e,f,g){var h="stealth.core.geo.ol3.layers.MapLayer: ";a.debug(h+"factory started");var i=function(e,i,j,k,l,m){var n=this;this.stateManager=AppState.StateManager.getInstance(),this.layerManager=ccriMap.base.LayerManager.getInstance(),this.id=e,this.type=m||"MapLayer",this.name=i,this.ol3Layer=j,this.olLayerParameters=this.olLayerParameters||{},this.olSourceParameters=this.olSourceParameters||{},this.queryable=k,this.zIndexHint=l||0,this.reverseZIndex=-1,this.styleDirective="st-map-layer-style",this.styleDirectiveScope=null,this.styleDirectiveIsoScopeAttrs=null,this.styleMap=null,this.popupOptions={level:null,iconClass:void 0,tooltipText:null,onTabFocus:null,onTabBlur:null,directive:f.table,type:"table"};var o,p,q;this.stateManager.getState(ccriMap.base.LAYER_PATH).has(e)||this.stateManager.dispatch({type:ccriMap.base.MapLayerActions.TypeKeys.ADD_LAYER,layer:new ccriMap.base.MapLayerRecord({id:e,name:i,type:this.type})}),this.onDestroy=function(){p&&ol.Observable.unByKey(p),j=n.ol3Layer=o.ol3Layer=null,o&&o.$destroy(),o=n.styleDirectiveScope=n.popupOptions=null,q&&(q.unsubscribe(),q=null),n.styleMap=null,n.layerManager.removeLayer(n.id),n.layerManager=null,n.stateManager.dispatch({type:ccriMap.base.MapLayerActions.TypeKeys.REMOVE_LAYER,id:n.id}),n=null},j&&(o=b.$new(),o.toggleVisibility=function(){n.stateManager.dispatch({type:ccriMap.base.MapLayerActions.TypeKeys.SET_STYLE,id:n.id,style:n.styleMap.set("visible",!j.getVisible())})},o.$watch("layerState.opacity",function(a){j.setOpacity(a),n.stateManager.dispatch({type:ccriMap.base.MapLayerActions.TypeKeys.SET_STYLE,id:n.id,style:n.styleMap.set("opacity",a)})}),o.$watch("layerState.visible",function(a){j.setVisible(a)}),j.set("id",e),j.set("name",i),o.ol3Layer=j,o.fragmentUrl="core/geo/ol3/layers/layer-fragments.tpl.html",o.styleVars={iconClass:"fa fa-fw fa-lg fa-globe"},this.styleDirectiveScope=o,this.styleMap=this.stateManager.getState([ccriMap.base.LAYER_PATH,e]).style,this.setDefaultStyle("visible",j.getVisible()),this.setDefaultStyle("opacity",j.getOpacity()),q=n.stateManager.getObservable([ccriMap.base.LAYER_PATH,e]).pipe(rxjsTakeWhile(function(a){return null!==a})).subscribe({next:function(a){if(null===a)n.onDestroy();else if(n.type=a.type,n.name=a.name,n.ol3Layer.set("name",a.name),!a.style.isEmpty()){var b=n.styleMap.toJS();n.styleMap=n.styleMap.merge(a.style),o.$applyAsync(function(){null!==n&&(o.layerState=n.styleMap.toJS(),n.onLayerStateUpdate(o.layerState,b))})}}}),this.searchPoint=function(){return c.when(this.getEmptySearchPointResult())},this.getEmptySearchPointResult=function(){return{name:this.name,isError:!1,capabilities:this.getCapabilities()}},this.getBaseCapabilities=function(){return{}},this.getCapabilitiesExtender=function(){return d},this.getCapabilitiesOpts=function(){return{}},this.getCapabilities=function(){return this.getCapabilitiesExtender().extendCapabilities(this.getBaseCapabilities(),this,this.getCapabilitiesOpts())},this.buildSearchPointWidgets=function(a,b,d){if(!this.ol3Layer.getVisible())return c.when({isError:!0});var e=this.searchPoint(a,b);return _.isArray(e)||(e=[e]),_.map(e,function(a){return c.when(a).then(function(a){return d.unformattedResponse?a:n.buildSearchPointWidgetsForResponse(a,d)})})},this.buildSearchPointWidgetsForResponse=function(a,b){if(a.isError||!_.isArray(a.records)||_.isEmpty(a.records))return null;var c=_.merge({reverseZIndex:n.reverseZIndex,iconClass:n.styleDirectiveScope.styleVars.iconClass},n.popupOptions);return g.buildWidgetsForResponse(a,b,c,n.id)},this.onLayerStateUpdate=function(){}),a.debug(h+"new MapLayer("+i+")"),this.layerManager.addLayer(this)};return i.prototype.getStyleDisplayDef=function(){return this.styleDisplayDef||(this.styleDisplayDef=new e({tag:this.styleDirective,scope:this.styleDirectiveScope,attrs:this.styleDirectiveIsoScopeAttrs,isolateScope:!!this.styleDirectiveScope})),this.styleDisplayDef},i.prototype.getId=function(){return this.id},i.prototype.getConfig=function(){return this.stateManager.getState([ccriMap.base.LAYER_PATH,this.id]).config},i.prototype.setConfig=function(a){this.stateManager.dispatch({type:ccriMap.base.MapLayerActions.SET_CONFIG,id:this.id,config:a})},i.prototype.getMapLayer=function(){return this.ol3Layer},i.prototype.getLayerParameters=function(){return this.olLayerParameters},i.prototype.getSourceParameters=function(){return this.olSourceParameters},i.prototype.getOl3Layer=function(){return this.ol3Layer},i.prototype.getZIndexHint=function(){return this.zIndexHint},i.prototype.setZIndex=function(a){this.zIndex=a},i.prototype.getName=function(){return this.name},i.prototype.setName=function(a){this.stateManager.dispatch({type:ccriMap.base.MapLayerActions.TypeKeys.SET_NAME,id:this.id,name:a})},i.prototype.getType=function(){return this.type},i.prototype.setType=function(a){this.stateManager.dispatch({type:ccriMap.base.MapLayerActions.TypeKeys.SET_TYPE,id:this.id,layerType:a})},i.prototype.setDefaultStyle=function(a,b){this.styleMap=this.styleMap.set(a,this.styleMap.get(a,b)),this.styleDirectiveScope.layerState=this.styleMap.toJS()},i.prototype.getIsVisible=function(){return this.ol3Layer.getVisible()},i.prototype.search=function(a,b,c){return this.buildSearchPointWidgets(a,b,c)},i}]).directive("stMapLayerStyle",["$log",function(a){return a.debug("stealth.core.geo.ol3.layers.stMapLayerStyle: directive defined"),{template:'<ui-include src="fragmentUrl" fragment="\'.layerStyleMapLayer\'"></ui-include>'}}]),angular.module("stealth.core.geo.ol3.layers",["ccri.angular-utils"]).service("stealth.core.geo.ol3.layers.mapLayerPopup",["$rootScope","ccri.angular-utils.WidgetDef","stealth.core.geo.ol3.layers.defaultPopup",function(a,b,c){this.buildWidgetsForResponse=function(d,e,f,g){if(_.isObject(d.popupOptionsOverrides)&&(d.popupOptionsOverrides.type=d.popupOptionsOverrides.type||"tabs",d.popupOptionsOverrides.directive=d.popupOptionsOverrides.directive||c[d.popupOptionsOverrides.type],f=_.merge(f,d.popupOptionsOverrides)),"table"===f.type){var h=(e||a).$new();return h.result=d,_.each(_.get(h.result,"metadata"),function(a){a.mapLayerId=g}),h.onRemoveAll=_.noop,{level:f.level?f.level:_.padLeft(f.reverseZIndex,4,"0")+(d.levelSuffix||""),iconClass:f.iconClass,tooltipText:f.tooltipText?f.tooltipText:d.name,widgetDef:new b({tag:f.directive,scope:h,attrs:'result="result" on-remove-all="onRemoveAll"'}),onTabFocus:function(){_.isFunction(f.onTabFocus)&&f.onTabFocus(d)},onTabBlur:function(){_.isFunction(f.onTabBlur)&&f.onTabBlur(d)}}}return _.map(d.records,function(c,h){var i=(e||a).$new();return i.response=d,i.record=c,i.index=h,i.metadata=_.isArray(d.metadata)?d.metadata[h]:{},i.metadata.mapLayerId=g,i.metadata.dataSource=d.dataSource,{level:f.level?f.level:_.padLeft(f.reverseZIndex,4,"0")+"_"+_.padLeft(h,4,"0"),iconClass:f.iconClass,tooltipText:f.tooltipText?f.tooltipText:d.name,widgetDef:new b({tag:f.directive,scope:i,attrs:'response="response" record="record" index="index" metadata="metadata"'}),onTabFocus:function(){_.isFunction(f.onTabFocus)&&f.onTabFocus(c)},onTabBlur:function(){_.isFunction(f.onTabBlur)&&f.onTabBlur(c)}}})}}]),angular.module("stealth.core.geo.ol3.layers").service("pollingManager",["$log","$interval",function(a,b){var c=1e4,d=null,e=[],f=function(){_.each(e,function(a){a()})},g=function(){_.isNull(d)||(a.debug(i+": polling stopping"),b.cancel(d),d=null)},h=function(a){d=b(function(){f()},a)},i="stealth.core.geo.ol3.layers.pollingManager: ";a.debug(i+"service created."),this.addPollingListener=function(a){_.indexOf(e,a)===-1&&_.isFunction(a)&&e.push(a)},this.removePollingListener=function(a){_.pull(e,a)},this.setPollingInterval=function(b){c!==b&&(c=b,a.debug(i+": setPollingInterval("+c+")"),c<1?g():(g(),h(c),f()))},h(c)}]).service("stealth.core.geo.ol3.layers.PollableLayer",["$interval","$log","$q","pollingManager",function(a,b,c,d){var e="stealth.core.geo.ol3.layers.PollableLayer: ";b.debug(e+"service started"),this.extending=function(f){var g=function(g){function h(a){if(a=a||{},j.isLoading())p=_.merge(p,a),n=!0;else if(j.isNotVisible())p=_.merge(p,a),i&&ol.Observable.unByKey(i),i=j.getOl3Layer().once("change:visible",function(){j.refresh(p)});else{b.debug(e+": refresh layer"),l=!0,j.updateRequestParams(a);var d=_.map(o,function(b){return b(a)});c.all(d).finally(function(){l=!1}),p={}}}var i,j=this,k=!1,l=!1,m=g||{},n=!1,o=[],p={};m.preventCaching=!0,b.debug(e+"new PollableLayer"),f.call(this,_.merge({onLoad:function(){n&&(n=!1,j.refresh(p))}},m));var q={onDestroy:this.onDestroy};this.onDestroy=function(){j.cancelPolling(),q.onDestroy(),q=null,g=null,o=null,i&&ol.Observable.unByKey(i),i=null,p=null,r=null,j=null},this.refresh=h,this.addRefreshListener=function(a){_.isFunction(a)&&o.push(a)},this.removeRefreshListener=function(a){_.pull(o,a)};var r=null;this.startPolling=function(){k||(_.isNumber(g.interval)&&g.interval>0?r=a(h,1e3*g.interval):d.addPollingListener(h),k=!0)},this.cancelPolling=function(){k&&(r?(a.cancel(r),r=null):d.removePollingListener(h),k=!1)},this.isPolling=function(){return k},this.isRefreshing=function(){return l},this.isNotVisible=function(){return!j.getOl3Layer().getVisible()},m.preventInitialPolling||this.startPolling()};return g.prototype=Object.create(f.prototype),g}}]).factory("stealth.core.geo.ol3.layers.PollingImageWmsLayer",["$log","stealth.core.geo.ol3.layers.PollableLayer","stealth.core.geo.ol3.layers.WmsLayer",function(a,b,c){var d=b.extending(c),e="stealth.core.geo.ol3.layers.PollingImageWmsLayer: ";a.debug(e+"factory started");var f=function(b){a.debug(e+"new PollingImageWmsLayer("+arguments[0]+")"),d.call(this,b)};return f.prototype=Object.create(d.prototype),f}]).factory("stealth.core.geo.ol3.layers.PollingGeoJsonVectorLayer",["$log","stealth.core.geo.ol3.layers.PollableLayer","stealth.core.geo.ol3.layers.UpdatableFeatureLayer",function(a,b,c){var d=b.extending(c),e="stealth.core.geo.ol3.layers.PollingGeoJsonVectorLayer: ";a.debug(e+"factory started");var f=function(b){var c=this;a.debug(e+"new PollingGeoJsonVectorLayer("+arguments[0]+")"),d.call(this,b),c.updateRequestParams=c.query};return f.prototype=Object.create(d.prototype),f}]),angular.module("stealth.core.geo.ol3.layers").factory("stealth.core.geo.ol3.layers.TintLayer",["$log","stealth.core.geo.ol3.layers.MapLayer","CONFIG",function(a,b,c){var d="stealth.core.geo.ol3.layers.TintLayer: ";a.debug(d+"factory started");var e=function(e){a.debug(d+"new TintLayer("+arguments[0]+")");var f=new ol.geom.Polygon([[[-180,90],[180,90],[180,-90],[-180,-90],[-180,90]]]);this.olSourceParameters={features:[new ol.Feature({geometry:f})]};var g=new ol.source.Vector(this.olSourceParameters);this.olLayerParameters={source:g,opacity:0,style:new ol.style.Style({fill:new ol.style.Fill({color:"#000"})})};var h=new ol.layer.Vector(this.olLayerParameters);b.apply(this,["TintLayer","Tint",h,!1,_.get(c,"map.tintIndex",-8),"TintLayer"]);var i=this;this.setDefaultStyle("darkness",e),this.styleDirective="st-tint-layer-style",this.styleDirectiveScope.styleVars.iconClass="fa fa-fw fa-lg fa-adjust",this.styleDirectiveScope.$watch("layerState.darkness",function(a){i.setDarkness(a)}),this.setDarkness=function(a){var b=Math.min(Math.max(a,-1),1);h.setOpacity(Math.abs(b));var c=h.getStyle();c.getFill().setColor(b<0?"#fff":"#000"),h.setStyle(c),i.stateManager.dispatch({type:ccriMap.base.MapLayerActions.TypeKeys.SET_STYLE,id:i.id,style:i.styleMap.set("darkness",b)})}};return e.prototype=Object.create(b.prototype),e}]).directive("stTintLayerStyle",["$log",function(a){return a.debug("stealth.core.geo.ol3.layers.stTintLayerStyle: directive defined"),{templateUrl:"core/geo/ol3/layers/tint.tpl.html"}}]),angular.module("stealth.core.geo.ol3.layers",["stealth.core.utils"]).factory("stealth.core.geo.ol3.layers.WmsLayer",["$http","$log","$q","wfs","clickSearchHelper","cqlHelper","stealth.core.geo.ol3.layers.MapLayer","stealth.core.popup.components.fieldFormat","CONFIG",function(a,b,c,d,e,f,g,h,i){function j(b,c,d,e,f){var g={},h={headers:g,responseType:"blob"},j=c,k=function(a){b.getImage().src=j,a&&a.status<0&&_.isFunction(f)&&f(!0)},l=function(a){if(200===a.status){var c=a.headers("content-type");if(~c.indexOf("xml"))b.getImage().src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";else{var d=new FileReader;d.onloadend=function(){b.getImage().src=d.result},d.readAsDataURL(a.data)}}};if(d&&(j=c+"&unique="+_.now(),g["Cache-Control"]="no-cache, no-store"),_.isFunction(e)&&e())return void k();if(j.length>i.geoserver.maxGET||d&&bowser.chrome){var m=j.indexOf("?"),n=j.substring(0,m),o=j.substring(m+1);g["Content-Type"]="application/x-www-form-urlencoded",a.post(n,o,h).then(l,k)}else a.get(j,h).then(l,k)}var k="stealth.core.geo.ol3.layers.WmsLayer: ";b.debug(k+"factory started");var l=function(a){var l,m,n,o,p,q=a||{},r=this,s=!1,t=q.requestParams||{},u=!_.isUndefined(q.isTiled)&&q.isTiled,v=q.layerThisBelongsTo,w=_.find(_.get(i,"ogc.configs"),"primary"),x=w?w.url:_.get(i,"geoserver.defaultUrl"),y=v.wfsUrl||x+"/wfs",z=v.wmsUrl||x+"/wms",A=function(){var a=r.styleDirectiveScope;r&&a&&a.$evalAsync(function(){s=!0,a.$emit(r.id+":isLoading")})},B=function(){var a=r.styleDirectiveScope;r&&a&&a.$evalAsync(function(){s=!1,a.$emit(r.id+":finishedLoading"),_.isFunction(q.onLoad)&&q.onLoad.call(this)})},C=function(){return l?c.when(l):_.has(v.KeywordConfig,"click.search.field.geom")?(l=_.get(v.KeywordConfig,"click.search.field.geom"),c.when(l)):d.getDefaultGeometryFieldName(y,m.getParams().LAYERS,void 0,void 0,!0).then(function(a){return l=a,a})};this.layerThisBelongsTo=v,_.isUndefined(t.VERSION)&&(t.VERSION="1.1.1"),_.isUndefined(t.TRANSPARENT)&&(t.TRANSPARENT="TRUE"),_.merge(t,_.get(v.KeywordConfig,"wms.params"));var D=!1,E=function(){return D},F=function(a){D=a};if(u){var G=0;t.tiled=!0,r.olSourceParameters={url:z,params:t,tileLoadFunction:_.partialRight(j,q.preventCaching,E,F)},m=new ol.source.TileWMS(r.olSourceParameters),n=m.on("tileloadstart",function(){G+=1,A()}),o=m.on(["tileloadend","tileloaderror"],function(){G-=1,G<=0&&(G=0,B())});var H=_.parseInt(_.get(v.KeywordConfig,"capability.tiled"));H=_.isFinite(H)&&H>0?H:0,r.olLayerParameters={preload:H,source:m},p=new ol.layer.Tile(r.olLayerParameters)}else r.olSourceParameters={ratio:1,url:z,params:t,imageLoadFunction:_.partialRight(j,q.preventCaching,E,F)},m=new ol.source.ImageWMS(r.olSourceParameters),n=m.on("imageloadstart",function(){A()}),o=m.on(["imageloadend","imageloaderror"],function(){B()}),r.olLayerParameters={source:m},p=new ol.layer.Image(r.olLayerParameters);p.setOpacity(Math.min(Math.max(parseFloat(_.get(v.KeywordConfig,"wms.initialOpacity"))||q.opacity,0),1)||1),b.debug(k+"new WmsLayer("+arguments[0]+")"),g.apply(this,[q.id,q.name,p,q.queryable,q.zIndexHint,q.type]);var I={onDestroy:this.onDestroy,getBaseCapabilities:this.getBaseCapabilities,getCapabilitiesOpts:this.getCapabilitiesOpts};this.onDestroy=function(){I.onDestroy(),I=null,q=null,t=null,n&&ol.Observable.unByKey(n),n=null,o&&ol.Observable.unByKey(o),o=null,m=null,p=null,v=null,A=B=C=_.noop,r=null},this.getBaseCapabilities=function(){return _.merge(_.cloneDeep(I.getBaseCapabilities()),_.get(v,"KeywordConfig.capability"))},this.getCapabilitiesOpts=function(){return _.merge(_.cloneDeep(I.getCapabilitiesOpts()),{wfsUrl:y,layerName:v.Name,mapLayer:r})},this.updateRequestParams=function(a){a=a||{},m.updateParams(a)},this.applyCql=function(a){r.updateRequestParams({CQL_FILTER:_.isEmpty(a)||_.isEmpty(a.trim())?null:a})},this.isLoading=function(){return s},this.getSearchPointCql=function(a,b,c){return f.combine(f.operator.AND,a,f.combine(f.operator.OR,_.map(b,function(a){return f.buildBboxFilter(c,a)})))},this.searchPoint=function(a,f,g){function j(a){if(Math.abs(a)<=n)return a;var b=a%n,c=b<0?n:-n,d=c+b,e=c===d?n:d;return e}var k=this.getEmptySearchPointResult(),l=90,n=180;return C().then(function(c){var o={srsName:ol.proj.get(i.map.projection).getCode()},p=_.merge({geom:c},e.getLayerOverrides(v.KeywordConfig)),q=[];q.push(e.getSearchExtent(a,f,p));var s,t=q[0];return t[3]<-l||t[1]>l?k:((t[0]<-n||t[2]>n)&&(t[0]=j(t[0]),t[2]=j(t[2]),t[0]<0&&t[2]>0?(s=_.clone(t),t[2]=-n,s[0]=n,q.push(s)):t[2]<0&&t[0]>0&&(s=_.clone(t),s[0]=-n,t[2]=n,q.push(s))),o.CQL_FILTER=r.getSearchPointCql(m.getParams().CQL_FILTER,q,c),d.getFeature(y,_.get(v.KeywordConfig,"click.search.altLayer",m.getParams().LAYERS),_.merge(o,g),"text",!0).then(function(c){b.debug("@@@ received click search request");var d=c.data.features,f=e.sortAndTrimFeatures(a,d,p);return _.merge(k,{metadata:_.map(f,function(a){return{source:a}}),getLayerLegendStyle:function(){return{display:"none"}},popupOptionsOverrides:_.get(v.KeywordConfig,"click.search.customPopup"),dataSource:v},h.formatFromKeywords(_.pluck(f,"properties"),v.KeywordConfig))},function(){return _.merge(k,{isError:!0,reason:"Server error"})}))},function(a){return ccriCorealerter.alerter.errorMsg("Failed to search "+q.name+". "+a,"Search Error",{timeOut:15e3}),c.when(_.merge(k,{isError:!0,reason:a}))})},this.getGeomField=function(){return C()}};return l.prototype=Object.create(g.prototype),l.loadFunction=j,l}]),angular.module("stealth.core.geo.ol3.layers",["stealth.core.utils"]).factory("stealth.core.geo.ol3.layers.XYZLayer",["$log","stealth.core.geo.ol3.layers.MapLayer",function(a,b){var c="stealth.core.geo.ol3.layers.XYZLayer: ";a.debug(c+"factory started");var d=function(a){var c,d,e=a||{},f=this,g=!1,h=e.serverUrl,i=function(){f.styleDirectiveScope.$evalAsync(function(){g=!0,f.styleDirectiveScope.$emit(f.id+":isLoading")})},j=function(){f.styleDirectiveScope.$evalAsync(function(){g=!1,f.styleDirectiveScope.$emit(f.id+":finishedLoading"),_.isFunction(e.onLoad)&&e.onLoad.call(this)})};f.olSourceParameters={projection:ol.proj.get(e.originalProjection),tileSize:e.tileSize||256,wrapX:!_.isBoolean(e.wrapX)||e.wrapX,minZoom:e.minZoom,maxZoom:e.maxZoom},c=new ol.source.XYZ(f.olSourceParameters);var k=/\{z(\s*[-+]{1}\s*[0-9]+)\}/g,l=/\{x(\s*[-+]{1}\s*[0-9]+)\}/g,m=/\{y(\s*[-+]{1}\s*[0-9]+)\}/g,n=h.match(k),o=h.match(l),p=h.match(m);n||o||p?c.setTileUrlFunction(function(a){var b=h;return b=n?b.replace(k,function(b,c){return a[0]+parseInt(c.replace(/\s*/g,""),10)}):b.replace(/\{z\}/g,a[0]),b=o?b.replace(l,function(b,c){return a[1]+parseInt(c.replace(/\s*/g,""),10)}):b.replace(/\{x\}/g,a[1]),b=p?b.replace(m,function(b,c){return-a[2]-1+parseInt(c.replace(/\s*/g,""),10)}):b.replace(/\{y\}/g,-a[2]-1)}):c.setUrl(h),c.on("imageloadstart",function(){i()}),c.on(["imageloadend","imageloaderror"],function(){j()}),f.olLayerParameters={source:c},d=new ol.layer.Tile(f.olLayerParameters),_.isNumber(e.opacity)&&d.setOpacity(Math.min(Math.max(e.opacity,0),1)),b.apply(this,[e.id,e.name,d,e.queryable,e.zIndexHint,e.type]),this.isLoading=function(){return g}};return d.prototype=Object.create(b.prototype),d}]),angular.module("stealth.core.geo.ol3.manager",["ui.sortable","stealth.core.sidebar","stealth.core.startmenu","stealth.core.geo.ol3.map","ccri.angular-utils"]).run(["$rootScope","CONFIG","sidebarManager","startMenuManager","ccri.angular-utils.WidgetDef",function(a,b,c,d,e){var f=a.$new(),g=b.map.mapManagerViews||[];f.dot={view:g[0]};var h=c.addButton("Layer Manager","ccri-icon ccri-icon-layers",350,new e({tag:"st-ol3-manager",attrs:'view="dot.view"',scope:f,isolateScope:!0}),g.length>1?new e({tag:"st-ol3-manager-view-switcher",attrs:'view="dot"',scope:f,isolateScope:!0}):null,!0);b.map.startupMapManagerOpen===!0&&c.toggleButton(h,!0),d.addButton("Layer Manager","ccri-icon ccri-icon-layers",function(){c.toggleButton(h,!0)}),f=g=null}]).directive("stOl3ManagerViewSwitcher",["$log",function(a){return a.debug("stealth.core.geo.ol3.manager.stOl3ManagerViewSwitcher: directive defined"),{restrict:"E",replace:!0,scope:{dot:"=view"},template:'<div class="btn-group ol3ManagerViewSwitcher">                       <label ng-repeat="v in ::views" class="btn btn-default"                        ng-model="dot.view" uib-btn-radio="\'{{::v}}\'">{{::v | lodash:\'capitalize\'}}</label>                   </div>',controller:["$scope","CONFIG",function(a,b){var c=a.$on("$destroy",function(){c(),c=null,a.views=null,a=null});a.views=b.map.mapManagerViews||[]}]}}]).directive("stOl3Manager",["$log","ol3Map","categoryManager",function(a,b,c){return a.debug("stealth.core.geo.ol3.manager.stOl3Manager: directive defined"),{restrict:"E",replace:!0,scope:{view:"="},templateUrl:"core/geo/ol3/manager/manager.tpl.html",controller:["$scope",function(a){var d=AppState.StateManager.getInstance(),e=d.getObservable(["OlMaps","RootMap","layers"]).subscribe({next:function(){a.$evalAsync(function(){a.layers=b.getLayersReversed()})}}),f=a.$on("$destroy",function(){f(),f=null,e.unsubscribe(),e=null,a.map=a.catMgr=a.layers=a.sortableOptions=null,a=null});a.map=b,a.catMgr=c,a.layers=b.getLayersReversed(),a.sortableOptions={stop:function(a,c){var d=c.item.sortable;d&&_.isNumber(d.dropindex)&&_.isNumber(d.index)&&d.index!==d.dropindex&&b.moveLayer(d.index,d.dropindex)}}}]}}]).directive("stCategoryResizable",function(){return{restrict:"A",scope:{category:"="},link:function(a,b){var c=a.$on("$destroy",function(){c(),c=null,a=b=null});b.children().css("max-height",(a.category.height||250)+"px"),b.resizable({handles:"s",start:function(){b.css("max-height",""),b.children().css("max-height","")},stop:function(b,c){a.$evalAsync(function(){a.category.height=c.size.height})}})}}}).service("categoryManager",[function(){var a=[];this.addCategory=function(b,c){if(_.isArray(a[b])){var d=_.sortedIndex(a[b],{order:c.order+1},"order");a[b].splice(d,0,c)}else a[b]=[c];return c},this.removeCategory=function(b){_.each(a,function(a){var c=_.remove(a,{id:b});_.isEmpty(c)||_.each(c,function(a){_.isFunction(a.onClose)&&a.onClose()})})},this.getLevels=function(){return _.range(a.length)},this.getLevel=function(b){return a[b]},this.getCategories=function(){return _.flatten(a,!0)}}]).factory("stealth.core.geo.ol3.manager.Category",[function(){var a=0,b=function(b,c,d,e,f,g,h,i){this.id=a++,this.order=b,this.iconClass=d,this.title=c,this.contentDef=e,this.toolDef=f,this.toggledOn=g,this.closable=h,this.onClose=i};return b}]),angular.module("stealth.core.geo.ol3.map",["ccri.bars","stealth.core.geo.controls","stealth.core.geo.ol3.layers","stealth.core.interaction.mapclick","stealth.display"]).constant("stealth.core.geo.ol3.map.Events",{addLayer:"ol3.map.event:addLayer",removeLayer:"ol3.map.event:removeLayer",updateLayer:"ol3.map.event:updateLayer"}).run(["$rootScope","ccri.angular-utils.WidgetDef","ccri.bars.mgr","ccri.bars.Widget","stealth.display.registry","stealth.display.View",function(a,b,c,d,e,f){var g=[new d({widget:new b({tag:"ccri-bars-separator",scope:a.$new()})}),new d({widget:new b({tag:"div",attrs:'st-mouse-position style="width:200px;"',scope:a.$new()})}),new d({widget:new b({tag:"div",attrs:'st-scale-line style="width:170px;" class="clickable noselect" uib-tooltip="Click to change units" tooltip-class="nowrap" tooltip-placement="top" tooltip-animation="false" tooltip-append-to-body="true" tooltip-popup-delay="500" tooltip-trigger="mouseenter" ',scope:a.$new()})}),new d({widget:new b({tag:"st-rotate-control",scope:a.$new()})})];_.each(g,function(b){c.insert("bottom",b,ccriBars.Position[ccriBars.Position.Last],800),e.on("display.selected",function(c){"map"===c.type&&a.$evalAsync(function(){b.hidden=!c.selected})})}),e.insert(new f({id:"map",type:"map",name:"Map",widget:new b({tag:"st-ol3-map"}),iconClass:"fa-map",active:!0}),"100")}]).directive("stOl3Map",["$log","$interval","ol3Map","CONFIG",function(a,b,c,d){return a.debug("stealth.core.geo.ol3.map.stOl3Map: directive defined"),{restrict:"E",replace:!0,template:'<div class="anchorAll ol3Map" tabindex="-1" onclick="this.focus()"></div>',link:function(a,e,f){function g(){return i.getState("map")}function h(a){a.center&&c.getView().setCenter(a.center),a.zoom&&c.getView().setZoom(a.zoom)}var i=AppState.StateManager.getInstance(),j=_.throttle(function(){c.getMap().updateSize()},10),k=b(function(){var f=e.css("display");if("none"!==f){b.cancel(k),c.setTarget(e[0]),a.$watch(function(){return e.width()},function(){j()}),a.$watch(function(){return e.height()},function(){j()}),_.eq(c.getCenter(),[0,0])&&(d.map.extent&&ol.extent.containsExtent(d.map.initExtent,d.map.extent)?c.fit(d.map.extent,!0):c.fit(d.map.initExtent,!0));var l=g();if(l)h(l);else var m=i.getObservable("map").subscribe({next:function(a){h(a),m.unsubscribe()}})}},100)}}}]).service("ol3Map",["$log","$rootScope","mapRef","stealth.core.geo.ol3.layers.TintLayer","CONFIG","stealth.core.geo.ol3.map.Events",function(a,b,c,d,e,f){a.debug("stealth.core.geo.ol3.map.ol3Map: service started");var g=ccriMap.ol.OlMapManager.getInstance().getMap("RootMap");c.setMap(g.getMap()),g.on("moveend",function(a){var b,c=a.frameState.viewState.center,d=c[0];d>180?(d>540&&(d=(d-180)%360+180),b=d-360):d<-180&&(d<-540&&(d=(d+180)%-360-180),b=d+360),isNaN(b)||(g.panTo([b,c[1]],{duration:0}),a.stopPropagation())}),this.getMap=function(){return g.getMap()},this.setTarget=function(a){g.setTarget(a)},this.fit=function(a,b,c,d){g.fit(a,_.extend({duration:b?0:c,padding:[0,0,0,400]},d))},this.panTo=function(a,b,c){g.panTo(a,{duration:b?0:c})},this.getExtent=function(){return g.getMapExtent()},this.getSize=function(){return g.getSize()},this.getLayersReversed=function(){return g.getLayers().toArray()},this.getView=function(){return g.getMap().getView()},this.addLayer=function(a,c){return g.addLayer(a,c),b.$emit(f.addLayer,a),a},this.removeLayer=function(a){g.removeLayer(a),b.$emit(f.removeLayer,a)},this.removeLayerById=function(a){var b=_.find(this.getLayersReversed(),{id:a});b&&this.removeLayer(b)},this.clear=function(){g.clear()},this.getLayerById=function(a){return g.getLayerById(a)},this.getLayers=function(){return g.getMap().getLayers()},this.moveLayer=function(a,b){a!==b&&g.moveLayer(a,b)},this.getInteractions=function(){return g.getMap().getInteractions()},this.addInteraction=function(a){a.setActive(!0),g.getMap().addInteraction(a)},this.removeInteraction=function(a){g.getMap().removeInteraction(a),a.setActive(!1)},this.addOverlay=function(a){return g.getMap().addOverlay(a),a},this.removeOverlay=function(a){g.getMap().removeOverlay(a)},this.addLayerOverlay=function(a){a.setMap(g.getMap())},this.removeLayerOverlay=function(a){a.setMap(null)},this.on=function(a,b,c){return g.on(a,b,c)},this.un=function(a,b,c){g.off(a,b,c)},this.unByKey=function(a){ol.Observable.unByKey(a)},this.getResolution=function(){return g.getResolution()},this.getCenter=function(){return g.getCenter()},this.getEventPixel=function(a){return g.getEventPixel(a)},this.searchLayers=function(a,b,c,d,e){return g.searchLayers(a,b,c,d,e)},this.addLayer(new d(e.map.initTint||0))}]),angular.module("stealth.core.geo.ol3",["stealth.core.geo.ol3.follow","stealth.core.geo.ol3.format","stealth.core.geo.ol3.interaction","stealth.core.geo.ol3.layers","stealth.core.geo.ol3.manager","stealth.core.geo.ol3.overlays","stealth.core.geo.ol3.style"]),angular.module("stealth.core.geo.ol3.overlays",["stealth.core.geo.ol3.map"]).factory("stealth.core.geo.ol3.overlays.Vector",["ol3Map",function(a){var b=["#ff0080","#00ff00","#00ffeb","#ff9933","#ccff00"],c=function(a){return new ol.style.Style({image:new ol.style.RegularShape({fill:new ol.style.Fill({color:"rgba(0,0,0,0)"}),points:4,radius:20,stroke:new ol.style.Stroke({color:a,width:3})})})},d=function(d){var e=d||{},f=0,g=e.colors||b,h=e.styleBuilder||c,i=function(a,b){var c=g[f];_.contains(a.getKeys(),"vectorOverlayColorIndex")&&(c=g[a.get("vectorOverlayColorIndex")%g.length]);var d=h(c,a,b);return _.isArray(d)?d:[d]},j=new ol.Collection,k=new ol.source.Vector({features:j,useSpatialIndex:!1}),l=new ol.layer.Vector(_.merge({source:k,style:i},e.layerOpts));this.getFeatures=function(){return j},this.addFeature=function(a){var b;return _.contains(a.getKeys(),"vectorOverlayColorIndex")?b=g[a.get("vectorOverlayColorIndex")%g.length]:(a.set("vectorOverlayColorIndex",f),b=g[f],f=(f+1)%g.length),k.addFeature(a),b},this.removeFeature=function(a){k.removeFeature(a)},this.addToMap=function(){a.addLayerOverlay(l)},this.removeFromMap=function(){a.removeLayerOverlay(l)},this.setOpacity=function(a,b){l.setOpacity(a),b||l.changed()},this.setVisible=function(a){l.setVisible(a)},this.clear=function(){k.clear()}};return d}]),angular.module("stealth.core.geo.ol3.style").service("ol3Styles",["colors",function(a){this.getLineStyle=function(a,b){return new ol.style.Style({stroke:new ol.style.Stroke({color:"#FFFFFF",width:a+2})}),new ol.style.Style({stroke:new ol.style.Stroke({color:"#000000",width:a+1})}),new ol.style.Style({stroke:new ol.style.Stroke({color:b,width:a})})},this.getPolyStyle=function(b,c,d){c&&!d&&(d=c);var e={stroke:new ol.style.Stroke({color:d,width:b})};return c&&(e=_.merge(e,{fill:new ol.style.Fill({color:a.hexStringToRgbArray(c).concat(.4)})})),new ol.style.Style(e)},this.getPointStyle=function(a,b){return new ol.style.Style({image:new ol.style.Circle({radius:a,fill:new ol.style.Fill({color:b}),stroke:new ol.style.Stroke({color:"#FFFFFF",width:1})})})},this.fillFromConfig=function(a){return _.has(a,"fill")?new ol.style.Fill(a.fill):void 0},this.strokeFromConfig=function(a){return _.has(a,"stroke")?new ol.style.Stroke(a.stroke):void 0},this.textFromConfig=function(a){var b=a;return b.fill=this.fillFromConfig(b),b.stroke=this.strokeFromConfig(b),new ol.style.Text(b)},this.styleFromConfig=function(a){var b={};return b.fill=this.fillFromConfig(a),b.stroke=this.strokeFromConfig(a),_.has(a,"text")&&(b.text=this.textFromConfig(a.text)),new ol.style.Style(b)}}]),angular.module("stealth.core.geo.ol3.utils",["stealth.core.geo.ol3.geodetics"]).constant("stealth.core.geo.ol3.utils.numberDotStyle",{style:function(){return function(a){return[new ol.style.Style({image:new ol.style.Circle({radius:9,fill:new ol.style.Fill({color:"#BDDADA"}),stroke:new ol.style.Stroke({color:"#000000",width:2})}),text:new ol.style.Text({textAlign:"center",textBaseline:"middle",text:a.get("name"),fill:new ol.style.Fill({color:"#000"}),stroke:new ol.style.Stroke({color:"#000",width:1}),offsetX:-.5,offsetY:1})})]}}}).service("stealth.core.geo.ol3.utils.geomHelper",[function(){var a=function(a){var b=_.size(a);
return 2===b?[a[1],a[0]]:3===b?[a[1],a[0],a[2]]:a},b=function(c){return _.isArray(c[0])?_.map(c,b):a(c)};this.flipXY=function(a){a.setCoordinates(b(a.getCoordinates()))},this.polygonFromExtent=function(a){return this.polygonFromExtentParts(a[0],a[1],a[2],a[3])},this.polygonFromExtentParts=function(a,b,c,d){return new ol.geom.Polygon([[[a,b],[a,d],[c,d],[c,b],[a,b]]])}}]).service("stealth.core.geo.ol3.utils.routeDrawHelper",["ol3Geodetics",function(a){this.initFeature=function(b,c,d){var e=b.getGeometry().getCoordinates();c.routeInfo={coords:e,meters:a.distanceVincenty(e)},b.get("pointData")||(b.set("pointData",{type:"FeatureCollection",features:[]}),_.each(e,function(a,c){b.get("pointData").features.push(new ol.Feature({id:_.now()+"_"+c,geometry:new ol.geom.Point(a)}))})),b.changeListenerKey=b.on("change",function(b){var d=b.target.getGeometry().getCoordinates();c.$evalAsync(function(){c.routeInfo.coords=d,c.routeInfo.meters=a.distanceVincenty(d)});var e={type:"FeatureCollection",features:[]};_.each(b.target.getGeometry().getCoordinates(),function(a,c){var d=_.now()+"_"+c,f=new ol.Feature({id:d,geometry:new ol.geom.Point(a)}),g=_.find(b.target.get("pointData").features,{id:d});g&&(f.properties=g.properties),e.features.push(f)}),b.target.set("pointData",e)}),c.$evalAsync(function(){c.geoFeature=b,_.isFunction(d)&&d()})},this.detachFeature=function(a){a.changeListenerKey&&ol.Observable.unByKey(a.changeListenerKey),delete a.changeListenerKey,a.set("pointData",{})}}]).service("stealth.core.geo.ol3.utils.trackDrawHelper",["ol3Geodetics","$timeout",function(a,b){var c=this;this.initFeature=function(a,b,d){if(!a.get("pointData")){var e=_.map(a.getGeometry().getCoordinates(),function(a,b){var c=new ol.Feature({id:_.now()+"_"+b,dtgIsInterpolated:!1,dtg:"",geometry:new ol.geom.Point(a)});return c.linkDtg=c.get("dtg"),c});a.set("pointData",{type:"FeatureCollection",features:e})}this.initTrackInfo(a,b),a.changeListenerKey=a.on("change",function(a){c.mapDrawChangeListener(a,b)}),b.$evalAsync(function(){b.geoFeature=a,_.isFunction(d)&&d()})},this.mapDrawChangeListener=function(c,d){var e=c.target.getGeometry().getCoordinates(),f=e.length-1,g=c.target.get("pointData").features;b(function(){d.trackInfo.meters=a.distanceVincenty(e)}),g.length===e.length?_.each(e,function(a,b){g[b].getGeometry().setCoordinates(a)}):g.push(new ol.Feature({id:_.now()+"_"+f,dtgIsInterpolated:!1,dtg:"",geometry:new ol.geom.Point(e[f])}))},this.loadFeature=function(a,b){this.initTrackInfo(a,b),_.each(a.get("pointData").features,function(a){a.get("dtg")&&(a.set("dtg",moment(a.get("dtg"),moment.ISO_8601).utc()),a.linkDtg=a.get("dtg")),a.get("dtgIsInterpolated")!==!0&&a.set("dtgIsInterpolated","true"===a.get("dtgIsInterpolated"))}),b.featureOverlay.getFeatures().clear(),b.featureOverlay.addFeature(a),b.geoFeature=a,this.updateAvgSpeed(b)},this.detachFeature=function(a){a.changeListenerKey&&ol.Observable.unByKey(a.changeListenerKey),delete a.changeListenerKey},this.initTrackInfo=function(b,c){c.trackInfo={meters:a.distanceVincenty(b.getGeometry().getCoordinates()),pdFeatures:b.get("pointData").features,avgSpeed:"unknown"}},this.updateAvgSpeed=function(a){var b=a.geoFeature.get("pointData").features,c=b[0].get("dtg"),d=b[b.length-1].get("dtg");if(this.validateDtgFields(a),moment.isMoment(c)&&c.isValid()&&moment.isMoment(d)&&d.isValid()&&a.trackInfo.meters>0){var e=d.diff(c,"seconds");a.trackInfo.avgSpeed=(a.trackInfo.meters/e).toFixed(3)+" m/s"}else a.trackInfo.avgSpeed="unknown"},this.validateDtgFields=function(a){a.trackInfo.allDtgValid=!0,_.each(a.geoFeature.get("pointData").features,function(b){var c=b.get("dtg");if(!moment.isMoment(c)||!c.isValid())return void(a.trackInfo.allDtgValid=null)})},this.interpolateTimes=function(b,c){var d=null,e=0,f=null,g=0,h=null,i=b.length-1,j=function(d,e){if(b[d].get("dtgIsInterpolated")||!moment.isMoment(b[d].get("dtg"))||!b[d].get("dtg").isValid()){var f=a.distanceVincenty([c[d],c[e]]),g=f/h;d<e?b[d].set("dtg",b[e].get("dtg").clone().subtract(g)):b[d].set("dtg",b[e].get("dtg").clone().add(g)),b[d].linkDtg=b[d].get("dtg"),b[d].set("dtgIsInterpolated",!0)}};return _.each(b,function(b,k){if(f&&(g+=a.distanceVincenty([c[k-1],c[k]])),moment.isMoment(b.get("dtg"))&&b.get("dtg").isValid()&&!b.get("dtgIsInterpolated")){if(f){var l=b.get("dtg").diff(f);if(l<0)return d="Out of order time at point #"+(k+1),!1;if(0===l)return d="Duplicate time at point #"+(k+1),!1;h=g/l,_.each(_.range(e,k).reverse(),function(a){j(a,a+1)}),e=k+1}f=b.get("dtg"),g=0}else if(k===i){if(!h)return d="Track must contain at least 2 non-estimated times.",!1;_.each(_.range(e,i+1),function(a){j(a,a-1)})}}),d}}]).service("stealth.core.geo.ol3.utils.sitesDrawHelper",["$timeout",function(a){this.initFeature=function(b,c,d){a(function(){c.geoFeature||(c.geoFeature=b),c.sitesInfo||(c.sitesInfo={nameCounter:1}),c.sitesInfo.pdFeatures=c.geoFeature}),c.$evalAsync(function(){_.isFunction(d)&&d()})},this.detachFeature=function(a){a.changeListenerKey&&ol.Observable.unByKey(a.changeListenerKey),delete a.changeListenerKey}}]),angular.module("stealth.core.geo.ol3.zoom",["stealth.core.geo.ol3.map","stealth.display"]).run(["$rootScope","ccri.angular-utils.WidgetDef","ccri.bars.mgr","ccri.bars.Widget","stealth.display.registry",function(a,b,c,d,e){var f=new d({widget:new b({tag:"st-zoom",scope:a.$new()})});c.insert("top",f,ccriBars.Position[ccriBars.Position.Last],770),e.on("display.selected",function(b){"map"===b.type&&a.$evalAsync(function(){f.hidden=!b.selected})})}]).directive("stZoom",["ol3Map",function(a){return{restrict:"EA",templateUrl:"core/geo/ol3/zoom.tpl.html",controller:["$scope",function(b){var c,d,e;b.zoomByDelta=function(b){c=a.getView(),d=c.getResolution(),d&&(e=c.constrainResolution(d,b),c.animate({duration:250,easing:ol.easing.easeOut,resolution:e}))}}]}}]),window.OpenLayers&&(OpenLayers.Format.CQL_fixed=function(){function a(a,b){return b instanceof RegExp?b.exec(a):b(a)}function b(b,c){var d,e,g=c.length;for(d=0;d<g;d++){e=c[d];var h=f[e],i=a(b,h);if(i){var j=i[0],k=b.substr(j.length).replace(/^\s*/,"");return{type:e,text:j,remainder:k}}}var l="ERROR: In parsing: ["+b+"], expected one of: ";for(d=0;d<g;d++)e=c[d],l+="\n    "+e+": "+f[e];throw new Error(l)}function c(a){var c,d=[],e=["NOT","GEOMETRY","SPATIAL","PROPERTY","LPAREN"];do{if(c=b(a,e),a=c.remainder,e=g[c.type],"END"!==c.type&&!e)throw new Error("No follows list for "+c.type);d.push(c)}while("END"!==c.type);return d}function d(a){function b(){var a=d.pop();switch(a.type){case"LOGICAL":var c=b(),e=b();return new OpenLayers.Filter.Logical({filters:[e,c],type:j[a.text.toUpperCase()]});case"NOT":var f=b();return new OpenLayers.Filter.Logical({filters:[f],type:OpenLayers.Filter.Logical.NOT});case"BETWEEN":var g,i,k;return d.pop(),i=b(),g=b(),k=b(),new OpenLayers.Filter.Comparison({property:k,lowerBoundary:g,upperBoundary:i,type:OpenLayers.Filter.Comparison.BETWEEN});case"COMPARISON":var l=b();return new OpenLayers.Filter.Comparison({property:b(),value:l,type:h[a.text.toUpperCase()]});case"IS_NULL":return new OpenLayers.Filter.Comparison({property:b(),type:h[a.text.toUpperCase()]});case"VALUE":var m=a.text.match(/^'(.*)'$/);return m?m[1].replace(/''/g,"'"):Number(a.text);case"SPATIAL":switch(a.text.toUpperCase()){case"BBOX":var n=b(),o=b(),p=b(),q=b(),r=b();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,property:r,value:OpenLayers.Bounds.fromArray([q,p,o,n])});case"INTERSECTS":return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.INTERSECTS,property:b(),value:b()});case"WITHIN":return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.WITHIN,property:b(),value:b()});case"CONTAINS":return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.CONTAINS,property:b(),value:b()});case"DWITHIN":var s=b();return new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,value:b(),property:b(),distance:Number(s)})}break;case"GEOMETRY":return OpenLayers.Geometry.fromWKT(a.text);default:return a.text}}for(var c=[],d=[];a.length;){var e=a.shift();switch(e.type){case"PROPERTY":case"GEOMETRY":case"VALUE":d.push(e);break;case"COMPARISON":case"BETWEEN":case"IS_NULL":case"LOGICAL":for(var f=l[e.type];c.length>0&&l[c[c.length-1].type]<=f;)d.push(c.pop());c.push(e);break;case"SPATIAL":case"NOT":case"LPAREN":c.push(e);break;case"RPAREN":for(;c.length>0&&"LPAREN"!==c[c.length-1].type;)d.push(c.pop());c.pop(),c.length>0&&"SPATIAL"===c[c.length-1].type&&d.push(c.pop());break;case"COMMA":case"END":break;default:throw new Error("Unknown token type "+e.type)}}for(;c.length>0;)d.push(c.pop());var g=b();if(d.length>0){for(var i="Remaining tokens after building AST: \n",k=d.length-1;k>=0;k--)i+=d[k].type+": "+d[k].text+"\n";throw new Error(i)}return g}var e,f={PROPERTY:/^[_a-zA-Z]\w*/,COMPARISON:/^(=|<>|<=|<|>=|>|LIKE)/i,IS_NULL:/^IS NULL/i,COMMA:/^,/,LOGICAL:/^(AND|OR)/i,VALUE:/^('([^']|'')*'|-?\d+(\.\d*)?|\.\d+)/,LPAREN:/^\(/,RPAREN:/^\)/,SPATIAL:/^(BBOX|INTERSECTS|DWITHIN|WITHIN|CONTAINS)/i,NOT:/^NOT/i,BETWEEN:/^BETWEEN/i,GEOMETRY:function(a){var b=/^(POINT|LINESTRING|POLYGON|MULTIPOINT|MULTILINESTRING|MULTIPOLYGON|GEOMETRYCOLLECTION)/.exec(a);if(b){var c=a.length,d=a.indexOf("(",b[0].length);if(d>-1)for(var e=1;d<c&&e>0;)switch(d++,a.charAt(d)){case"(":e++;break;case")":e--}return[a.substr(0,d+1)]}},END:/^$/},g={LPAREN:["GEOMETRY","SPATIAL","PROPERTY","VALUE","LPAREN"],RPAREN:["NOT","LOGICAL","END","RPAREN"],PROPERTY:["COMPARISON","BETWEEN","COMMA","IS_NULL"],BETWEEN:["VALUE"],IS_NULL:["END"],COMPARISON:["VALUE"],COMMA:["GEOMETRY","VALUE","PROPERTY"],VALUE:["LOGICAL","COMMA","RPAREN","END"],SPATIAL:["LPAREN"],LOGICAL:["NOT","VALUE","SPATIAL","PROPERTY","LPAREN"],NOT:["PROPERTY","LPAREN"],GEOMETRY:["COMMA","RPAREN"]},h={"=":OpenLayers.Filter.Comparison.EQUAL_TO,"<>":OpenLayers.Filter.Comparison.NOT_EQUAL_TO,"<":OpenLayers.Filter.Comparison.LESS_THAN,"<=":OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO,">":OpenLayers.Filter.Comparison.GREATER_THAN,">=":OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO,LIKE:OpenLayers.Filter.Comparison.LIKE,BETWEEN:OpenLayers.Filter.Comparison.BETWEEN,"IS NULL":OpenLayers.Filter.Comparison.IS_NULL},i={},j={AND:OpenLayers.Filter.Logical.AND,OR:OpenLayers.Filter.Logical.OR},k={},l={RPAREN:3,LOGICAL:2,COMPARISON:1};for(e in h)h.hasOwnProperty(e)&&(i[h[e]]=e);for(e in j)j.hasOwnProperty(e)&&(k[j[e]]=e);return OpenLayers.Class(OpenLayers.Format.CQL,{read:function(a){var b=d(c(a));return this.keepData&&(this.data=b),b},CLASS_NAME:"OpenLayers.Format.CQL_fixed"})}()),angular.module("stealth.core.geo.ows",["ccri.angular-utils"]).service("owsLayers",["$filter","wms","stealth.core.geo.ows.KeywordExtender","CONFIG",function(a,b,c,d){var e=this,f=null,g=!0;_.get(d,"geoserver.disableCapabilitiesRefresh")===!0&&(g=!1),this.getLayers=function(a,c){return c&&g&&(f=null),_.isNull(f)&&(f=b.getCapabilities(d.geoserver.defaultUrl,c).then(function(a){var b=a.Capability.Layer.Layer||[];return b},function(){return[]}).then(function(a){return _.each(d.map.extraLayers,function(b){!b.Title&&b.Name&&(b.Title=b.Name),a.push(b)}),_.each(a,function(a){e.getKeywordConfig(a)}),a})),f.then(function(b){return _.isString(a)||_.isArray(a)?_.filter(b,function(b){return _.has(b.KeywordConfig,a)}):b})},this.getKeywordConfig=function(b){b.KeywordConfig={},_.eachRight(_.sortByOrder(b.KeywordList,[_.identity],[!1]),function(c){if(0===c.indexOf(d.app.context+".")){var e=a("splitLimit")(c,"=",1),f=_.map(_.rest(e[0].split(".")),function(a){return a.replace("%2E",".")});_.has(b.KeywordConfig,f)||_.set(b.KeywordConfig,f,e[1]||{})}}),delete b.KeywordList,delete b.CRS,b.KeywordConfig=e.keywordExtender.extendKeywords(b.KeywordConfig)},this.keywordExtender=new c}]).factory("stealth.core.geo.ows.KeywordExtender",[function(){var a=function(){var a=[];this.extendKeywords=function(b){return _.each(a,function(a){_.isFunction(a)?b=a.call(this,b):_.isObject(a)&&_.isFunction(a.extendKeywords)&&(b=a.extendKeywords.call(this,b))}),b},this.addKeywordExtender=function(b){a.push(b)}};return a}]),angular.module("stealth.core.geo.ows").service("wfs",["$q","$filter","$http","CONFIG",function(a,b,c,d){var e,f,g,h={},i={},j=new ol.format.WFS,k=new XMLSerializer;window.OpenLayers&&(e=new OpenLayers.Format.CQL_fixed,f=new OpenLayers.Format.Filter({version:"1.1.0",srsName:"EPSG:4326"}),g=new OpenLayers.Format.XML);var l=function(a,b){return c.get(a,{params:{service:"WFS",version:"1.0.0",request:"DescribeFeatureType",typeName:b,outputFormat:"application/json"},timeout:3e4})},m=function(b,e,f,g){var h,i,j={service:"WFS",version:"1.0.0",request:"GetFeature",typeName:e,outputFormat:"application/json",srsName:"EPSG:4326"},k=_.merge(j,f),l=$.param(k);return i=l.length>d.geoserver.maxGET?c.post(b,l,{headers:{"Content-Type":"application/x-www-form-urlencoded"},responseType:g||"text"}):c.get(b,{params:k,responseType:g||"text"}),i.then(function(b){var c=b.headers("content-type");return~c.indexOf("xml")?(h="Geoserver ExceptionReport",a.reject(_.merge(b,{error:new Error(h)}))):0===b.data.byteLength?(h="No Results",a.reject(_.merge(b,{error:new Error(h)}))):b},function(b){return h=b.status+b.statusText,a.reject(_.merge(b,{error:new Error(h)}))})};this.getFeatureTypeDescription=function(c,d,e,f){return c=f?c:b("uriCat")(c,"/wfs"),!e&&angular.isDefined(h[c])&&angular.isDefined(h[c][d])?a.when(h[c][d]):l(c,d).then(function(a){return angular.isDefined(h[c])||(h[c]={}),h[c][d]=a.data,h[c][d]})},this.getFeature=function(a,c,d,e,f){return a=f?a:b("uriCat")(a,"/wfs"),m(a,c,d,e)},this.getDefaultGeometryFieldName=function(b,c,d,e){return!d&&angular.isDefined(i[b])&&angular.isDefined(i[b][c])?a.when(i[b][c]):this.getFeatureTypeDescription(b,c,d,e).then(function(d){if(!d.error&&d.featureTypes){var e=_.filter(d.featureTypes[0].properties,function(a){return a.type.indexOf("gml:")!==-1});return 1===e.length?(_.isUndefined(i[b])&&(i[b]={}),i[b][c]=e[0].name,i[b][c]):a.reject("Could not find or uniquely identify default geometry field.")}return a.reject(d.error)})},window.OpenLayers&&(this.cqlToFilterXml=function(a){var b=e.read(a);return g.write(f.write(b))}),this.writeUpdates=function(b,d,e){var f=e.split(":"),g="NS_PLACEHOLDER",h=j.writeTransaction(null,b,null,{featurePrefix:f[0],featureType:f[1],featureNS:g}),i=k.serializeToString(h);return i=i.replace("xmlns:"+f[0]+'="'+g+'"',""),c.post(d,i).then(function(b){return b.data.indexOf("ows:ExceptionReport")<0?j.readTransactionResponse(b.data):(ccriCorealerter.alerter.errorMsg("Transaction failed with server exception."),a.reject(b.data))},function(){var b="Transaction failed.";return ccriCorealerter.alerter.errorMsg(b),a.reject(b)})},this.writeInserts=function(b,d,e,f){var g=e.split(":"),h=j.writeTransaction(b,null,null,{featurePrefix:g[0],featureType:g[1],featureNS:f}),i=k.serializeToString(h);return c.post(d,i).then(function(b){return b.data.indexOf("ows:ExceptionReport")<0?j.readTransactionResponse(b.data):(ccriCorealerter.alerter.errorMsg("Transaction failed with server exception."),a.reject(b.data))},function(){var b="Transaction failed.";return ccriCorealerter.alerterMsg.errorMsg(b),a.reject(b)})}}]),angular.module("stealth.core.geo.ows",[]).service("wms",["$http","$filter","$q",function(a,b,c){var d={},e=new ol.format.WMSCapabilities,f={timeOut:0,extendedTimeOut:0,tapToDismiss:!1},g=function(b){var d=!1,g=!1,h={timeOut:0,extendedTimeOut:0,tapToDismiss:!1,toastClass:"waitingToast",iconClass:"waitingToastIcon",onShown:function(){g=!0,d&&ccriCorealerter.alerter.clearMsg(i)}},i=ccriCorealerter.alerter.infoMsg("Waiting for capabilities from server.","",h);return a.get(b,{params:{service:"WMS",version:"1.3.0",request:"GetCapabilities"},timeout:3e4}).then(function(a){return a&&a.data?a.data.indexOf("ServiceExceptionReport")!==-1?(ccriCorealerter.alerter.errorMsg("Server encountered an error generating capabilities. Application functionality may be degraded.","Capabilities Error",f),c.reject("Server encountered an error generating capabilities.")):e.read(a.data):(ccriCorealerter.alerter.errorMsg("Failed to get capabilities from server. Application will not function properly.","Capabilities Error",f),c.reject("Failed to get capabilities from server."))},function(){return ccriCorealerter.alerter.errorMsg("Failed to get capabilities from server. Application will not function properly.","Capabilities Error",f),c.reject("Failed to get capabilities from server.")}).finally(function(){d=!0,g&&ccriCorealerter.alerter.clearMsg(i)})};this.getCapabilities=function(a,c,e){return a=e?a:b("uriCat")(a,"/wms"),c&&angular.isDefined(d)&&delete d[a],angular.isDefined(d[a])||(d[a]=g(a).then(function(a){return a})),d[a]}}]),angular.module("stealth.core.geo.ows").service("wps",["$q","$http","$filter",function(a,b,c){function d(a,b){return a=a.indexOf("wps/")>-1?a:"wps/"+a,a=a.indexOf(".xml")>-1?a:a+".xml",stealth.jst[a](b)}function e(b){var c=a.defer();return b.success(function(a){if(_.isString(a)&&a.indexOf("ExceptionText")!==-1)try{var b=/<ows:ExceptionText>(.*)<\/ows:ExceptionText>/,d=b.exec(a.replace(/(\r\n|\r|\n)/g," "));_.isArray(d)&&d.length>1&&c.reject(d[1])}catch(b){console.log(a,b),c.reject("An error occurred")}c.resolve(a)}).error(function(a,b){c.reject("Error: "+b)}),c.promise}this.submit=function(a,d,f){return a=f?a:c("uriCat")(a,"/wps"),e(b.post(a,d))},this.buildAndSubmit=function(a,f,g){f=f||{},g=g||{};var h=d(a,f);h=h.replace(/\<\?xml version=\"1\.0\" encoding=\"UTF\-8\"\?\>/g,""),h='<?xml version="1.0" encoding="UTF-8"?>\n'+h;var i=g.url||DataSourceManager.getPrimaryOgcConfig().url;i=g.omitWps?i:c("uriCat")(i,"/wps");var j={method:"POST",url:i,data:h,headers:{"Content-Type":"text/xml"}};a.indexOf(!1)&&(j.responseType="arraybuffer");var k=_.isEmpty(g.httpConfig)?j:_.merge(j,g.httpConfig);return e(b(k))},this.compileTemplate=d,this.chainRequest=function(a,b){return d("partials/reference",{bodyXml:d(a,b)})},this.complexData=function(a){return d("partials/complexData",{data:a})}}]),angular.module("stealth.core.header",["ccri.bars","stealth.core.utils.cookies","ngSanitize"]).run(["ccri.angular-utils.WidgetDef","ccri.bars.mgr","ccri.bars.Widget",function(a,b,c){b.insert("top",new c({widget:new a({tag:"st-header"})}),ccriBars.Position[ccriBars.Position.First],-1e3),b.insert("top",new c({widget:new a({tag:"ccri-bars-separator"})}),ccriBars.Position[ccriBars.Position.First],-1e3)}]).directive("stHeader",["$http","cookies","CONFIG","$interval",function(a,b,c,d){return{restrict:"E",scope:{},templateUrl:"core/header/header.tpl.html",controller:["$scope",function(e){function f(b,c){function f(){a.get(b+"?"+moment.utc().format("YYYYMMDDHHmmSS")).then(function(a){if(!_.isEmpty(a.data)){var b=_.flatten([a.data]),c=[];b.forEach(function(a){i.some(function(b){return JSON.stringify(a)===JSON.stringify(b)})||c.push(a)}),i=b,_.each(c,g)}}).catch(function(){j>0?j--:(ccriCorealerter.alerter.errorMsg("There was a problem displaying an announcement."),angular.isDefined(h)&&(d.cancel(h),h=void 0))})}if(b){var h,i=[],j=3;if(c){var k=1e3*c;h=d(f,k)}f(),e.$on("$destroy",function(){angular.isDefined(h)&&(d.cancel(h),h=void 0)})}}function g(a){var b,c=moment.utc();!_.isUndefined(a.expiration)&&(b=moment.utc(a.expiration),b.isValid()&&c.isAfter(b))||(_.has(a,"url")?f(a.url,a.pollingIntervalSeconds):h(a))}function h(a){var c,d,e,f=["successMsg","infoMsg","warningMsg","errorMsg"],g=a.message||"",h=a.title||"",j="infoMsg";if(!_.isEmpty(g)||!_.isEmpty(h)){if(_.isString(a.level)){var k=f.indexOf(a.level.slice(0,-3).toLowerCase()+"Msg"),l=f.indexOf(a.level.toLowerCase()+"Msg");j=k!==-1?f[k]:l!==-1?f[l]:j}if(c=[j,h,g].join("-"),_.isUndefined(a.expiration)||(e=moment.utc(a.expiration),e.isValid()&&(c+="-"+e.format("x"))),d=b.get(c,0),_.isUndefined(d)||!d.dismissed){var m,n=_.clone(i);(_.isUndefined(a.dismissable)||a.dismissable)&&(g+='<label class="dismissAnnouncement"><input type="checkbox" class="dismissAnnouncementCheckbox"/> <i>Never show this message again.</i></label>',n.onHidden=function(){if(m.find(".dismissAnnouncementCheckbox").prop("checked")){var a=moment.isMoment(e)&&e.isValid()?e:moment.utc().add(1,"y");b.put(c,0,{dismissed:!0},a)}},n.tapToDismiss=!1),m=ccriCorealerter.alerter[j](g,h,n)}}}e.logoUrl="assets/logo.png?"+c.app.loadTime,e.title=c.app.title,e.version=c.app.version.replace(/SNAPSHOT$/,"S"),e.subTitle=c.app.subTitle;var i={timeOut:0,extendedTimeOut:0},j=_.find(c.app.browsers,function(a,b){return bowser[b]});j?(bowser.version<j.minVersion?ccriCorealerter.alerter.errorMsg(e.title+" requires "+j.name+" version "+j.minVersion+" or higher. "+e.title+" may not function properly, please upgrade your browser.","Unsupported Version",i):j.maxVersion&&bowser.version>j.maxVersion&&ccriCorealerter.alerter.errorMsg(e.title+" requires "+j.name+" version between "+j.minVersion+" and "+j.maxVersion+". "+e.title+" may not function properly, please downgrade your browser.","Unsupported Version",i),_.isArray(j.preferred)&&!_.isEmpty(j.preferred)&&ccriCorealerter.alerter.warningMsg(e.title+" is best viewed with "+j.preferred.join(" or ")+".","Browser Warning",{timeOut:15e3})):ccriCorealerter.alerter.errorMsg(e.title+" does not support "+bowser.name.toUpperCase()+". Please use one of the following supported browsers: "+_.pluck(c.app.browsers,"name").join()+".","Unsupported Browser",i),_.isArray(c.app.announcements)&&_.each(c.app.announcements,g)}]}}]),angular.module("stealth.core.interaction.lists",[]).factory("SelectionHelper",[function(){function a(a){this.toggle=a,this.selectedIndexes=new Set,this.rangeStartIdx=null,this.rangeEndIdx=null}return a.prototype.click=function(a,b,c){var d,e;if((!b&&!c||c&&null===this.rangeStartIdx)&&(!this.selectedIndexes.has(a)||this.selectedIndexes.has(a)&&this.selectedIndexes.size>1))return this.clearSelectionsExceptFor([a]),this.selectedIndexes.add(a),this.rangeStartIdx=a,this.rangeEndIdx=null,void this.toggle(a,!0);if(b&&!c||this.selectedIndexes.has(a)&&1===this.selectedIndexes.size&&!c)return void(this.selectedIndexes.has(a)?(this.selectedIndexes.delete(a),this.rangeStartIdx=null,this.rangeEndIdx=null,this.toggle(a,!1)):(this.selectedIndexes.add(a),this.rangeStartIdx=a,this.rangeEndIdx=null,this.toggle(a,!0)));if(c&&!b&&null!==this.rangeStartIdx&&null===this.rangeEndIdx)return this.rangeEndIdx=a,d=this.rangeStartIdx<a?1:-1,e=_.range(this.rangeStartIdx,a+d,d),this.clearSelectionsExceptFor(e),void this.selectIndexes(e.slice(1));if(c&&b&&null!==this.rangeStartIdx)return this.rangeEndIdx=a,d=this.rangeStartIdx<a?1:-1,e=_.range(this.rangeStartIdx,a+d,d),this.selectIndexes(e.slice(1)),this.rangeStartIdx=a,void(this.rangeEndIdx=null);if(c&&!b&&null!==this.rangeStartIdx&&null!==this.rangeEndIdx){var f=this.rangeEndIdx;d=this.rangeStartIdx<f?1:-1;var g=_.range(this.rangeStartIdx,f+d,d);this.rangeEndIdx=a,d=this.rangeStartIdx<a?1:-1,e=_.range(this.rangeStartIdx,a+d,d),this.clearSelectionsExceptFor(e);var h=[];return _.forEach(e,function(a){g.indexOf(a)===-1&&h.push(a)}),void this.selectIndexes(h)}},a.prototype.clearSelectionsExceptFor=function(a){var b=this,c=new Set(this.selectedIndexes);_.forEach(a,function(a){c.delete(a)}),c.forEach(function(a){b.selectedIndexes.delete(a),b.toggle(a,!1)})},a.prototype.selectIndexes=function(a){var b=this;a.forEach(function(a){b.selectedIndexes.add(a),b.toggle(a,!0)})},a.prototype.clear=function(){var a=this;this.selectedIndexes.forEach(function(b){a.selectedIndexes.delete(b),a.toggle(b,!1)}),this.rangeStartIdx=null,this.rangeEndIdx=null},a.prototype.getSelections=function(){return Array.from(this.selectedIndexes.values())},a}]),angular.module("stealth.core.interaction.drag",["stealth.core.geo.ol3.map"]).run(["ol3Map",function(a){var b=function(){ol.interaction.Pointer.call(this,{handleDownEvent:b.prototype.getFeatureOnClick,handleDragEvent:b.prototype.drag,handleUpEvent:b.prototype.endDrag}),this._coordinate=null,this._feature=null,this._layer=null,this._cursor="move",this._previousCursor=void 0};ol.inherits(b,ol.interaction.Pointer),b.prototype.getDraggableFeatureAndLayer=function(a){var b=null,c=a.map.forEachFeatureAtPixel(a.pixel,function(a,c){return null!==c&&c.draggable?(b=c,a):null},{layerFilter:function(b){if(a.map.getLayers().getArray().indexOf(b)!==-1)return b.draggable}});return[c,b]},b.prototype.getFeatureOnClick=function(a){var b=this.getDraggableFeatureAndLayer(a),c=!_.isUndefined(b[0]);return c&&(this._coordinate=a.coordinate,this._feature=b[0],this._layer=b[1]),c},b.prototype.drag=function(a){var b=a.coordinate[0]-this._coordinate[0],c=a.coordinate[1]-this._coordinate[1],d=this._feature.getGeometry();d.translate(b,c),this._coordinate[0]=a.coordinate[0],this._coordinate[1]=a.coordinate[1]},b.prototype.updateCursorType=function(a){if(!_.isUndefined(this._cursor)){var b=this.getDraggableFeatureAndLayer(a),c=a.map.getTargetElement();_.isUndefined(b[0])?_.isUndefined(this._previousCursor)||(c.style.cursor=this._previousCursor,this._previousCursor=void 0):c.style.cursor!==this._cursor&&(this._previousCursor=c.style.cursor,c.style.cursor=this._cursor)}},b.prototype.endDrag=function(){return!_.isNull(this._layer)&&_.isFunction(this._layer.onDragEnd)&&this._layer.onDragEnd(this._feature,this._layer),this._coordinate=null,this._feature=null,this._layer=null,!1},a.addInteraction(new b)}]),angular.module("stealth.core.interaction.dragAndDrop",["stealth.core.geo.ol3.map","stealth.import.files"]).run(["ol3Map","stealth.import.files.importer",function(a,b){var c=new ol.interaction.DragAndDrop({formatConstructors:[]});c.on("addfeatures",function(a){b.importFile(a.file).then(function(a){"KMZ"===a.type&&ccriCorealerter.alerter.warningMsg("Only displaying main KML geometries.","KMZ Not Fully Supported")})}),a.addInteraction(c)}]),angular.module("stealth.core.interaction",["stealth.core.interaction.mapclick","stealth.core.interaction.drag","stealth.core.interaction.dragAndDrop","stealth.core.interaction.mouseover","stealth.core.interaction.lists"]),angular.module("stealth.core.interaction.mapclick",["ccri.popup","stealth.core.geo.ol3.map","stealth.core.popup","stealth.core.utils"]).service("stealth.core.interaction.mapclick.manager",["$filter","$rootScope","ol3Map","stealth.core.interaction.mapclick.searchManager","ccri.popup.manager","ccri.angular-utils.WidgetDef",function(a,b,c,d,e,f){var g,h,i=this,j=angular.element('<div class="fa fa-fw fa-spinner fa-spin fa-lg mapSearchSpinner"></div>')[0],k=angular.element(".primaryDisplay > ccri-popup-container"),l=function(a){var b=e.getViewportDim(g),c=[b[0]/2,b[1]/2];return a[0]<c[0]?a[1]<c[1]?Popup.Positioning.TopLeft:Popup.Positioning.BottomLeft:a[1]<c[1]?Popup.Positioning.TopRight:Popup.Positioning.BottomRight},m=function(h){b.$evalAsync(function(){function m(d){if(c.removeOverlay(n),o.results=_(d).filter().flattenDeep().filter(function(a){return!a.isError&&a.widgetDef}).value(),o.results.length>0){var j="("+a("number")(h.coordinate[1],2)+", "+a("number")(h.coordinate[0],2)+")",k=new f({tag:"ccri-popup-components-tab-container",scope:o,attrs:'results="results" active-tab-idx="activeTabIdx" popup-id="popupId"'}),m=c.getEventPixel(h.originalEvent),p=b.$new(),q=!0;if(p.iconClass="fa-thumb-tack",p.tooltipText="Pin",p.extraClasses=function(){return{active:o.isPinned}},p.onClick=function(){o.isPinned=!o.isPinned},_.has(o.results[0],"widgetDef.scope.response.dataSource")){var r=o.results[0].widgetDef.scope.response.dataSource;q=r.keywordConfig&&r.keywordConfig.hasIn(["popup","limitStartSize"])?"true"===r.keywordConfig.getIn(["popup","limitStartSize"]):!r.KeywordConfig||!_.has(r.KeywordConfig,"popup.limitStartSize")||"true"===_.get(r.KeywordConfig,"popup.limitStartSize")}o.popupId=e.displayPopup(g,j,"search","fa-crosshairs",k,{offsets:m,positioning:l(m),resizable:!0,toolDefs:[new f({tag:"ccri-popup-tooldefs-button",scope:p,attrs:'icon-class="iconClass" tooltip-text="tooltipText" extra-classes="extraClasses" on-click="onClick"'})],onClose:function(){t(),u(),o.$destroy(),o=null,p.$destroy(),p=null,c.un("singleclick",s)},limitStartSize:q}),k.scope.$on("TabChanged",function(a,b){if(b){var c=_.find(e.getPopups(),{id:k.scope.popupId});c.title=b.title+" "+j,c.iconClass=b.icon}else e.closePopup(o.popupId)});var s=function(){!o.isPinned&&i.enabled&&(c.un("singleclick",s),e.closePopup(o.popupId))},t=b.$on("wizard:launchWizard",function(){c.un("singleclick",s)}),u=b.$on("wizard:closeWizard",function(){c.on("singleclick",s)});c.on("singleclick",s)}else o.$destroy(),o=null}b.$emit("mapclick:search");var n=new ol.Overlay({element:j,position:h.coordinate});_.isUndefined(g)&&(g=k.data("ccri.popup.containerId")),c.addOverlay(n);var o=b.$new();_.defer(function(){d.search(h.coordinate,c.getResolution(),m,o)})})};this.enabled=!1,this.enableClicks=function(a){a!==this.enabled&&(a?h=c.on("singleclick",m):h&&(c.unByKey(h),h=null),this.enabled=a)}}]).service("stealth.core.interaction.mapclick.searchManager",["$log","ol3Map",function(a,b){var c="stealth.core.interaction.mapclick.searchManager: ";this.search=function(d,e,f,g,h){a.debug(c+"Starting new click search.");var i=[],j=_.flattenDeep(b.searchLayers(d,e,g,!0,h)),k=function(a){f(a)};if(0===j.length)a.debug(c+"No layers were searched."),k(i);else{var l=function(b){i.push(b),i.length===j.length&&(a.debug(c+"All promises have returned. Passing results to caller."),k(i))};_.forEach(j,function(a){a.then(l,l)})}},a.debug(c+"Service started.")}]),angular.module("stealth.core.interaction.mouseover",["stealth.core.geo.ol3.map"]).run(["ol3Map",function(a){var b=function(){ol.interaction.Pointer.call(this,{handleMoveEvent:b.prototype.mouseover})};ol.inherits(b,ol.interaction.Pointer),b.prototype.mouseover=function(a){_.isUndefined(this._layer)||(this._layer.onMouseLeave(),this._layer=void 0);var b,c=a.map.forEachFeatureAtPixel(a.pixel,function(a,c){return!(null===c||!_.isFunction(c.onMouseOver)||!_.isFunction(c.onMouseLeave))&&(b=a,c)},{layerFilter:function(b){if(a.map.getLayers().getArray().indexOf(b)!==-1)return _.isFunction(b.onMouseOver)&&_.isFunction(b.onMouseLeave)}});_.isUndefined(c)||(this._layer=c,this._layer.onMouseOver(b,c))},a.addInteraction(new b)}]),angular.module("stealth.core.manager").service("moduleManager",["$log","$injector",function(a,b){var c="stealth.core.manager.moduleManager: ";this.moduleRegistered=function(b){return a.debug(c+"Looking for module: "+b),angular.moduleRegistered(b)},this.findModuleService=function(d,e,f){var g;return a.debug(c+"Searching for service instance for "+f),angular.moduleRegistered(d)&&(a.debug(c+"Service search found "+d),b.has(e)&&(a.debug(c+"Service search found "+e),g=b.get(e,f))),g}}]),angular.module("stealth.core.mapTooltips",[]).provider("cursorTooltipManager",[function(){this.$get=["$interval","mousePosition","ol3Map",function(a,b,c){function d(){var a;n?(p=!0,a=n.find(".map-tooltip"),n.detach(".map-tooltip")):(p=!1,n=angular.element("<div>"),n.addClass("map-tooltip-container"),o=n.get(0),o.style.position="absolute",o.style.top="0",o.style.left="0"),l=c.getMap(),j=l.getViewport(),k=angular.element(j),m=k.offsetParent(),m.append(n),a&&n.append(a)}function e(a){p&&(b.pixel[0]=a.clientX,b.pixel[1]=a.clientY),o&&(o.style.left=b.pixel[0]+r+"px",o.style.top=b.pixel[1]+0+"px")}function f(){_.each(q,function(a){g(a)})}function g(a){!a.hidden&&b.isOverMap?a.tooltipElement.style.display="block":a.tooltipElement.style.display="none"}function h(a){return n?(q.push(a),void n.append(a.tooltipElement)):void s.push(a)}function i(a){_.pull(q,a),n.find(a.tooltipElement).remove()}var j,k,l,m,n,o,p=!0,q=[],r=12;b.on("mousemove",e),b.on("mouseout",f),b.on("mouseover",f);var s=[],t=a(function(){if(m){a.cancel(t);for(var b;b=s.pop();)h(b)}},500);return{init:d,add:h,remove:i,updateVisibility:g}}]}]).run(["$timeout","cursorTooltipManager","stealth.display.registry",function(a,b,c){a(function(){b.init()},1e3),c.on("display.active",function(c){"map"===c.type&&c.active&&a(function(){b.init()})})}]),angular.module("stealth.core.mapTooltips",["stealth.core.geo.ol3.map"]).factory("MapTooltip",["cursorTooltipManager","ol3Map",function(a,b){
function c(a){a=a||{},_.defaults(a,{className:"",iconClass:"",zIndex:0});var b=angular.element("<div>"),c=angular.element("<span>");if(a.className&&b.addClass(a.className),b.css({zIndex:a.zIndex}),a.iconClass){var d=angular.element("<i>");d.addClass(a.iconClass),b.append(d)}b.append(c),this.tooltipElement=b.get(0),this.tooltipTextElement=c.get(0),this.lastText=null,this.positionMode=null,this.hidden=!0,this.overlay=null,this.coordinate=[null,null]}var d=b.getMap();return c.prototype.destroy=function(){a.remove(this),this.overlay&&(d.removeOverlay(this.overlay),this.overlay=null),this.tooltipElement=this.tooltipTextElement=this.lastText=this.positionMode=this.hidden=null},c.prototype.show=function(){this.hidden=!1,"coordinates"===this.positionMode?this.overlay.setPosition(this.coordinate):"cursor"===this.positionMode&&a.updateVisibility(this)},c.prototype.hide=function(){this.hidden=!0,"coordinates"===this.positionMode?this.overlay.setPosition(void 0):"cursor"===this.positionMode&&a.updateVisibility(this)},c.prototype.setText=function(a){this.lastText!==a&&(this.lastText=a,this.tooltipTextElement.textContent=this.lastText)},c.prototype.followCursor=function(){if(this.positionMode&&"cursor"!==this.positionMode)throw new Error("Switching positioning mode is not supported");this.positionMode||(a.add(this),this.positionMode="cursor")},c.prototype.setCoordinates=function(a){if(this.positionMode&&"coordinates"!==this.positionMode)throw new Error("Switching positioning mode is not supported");this.coordinate[0]=a[0],this.coordinate[1]=a[1],this.positionMode?this.hidden||this.overlay.setPosition(this.coordinate):(this.overlay=new ol.Overlay({element:this.tooltipElement,position:this.coordinate,positioning:"top-left",stopEvent:!1}),d.addOverlay(this.overlay),this.positionMode="coordinates")},c}]),angular.module("stealth.core.measure").service("stealth.core.drawingInteractionService",["ol3Geodetics","stealth.core.geo.ol3.overlays.Vector","stealth.core.measureService","csvFormat","stealth.core.geo.ol3.format.GeoJson",function(a,b,c,d,e){function f(b,c,d,e){var f=new ol.geom.MultiLineString(_(b).map(function(a,c){if(c+1===b.length)return null;var d=new arc.GreatCircle({x:a[0],y:a[1]},{x:b[c+1][0],y:b[c+1][1]}),e=0;return d.Arc(16,{offset:.001}).geometries[0].coords.map(function(a,b,c){var d=a[0];if(a[0]+=e,b<c.length-1){var f=c[b+1][0]-d;f<-180?e=360:f>180&&(e=-360)}return a})}).compact().value());if(d.setGeometry(f),!_.isEmpty(e))if(b.length>2)e.setGeometry(null);else{var g=ol.geom.Polygon.circular(a.sphere,b[0],c);e.setGeometry(g)}}var g=function(a,b,c,d){this.overlay=a,this.drawing=b,this.ol3Map=c,this.scope=d,this.geoFeature=null,this.helperFeatures=[]};g.prototype.init=function(a){a=a||{};var b="MultiPoint"===this.drawing.drawingType;if(b){var c=this,d=new ol.Feature;if(d.setStyle(Geo.getActiveStyle()),c.overlay.addFeature(d),c.helperFeatures.push(d),a.showGuides){var e=new ol.Feature;e.setStyle(Geo.getActiveStyle({dashed:!0})),c.overlay.addFeature(e),c.helperFeatures.push(e)}var f=function(){c.geoFeature&&c.drawing.getActive()&&c.redraw()},g=c.ol3Map.on("pointermove",f),h=c.drawing.on("drawend",f),i=c.scope.$on("$destroy",function(){i(),i=null,_.isEmpty(c.drawing)||ol.Observable.unByKey(h),ol.Observable.unByKey(g)});c.drawing.on("drawend",function(){ol.Observable.unByKey(g)})}this.overlay.addToMap(),this.ol3Map.removeInteraction(this.drawing),this.ol3Map.addInteraction(this.drawing)},g.prototype.erase=function(){this.overlay.clear(),this.helperFeatures.length=0,this.geoFeature=null},g.prototype.setActive=function(a){var b=a?Geo.getActiveColor():Geo.getInactiveColor(),c=a?Geo.getActiveStyle():Geo.getInactiveStyle();this.geoFeature.setStyle(c),_.each(this.helperFeatures,function(a){_.isEmpty(a.getStyle())||_.isEmpty(a.getStyle()[1])||a.getStyle()[1].getStroke().setColor(b)})},g.prototype.redraw=function(){if("MultiPoint"===this.drawing.drawingType){var a=this.geoFeature.getGeometry().getCoordinates(),b=c.getDistance(a,"meter");f(a,b,this.helperFeatures[0],this.helperFeatures[1])}},g.prototype.destroy=function(){this.ol3Map.removeInteraction(this.drawing),this.erase(),this.overlay.getFeatures().getArray().length||this.overlay.removeFromMap(),this.scope.$destroy(),this.scope=this.overlay=this.ol3Map=this.drawing=this.geoFeature=this.helperFeatures=null};var h=this;h.createDrawingInteraction=function(a,b,c,d){var e=new g(a,b,c,d);return e.drawing.on("drawstart",function(a){e.geoFeature=a.feature,e.setActive(!0)}),e.drawing.on("drawend",function(){e.drawing.setActive(!1),e.setActive(!1)}),e},h.addWidgetDefSupport=function(a,b){a.wdAttributes=b,a.updateWdAttributes=function(a){_.extend(this.wdAttributes,a)}},h.addPointerMoveSupport=function(a,b,c){a.updateMousePixel=function(b,c){a.mousePixelX=b,a.mousePixelY=c},a.onPointerMove=function(c){c.dragging||a.scope.$apply(function(){a.updateMousePixel(c.pixel[0],c.pixel[1]),b()})},a.drawing.on("drawstart",function(){a.listenerKey_pointermove=c.on("pointermove",function(b){a.onPointerMove(b)})}),a.drawing.on("drawend",function(){ol.Observable.unByKey(a.listenerKey_pointermove)});var d=a.scope.$on("$destroy",function(){d(),d=null,a.listenerKey_pointermove&&ol.Observable.unByKey(a.listenerKey_pointermove)})},h.createOverlay=function(){return new b({colors:[Geo.getInactiveColor()],styleBuilder:Geo.getInactiveStyle()})},h.createDrawing=function(a,b,c){b=b||"LineString",c=c||{};var d={features:a.getFeatures(),type:"Rectangle"===b?"LineString":b,freehandCondition:c.freehandCondition||ol.events.condition.never,style:[new ol.style.Style({stroke:Geo.getStroke(Geo.getActiveBorderColor(),4)}),new ol.style.Style({stroke:Geo.getStroke(Geo.getActiveColor(),2),image:Geo.getCircle(4,Geo.getActiveColor(),Geo.getActiveBorderColor())})]};"Rectangle"===b?(d.geometryFunction=function(a,b){b||(b=new ol.geom.Polygon(null));var c=ol.Coordinate=a[0],d=ol.Coordinate=a[1];return b.setCoordinates([[c,[c[0],d[1]],d,[d[0],c[1]],c]]),b},d.maxPoints=2):"LineString"===b&&(b="MultiPoint",d.geometryFunction=function(a,b){return b||(b=new ol.geom.MultiPoint(null)),b.setCoordinates(a),b}),_.merge(d,c);var e=new ol.interaction.Draw(d);return e.drawingType=b,e},h.eraseDrawings=function(a){_.isEmpty(a)||a.getFeatures().clear()},h.uploadDrawings=function(a){a.click()},h.saveDrawings=function(a,b,c){if(!_.isEmpty(b)){var f=b.getFeatures().getArray();if(!f.length)return;var g,h=(new e).writeFeatures(f);switch(a){case"json":g="application/json";break;case"csv":h=d.geoJsonToCsv(h,d.coordFormat.dmshCombined,["DMS"]),g="text/csv"}var i=new Blob([h],{type:g});saveAs(i,(c?c:"geofeatures")+"."+a)}}}]),angular.module("stealth.core.measure").service("stealth.core.measure.measureControllerHelper",["$filter","$rootScope","ccri.angular-utils.WidgetDef","ccri.popup.manager","CONFIG","measureTooltip","ol3Map","stealth.core.drawingInteractionService","stealth.core.geo.controls.mapMode.modeManager","stealth.core.measureService",function(a,b,c,d,e,f,g,h,i,j){var k={name:"Measure",iconClass:"ccri-icon ccri-icon-ruler",active:!1};i.addMode(k);var l=this,m=[{name:"line",label:"Line",iconClass:"fa-arrows-h",type:"LineString",maxPoints:e.measure.maxPointsForLineString}],n=_.get(e,"measure.decimalPlaces",0);l.getModeInstance=function(){return k},l.toggleMode=function(){i.toggle(k.name)},l.createMeasurement=function(b,c,d){function e(a){var b=j.getCurrentScaleLineUnit().id,c=j.getDistance(a),d="meter"===b?"formatMeters":"mile"===b?"formatMiles":"nauticalmile"===b?"formatNauticalmiles":"degreelatitude"===b?"formatDegrees":"numberTrim",e="",f=MathUtils.converter.convert(c,"meter",b);_.isUndefined(f)&&(f=c);var g=j.getBearing(a.slice(-2)),h=Geo.geomagnetism.getMagVarAtCoordinate(a[a.length-2]),i=g+h;return{distanceDisp:f,distanceMeters:c,bearing:g,magBearing:i,unitSymbol:e,distanceFormatter:d}}var i=h.createOverlay(),k=h.createDrawing(i,c,d),m=h.createDrawingInteraction(i,k,g,b.$new());return h.addWidgetDefSupport(m,{}),h.addPointerMoveSupport(m,function(){var b=m.geoFeature.getGeometry().getCoordinates(),c=e(b);f.setText(a("formatBearing")(c.bearing)+" ("+a("formatBearing")(c.magBearing)+"mag) / "+a(c.distanceFormatter)(c.distanceDisp,n)+c.unitSymbol)},g),m.drawing.on("drawend",function(){m.scope.$apply(function(){var b=m.geoFeature.getGeometry().getCoordinates(),c=e(b);m.updateWdAttributes({Distance:a(c.distanceFormatter)(c.distanceDisp,n)+c.unitSymbol,Bearing:a("formatBearing")(c.bearing)+" ("+a("formatBearing")(c.magBearing)+"mag)"}),m.finalMousePos=[m.mousePixelX,m.mousePixelY],m.popupId=l.createMeasurementPopup(m)})}),m},l.createMeasurementPopup=function(a){var e=b.$new(),f=angular.element(".primaryDisplay > ccri-popup-container"),g=f.data("ccri.popup.containerId"),h=[a.finalMousePos[0],a.finalMousePos[1]],i={draggable:!0,resizable:!1,offsets:h,contentMinWidth:150,positioning:Popup.Positioning.TopRight,onClose:function(){a.destroy(),a=null,e.$destroy(),e=f=g=h=i=null}};e.measurementAttrs=a.wdAttributes;var j=d.displayPopup(g,"Measurement","measure","ccri-icon ccri-icon-ruler",new c({tag:"st-simple-table",attrs:"object=measurementAttrs css-class='measureDisplayText'",scope:e}),i);return j},l.closePopups=function(a){for(;!_.isEmpty(a);)d.closePopup(a.pop())},l.getDrawingTypes=function(){return m},l.getMaxMeasurementsAtOnce=function(){return e.measure.maxMeasurementsAtOnce>0?e.measure.maxMeasurementsAtOnce:null}}]),angular.module("stealth.core.measure").service("stealth.core.measureService",["$rootScope","CONFIG","cookies","ol3Geodetics",function(a,b,c,d){function e(){var a=_.findIndex(h,function(a){return c.get("scaleLineUnits",1)===a.id});return a===-1?0:a}var f=this,g={degrees:"degreelatitude",imperial:"mile",nautical:"nauticalmile",metric:"meter"},h=_.map(b.map.scaleLineUnits||["metric","imperial","degrees","nautical"],function(a){return MathUtils.converter.getUnit(g[a])}),i=e(),j="stealth.scaleLine.unitChange",k=AppState.StateManager.getInstance();k.getObservable("UserPreferencesReducer").subscribe({next:function(a){a.settings.get("scaleLineUnits")&&h[i].id!==a.settings.get("scaleLineUnits")&&f.setScaleLineUnit(a.settings.get("scaleLineUnits"),!0)}}),f.getDistance=function(a,b){var c="meter",e=d.distanceVincenty(a);return _.isEmpty(b)||(e=MathUtils.converter.convert(e,c,b)),e},f.getBearing=function(a){var b=d.vincentyInitialBearing(a)[0];return parseFloat(b)},f.setScaleLineUnit=function(b,d){_.isNumber(b)?i=b<0?0:b%h.length:(i=_.findIndex(h,function(a){return a.id===b}),i=i<0?0:i);var e=h[i];return d||c.put("scaleLineUnits",1,e.id,moment.utc().add(1,"y")),a.$emit(j),k.dispatch({type:ccriCoreuserprefs.TypeKeys.USER_PREF_UPDATE,settings:{scaleLineUnits:e.id}}),e},f.getScaleLineUnitsList=function(a){return a?b.map.scaleLineUnits:h},f.getCurrentScaleLineUnit=function(a){return a?b.map.scaleLineUnits[i]:h[i]},f.advanceToNextScaleLineUnit=function(){return i++,f.setScaleLineUnit(i)},f.onScaleLineChange=function(b){return a.$on(j,b)}}]),angular.module("stealth.core.measure",[]).run(["$rootScope","ccri.angular-utils.WidgetDef","ccri.bars.mgr","ccri.bars.Widget","stealth.display.registry",function(a,b,c,d,e){var f=new d({widget:new b({tag:"st-measure",scope:a.$new()})});c.insert("top",f,ccriBars.Position[ccriBars.Position.Last],700),e.on("display.selected",function(b){"map"===b.type&&a.$evalAsync(function(){f.hidden=!b.selected})})}]).directive("stMeasure",["measureTooltip","stealth.core.measure.measureControllerHelper",function(a,b){return{restrict:"E",templateUrl:"core/measure/measure.tpl.html",scope:{},controller:["$scope",function(c){function d(){c.currentTool=c.drawingTypes[0],c.activeMeasurement=null,a.hide(),k=[],l={}}function e(d,g){_.isNumber(g)&&g>0&&(l.maxPoints=g);var h=b.createMeasurement(c,d,l);h.drawing.on("drawstart",function(){a.show()}),h.drawing.on("drawend",function(){f(),e(d,g)}),h.init({showGuides:!0}),null!==c.activeMeasurement&&k.push(c.activeMeasurement.popupId),c.activeMeasurement=h}function f(){_.isNumber(m)&&m>0&&k.length>=m&&g(k.length-m||1),a.hide()}function g(a){if(!_.isEmpty(k)){var c=k;_.isNumber(a)&&(c=_.slice(k,0,a),k=_.slice(k,a)),b.closePopups(c),c.length=0}}function h(a){27===a.keyCode&&(b.toggleMode(),c.$apply())}function i(){d(),e(c.currentTool.type,c.currentTool.maxPoints),angular.element("body").on("keyup",h)}function j(){g(),a.hide(),c.activeMeasurement&&(c.activeMeasurement.destroy(),c.activeMeasurement=null),angular.element("body").off("keyup",h)}c.mode=b.getModeInstance(),c.measureService=b,c.drawingTypes=b.getDrawingTypes(),c.beginMeasureMode=i,c.endMeasureMode=j;var k,l,m=b.getMaxMeasurementsAtOnce();c.$watch("mode.active",function(a){a?c.beginMeasureMode():c.endMeasureMode()})}]}}]),angular.module("stealth.core.measure").service("measureTooltip",["MapTooltip",function(a){var b=new a({className:"map-tooltip",iconClass:"fa ccri-icon ccri-icon-ruler"});return b.followCursor(),b.hide(),b}]).directive("stSimpleTable",[function(){return{restrict:"E",templateUrl:"core/measure/simpleTable.tpl.html",scope:{object:"=",cssClass:"@"}}}]),angular.module("stealth.core.popup.capabilities",["ui.bootstrap","ccri.popup","stealth.core.sidebar","stealth.core.utils"]).factory("stealth.core.popup.capabilities.Extender",[function(){return ccriCorecapabilities.Extender}]).service("coreCapabilitiesExtender",["$rootScope","$uibModal","$interpolate","$window","ccri.angular-utils.WidgetDef","sidebarManager","stealth.core.popup.capabilities.Extender","CONFIG",function(a,b,c,d,e,f,g,h){var i=new g;this.addCapabilitiesExtender=i.addCapabilitiesExtender.bind(i),this.extendCapabilities=i.extendCapabilities.bind(i),this.addCapabilitiesExtender(function(c){return _.isUndefined(c.view)||_.forOwn(c.view,function(d,e){_.isString(d)&&(c["view:"+d]={toolTipText:"View "+e,iconClass:"fa-file-text-o",onClick:function(c,f){var g=a.$new();g.title=e,g.value=_.map(d.split(","),function(a){return f[a]}).join("\n"),b.open({size:"lg",scope:g,templateUrl:"core/popup/components/fieldview.tpl.html",controller:"fieldViewController",backdrop:"static",backdropClass:"wizardMask"})}})}),c}),this.addCapabilitiesExtender(function(a){if(_.isObject(a.link)){var b=_.keys(_.get(a.link,"role"));_.isEmpty(b)||!_.isEmpty(_.intersection(b,h.userRoles))?(_.isString(a.link.url)&&(a.link["** legacy format support **"]={toolTipText:a.link.toolTipText||"Link",url:a.link.url||"",iconClass:a.link.iconClass||"fa-external-link"},delete a.link.toolTipText,delete a.link.url,delete a.link.iconClass),_.forOwn(a.link,function(b,e){if(_.isString(e)&&_.isObject(b))if(_.isEmpty(b.url))delete a.link[e];else{var f=_.keys(_.get(b,"role"));if(_.isEmpty(f)||!_.isEmpty(_.intersection(f,h.userRoles))){var g={};g.toolTipText=e||"Link",g.iconClass="fa-external-link",g.onClick=function(a,b,e){var f=e.url;if(!_.isEmpty(f)){var g=c(f),h=g(b);d.open(h)}},a["link:"+e]=_.merge(g,b)}}})):delete a.link}return a}),this.addCapabilitiesExtender(function(b,c){if(_.isObject(b.edit)){var d=_.keys(_.get(b.edit,"role"));if(_.isEmpty(d)||!_.isEmpty(_.intersection(d,h.userRoles))){var g=_.get(b,"edit.editor","st-wfst-editor");b.edit.toolTipText="Edit",b.edit.iconClass="fa-edit",b.edit.onClick=function(b,d,h,i){var j=a.$new();j.record=d,j.source=i?i.source:void 0,j.opts=c,f.toggleButton(j.opts.sidebarButtonId=f.addButton("EDIT - "+b,"fa-edit",300,new e({tag:g,scope:j,attrs:"record='record' source='source' opts='opts'"}),null,!1,function(){j.$destroy()}),!0)}}else delete b.edit}return b})}]),angular.module("stealth.core.popup.components",["stealth.core.geo.ol3.format","stealth.core.geo.ows"]).directive("stWfstEditor",[function(){return{restrict:"E",templateUrl:"core/popup/components/edit.tpl.html",controller:"wfstEditorController"}}]).controller("wfstEditorController",["$scope","wfs","stealth.core.geo.ol3.format.GeoJson",function(a,b,c){var d=new c;if(!_.get(a,"init.done")){a.originalFeature=d.readFeatures(a.source)[0];var e=a.originalFeature.getId();a.feature=new ol.Feature(_.omit(a.originalFeature.getProperties(),_.isObject)),a.feature.setId(e),a.properties=a.feature.getProperties(),a.save=function(){a.feature.setProperties(a.properties),b.writeUpdates([a.feature],a.opts.wfsUrl,a.opts.layerName).then(function(){ccriCorealerter.alerter.successMsg("Save successful")},function(){ccriCorealerter.alerter.errorMsg("Save failed")})},a.init={done:!0}}}]),angular.module("stealth.core.popup.components",[]).service("stealth.core.popup.components.fieldFormat",[function(){this.formatFromKeywords=function(a,b){var c=_.keys(_.get(b,"field.escape")),d=_.get(b,"field.format"),e=_.get(b,"field.putFirst");return e&&(e=e.split(",")),{records:a,omitKeys:_.keys(_.get(b,"field.hide")),escapedKeys:c,fieldFormat:d,sortOrder:_.get(b,"field.order"),frontList:e}}}]),angular.module("stealth.core.popup.components").controller("fieldViewController",["$scope","$timeout",function(a,b){a.selectAllText=function(a,c){b(function(){a.delegateTarget.select()},c)}}]),angular.module("stealth.core.popup",["ccri.angular-utils"]).directive("stCustomTabPopup",["CONFIG","$interpolate","ccri.angular-utils.WidgetDef","stCustomPopupService","$rootScope",function(a,b,c,d,e){return{scope:{response:"=",record:"=",index:"=",metadata:"=?",displayState:"=?"},templateUrl:"core/popup/customTabPopup.tpl.html",controller:["$scope",function(f){e.$on("stCustomPopupServiceThemeChange",function(a,b){f.themeToggle="dark"===b}),0===d.getTheme().length&&_.has(f.response,"popupOptionsOverrides.theme")?d.setTheme(f.response.popupOptionsOverrides.theme):d.getTheme().length>0?f.themeToggle="dark"===d.getTheme():d.setTheme("light"),f.title=_.has(f.response,"popupOptionsOverrides.title")?b(f.response.popupOptionsOverrides.title)(f.record):f.response.name,f.name=f.record.name||f.response.name,f.getBorderStyle=function(){return _.isFunction(f.response.getLayerLegendStyle)||f.displayState?{"border-style":"solid","border-width":"2px 0 2px 0","border-color":f.displayState?_.get(f.displayState.highlight,"border-color"):_.get(f.response.getLayerLegendStyle(),"color")}:{"border-bottom":"1px solid #808080"}},_.has(f.response,"popupOptionsOverrides.outerContent")&&(f.outerContent={labels:f.response.popupOptionsOverrides.outerContent.labels.split(","),fields:f.response.popupOptionsOverrides.outerContent.fields.split(",")});var g=_.get(f.response,"popupOptionsOverrides.tab"),h=_.filter(_.has(f.response,"popupOptionsOverrides.tabOrder")?f.response.popupOptionsOverrides.tabOrder.split(","):_.keys(g),function(b){var c=_.keys(_.get(g[b],"role"));return _.isEmpty(c)||!_.isEmpty(_.intersection(c,a.userRoles))});f.tabs=_.map(h,function(a){var b=f.$new();return b.properties=g[a],b.record=f.record,b.response=f.response,b.index=f.index,{label:_.get(g[a],"label")||a,content:new c({tag:_.get(g[a],"directive"),scope:b,attrs:'record="record" response="response" properties="properties" index="index"'})}}),f.toggleTheme=function(){d.toggleTheme()}}]}}]).service("stCustomPopupService",["$rootScope",function(a){this.theme="",this.toggleTheme=function(){"light"===this.theme?this.theme="dark":this.theme="light",this.broadcastTheme()},this.setTheme=function(a){this.theme=a,this.broadcastTheme()},this.getTheme=function(){return this.theme},this.broadcastTheme=function(){a.$broadcast("stCustomPopupServiceThemeChange",this.theme)}}]).factory("TabPopupHelper",["$interval","wfs",function(a,b){var c=function(c,d){function e(){l&&!c.loading&&(c.loading=!0,i={CQL_FILTER:c.properties.trkIdField+"='"+c.record[c.properties.trkIdField]+"'"},b.getFeature(m,c.properties.layerName,i,void 0,!0).then(function(a){_.isFunction(d)&&d(a)}).finally(function(){c.loading=!1,c.tabHasBeenFocused=!0}))}var f,g,h,i,j,k,l=!1,m=c.response.dataSource?c.response.dataSource.wfsUrl:DataSourceManager.getPrimaryOgcConfig().url;_.has(c.properties,"layerName")&&_.has(c.properties,"trkIdField")&&(f=c.$on("TabBar:TabFocused",function(){l=!0,e()}),g=c.$on("TabBar:TabBlurred",function(){l=!1}),_.has(c.properties,"refreshInterval")?(j=1e3*Number(_.get(c.properties,"refreshInterval")),j>0&&(k=a(e,j))):h=c.$on("TabBar:RefreshTab",e)),this.destroy=function(){_.isFunction(f)&&(f(),f=null),_.isFunction(g)&&(g(),g=null),_.isUndefined(k)||(a.cancel(k),k=null),_.isFunction(h)&&(h(),h=null)}};return c}]),angular.module("stealth.core.popup",["stealth.core.popup.capabilities","stealth.core.popup.components"]),angular.module("stealth.core.save",["ccri.bars","ui.bootstrap"]).run(["$location","$timeout","$uibModal","ccri.angular-utils.WidgetDef","ccri.bars.mgr","ccri.bars.Widget","CONFIG",function(a,b,c,d,e,f,g){var h,i=a.search(),j=_.get(i,"state");j&&(h=c.open({templateUrl:"core/save/loadModal.tpl.html",keyboard:!1,backdrop:"static",backdropClass:"wizardMask"}),DataSourceManager.loadDataSources().then(function(){b(function(){AppState.StateManager.getInstance().load(j).then(function(){h.dismiss("State Loaded"),ccriCorealerter.alerter.successMsg("Saved state loaded.")},function(){h.dismiss("State Load failed"),ccriCorealerter.alerter.errorMsg("Failed to load saved state.")})})},function(){h.dismiss("Capabilities Error")})),_.has(g,"app-state.showGenerateLink")&&_.get(g,"app-state.showGenerateLink")&&e.insert("top",new f({widget:new d({tag:"st-save-button"})}),ccriBars.Position[ccriBars.Position.Last],825)}]).controller("stealth.core.save.modalController",["$rootScope","$scope","$window","CONFIG",function(a,b,c,d){var e=AppState.StateManager.getInstance();b.expirationDays=_.get(d,"app-state.shareableLink.expirationDays",0),(!_.isNumber(b.expirationDays)||b.expirationDays<0)&&(b.expirationDays=0),b.classOptions=_.get(d,"classification.options",["UNCLASSIFIED"]),b.classification=_.last(b.classOptions),b.status={saveStarted:!1,saveComplete:!1,saveError:"",isOpen:!1},a.$emit("SaveState"),b.setClassification=function(a){b.classification=a},b.save=function(){var a=moment.utc(),f=d.userCn+"-"+a.format(),g={shared:!0};b.expirationDays>0&&(g.expires=a.add(b.expirationDays,"days").toISOString()),b.status.saveStarted=!0,e.save(f,b.classification,g).then(function(a){b.$evalAsync(function(){b.status.saveComplete=!0,b.url=c.location.origin+c.location.pathname+"#?state="+a})},function(a){b.$evalAsync(function(){b.status.saveComplete=!0,b.status.saveError=a})})}}]).directive("stSaveButton",["$uibModal",function(a){return{restrict:"E",templateUrl:"core/save/save.tpl.html",scope:{},bindToController:!0,controllerAs:"ctrl",controller:function(){this.onClick=function(){a.open({templateUrl:"core/save/saveModal.tpl.html",controller:"stealth.core.save.modalController",backdrop:"static",backdropClass:"wizardMask"})}}}}]),angular.module("stealth.core.sidebar",["ccri.angular-utils"]).service("sidebarManager",["$log",function(a){function b(){var a=e;_.each(h,function(b){var c=_.find(g,{id:b});c&&(c.panel.style.left=a+"px",a+=parseInt(c.panel.style.width.slice(0,-2),10))})}a.debug("stealth.core.sidebar.sidebarManager: service started");var c,d,e=36,f=0,g=[],h=[],i=!1;this.getButtons=function(){return g},this.getButtonEmitterById=function(a){var b=_.find(g,{id:a});return b?b.emitter:null},this.addButton=function(a,b,c,d,e,h,i){var j=f++,k=new EventEmitter;return g.push({id:j,iconClass:b,permanent:h,onClose:i,emitter:k,panel:{title:a,style:{width:c+"px"},open:!1,contentDef:d,toolDef:e,pinned:!1}}),k.emit("added"),j},this.removeButton=function(a,c){var d=_.remove(g,{id:a});_.isEmpty(d)||(_.each(d,function(a){a.emitter.emit("removed"),_.isFunction(a.onClose)&&a.onClose(!!c)}),_.pull(h,a),b())},this.pinButton=function(a,b,c){var d;c?_.each(g,function(b){a===b.id?d=b:b.panel.pinned=!1}):d=_.find(g,{id:a}),d&&(b&&this.toggleButton(a,!0),d.panel.pinned=!0)},this.unpinButton=function(a){var b=_.find(g,{id:a});b&&(b.panel.pinned=!1)},this.toggleButton=function(a,c){var d=_.find(g,{id:a});return d&&c!==d.panel.open&&(d.panel.pinned=!1,d.panel.open?(delete d.panel.style.left,_.pull(h,d.id),d.emitter.emit("collapsed")):(_.each(g,function(b){b.id===a||b.panel.pinned||(b.panel.open&&d.emitter.emit("collapsed"),b.panel.open=!1,delete b.panel.style.left,_.pull(h,b.id))}),h.push(a),d.emitter.emit("expanded")),b(),d.panel.open=c),a},this.getHideAll=function(){return i},this.setHideAll=function(a){i=a},this.getSidebarText=function(){return c},this.setSidebarText=function(a){c=a},this.getIconClass=function(){return d},this.setIconClass=function(a){d=a},this.setPanelTitle=function(a,b){var c=_.find(g,{id:a});c&&(c.panel.title=b)}}]).directive("stSidebar",["$log","sidebarManager",function(a,b){return a.debug("stealth.core.sidebar.stSidebar: directive defined"),{restrict:"E",replace:!0,scope:{},templateUrl:"core/sidebar/sidebar.tpl.html",controller:["$scope",function(a){a.manager=b}]}}]),angular.module("stealth.core.sidebar",[]).service("sidebarButtons",function(){function a(){this.open=!1}a.prototype=new EventEmitter,a.prototype.setOpen=function(a){this.open=!!a,this.emit(a?"opened":"closed")},a.prototype.isOpen=function(){return this.open};var b={};this.getByName=function(a){return b.hasOwnProperty(a)?b[a]:void 0},this.register=function(c){b[c]=new a},this.deregister=function(a){delete b[a]}}),angular.module("stealth.core.startmenu",["ccri.bars","ui.bootstrap"]).run(["$window","CONFIG","ccri.angular-utils.WidgetDef","ccri.bars.mgr","ccri.bars.Widget","startMenuManager",function(a,b,c,d,e,f){function g(b){switch(b.type){case"Link":b.metadata&&_.isString(b.metadata.url)&&f.addButton(b.title||b.type,b.iconClass,function(){0===b.metadata.url.indexOf("mailto")?a.open(b.metadata.url,"_self"):a.open(b.metadata.url)},b.grouping,b.order)}}function h(a){return _.every(a,i)}function i(a){return _.some(a,function(a){return _.some(b.userRoles,function(b){return a===b})})}d.insert("top",new e({widget:new c({tag:"ccri-bars-separator"})}),ccriBars.Position[ccriBars.Position.Last],800),d.insert("top",new e({widget:new c({tag:"st-user"})}),ccriBars.Position[ccriBars.Position.Last],900),d.insert("top",new e({widget:new c({tag:"st-start-menu"})}),ccriBars.Position[ccriBars.Position.Last],920);var j=_.get(b,"app.menu.extraItems");_.isArray(j)&&_.each(j,function(a){var b=0;switch(!_.isEmpty(a.requiredRoles)&&_.isArray(a.requiredRoles)&&(b=1,_.isArray(_.first(a.requiredRoles))&&(b=2)),b){case 0:return g(a);case 1:return i(a.requiredRoles)?g(a):null;case 2:return h(a.requiredRoles)?g(a):null}})}]).directive("stUser",["CONFIG",function(a){return{restrict:"E",templateUrl:"core/startmenu/user.tpl.html",scope:{},controller:["$scope",function(b){b.userCn=a.userCn}]}}]).service("startMenuManager",function(){var a={},b=0,c=this,d=function(){var b=[];_.forOwn(a,function(a,c){_.each(a,function(a){ccriUtils.orderedInsert(b,a,a.order?c+"__"+a.order:c)})}),c.buttonList=_.pluck(b,"thing")};this.buttonList=[],this.addButton=function(c,e,f,g,h,i){var j=b++,k=_.isEmpty(g)?"default":g,l={callBack:f,iconClass:e||"fa-square",id:j,grouping:k,order:h,title:c,menuOptions:i||null};if(_.isArray(a[k])){var m=_.sortedIndex(a[k],l,"title");a[k].splice(m,0,l)}else a[k]=[l];return d(),j},this.removeButton=function(b){_.forEach(_.values(a),function(a){return _.isEmpty(_.remove(a,"id",b))}),d()},this.triggerButton=function(a){_.isFunction(a.callBack)&&a.callBack()}}).directive("stStartMenu",["startMenuManager",function(a){return{restrict:"E",templateUrl:"core/startmenu/startmenu.tpl.html",scope:{},controller:["$scope",function(b){b.manager=a}]}}]),angular.module("stealth.core.utils").filter("attributeLabel",["CONFIG",function(a){return function(b){return _.get(a,["app","attributeLabels",b])||_.startCase(b)}}]),angular.module("stealth.core.utils").service("boundsHelper",[function(){this.boundsFromXMLString=function(a){var b=[];return[].slice.call(ol.xml.parse(a).firstChild.children).forEach(function(a){a.textContent.split(" ").forEach(function(a){b.push(Number(a))})}),b}}]),angular.module("stealth.core.utils").service("colors",[function(){return ccriUtils.colors}]),angular.module("stealth.core.utils.cookies",["ngCookies"]).service("cookies",["$cookies","CONFIG",function(a,b){var c=function(a,c){return b.app.context+"."+a+".v"+c};this.get=function(b,d){return a.getObject(c(b,d))},this.put=function(b,d,e,f){return a.putObject(c(b,d),e,{expires:moment.isMoment(f)?f.toDate():moment.isDate(f)||_.isString(f)?f:null})}}]),angular.module("stealth.core.utils").factory("stealth.core.utils.BboxClauseInfo",[function(){var a=/^BBOX\(([^,]*),\s*(.*)\)/,b=function(b){var c=a.exec(b);if(_.isArray(c)&&c.length>=3){var d=c[2].split(",");4===d.length?(this.geomField=c[1],this.extent=_.map(d,function(a){return parseFloat(a)})):this.error="BBOX filter ("+b+") has invalid extent."}else this.error="Failed to parse filter: "+b};return b}]).factory("stealth.core.utils.DtgClauseInfo",[function(){var a=/^(.*)\s+DURING\s+(.*)\s*\/\s*(.*)/,b=/^(.*)\s+>=\s+'(.*)'\s+AND\s+\1\s+<=\s+'(.*)'/,c=function(c){var d=b.exec(c)||a.exec(c);_.isArray(d)&&d.length>=4&&(this.dtgField=d[1],this.startDtg=moment(d[2]),this.endDtg=moment(d[3])),null===d&&(this.error="Failed to parse dtg filter: "+c)};return c}]).factory("stealth.core.utils.GeomClauseInfo",[function(){var a=/^INTERSECTS\(([^,]*),\s*(.*)\)/,b=new ol.format.WKT,c=function(c){var d=a.exec(c);_.isArray(d)&&d.length>=3?(this.geomField=d[1],this.geomFeatures=[b.readFeature(d[2])]):this.error="Failed to parse filter: "+c};return c}]).service("cqlHelper",[function(){function a(d,e,f){if(d instanceof arrow_geo.UnaryFunc)throw new Error("Cannot translate arrow_geo.UnaryFunc expression into CQL.");var g=d.getChildren();if(g.length){var h=b(d);return"("+g.map(function(b){return a(b,d,f)}).join(" "+h+" ")+")"}if(d instanceof arrow_geo.Col)return d.name;if(d instanceof arrow_geo.Literal){if(e&&f){var i=_.find(e.getChildren(),function(a){return a instanceof arrow_geo.Col});return c(i?f(d.v,i.name):d.v)}return c(d.v)}throw new Error("Unsupported arrow_geo expression type.")}function b(a){if(a instanceof arrow_geo.And)return"AND";if(a instanceof arrow_geo.Or)return"OR";if(a instanceof arrow_geo.Equals)return"=";if(a instanceof arrow_geo.LTeq)return"<=";if(a instanceof arrow_geo.GTeq)return">=";throw new Error("Unsupported arrow_geo expression type; can't get operand.")}function c(a){return"string"==typeof a?"'"+a+"'":"number"==typeof a?a:a}this.operator={AND:"AND",OR:"OR"},this.combine=function(a){var b=_.filter(_.flatten(_.rest(arguments)),function(a){return _.isString(a)&&!_.isEmpty(a.trim())&&!_.isEmpty(a.replace(/[()]|INCLUDE/gi,"").trim())});return b=b.length>1?_.map(b,function(a){return"("+a.trim()+")"}):_.map(b,function(a){return a.trim()}),b.join(" "+a+" ")||"INCLUDE"},this.buildFeature=function(a){function b(a){return(1e5*a|0)/1e5}var c=[];a.forEach(function(a){var b=a.getGeometry();if(b instanceof ol.geom.MultiPolygon){var d=b.getPolygons();d.forEach(function(a){c.push(a)})}else b instanceof ol.geom.Polygon&&c.push(b)}),c.forEach(function(a){a.setCoordinates(a.getCoordinates().map(function(a){return a.map(function(a){return[b(a[0]),b(a[1])]})}))});var d;if(c.length>1){var e=[];c.forEach(function(a){e.push(a.getCoordinates())}),d=new ol.geom.MultiPolygon(e)}else d=c[0];return d?(new ol.format.WKT).writeFeature(new ol.Feature(d)):null},this.buildFeatureFilter=function(a,b){var c=this.buildFeature(a);return c?"INTERSECTS("+(b||"geom")+", "+c+")":null},this.buildFeatureFilterSwapFeatureAndGeom=function(a,b){var c=this.buildFeature(a);return c?"INTERSECTS("+c+", '"+(b||"geom")+"')":null},this.buildDtgFilter=function(a,b,c,d,e){_.isString(b)&&(b=moment.utc(b)),_.isString(c)&&(c=moment.utc(c));var f=!!d,g=_.isFunction(e)?e:function(a){return a.toISOString()};if(moment.isMoment(b)&&b.isValid()&&moment.isMoment(c)&&c.isValid()){var h=b,i=c;return b.isAfter(c)&&(h=c,i=b),f?a+" >= '"+g(h)+"' AND "+a+" <= '"+g(i)+"'":a+" DURING "+g(h)+"/"+g(i)}return moment.isMoment(b)&&b.isValid()?f?a+" >= '"+g(b)+"'":a+" AFTER "+g(b):moment.isMoment(c)&&c.isValid()?f?a+" <= '"+g(c)+"'":a+" BEFORE "+g(c):"INCLUDE"},this.buildBboxFilter=function(a,b){return"BBOX("+a+","+b.join()+")"},this.buildSpaceTimeFilter=function(a){return this.combine(this.operator.AND,this.buildBboxFilter(a.geomField.name,[a.minLon,a.minLat,a.maxLon,a.maxLat]),this.buildDtgFilter(a.dtgField.name,a.startDtg,a.endDtg,a.dtgField.isString,a.dtgField.dtgFormatter),a.cql);
},this.bboxToPolygon=function(a){return"POLYGON(("+a[0]+" "+a[1]+","+a[0]+" "+a[3]+","+a[2]+" "+a[3]+","+a[2]+" "+a[1]+","+a[0]+" "+a[1]+"))"},this.generateLineString=function(a){for(var b="LINESTRING(",c=0;c<a.length;c++)b+=a[c][0]+" "+a[c][1]+", ";return b=b.slice(0,-2)+")"},this.buildFreeTextFilter=function(a,b,c){return _.isArray(b)||(b=[b]),this.combine(this.operator.OR,_(ccriUtils.string.tokenizeSearchText(a)).map(function(a){return _(b).map(function(b){return b+(c?" ILIKE '%"+a+"%'":a.indexOf("%")>-1?" ILIKE '"+a+"'":" = '"+a+"'")}).value()}).flatten().value())},this.filterEmptyCqlParams=function(a){var b=["both"," = true"," = false"],c=_.mapValues(a,function(a,c){switch(c){case"strings":return _.pick(a,function(a){return _.isString(a)&&!_.isEmpty(a.trim())});case"numbers":return _.pick(a,function(a){return _.isNumber(a.min)||_.isNumber(a.max)});case"bools":return _.pick(a,_.bind(function(a){return a!==b[0]},this));case"enums":return _.pick(a,function(a){return!_.isEmpty(a.selected)});case"datetimes":return _.pick(a,function(a){return moment.isMoment(a.min)&&a.min.isValid()||moment.isMoment(a.max)&&a.max.isValid()});default:return a}});return _.pick(c,function(a){return!(_.isEmpty(a)||_.isNull(a))})},this.cloneCqlParams=function(a){var b=_.cloneDeep(a,function(a){return moment.isMoment(a)?a.clone():void 0});return _.has(b,"datetimes")&&(b.datetimes=_.mapValues(b.datetimes,function(a){return _.isString(a.min)&&(a.min=moment.utc(a.min)),_.isString(a.max)&&(a.max=moment.utc(a.max)),a})),b},this.fromArrowExpr=function(b,c){return a(b,null,c)}}]).factory("CqlFormBuilder",["$filter","$timeout","cqlHelper",function(a,b,c){var d=function(d,e,f){this.params=_.merge({},d),f=f||{},this.numberMinPlaceholder=f.numberMinPlaceholder||"Enter min value",this.numberMaxPlaceholder=f.numberMaxPlaceholder||"Enter max value",this.stringPlaceholder=f.stringPlaceholder||"Enter search term(s)",this.freeTextDirections=f.freeTextDirections||"Separate terms with spaces or commas. Wrap phrases in double-quotes.<br>Individual terms can contain % as a wildcard.",this.booleanOptions=["both"," = true"," = false"],this.booleanLabelFn=_.bind(function(a){return a===this.booleanOptions[0]?"&nbsp;":a===this.booleanOptions[1]?"True":"False"},this);var g;this.build=function(){g&&b.cancel(g),g=b(_.bind(function(){var b=null;_.each(_.pick(this.params.strings,function(a){return _.isString(a)&&!_.isEmpty(a.trim())}),function(a,d){b=c.combine(c.operator.AND,b,c.buildFreeTextFilter(a,[d]))}),_.each(this.params.numbers,function(d,e){var f=d.convert||(d.fromUnit&&d.toUnit?MathUtils.converter.convert:_.identity);_.isNumber(d.min)&&(b=c.combine(c.operator.AND,b,e+" >= "+a("numberTrim")(f(d.min,d.fromUnit,d.toUnit),4).replace(/,/g,""))),_.isNumber(d.max)&&(b=c.combine(c.operator.AND,b,e+" <= "+a("numberTrim")(f(d.max,d.fromUnit,d.toUnit),4).replace(/,/g,"")))}),_.each(this.params.bools,_.bind(function(a,d){a!==this.booleanOptions[0]&&(b=c.combine(c.operator.AND,b,d+a))},this)),_.each(this.params.enums,function(a,d){_.isEmpty(a.selected)||(b=c.combine(c.operator.AND,b,d+" IN ('"+a.selected.join("','")+"')"))}),_.each(this.params.datetimes,function(a,d){b=c.combine(c.operator.AND,b,c.buildDtgFilter(d,a.min,a.max,!0))}),b=c.combine(c.operator.AND,b,this.params.additionalCql),e("INCLUDE"===b?"":b,this.params)},this),500)},this.updateEnumSelection=function(a,b){_.includes(a,b)?_.pull(a,b):a.push(b),this.build()}};return d}]),angular.module("stealth.core.utils").filter("formatMeters",["$filter",function(a){return function(b,c){if(_.isNumber(b)){var d=" ";return b>1e3&&(d=" k",b/=1e3),a("numberTrim")(b,c)+d+"m"}return""}}]).filter("formatMiles",["$filter",function(a){return function(b,c){if(_.isNumber(b)){var d=" mi";return b<1&&(d=" ft",b*=5280),a("numberTrim")(b,c)+d}return""}}]).filter("formatNauticalmiles",["$filter",function(a){return function(b,c){if(_.isNumber(b)){var d=" nm";return b<1&&(d=" ft",b*=6076),a("numberTrim")(b,c)+d}return""}}]).filter("formatDegrees",["$filter",function(a){return function(b,c){if(_.isNumber(b)){var d=" °";return b<1&&(d=" ′",b*=60,b<1&&(d=" ′′",b*=60)),a("numberTrim")(b,c)+d}return""}}]).filter("formatAngle",["$filter",function(a){return function(b,c,d,e){if(_.isNumber(b)){for(e&&(b%=360);d&&b<0;)b+=360;return a("numberTrim")(b,c)+"°"}return""}}]).filter("formatBearing",[function(){return function(a){if(!_.isNumber(a))return"NaN";for(a=Math.round(a);a<0;)a+=360;a>=360&&(a%=360);var b=_.padLeft(a,3,"0");return b+"°"}}]).filter("coordToDMSH",function(){var a=function(a){return ol.coordinate.toStringHDMS(a).replace(/([NnSs]) /,"$1:::").replace(/\s/g,"").split(":::")};return function(b){return _.isArray(b)?_.isNumber(b[0])?a(b):_.map(b,a):b}}).filter("coordToDMSHWithColons",["$filter",function(a){function b(a){return a.replace("°",":").replace("′",":").replace("″",".00 ")}return function(c){return a("coordToDMSH")(c).map(b)}}]).filter("numberTrim",["$filter",function(a){return function(b,c){var d=_([b]).flatten().map(function(b){var d=a("number")(b,c);return _.isString(d)&&d.match(/\./)?(d=d.replace(/0+$/,""),d.replace(/\.$/,"")):d}).value();return _.isArray(b)?d:d[0]}}]).filter("uriCat",[function(){return ccriUtils.uri.concatUri}]),angular.module("stealth.core.utils").service("stealth.core.utils.keyboard",["$document",function(a){var b=0,c=[],d=function(a){_.contains(c,a.keyCode)||c.push(a.keyCode)},e=function(a){_.pull(c,a.keyCode)};this.listen=function(){b=Math.max(0,++b),1===b&&a.on("keydown",d).on("keyup",e)},this.unlisten=function(f){b=f?0:Math.max(0,--b),0===b&&(a.off("keydown",d).off("keyup",e),c=[])},this.isDown=function(a,b){if(_.isArray(a)&&a.length){var d=_.intersection(c,a).length===a.length;return d&&(!b||c.length===a.length)}return!1}}]),angular.module("stealth.core.utils").directive("stPager",[function(){return{restrict:"E",scope:{paging:"=?",records:"="},templateUrl:"core/utils/paging.tpl.html",link:function(a){a.paging=_.merge({suggestedPage:1,currentPage:1,pageSize:20,checkSuggestedPage:function(){a.paging.suggestedPage>0&&a.paging.suggestedPage<=a.paging.numberOfPages()&&(a.paging.currentPage=a.paging.suggestedPage)},filter:function(a){return a},numberOfPages:function(){var b=0,c=a.paging.filter(a.records);return _.isArray(c)&&(b=Math.ceil(c.length/a.paging.pageSize)),b},previousPage:function(){a.paging.suggestedPage=a.paging.currentPage=a.paging.currentPage<2?a.paging.numberOfPages():a.paging.currentPage-1},nextPage:function(){a.paging.suggestedPage=a.paging.currentPage=a.paging.currentPage>=a.paging.numberOfPages()?1:a.paging.currentPage+1},currentPageFirstIndex:function(){return(a.paging.currentPage-1)*a.paging.pageSize},pageToRecordIndex:function(b){a.paging.suggestedPage=a.paging.currentPage=Math.ceil((b+1)/a.paging.pageSize)}},a.paging)}}}]),angular.module("stealth.core.utils",["stealth.core.geo.ol3.format","stealth.core.geo.ol3.geodetics"]).service("clickSearchHelper",["$filter","ol3Geodetics","stealth.core.geo.ol3.format.GeoJson","CONFIG",function(a,b,c,d){function e(a){return a.indexOf("zoom")!==-1}function f(a){return a.indexOf("nearest")!==-1}var g=d.map.clicksearch.strategy,h=d.map.clicksearch.fixedPixelBuffer,i=d.map.clicksearch.zoomMeterBuffer,j=new c,k=new ol.proj.Projection({code:d.map.projection,units:d.map.units});this.getLayerOverrides=function(a){var b={};return _.has(a,"click.search.strategy")&&(b.strategy=_.get(a,"click.search.strategy")),_.has(a,"click.search.fixed.pixelBuffer")&&(b.fixedPixelBuffer=_.get(a,"click.search.fixed.pixelBuffer")),_.has(a,"click.search.zoom.meterBuffer")&&(b.zoomMeterBuffer=_.get(a,"click.search.zoom.meterBuffer")),_.has(a,"field.add")&&(b.showFields=_.get(a,"field.add")),b},this.getSearchExtent=function(a,b,c){c=c||{};var d=a[0],f=a[1],j=c.fixedPixelBuffer||h,l=c.zoomMeterBuffer||i,m=c.strategy||g,n=b*j;return e(m)&&(n=Math.max(n,l/k.getMetersPerUnit())),[d-n,f-n,d+n,f+n]},this.sortAndTrimFeatures=function(c,e,h){h=h||{};var i=_.sortBy(e,function(e){var f,g=_.isFunction(e.getProperties)?e.getProperties():e.properties;if(h.geom&&_.contains(_.keys(g),h.geom)&&(f=j.readGeometry(g[h.geom])),f||(f=_.isFunction(e.getGeometry)?e.getGeometry():j.readGeometry(e.geometry)),_.isFunction(f.getType)&&"Point"===f.getType()){var i="false"!==_.get(d.map.clicksearch.add,"Lat-Lon",!1).toString().toLowerCase(),k="false"!==_.get(h.showFields,"Lat-Lon",i).toString().toLowerCase();if(k){var l=a("coordToDMSH")(f.getCoordinates());l=l[0]+", "+l[1],_.isFunction(e.set)?e.set("Lat-Lon",l):e.properties["Lat-Lon"]=l}}return b.distanceHaversine([c,f.getClosestPoint(c)])}),k=h.strategy||g;if(f(k)){var l=k.split("-"),m=1;return l.length>=3&&(m=parseInt(k.split("-")[2],10)||m),_.take(i,m)}return i}}]),angular.module("stealth.core.utils",[]).constant("stealth.core.utils.SFTAttributeTypes",function(){var a=["String","Integer","Long","Double","Float","Boolean","UUID","Date"],b=["Geometry","Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"];return{simple:a,geom:b,all:a.concat(b)}}()),angular.module("stealth.core.utils").service("stylepicker",["ol3Styles",function(a){var b=this;this.defaultStyleMatcher=function(b,c){var d=[],e=c.size,f=c.fillColor;switch(b.getGeometry().getType()){case"MultiLineString":case"LinearRing":case"LineString":d.push(a.getLineStyle(e,f));break;case"MultiPolygon":case"Circle":case"Polygon":d.push(a.getPolyStyle(e,f));break;case"MultiPoint":case"Point":d.push(a.getPointStyle(e,f))}return d},this.hiddenStyleFunction=function(a,c,d){var e=c.getStyleFunction();return e?e.call(c,d):b.defaultStyleMatcher(c,a)},this.styleFunction=function(a){var c=_.curry(b.hiddenStyleFunction);return c(a)}}]),angular.module("stealth.core.utils").directive("stToggleMapLayer",["$log",function(a){var b="stealth.core.utils.stToggleLayer: ";return a.debug(b+"directive defined"),{restrict:"E",templateUrl:"core/utils/toggleMapLayer.tpl.html",scope:{visible:"=",loading:"=",toggle:"&"}}}]),angular.module("stealth.core.utils").directive("stUploadFile",[function(){return{restrict:"E",templateUrl:"core/utils/upload.tpl.html",scope:{process:"&processFile",tooltip:"@?tooltipText"},link:function(a,b){var c=b.find("input");c.on("change",function(b){a.process({file:b.target.files[0]})}),a.upload=function(){c[0].value=null,a.$evalAsync(function(){c.click()})}}}}]),angular.module("stealth.core.utils").service("user",["CONFIG",function(a){this.getCn=function(){return a.userCn},this.getStrippedCn=function(){return this.getCn().replace(/\W/g,"")}}]),angular.module("stealth.core.utils").directive("stFloatInput",["$log",function(a){return a.debug("stealth.core.utils.stFloatInput: directive defined"),{require:"ngModel",link:function(a,b,c,d){d.$parsers.unshift(function(a){if(a)return parseFloat(a)}),d.$formatters.push(function(a){if(a)return a.toString(10)})}}}]).directive("stIntInput",["$log",function(a){return a.debug("stealth.core.utils.stIntInput: directive defined"),{require:"ngModel",link:function(a,b,c,d){d.$parsers.unshift(function(a){return parseInt(a,10)}),d.$formatters.push(function(a){return a.toString(10)})}}}]).directive("stKmToMetersFormat",[function(){return{restrict:"A",require:"ngModel",priority:-10,link:{pre:function(a,b,c,d){d.$parsers.push(function(a){return null===a?a:1e3*a}),d.$formatters.push(function(a){return a||0===a?a/1e3:a})}}}}]).directive("stFtToMetersFormat",[function(){return{restrict:"A",require:"ngModel",priority:-10,link:{pre:function(a,b,c,d){d.$parsers.push(function(a){return null===a?a:.3048*a}),d.$formatters.push(function(a){return a||0===a?a/.3048:a})}}}}]).directive("stMpsToKnotsFormat",[function(){return{restrict:"A",require:"ngModel",priority:-10,link:{pre:function(a,b,c,d){d.$parsers.push(function(a){return null===a?a:a/1.94384}),d.$formatters.push(function(a){return a||0===a?1.94384*a:a})}}}}]).directive("stRoundFormat",[function(){return{restrict:"A",require:"ngModel",priority:-5,link:{pre:function(a,b,c,d){d.$formatters.push(function(a){return a||0===a?Math.round(a):a})}}}}]).value("getClassificationClass",function(a){if(_.isString(a)&&!_.isEmpty(a))switch(a[0].toUpperCase()){case"U":return"unclassified";case"C":return"confidential";case"S":return"secret";case"T":return"topSecret"}return null}).filter("isEmpty",function(){return function(a){return angular.isUndefined(a)||""===a||null===a||a!==a}}),angular.module("stealth.core.utils").directive("stToggleVisibility",function(){return{templateUrl:"core/utils/visibility.tpl.html",scope:{visible:"=",toggle:"&"}}}),angular.module("stealth.core.utils").service("elementAppender",["$templateCache","$compile",function(a,b){this.append=function(c,d,e,f){var g=angular.element(c),h=angular.element(a.get(d)),i={},j=e.$watch(i,function(){var a=b(i)(e);g.append(a),_.isFunction(f)&&f(a),j()});i=angular.element(h)}}]),angular.module("stealth.core.wizard",["stealth.display","stealth.wizard"]).run(["stealth.display.registry","stealth.wizard.wizardDispatcher",function(a,b){var c,d,e;b.registerLaunchListener(function(){c=a.listActive(),e=a.selected,d=_.find(_.pluck(a.views,"thing"),{type:"map"}),d&&a.emit("show.only",{new:d,old:c,selected:e})}),b.registerCloseListener(function(){d&&a.emit("show.only.revert",{new:d,old:c,selected:e}),d=null})}]),angular.module("stealth.core.wizard",["stealth.wizard"]).service("wizardManager",["stealth.wizard.wizardManager",function(a){return a}]),angular.module("stealth.core.wizard").factory("stealth.core.wizard.Wizard",["stealth.wizard.Wizard",function(a){return a}]).factory("stealth.core.wizard.Step",["stealth.wizard.Step",function(a){return a}]),angular.module("stealth.drawroute.category",["stealth.core.geo.ol3.geodetics"]).run(["$log","$rootScope","$filter","ol3Map","wfs","owsLayers","categoryManager","stealth.core.geo.ol3.manager.Category","ccri.angular-utils.WidgetDef","stealth.core.geo.ol3.layers.MapLayer","colors","savedRouteWizard","ol3Geodetics","CONFIG",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){var o="stealth.routeanalysis.geo: ";a.debug(o+"run called");var p=b.$new();p.workspaces={},p.launchRouteAnalysisWizard=function(a){b.$emit("routeanalysis:run:analysis",{routeLayer:a})},p.removeLayer=function(a,b){_.isUndefined(b.routeanalysis)||(b.routeanalysis.viewState.toggledOn&&b.routeanalysis.closePopup(b.routeanalysis),delete b.routeanalysis),_.pull(a.derivedLayers,b)},p.showRoute=function(a){var b=new ol.source.Vector({features:[new ol.Feature({geometry:a.the_geom})],wrapX:!1}),c=new ol.layer.Vector({source:b,style:new ol.style.Style({stroke:new ol.style.Stroke({color:a.fillColor,width:3}),fill:new ol.style.Fill({color:a.fillColor})})}),e=new j(ccriUtils.uuid.generate(),a.name,c);c.mapLayerId=e.id,a.mapLayerId=e.id,a.viewState.isOnMap=!0,a.viewState.toggledOn=c.getVisible(),d.addLayer(e)},p.toggleVisibility=function(a){var b=d.getLayerById(a.mapLayerId),c=b.getOl3Layer();a.viewState.toggledOn=!a.viewState.toggledOn,c.setVisible(!c.getVisible())};var q=function(a){e.getFeatureTypeDescription(n.geoserver.defaultUrl,a.Name).then(function(b){a.featureTypeDescription=b})},r="drawroute";f.getLayers(r,!1).then(function(b){a.debug("owsLayers.getLayers()"),_.each(b,function(a){var b=_.cloneDeep(a);b.derivedLayers=[],q(b),_.each(_.deepGet(b.KeywordConfig,r),function(a,c,d){var e=d[c];_.forOwn(e,function(a,c){_.isArray(p.workspaces[c])?p.workspaces[c].push(b):p.workspaces[c]=[b]})})})});var s=new i({tag:"st-draw-route-category",scope:p,isolateScope:!0}),t=new h(1,"Routes","fa-long-arrow-right",s,null,(!0));g.addCategory(1,t),b.$on("drawroute:drawn:route",function(a,b){p.addRoute(b),b.routeFeature.setProperties({user:n.userCn,date:(new Date).toISOString(),name:b.name}),e.writeInserts([b.routeFeature],c("uriCat")(n.geoserver.defaultUrl,"/wfs"),n.drawroute.routesWorkspace+":"+n.drawroute.routesLayer,n.drawroute.routesWorkspace).then(function(a){a&&(b.routeFeature.setId(a.insertIds[0]),ccriCorealerter.alerter.successMsg("Successfully saved route on server."))},function(){ccriCorealerter.alerter.errorMsg("Could not save route on server.")})}),p.addRouteFromStore=function(a){p.addRoute({name:a.getProperties().name,workspaceName:a.getProperties().user,color:k.getColor(),routeGeom:a.getProperties().geometry})},p.addRoute=function(a){var b={name:a.name,workspace:a.workspaceName,fillColor:a.color,viewState:{isOnMap:!1,toggledOn:!1},the_geom:a.routeGeom};_.isArray(p.workspaces[b.workspace])?p.workspaces[b.workspace].push(b):p.workspaces[b.workspace]=[b],p.showRoute(b)},p.removeRoute=function(a){if(!_.isUndefined(a.derivedLayers))for(var b=0;b<a.derivedLayers.length;b++)a.derivedLayers[b].routeanalysis.cleanup(a.derivedLayers[b].routeanalysis);d.removeLayerById(a.mapLayerId);var c,e=p.workspaces[a.workspace];1===e.length?delete p.workspaces[a.workspace]:(c=e.indexOf(a),e=e.splice(c,1)),d.removeLayerById(p.traceLayerId),delete p.traceLayerId},b.$on("drawroute:add:routeanalysis",function(a){_.isUndefined(a.route.derivedLayers)?a.route.derivedLayers=[a.derivedLayer]:a.route.derivedLayers.push(a.derivedLayer)});var u;b.$on("drawroute:trace:point",function(a,b){var c=b.distance,e=b.route.the_geom.getCoordinates(),f=0,g=0;for(g=0;f<c;g++)c-=f,f=m.distanceVincenty([e[g],e[g+1]]);var h,i=m.vincentyInitialBearing([e[g-1],e[g]]),k={lon:e[g-1][0],lat:e[g-1][1]},l=OpenLayers.Util.destinationVincenty(k,i[0],c);if(_.isUndefined(p.traceLayerId)){var n=new ol.source.Vector({features:[new ol.Feature({geometry:new ol.geom.Point([l.lon,l.lat])})]}),o=new ol.layer.Vector({source:n,style:new ol.style.Style({image:new ol.style.Circle({radius:5,fill:new ol.style.Fill({color:b.route.fillColor})})})});h=new j(ccriUtils.uuid.generate(),b.route.name+" trace",o),p.traceLayerId=h.id,u=b.route.fillColor,d.addLayer(h)}else{h=d.getLayerById(p.traceLayerId);var q=new ol.source.Vector({features:[new ol.Feature({geometry:new ol.geom.Point([l.lon,l.lat])})]}),r=h.getOl3Layer();r.setSource(q),b.route.fillColor!==u&&(r.setStyle(new ol.style.Style({image:new ol.style.Circle({radius:5,fill:new ol.style.Fill({color:b.route.fillColor})})})),u=b.route.fillColor)}}),b.$on("drawroute:trace:stop",function(a){d.removeLayerById(p.traceLayerId),delete p.traceLayerId}),p.showRouteAnalysis=function(a){b.$emit("routeanalysis:show:results",{routeanalysis:a})},p.updateRouteAnalysisTitle=function(a){a.routeanalysis.title=a.title},p.launchSavedRouteWizard=function(){l.setCategoryScope(p),l.launch()},s=t=null}]).directive("stDrawRouteCategory",["$log",function(a){var b="stealth.drawroute.category.stDrawRouteCategory: ";return a.debug(b+"directive defined"),{templateUrl:"drawroute/category/category.tpl.html"}}]),angular.module("stealth.drawroute",["stealth.drawroute.category","stealth.drawroute.wizard"]),angular.module("stealth.drawroute.wizard",["ccri.angular-utils","stealth.drawroute.category","stealth.core.geo.ol3.utils","stealth.core.geo.ol3.overlays","stealth.wizard"]).run(["$rootScope","$timeout","startMenuManager","stealth.wizard.wizardManager","stealth.core.wizard.Wizard","stealth.core.wizard.Step","ccri.angular-utils.WidgetDef","ol3Map","ol3Styles","colors","stealth.core.geo.ol3.overlays.Vector","elementAppender","stealth.core.geo.ol3.utils.routeDrawHelper",function(a,b,c,d,e,f,g,h,i,j,k,l,m){var n=1,o=function(){var c=a.$new(),o=j.getColor();angular.extend(c,{name:"Route "+n++,workspaceName:"Routes",type:"route",source:"drawing",color:o,style:{"background-color":o},datasources:[]});var p=new k({colors:["#CC0099"],styleBuilder:_.curry(i.getLineStyle)(3)}),q=new ol.interaction.Modify({features:p.getFeatures(),deleteCondition:function(a){return ol.events.condition.altShiftKeysOnly(a)&&ol.events.condition.singleClick(a)}}),r=new ol.interaction.Draw({features:p.getFeatures(),type:"LineString",geometryName:"the_geom"});r.on("drawstart",function(a){c.$apply(function(){c.geoFeature?r.finishDrawing():m.initFeature(a.feature,c)})}),r.on("drawend",function(){return b(function(){r.setActive(!1)},1),!1});var s=null;c.featureOverlay=p,d.launchWizard(new e("Draw Route","fa-long-arrow-right","fa-ellipsis-h",[new f("Define route",new g({tag:"st-dr-wiz-draw",scope:c}),null,(!1),function(){c.geoFeature&&m.initFeature(c.geoFeature,c),p.addToMap(),h.addInteraction(q),h.addInteraction(r),l.append(".primaryDisplay","drawroute/wizard/templates/routePoints.tpl.html",c,function(a){s=a})},function(){s&&s.remove(),h.removeInteraction(r),h.removeInteraction(q),p.removeFromMap(),c.geoFeature&&m.detachFeature(c.geoFeature)}),new f("Set options",new g({tag:"st-dr-route-options-wiz",scope:c}),null,(!0),null,function(b){b&&a.$emit("drawroute:drawn:route",{name:c.name,workspaceName:c.workspaceName,routeFeature:c.geoFeature,routeGeom:c.geoFeature.getGeometry(),color:c.color})})],c,(void 0),function(){r=null}))};c.addButton("Draw Route","fa-long-arrow-right",o)}]).directive("stDrWizDraw",[function(){return{restrict:"E",replace:!0,templateUrl:"drawroute/wizard/templates/draw.tpl.html"}}]).directive("stDrRouteOptionsWiz",[function(){return{restrict:"E",replace:!0,templateUrl:"drawroute/wizard/templates/routeOptions.tpl.html"}}]).service("savedRouteWizard",["$log","$rootScope","stealth.wizard.wizardManager","colors","stealth.core.wizard.Step","stealth.core.wizard.Wizard","ccri.angular-utils.WidgetDef","wfs","CONFIG",function(a,b,c,d,e,f,g,h,i){var j="stealth.routeanalysis.wizard.savedRouteWizard: ";a.debug(j+"service started");var k;this.setCategoryScope=function(a){k=a},this.launch=function(){var a=b.$new(),j=[];a.routes=[];var l=i.drawroute.routesWorkspace+":"+i.drawroute.routesLayer;h.getFeature(i.geoserver.defaultUrl,l).then(function(b){angular.isString(b.data)||b.data.features.forEach(function(b){var c=new ol.Feature({geometry:new ol.geom.LineString(b.geometry.coordinates)});c.setGeometryName(b.geometry_name),c.setId(b.id),c.setProperties(b.properties),c.set("date",new Date(c.get("date"))),a.routes.push(c)})}),j.push(new e("Choose Saved Route",new g({tag:"st-saved-routes-wiz",scope:a}))),angular.extend(a,{style:{"background-color":d.getColor()}});var m=new f("Import Saved Route","fa-long-arrow-right","fa-check text-success",j,a,"wizard-dark");c.launchWizard(m),a.addRouteFromStore=function(a){k.addRouteFromStore(a)}}}]).directive("stSavedRoutesWiz",function(){return{restrict:"E",templateUrl:"drawroute/wizard/templates/savedRoutes.tpl.html"}}),angular.module("stealth.histogram.geo",["ccri.angular-utils","ccri.time-controls","stealth.histogram.geo.ol3.layers","stealth.histogram.wizard"]).run(["$log","$rootScope","$timeout","ol3Map","wfs","cqlHelper","categoryManager","ccri.time-controls.manager","histogramQueryService","histogramWizard","histogramBuilder","stealth.core.geo.ol3.manager.Category","ccri.angular-utils.WidgetDef","stealth.core.geo.ol3.layers.MapLayer","stealth.core.geo.ol3.overlays.Vector","colors","CONFIG",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){function r(a,b,c){"time-lapse"===a.query.origin&&(a.query.params.startDtg=moment.utc(b),a.query.params.startDtg.valueOf()<a.query.params.minDtgMillis&&(a.query.params.startDtg=moment.utc(a.query.params.minDtgMillis)),a.query.params.endDtg=moment.utc(c),a.query.params.endDtg.valueOf()>a.query.params.maxDtgMillis&&(a.query.params.endDtg=moment.utc(a.query.params.maxDtgMillis)))}function s(a){var b,c,d,e;c=f.buildFeatureFilter(a.generatedFeatures,a.geomField.name);var g=c.replace("INTERSECTS("+a.geomField.name+",","");g=g.substring(0,g.length-1),a.cqlBounds=g,"No Time Range"!==a.dtgField.name&&(d=f.buildDtgFilter(a.dtgField.name,a.startDtg,a.endDtg,a.dtgField.isString,a.dtgField.dtgFormatter)),b=[f.operator.AND,c,d],e=a.cql,_.isEmpty(e)||b.push(e),a.fullCqlFilter=f.combine.apply(f,b)}var t="stealth.histogram.geo: ";a.debug(t+"run called");var u,v=b.$new();v.workspaces={},v.toggleLayer=function(a){var b,e;if(_.isUndefined(a.mapLayerId)||_.isNull(a.mapLayerId)){var f=new ol.source.Vector({features:a.query.params.generatedFeatures});b=new ol.layer.Vector({source:f,style:new ol.style.Style({stroke:new ol.style.Stroke({color:a.viewState.fillColor}),fill:new ol.style.Fill({color:[255,255,255,.35]})})});var g=[-180,-90,180,90],i=_.filter(f.getFeatures(),function(a){return!_.isUndefined(a.getGeometry().getExtent())&&_.isEqual(a.getGeometry().getExtent(),g)});0===i.length?b.draggable=!0:b.setVisible(!1),b.onDragEnd=function(b,c){var d=b.index;_.isUndefined(d)||(a.query.params.generatedFeatures[d]=b,v.updateHistogram(c.mapLayerId))},b.onMouseOver=function(a,b){v.highlightLayer(b.mapLayerId),v.highlightPopup(b.mapLayerId)},b.onMouseLeave=function(){v.unhighlightLayer(b.mapLayerId),v.unhighlightPopup(b.mapLayerId)},u=h.registerListener(function(b,c,d,e){r(a,1e3*b,1e3*c),e()}),e=new n(ccriUtils.uuid.generate(),a.title,b,(!1),20),e.styleDirective="st-histogram-layer-style",e.styleDirectiveScope.styleVars.iconClass="fa fa-fw fa-bar-chart",e.styleDirectiveScope.derivedLayer=a,b.mapLayerId=e.id,a.mapLayerId=e.id,a.viewState.isOnMap=!0,a.viewState.toggledOn=b.getVisible(),a.viewState.isDraggable=!0,a.draggableTooltip="Disable region dragging",d.addLayer(e),a.changeListenerKey=b.on("change:visible",function(){c(function(){a.viewState.toggledOn=b.getVisible()})}),a.viewState.isLoading=!0,a.histogram={id:_.now(),viewState:{toggledOn:!1,isLoading:!1,isWizardInProgress:!!v.isWizardInProgress},layerId:a.mapLayerId},e.styleDirectiveScope.setFillColor=function(b){var c=new ol.style.Style({stroke:new ol.style.Stroke({color:b}),fill:new ol.style.Fill({color:[255,255,255,.35]})});e.getOl3Layer().setStyle(c),a.histogram.fillColor=b,!a.histogram.viewState.isWizardInProgress&&a.histogram.viewState.toggledOn&&a.histogram.updateBars(a.histogram)},v.updateHistogram(a.mapLayerId)}else a.changeListenerKey&&ol.Observable.unByKey(a.changeListenerKey),d.removeLayerById(a.mapLayerId),delete a.mapLayerId,a.viewState.isOnMap=!1,a.viewState.toggledOn=!1},v.removeLayer=function(a,b){_.isUndefined(b.histogram)||(b.histogram.viewState.toggledOn&&b.histogram.closePopup(b.histogram),delete b.histogram),b.viewState.isOnMap&&v.toggleLayer(b),h.unregisterListener(u),_.pull(a.derivedLayers,b)},v.toggleVisibility=function(a){var b=d.getLayerById(a.mapLayerId),c=b.getOl3Layer();c.setVisible(!c.getVisible())},v.toggleDraggable=function(a){var b=d.getLayerById(a.mapLayerId),c=b.getOl3Layer();a.viewState.isDraggable=!a.viewState.isDraggable,c.draggable=!c.draggable,a.viewState.isDraggable?a.draggableTooltip="Disable region dragging":a.draggableTooltip="Enable region dragging"},v.updateHistogramTitle=function(a){a.histogram.title=a.title},v.showHistogram=function(a){if(a.viewState.toggledOn)if(a.viewState.isLoading){var d=!0;k.build(a,d)}else b.$emit("histogram:focus",a.histId),c(function(){b.$emit("histogram:unhighlight",a.histId)},500);else k.build(a),a.viewState.toggledOn=!0},v.updateHistogram=function(a){var b=_.flatten(_.map(v.workspaces,_.identity)),c=_.flatten(_.pluck(b,"derivedLayers")),d=_.find(c,{mapLayerId:a});if(!(_.isUndefined(d)||d.histogram.viewState.isLoading||_.isUndefined(d.histogram)&&d.histogram.viewState.isLoading)){if(!_.isUndefined(d.histogram.query)){var e=d.histogram.query.params.cql;d.query.params.cql=""===e||_.isNull(e)?null:e}d.histogram.nBinsChoices=[],_.each(_.range(1,14),function(a){d.histogram.nBinsChoices.push(Math.pow(2,a))}),d.viewState.isLoading=!0,d.histogram.viewState.isLoading=!0,s(d.query.params),i.doHistogramQuery({layer:d.query.layerData.currentLayer.Name,workspace:d.query.featureTypeData.targetPrefix,namespace:d.query.featureTypeData.targetNamespace,filter:d.query.params.fullCqlFilter,attribute:d.query.params.attribute.name}).then(function(a){var b=0;_.isUndefined(d.histogram)||(d.viewState.isLoading=!1,d.histogram.title=d.title,d.histogram.type=d.query.params.attribute.localType,d.histogram.xLabel=d.query.params.attribute.name,_.isUndefined(d.histogram.fillColor)&&(d.histogram.fillColor=d.query.params.fillColor),d.histogram.query={params:{startDtg:d.query.params.startDtg.format("YYYY-MM-DD HH:mm:ss[Z]"),endDtg:d.query.params.endDtg.format("YYYY-MM-DD HH:mm:ss[Z]"),cql:d.query.params.cql,originalQuery:d.query}},d.histogram.yScaleChoices=["linear","log"],d.histogram.data=_.map(a.features,function(a){return"date-time"===d.histogram.type&&(a.properties.value=moment.utc(a.properties.value).valueOf()),_.isUndefined(d.histogram.dataMin)&&(d.histogram.dataMin=a.properties.value),_.isUndefined(d.histogram.dataMax)&&(d.histogram.dataMax=a.properties.value),a.properties.value<d.histogram.dataMin&&(d.histogram.dataMin=a.properties.value),a.properties.value>d.histogram.dataMax&&(d.histogram.dataMax=a.properties.value),{x:a.properties.value,y:a.properties.count}}),d.histogram.data=_.sortBy(d.histogram.data,"x"),d.histogram.data=_.map(d.histogram.data,function(a){return{id:b++,x:a.x,y:a.y}}),_.isUndefined(d.histogram.dataMin)&&(d.histogram.dataMin=0),_.isUndefined(d.histogram.dataMax)&&(d.histogram.dataMax=1),d.histogram.min=d.histogram.dataMin,d.histogram.max=d.histogram.dataMax,d.histogram.updateHistogram=v.updateHistogram,d.histogram.highlightLayer=v.highlightLayer,d.histogram.unhighlightLayer=v.unhighlightLayer,v.showHistogram(d.histogram))},function(){ccriCorealerter.alerter.errorMsg("Failed histogram query"),_.each(v.workspaces,function(a){var b=_.find(a,function(a){return a.Name===d.query.layerData.currentLayer.Name});_.isUndefined(b)||v.removeLayer(b,d)})})}},v.highlightLayer=function(a){var b=d.getLayerById(a);d.removeLayer(b),d.addLayer(b);var c=b.getOl3Layer(),e=c.getSource(),f=e.getFeatures(),g=p.hexStringToRgbArray(c.getStyle().getStroke().getColor());g[3]=.75;var h=function(){return new ol.style.Style({stroke:new ol.style.Stroke({color:g,width:2})})};_.isUndefined(v.hiLiteLyr)&&(v.hiLiteLyr=new o({styleBuilder:h}),f.forEach(function(a){v.hiLiteLyr.addFeature(a)}),v.hiLiteLyr.addToMap())},v.unhighlightLayer=function(){_.isUndefined(v.hiLiteLyr)||(v.hiLiteLyr.removeFromMap(),delete v.hiLiteLyr)};var w=function(a){var b=_.flatten(_.values(v.workspaces)),c=_.flatten(_.pluck(b,"derivedLayers")),d=_.find(c,function(b){return b.mapLayerId===a});return d};v.highlightPopup=function(a){var c=w(a);_.isUndefined(c)||b.$emit("histogram:focus",c.histogram.histId)},v.unhighlightPopup=function(a){var c=w(a);_.isUndefined(c)||b.$emit("histogram:unhighlight",c.histogram.histId)},v.launchHistogramWizard=function(a){var b=["capability","histogram"],c=_.keys(_.get(a.KeywordConfig,b)),d=_.find(a.featureTypeDescription.featureTypes[0].properties,{name:_.get(a.KeywordConfig,b.concat([c,"field","attr"]),null)}),e=_.find(a.featureTypeDescription.featureTypes[0].properties,{name:_.get(a.KeywordConfig,b.concat([c,"field","dtg"]),"dtg")}),f=_.find(a.featureTypeDescription.featureTypes[0].properties,{name:_.get(a.KeywordConfig,b.concat([c,"field","geom"]),"geom")}),g=moment.utc(_.get(a.KeywordConfig,b.concat([c,"minTime"]),null)),h=moment.utc(_.get(a.KeywordConfig,b.concat([c,"maxTime"]),null)),i=g.clone(),k=h.clone();i.isValid()||(i=moment().utc().subtract(7,"days")),k.isValid()||(k=moment().utc());var l={featureTypeData:a.featureTypeDescription,layerData:{currentLayer:{Name:a.Name,Title:a.Title}},params:{attribute:d,dtgField:e,geomField:f,startDtg:null,endDtg:null,cql:null,generatedFeatures:[]},timeData:{minTime:g,maxTime:h,defaultStartDtg:i,defaultEndDtg:k,maxTimeRangeMillis:parseInt(_.get(a.KeywordConfig,b.concat([c,"maxTimeRangeMillis"])),10)||Number.POSITIVE_INFINITY}};v.isWizardInProgress=!0,j.launch(a.Name,l)},v.deregLaunchWizardListener=b.$on("wizard:launchWizard",function(){_.each(v.workspaces,function(a){_.each(a,function(a){_.each(a.derivedLayers,function(a){v.isWizardInProgress=!0,a.histogram.viewState.isWizardInProgress=!0})})})}),v.deregCloseWizardListener=b.$on("wizard:closeWizard",function(){_.each(v.workspaces,function(a){_.each(a,function(a){_.each(a.derivedLayers,function(a){v.isWizardInProgress=!1,a.histogram.viewState.isWizardInProgress=!1})})})});var x=function(a){e.getFeatureTypeDescription(q.geoserver.defaultUrl,a.Name).then(function(b){a.featureTypeDescription=b})},y="histogram";DataSourceManager.loadDataSources().then(function(){a.debug("stealth.histogram.geo: DataSourceManager loaded");var b=DataSourceManager.getDataSourcesByKeyword(y);
b.forEach(function(a){var b={Name:a.name,Title:a.title,KeywordConfig:a.keywordConfig.toJS(),queryable:a.queryable,wmsUrl:a.wmsUrl,wfsUrl:a.wfsUrl};b.derivedLayers=[],x(b),_.each(_.get(b.KeywordConfig,y),function(a){_.each(_.keys(a),function(a){_.isArray(v.workspaces[a])?v.workspaces[a].push(b):v.workspaces[a]=[b]})})})}),j.setCategoryScope(v);var z=new m({tag:"st-histogram-geo-category",scope:v,isolateScope:!0}),A=new l(2,"Histograms","fa-bar-chart",z,null,(!0));g.addCategory(1,A),z=A=null}]).directive("stHistogramGeoCategory",["$log",function(a){var b="stealth.histogram.geo.stHistogramGeoCategory: ";return a.debug(b+"directive defined"),{templateUrl:"histogram/geo/category.tpl.html"}}]),angular.module("stealth.histogram.geo.ol3.layers").directive("stHistogramLayerStyle",[function(){return{templateUrl:"histogram/geo/ol3/layers/histostyleview.tpl.html"}}]),angular.module("stealth.histogram.geo.query").service("histogramQueryService",["wps","CONFIG",function(a,b){this.doHistogramQuery=function(c){var d=stealth.jst["wps/histogram_geojson.xml"],e=d({layer:c.layer,workspace:c.workspace,namespace:c.namespace,filter:c.filter,attr:c.attribute});return a.submit(b.geoserver.defaultUrl,e)}}]),angular.module("stealth.histogram",["stealth.histogram.geo","stealth.histogram.geo.query","stealth.histogram.popup","stealth.histogram.wizard"]),angular.module("stealth.histogram.popup").service("histogramBuilder",["$filter","$interval","$rootScope","ccri.angular-utils.WidgetDef","ccri.popup.manager",function(a,b,c,d,e){var f=[],g=function(a){return _.find(f,function(b){return b.histogram.histId===a})},h=function(b){var c=g(b.histId);b.maxNBins=8192,b.defaultBins=512,c.histogram.updateBars=function(a){c.viz.updateBars({},{fill:a.fillColor,stroke:a.fillColor})};var d="#"+b.histId;c.viz=sonic.viz(d,[],{animation:{delay:0,duration:500}}).addYAxis({min:0,label:{text:"counts",dx:3}}),_.isUndefined(b.yScale)&&(b.yScale="linear");var e=function(c){var d=c[0].point,e=a("numberTrim")(d.binMin,4),f=a("numberTrim")(d.binMax,4),g=a("numberTrim")(d.center,4);return"date-time"===b.type&&(e=moment(d.binMin).format("lll"),f=moment(d.binMax).format("lll"),g=moment(d.center).format("lll")),"<b>binId: </b>"+(d.id+1)+" <b>center: </b>"+g+"<br><b>min: </b>"+e+" <b>max: </b>"+f+"<br><b>count: </b>"+d.y},f="x";switch(b.type){case"number":b.nBinsChoice=b.defaultBins,c.viz.addXAxis({type:"linear",label:{text:b.xLabel},pad:{min:.1,max:.1}});break;case"int":b.nBinsChoice=Math.min(b.maxNBins,b.max-b.min+1),c.viz.addXAxis({type:"linear",label:{text:b.xLabel},pad:{min:.1,max:.1}});break;case"date-time":b.nBinsChoice=Math.min(b.defaultBins,b.max-b.min+1),c.viz.addXAxis({type:"time",label:{text:b.xLabel},pad:{min:.1,max:.1}});break;case"string":f="id",c.viz.addXAxis({dataKey:f,type:"linear",ticks:{formatFn:function(a){var c=b.data[a],d=10;return c?c.x.length>d?c.x.substring(0,d)+"...":c.x:""},minHorizSpacing:5,snapTo:"integer",textAnchor:"end",rotate:-45,dx:-6,dy:3},label:{text:b.xLabel,dy:50}}),e=function(a){var b=a[0].point;return"<b>x: </b>"+b.x+"<br><b>count: </b>"+b.y},b.data.length>b.maxNBins&&(ccriCorealerter.alerter.errorMsg("Histogram had too much data: "+b.data.length+" values. Try limiting the query."),b.data=_.slice(b.data,0,b.maxNBins)),b.nBinsChoice=Math.min(b.maxNBins,b.data.length),b.maxBin=Math.min(30,b.nBinsChoice),b.data=_.map(b.data,function(a){return _.merge(a,{binMin:a.id,id:a.id-.5})}),_.isEmpty(b.fieldList)&&(b.fieldList=[{label:"Count",prop:"count"},{label:"Value",prop:"value"}]),_.isEmpty(b.sortFields)&&(b.sortFields=[{label:"Value",prop:"value"}]),_.isEmpty(b.sortOrders)&&(b.sortOrders=["asc"])}b.currentNBins=b.nBinsChoice,_.isUndefined(b.minBin)&&(b.minBin=1),_.isUndefined(b.maxBin)&&(b.maxBin=b.currentNBins),c.selectedBars=[],c.viz.addBars({xDataKey:f,fill:b.fillColor,stroke:b.fillColor,animation:{delay:0,duration:0},barPosition:"left",minBarWidth:1,maxBarWidth:1e3,barGroupPadding:0,strokeWidth:0,zoom:!0,tooltip:{renderFn:e},selectedBars:c.selectedBars}).addCrosshair(),q(b),b.viewState.isLoading=!1},i=function(a){a.keepView||(a.minBin=1,a.maxBin=a.currentNBins,"string"===a.type&&(a.maxBin=Math.min(30,a.data.length))),q(a),a.viewState.isLoading=!1},j=function(a){return Math.ceil(.2*a)},k=function(a){if(a.minBin>1){var b=j(a.currentBinned.length);a.minBin-=b,a.maxBin-=b,q(a)}},l=function(a){if(a.maxBin<a.nBinsChoice){var b=j(a.currentBinned.length);a.minBin+=b,a.maxBin+=b,q(a)}},m=function(a){"hidden"===a.showBinOptions?a.showBinOptions="visible":a.showBinOptions="hidden"},n=function(a){var b=g(a.histId);b.selectedBars.length>0&&c.$emit("histogram.click",{selectedBars:b.selectedBars,histogram:a}),b.selectedBars.length=0},o=function(a){switch(a.minBin=1,a.maxBin=a.nBinsChoice,a.type){case"int":a.nBinsChoice=Math.min(a.maxNBins,a.max-a.min+1);break;case"date-time":a.nBinsChoice=Math.min(a.defaultBins,a.max-a.min+1);break;case"string":a.nBinsChoice=Math.min(a.maxNBins,a.data.length),a.minBin=1,a.maxBin=Math.min(30,a.nBinsChoice);break;default:a.nBinsChoice=a.defaultBins}q(a)},p=function(a){_.isNaN(Number.parseInt(a.nBinsChoice,10))||q(a)},q=function(a){var b,c,d=g(a.histId);switch(s(a),a.currentNBins=a.nBinsChoice,t(a),a.type){case"date-time":b=b.valueOf(),c=c.valueOf();break;case"string":b=0,c=1;break;default:b=a.currentBinned[0].binMin,c=a.currentBinned[0].binMax}d.viz.updateBars({},{barWidth:{amount:c-b}}),a.currentBinned=_.slice(a.currentBinned,a.minBin-1,a.maxBin),d.viz.data(a.currentBinned)},r=function(a,b,c){if(!_.isEmpty(a.currentBinned))if(_.isEmpty(b)||_.isEmpty(c))a.sortFields=[{label:"Value",prop:"value"}],a.sortOrders=["asc"],r(a,["value"],a.sortOrders);else{var d="count"===b[0]?"y":"x";a.data=_.sortBy(a.data,d),"desc"===c[0]&&a.data.reverse(),a.data=_.map(a.data,function(a,b){return a.id=b,a}),q(a)}},s=function(a){a.nBinsChoice>a.maxNBins&&(a.nBinsChoice=a.maxNBins),a.nBinsChoice<1&&(a.nBinsChoice=1);var b=a.nBinsChoice/a.currentNBins;a.minBin>1&&(a.minBin=a.minBin*b|0),a.maxBin=a.maxBin*b|0,a.minBin<1&&(a.minBin=1),a.maxBin<1&&(a.maxBin=1),a.minBin>a.nBinsChoice&&(a.minBin=a.nBinsChoice),a.maxBin>a.nBinsChoice&&(a.maxBin=a.nBinsChoice)},t=function(a){var b=g(a.histId);"log"===a.yScale?(a.currentBinned=u(a.type,a.currentNBins,a.min,a.max,a.data,function(a){_.each(a,function(a){a.y>0&&(a.y=math.log10(a.y))})}),b.viz.updateYAxis({},{label:{text:"log(counts)"}})):(a.currentBinned=u(a.type,a.currentNBins,a.min,a.max,a.data),b.viz.updateYAxis({},{label:{text:"counts"}}))},u=function(a,b,c,d,e,f){var g,h=[];switch(a){case"string":h=angular.copy(e);break;case"int":g=(d-c+1)/b,h=v(b,c,g,e);break;default:g=(d-c)/b,h=v(b,c,g,e)}return _.isFunction(f)&&f(h),h},v=function(a,b,c,d){var e=_.map(_.range(0,a),function(a){var d=b+a*c;return{id:a,x:d,y:0,binMin:d,center:d+.5*c,binMax:d+c}}),f=0;return _.each(d,function(a){for(;f<e.length-1&&a.x>=e[f].binMax;)f++;e[f].y+=a.y}),e},w=function(a){var b=g(a.histId);a.currentBinned.splice(0,a.currentBinned.length),a.viewState.toggledOn=!1,b.viz=void 0,e.closePopup(b.popupId),b.$destroy(),_.pull(f,b),b.unhighlightLayer(a.layerId)},x=angular.element(".primaryDisplay > ccri-popup-container");this.build=function(a,g){if(g)return void i(a);var j=c.$new();j.highlightLayer=a.highlightLayer,j.unhighlightLayer=a.unhighlightLayer,j.histogram=a,j.histId="histogram-"+j.histogram.id,j.histogram.histId=j.histId,j.popupContainerId=x.data("ccri.popup.containerId"),"No Time Range"!==a.query.params.originalQuery.params.dtgField.name?(j.histogram.sDateStr=moment.utc(a.query.params.startDtg).format("YYYY-MM-DD"),j.histogram.sTimeStr=moment.utc(a.query.params.startDtg).format("HH:mm")+" Z",j.histogram.eDateStr=moment.utc(a.query.params.endDtg).format("YYYY-MM-DD"),j.histogram.eTimeStr=moment.utc(a.query.params.endDtg).format("HH:mm")+" Z"):(j.histogram.sDateStr="No Time Range",j.histogram.sTimeStr="",j.histogram.eDateStr="",j.histogram.eTimeStr=""),f.push(j);var s=new d({tag:"st-histogram-popup",scope:j});j.popupId=e.displayPopup(j.popupContainerId,a.title,"histogram","fa fa-fw fa-bar-chart",s,{offsets:[450,20],contentMinHeight:400,contentMinWidth:500,contentWidth:500,contentHeight:400,resizable:!0,limitStartSize:!1,onClose:function(){w(j.histogram)},extraStyles:{border:"1px solid rgba(0, 0, 0, 0)"}}),j.histogram.changedBins=p,j.histogram.rebin=q,j.histogram.closePopup=w,j.histogram.dataQuery=n,j.histogram.reset=o,j.histogram.stepLeft=k,j.histogram.stepRight=l,j.histogram.toggleBinOptions=m,j.histogram.showBinOptions="string"===j.histogram.type?"visible":"hidden",j.histogram.keepView=!1,j.histogram.sortList=function(a,b){r(j.histogram,a,b)};var t,u=function(){b.cancel(t),t=void 0};t=b(function(){_.isUndefined(x)||(h(a),u())},250)}}]).directive("stHistogramPopup",["$rootScope","colors","ccri.popup.manager",function(a,b,c){return{restrict:"E",templateUrl:"histogram/popup/popup.tpl.html",link:function(d,e){function f(a,b){for(;null!==a&&(a=a.parentElement)&&!a.classList.contains(b););return a}function g(a){var c=b.hexStringToRgbArray(d.histogram.fillColor),e=f(a[0],"popupWindow");_.isUndefined(e)||(e.style.border="1px solid rgba("+c[0]+", "+c[1]+", "+c[2]+", 0.75")}function h(a){var b=f(a[0],"popupWindow");_.isUndefined(b)||(b.style.border="1px solid rgba(0, 0, 0, 0)")}var i=a.$on("Popup Focus Change",function(a,b){b!==d.histId&&h(e)});d.focus=function(){e.css("z-index","92"),a.$emit("Popup Focus Change",d.histId)};var j=a.$on("histogram:focus",function(a,b){b===d.histId&&(c.focusPopup(d.popupContainerId),g(e))}),k=a.$on("histogram:unhighlight",function(a,b){b===d.histId&&h(e)});d.$on("$destroy",function(){i(),j(),k()})}}}]),angular.module("stealth.histogram.wizard",["ccri.angular-utils","ccri.area-definition","stealth.wizard"]).service("histogramWizard",["$log","$q","$rootScope","$timeout","stealth.wizard.wizardManager","colors","stealth.core.wizard.Step","stealth.core.wizard.Wizard","ccri.angular-utils.WidgetDef","ccri.area-definition.FeatureCreator",function(a,b,c,d,e,f,g,h,i,j){var k="stealth.histogram.wizard.histogramWizard: ";a.debug(k+"service started");var l;this.setCategoryScope=function(a){l=a},this.launch=function(a,k){function m(){var a=0;s.query.params.generatedFeatures.forEach(function(b){b.index=a++});var b={title:s.query.params.title,query:s.query,viewState:{isOnMap:!1,toggledOn:!1,isLoading:!1,isRemovable:!0,fillColor:s.query.params.fillColor}};return _.isUndefined(l)||_.each(l.workspaces,function(a){var c=_.find(a,function(a){return a.Name===s.query.layerData.currentLayer.Name});_.isUndefined(c)||(c.derivedLayers.push(b),l.toggleLayer(b))}),o()}function n(){w.toolWasOpened=!0}function o(){return v.finish().then(r)}function p(){v.getFeatures().then(q)}function q(a){var b=_.filter(a,function(a){var b=a.getGeometry();return b instanceof ol.geom.Polygon||b instanceof ol.geom.MultiPolygon});k.params.generatedFeatures=b}function r(){k=null,v.un("featureschanged",p),v.un("toolstarted",n),v=null,s.$destroy(),s.query=null,s=null,w.$destroy(),w.query=w.cqlStats=w.featureCreator=w.hasShapes=null,w=null,x.$destroy(),x.featureCreator=null,x=null}var s=c.$new(),t=[];s.query=k,s.featureAttributes=_.sortBy(s.query.featureTypeData.featureTypes[0].properties,function(a){return a.name}),s.timeAttributes=s.featureAttributes.slice(),s.timeAttributes.push({localType:"date-time",name:"No Time Range",type:"xsd:date-time"}),s.showTimeRange=!0,s.query.params.attribute||(s.query.params.attribute=s.featureAttributes[0]),s.query.params.fromName=a,s.labelFn=function(a){return a.name},s.dateTimeFilter=ccriUtils.strategies.featurePropertiesFilter("date-time"),s.geomFilter=ccriUtils.strategies.featurePropertiesFilter(["point","linestring","multilinestring","polygon","multipolygon"]);var u=!0,v=new j({supportedTools:["coordRect","polygon","radiusCircle","bufferFeature","mapView","wholeEarth"],disableMultiple:!1}),w=s.$new();w.query=k,w.featureCreator=v,w.hasShapes=function(){if(!arguments.length)return!!v.hasFeatures()||null};var x=s.$new();x.featureCreator=v,v.on("featureschanged",p),w.toolWasOpened=!1,v.on("toolstarted",n),d(function(){_.get(k,"params.generatedFeatures")&&v.addFeatures(k.params.generatedFeatures)},500),t.push(new g("Select attribute and time range",new i({tag:"st-histogram-wiz-source",scope:s}),null,u,function(){_.isUndefined(s.query.params.dtgField)&&(s.query.params.dtgField=s.timeAttributes[s.timeAttributes.length-1])},function(a){if(a!==!0)return o()})),t.push(new g("Select area",new i({tag:"st-tl-wiz-area-step",scope:w}),new i({tag:"st-wiz-draw-toolbar",scope:x}),(!1),null,function(a){return a===!0?v.finishActiveTool().then(function(){return v.getFeatures()}).then(function(a){return a.length?void q(a):b.reject()}):a!==!1?o():void 0})),angular.extend(s,{style:{"background-color":f.getColor()}}),s.query.params.fillColor=s.style["background-color"],t.push(new g("Set options",new i({tag:"st-histogram-wiz-options",scope:s}),null,u,function(){s.query.params.title="'"+s.query.params.attribute.name+"' Histogram for '"+s.query.layerData.currentLayer.Title+"'"},function(a){return a?m():a!==!1?o():void 0}));var y=new h("Make Histogram","fa-bar-chart","fa-check text-success",t,s,"wizard-dark AreaDefinitionWizard");e.launchWizard(y)}}]).directive("stHistogramWizSource",function(){return{restrict:"E",templateUrl:"histogram/wizard/templates/source.tpl.html",link:function(a){var b=a.$watch("query.params.dtgField",function(b){_.isUndefined(b)||"No Time Range"!==b.name?a.showTimeRange=!0:a.showTimeRange=!1});a.$on("$destroy",function(){b()})}}}).directive("stHistogramWizOptions",function(){return{restrict:"E",templateUrl:"histogram/wizard/templates/options.tpl.html"}}),angular.module("stealth.mediator.air-tfi",["stealth.live.list","stealth.tfi"]).config(["$provide",function(a){a.decorator("stealthLiveListToolbarDirective",["$delegate",function(a){var b=a[0];return b.templateUrl="mediator/air-tfi/toolbar.tpl.html",b.controller=["$scope","stealth.tfi.filter.service",function(a,b){function c(a){f.setEnabled(!!a)}function d(){this.theaterFilterEnabled=!this.theaterFilterEnabled,e(this.theaterFilterEnabled)}function e(c){c?a.extraCQL.tfi="theaterNetworkMatches ILIKE '%"+b.theaterNetworkPair.theater+"-"+b.theaterNetworkPair.network+"%'":delete a.extraCQL.tfi,a.liveLayer.refresh()}var f=a.extentFilterState;this.extentFilter=f,this.toggleExtentFiltering=c,this.theaterFilterEnabled=!0,this.toggleTheaterFilter=d,e(this.theaterFilterEnabled)}],a}])}]),angular.module("stealth.mediator.air-timelapse",["stealth.air.geo.ol3.layers","stealth.timelapse.geo.ol3.layers"]).config(["$provide",function(a){a.decorator("stealth.timelapse.geo.ol3.layers.LiveWmsLayer",["$delegate","stealth.air.geo.ol3.layers.LiveWmsLayerConstructorFactory",function(a,b){return b.getConstructor(a)}])}]).run([function(){DataSourceManager.addKeywordExtender(function(a){var b=a,c=a.getIn(["air","live"]);c&&(b=b.mergeDeepIn(["timelapse","live"],c));var d=b.getIn(["air","historical"]);return d&&(b=b.mergeDeepIn(["timelapse","historical"],d)),b})}]),angular.module("stealth.mediator.histogram-static",["stealth.histogram.popup"]).run(["$rootScope","colors","cqlHelper","staticWorkspaceManager",function(a,b,c,d){function e(){return g%=f.length,f[g++]}var f=d.markerShapes,g=0,h=function(a,f){var g=f.query.params.originalQuery,h=g.layerData.currentLayer.Name,i=d.findLayer(h);if(i){var j=[];_.each(a,function(a){var b="";switch(f.type){case"int":case"number":b="("+g.params.attribute.name+" >= "+a.binMin+" AND "+g.params.attribute.name+" <= "+a.binMax+")";break;case"date-time":var c=new Date(a.binMin).toISOString(),d=new Date(a.binMax).toISOString();b="("+g.params.attribute.name+" DURING "+c+"/"+d+")";break;case"string":b=g.params.attribute.name+" = '"+a.x+"'"}j.push(b)});var k;if(0!==j.length){var l=c.combine("OR",j);k=c.combine("AND",[g.params.fullCqlFilter,l])}else k=g.params.fullCqlFilter;var m={title:"Bar(s) from "+f.title,query:g,layerName:g.layerData.currentLayer.Name,layerTitle:g.layerData.currentLayer.Title,queryable:!0,viewState:{isOnMap:!1,toggledOn:!1,isLoading:!1,isRemovable:!0,markerStyle:"point",markerShape:e(),size:9,fillColor:b.getColor(),radiusPixels:5,colorRamp:void 0,geom:null,hashAttr:{name:g.params.attribute.name}},cqlFilter:k,style:"stealth_dataPoints"};i.filterLayers.push(m),d.toggleLayer(i,m)}};a.$on("histogram.click",function(a,b){h(b.selectedBars,b.histogram)})}]),angular.module("stealth.mediator.histogram-timelapse",["stealth.histogram.wizard","stealth.timelapse.stores"]).run(["histogramWizard","queryBinStoreExtender",function(a,b){b.addCapabilitiesExtender(function(b,c){var d=this;return _.isUndefined(b.histogram)||(b.histogram.toolTipText="Make histogram",b.histogram.iconClass="fa-bar-chart",b.histogram.onClick=function(){var b=d.getQuery(),e=_.cloneDeep(b);e.params.startDtg=moment.utc(c.startMillis),e.params.endDtg=moment.utc(c.endMillis),e.params.attribute=e.params.idField,e.params.generatedFeatures=b.params.generatedFeatures.map(function(a){return a.clone()}),a.launch(e.params.storeName,e)}),b})}]),angular.module("stealth.mediator.savedqueries-timelapse").factory("stealth.mediator.savedqueries-timelapse.Query.asLive",["$log","cqlHelper","stealth.timelapse.wizard.live.Query","wfs",function(a,b,c,d){function e(b){var d=this,e=DataSourceManager.getDataSourcesById(b.source).first();if(e){var h=DataSourceManager.buildLegacyLayer(e);c.call(this),this.cqlBounds=b.bounds,this.cqlCustom=b.attributeFilter,this.originalTitle=b.title,this.originalLayerTitle=h.Title,this.buildSpaceFilter=g,Promise.all([this.liveLayers,f(h)]).then(function(b){var c=_.map(b[1],"name"),e=_.map(b[0],function(a){return[a,f(a)]});_.reduce(e,function(b,d){return b.then(function(b){var e=d[1];return e.then(function(a){var e=_.map(a,"name");return _.isEmpty(_.xor(e,c))?(b.push(d[0]),b):b}).catch(function(c){return a.error(c),b})})},Promise.resolve([])).then(function(a){if(_.isEmpty(a))throw d.layerData={layers:[],currentLayer:null},new Error("No valid layers found for saved filter.");d.layerData.layers=_.sortBy(a,function(a){return a.serverUrl+a.Name}),d.layerData.currentLayer=d.layerData.layers[0],d.getFeatureTypeDescription()}).catch(function(b){a.error(b)})})}}function f(a){return d.getFeatureTypeDescription(a.wfsUrl,a.Name,!1,!0).then(function(b){var c=_.get(b,"featureTypes[0].properties",[]);if(b.error||_.isEmpty(c))throw new Error("Feature type properties missing for "+a.serverUrl+" "+a.Name);return c})}function g(){var a,c="INTERSECTS("+(this.params.geomField||"geom")+", "+this.cqlBounds+")";return a=[b.operator.AND,c],_.isEmpty(this.cqlCustom)||a.push(this.cqlCustom),b.combine.apply(b,a)}return e.prototype=Object.create(c.prototype),e}]),angular.module("stealth.mediator.savedqueries-timelapse").factory("stealth.mediator.savedqueries-timelapse.Wizard.asLive",["$rootScope","ccri.angular-utils.WidgetDef","stealth.core.wizard.Step","stealth.core.wizard.Wizard","stealth.mediator.savedqueries-timelapse.Query.asLive","stealth.live.manager.Manager",function(a,b,c,d,e,f){function g(g){var h=a.$new();return h.query=new e(g),new d("Filter on Live Data","ccri-icon ccri-icon-filter-1","fa-check text-success",[new c("Select live data source",new b({tag:"st-tl-wiz-source-timerange",scope:h}),null,(!0),null,function(a){if(a){var b=h.query.buildSpaceFilter(),c=h.query.originalTitle,d=DataSourceManager.getDataSourcesById(h.query.layerData.currentLayer.id).first();if(d){var e=d.keywordConfig.getIn(["timelapse","live"]).keySeq().first(),g=f.buildView(e,ccriUtils.uuid.generate(),d,c,{cql:{value:b}});f.updateViewDisplayStatus(e,g.id,{isExpanded:!0}),f.toggleView(e,g.id)}}})],h,"AsHistoricalWizard")}return g}]),angular.module("stealth.mediator.savedqueries-timelapse",["ccri.angular-utils","stealth.core.utils","stealth.core.wizard","stealth.savedqueries","stealth.timelapse.wizard","stealth.timelapse.wizard.live","stealth.wizard"]).service("stealth.mediator.savedqueries-timelapse.queryHelper",["CONFIG","cqlHelper","liveWizard","stealth.timelapse.wizard.TimelapseWizard",function(a,b,c,d){function e(c,d){return d=_.isEmpty(d)?c.title+" ("+a.userCn+")":d,{title:d,bounds:c.bounds,classification:c.classification,userId:a.userDn,cql:c.attributeFilter,cqlParameters:b.cloneCqlParams(c.cqlParameters)}}var f=this,g={LIVE:{type:"live",displayName:"Live",wizard:c},TIMELAPSE:{type:"time-lapse",displayName:"Time-lapse",wizard:d,copyTypeSpecificFields:function(a,b){var c=b.dates;return(_.isUndefined(c)||0===moment.utc(c.start).year()||9999===moment.utc(c.end))&&(c={start:null,end:null}),a.startDtg=c.start,a.endDtg=c.end,a}}};f.QueryTypes=g,f.getExactQueryCopy=function(a,b){var c=e(a,b);return c.type=a.type,c.source=a.source,c.filter=a.filter,c},f.getWizardQueryCopy=function(a,c,d){var g;return _.isEmpty(c)||c.type===a.type?g=f.getExactQueryCopy(a,d):(g=e(a,d),g.type=c.type),_.isFunction(c.copyTypeSpecificFields)&&(g=c.copyTypeSpecificFields(g,a)),g.shouldBeShared=a.isPublic,g.showOnStartup=a.showOnStartup,g.type=c.type,g.cqlParams=b.cloneCqlParams(a.cqlParameters),g}}]).run(["CONFIG","cqlHelper","liveWizard","stealth.geo.timelapse.wizard.TimelapseWizard","stealth.mediator.savedqueries-timelapse.queryHelper","stealth.mediator.savedqueries-timelapse.Wizard.asLive","stealth.savedqueries.SQCONFIG","stealth.savedqueries.data","stealth.savedqueries.manager","stealth.savedqueries.timelapse.AddToMapService","stealth.savedqueries.timelapse.EditSavedQueryWizard","stealth.savedqueries.timelapse.RunAsTimelapseWizard","stealth.live.manager.Manager","stealth.timelapse.wizard.live.Query","stealth.timelapse.wizard.Query","stealth.wizard.wizardManager",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=[n,o],r=_.get(a,"savedqueries.classifications",_.get(a,"classification.options",["UNCLASSIFIED"])),s=r[0];q.forEach(function(a){a.prototype.isSaveable=g.enabled,a.prototype.editMode=!1,a.prototype.id="",a.prototype.shouldBeSaved=!1,a.prototype.shouldBeShared=!1,a.prototype.classifications=r,a.prototype.classification=s,a.prototype.save=function(a){var c={classification:this.classification,cqlParameters:b.filterEmptyCqlParams(this.params.cqlParams||{additionalCql:this.params.cql}),filter:a,isPublic:this.shouldBeSaved&&this.shouldBeShared,source:this.layerData.currentLayer.id,showOnStartup:this.showOnStartup,title:this.params.storeName,type:this.type};this.shouldBeSaved&&(this.editMode?h.update(_.merge(c,{id:this.id})):h.add(c))}});var t=function(a,b){return{order:a,text:"Copy as "+b.displayName,onClick:function(a){if(a.type===b.type)h.add(e.getExactQueryCopy(a));else{var c=e.getWizardQueryCopy(a,b);c.runOnCompletion=!1,c.shouldBeSaved=!0,b.wizard.launchWizard(c)}}}},u=t(810,e.QueryTypes.LIVE),v=t(820,e.QueryTypes.TIMELAPSE);i.registerType({type:"live",icon:"fa fa-bolt",runner:function(a){var b=DataSourceManager.getDataSourcesById(a.source).first();if(b){var c=b.keywordConfig.getIn(["timelapse","live"]).keySeq().first(),d=m.buildView(c,ccriUtils.uuid.generate(),b,a.title,{cql:{value:a.filter}});m.updateViewDisplayStatus(c,d.id,{isExpanded:!0}),m.toggleView(c,d.id)}},editor:function(a){c.launchWizard({id:a.id,runOnCompletion:!1,bounds:a.bounds,classification:a.classification,cql:a.attributeFilter,cqlParams:a.cqlParameters,shouldBeSaved:!0,shouldBeShared:a.isPublic,showOnStartup:a.showOnStartup,source:a.source,title:a.title})},menuOptions:{copy:u}}),i.registerType({type:"time-lapse",icon:"fa fa-clock-o",runner:function(a){j.submitSavedQuery(a)},editor:function(a){a.id?k.launchWizard(a):d.launchWizard({shouldBeSaved:!0},{isSaveable:!0,classifications:r,defaultClassification:s})},menuOptions:{manageEmailAlerts:!1,copy:v}}),i.registerMenuOption(["live","time-lapse"],"runAsLive",{order:500,text:"Run as Live",onClick:function(a){p.launchWizard(new f(a))}}),i.registerMenuOption(["live","time-lapse"],"runAsTL",{order:501,text:"Run as Time-lapse",onClick:function(a){l.launchWizard(a)}}),i.registerMenuOption(["time-lapse"],"copyAsLive",u),i.registerMenuOption(["live"],"copyAsTL",v)}]),angular.module("stealth.mediator.savedqueries-timelapse").directive("stTlWizSourceTimerange",function(){return{restrict:"E",templateUrl:"mediator/savedqueries-timelapse/sourcetimerange.tpl.html",link:function(a){a.datasourceLabelFn=function(a){return a.Title}}}}),angular.module("stealth.routeanalysis.geo",["stealth.routeanalysis.popup","stealth.routeanalysis.runner","stealth.routeanalysis.wizard"]).run(["$log","$rootScope","ol3Map","routeAnalysisWizard","routeAnalysisBuilder",function(a,b,c,d,e){var f="stealth.routeanalysis.geo: ";a.debug(f+"run called");var g=b.$new();g.workspaces={},g.toggleLayer=function(a,b){(_.isUndefined(a.mapLayerId)||_.isNull(a.mapLayerId))&&(a.viewState.isLoading=!0,a.routeanalysis={id:_.now(),viewState:{toggledOn:!1,isLoading:!1,isWizardInProgress:!!g.isWizardInProgress},layerId:a.mapLayerId,arrowColor:a.params.arrowColor,parentRoute:b},g.updateRouteAnalysis(a),_.isUndefined(b.derivedLayers)?b.derivedLayers=[a]:b.derivedLayers.push(a))},g.removeLayer=function(a,b){_.isUndefined(b.routeanalysis)||b.routeanalysis.viewState.toggledOn&&b.routeanalysis.closePopup(b.routeanalysis),b.viewState.isOnMap&&g.toggleLayer(a,b),_.pull(a.derivedLayers,b)},g.toggleVisibility=function(a){var b=c.getLayerById(a.mapLayerId),d=b.getOl3Layer();d.setVisible(!d.getVisible())},g.updateRouteAnalysisTitle=function(a){a.routeanalysis.title=a.title},g.setYAxisLabel=function(a,b){a.routeanalysis.yAxis=b},b.$on("routeanalysis:show:results",function(a,b){g.showRouteAnalysis(b.routeanalysis)}),g.showRouteAnalysis=function(a){a.viewState.toggledOn?a.viewState.isLoading&&(a.viewState.isLoading=!1):(e.build(a),a.viewState.toggledOn=!0)},g.updateRouteAnalysis=function(a){if(!(_.isUndefined(a)||a.routeanalysis.viewState.isLoading||_.isUndefined(a.routeanalysis)&&a.routeanalysis.viewState.isLoading)){if(!_.isUndefined(a.routeanalysis.query)){var b=a.routeanalysis.query.params.cql;a.query.params.cql=""===b||_.isNull(b)?null:b}a.viewState.isLoading=!1,a.routeanalysis.viewState.isLoading=!0,a.routeanalysis.title=a.title,_.isUndefined(a.routeanalysis.arrowColor)&&(a.routeanalysis.arrowColor=a.params.arrowColor)}},g.launchRouteAnalysisWizard=function(a){d.launch(a)},g.deregLaunchWizardListener=b.$on("wizard:launchWizard",function(){_.each(g.workspaces,function(a){_.each(a,function(a){_.each(a.derivedLayers,function(a){g.isWizardInProgress=!0,a.viewState.isWizardInProgress=!0})})})}),g.deregCloseWizardListener=b.$on("wizard:closeWizard",function(){_.each(g.workspaces,function(a){_.each(a,function(a){_.each(a.derivedLayers,function(a){g.isWizardInProgress=!1,a.viewState.isWizardInProgress=!1})})})}),d.setCategoryScope(g)}]),angular.module("stealth.routeanalysis.popup").service("routeAnalysisBuilder",["$rootScope","$interval","elementAppender",function(a,b,c){var d=[],e=function(a){return _.find(d,function(b){return b.routeanalysis.routeId===a})},f=function(c){var d,f=e(c.routeId),g="#"+c.routeId,h=function(){b.cancel(d),d=void 0};d=b(function(){0!==$(g)[0].getBoundingClientRect().width&&(f.viz=sonic.viz(g,[c.response.results]).addXAxis({label:{text:"Distance (m)"}}).addYAxis({label:{text:c.yAxis},pad:{top:.1,bottom:.1}}).addLines({seriesIndexes:[0],sort:!0,tooltip:{renderFn:function(b){return a.$emit("drawroute:trace:point",{distance:b[0].point.x,route:c.parentRoute}),"<p>x: "+b[0].point.x.toFixed(0)+"<br>y: "+b[0].point.y.toPrecision(3)+"</p>"}}}),h())},500),_.isUndefined(c.yScale)&&(c.yScale="linear"),c.viewState.isLoading=!1,c.viewState.isWizardInProgress=!1},g=function(a){a.viewState.isLoading=!1},h=function(a){var b=e(a.routeId);a.viewState.toggledOn=!1,b.viz=void 0,b.$destroy(),_.pull(d,b),angular.element("."+a.routeId+"-container").remove()},i=function(a){_.isUndefined(e(a.routeId))||h(a)};this.build=function(e,j){if(j)return void g(e);var k=a.$new();k.routeanalysis=e,k.routeId="routeanalysis-"+k.routeanalysis.id,k.routeanalysis.routeId=k.routeId,d.push(k);var l;c.append(".primaryDisplay","routeanalysis/runner/container.tpl.html",k,function(a){l=a}),k.routeanalysis.closePopup=h,k.routeanalysis.cleanup=i;var m,n=function(){b.cancel(m),m=void 0};m=b(function(){_.isUndefined(l)||(f(e),n())},250)}}]).directive("stRouteAnalysisPopup",["$rootScope",function(a){return{restrict:"E",templateUrl:"routeanalysis/results/popup.tpl.html",link:function(b,c,d){c.parent().css("height",5),c.draggable({stop:function(){b.$apply(function(){c.css("width","")})}});var e=a.$on("Popup Focus Change",function(a,b){b!==d.id&&c.zIndex()>85&&(c.css("z-index",c.zIndex()-1),c.children().css("box-shadow","none"))});b.focus=function(){c.css("z-index","92"),a.$emit("Popup Focus Change",d.id)},b.$on("$destroy",function(){e(),c.draggable("destroy")})}}}]),angular.module("stealth.routeanalysis",["stealth.routeanalysis.geo","stealth.routeanalysis.popup","stealth.routeanalysis.runner","stealth.routeanalysis.wizard"]),angular.module("stealth.routeanalysis.runner").service("analysisService",["$q","wps","wms","cqlHelper","CONFIG",function(a,b,c,d,e){function f(a,b,c){if(_.isEmpty(a))return{combined:{maxScore:0,results:[]},dataSources:b};var d=[],e=0;return _.each(a,function(a){_.each(a.features,function(a){d[e++]={id:e,x:a.properties.dist,y:a.properties.value}})}),{results:{key:"series1",color:c,values:d},dataSources:b}}this.doGeoJsonLineQuery=function(g,h){var i=a.defer(),j=stealth.jst["wps/routeAnalysis_geojson.xml"],k=g.length,l={},m={};return k>0?(_.each(g,function(a){c.getCapabilities(e.geoserver.defaultUrl,!0,!1).then(function(c){for(var f,g=c.Capability.Layer.Layer,n=0;n<g.length;n++)if(g[n].Name.indexOf(a.Name)>=0){f=g[n];break}var o=f.EX_GeographicBoundingBox[0]+" "+f.EX_GeographicBoundingBox[1],p=f.EX_GeographicBoundingBox[2]+" "+f.EX_GeographicBoundingBox[3],q=d.generateLineString(h.inputGeoJson.the_geom.getCoordinates()),r=j(_.merge({lineString:q,dataLayer:a.Name,lowerCorner:o,upperCorner:p,resolution:h.resolution},h));l[a.Name]=a,b.submit(e.geoserver.defaultUrl+"/wps",r).then(function(b){m[a.Name]=b}).finally(function(){--k<=0&&i.resolve(m)})})},function(a){i.reject(a)}),i.promise.then(function(a){return f(a,l,h.color)})):a.when([])}}]),angular.module("stealth.routeanalysis.runner").run(["$rootScope","routeAnalysisRunner",function(a,b){a.$on("routeanalysis:request:route",function(a,c,d,e){b.run(c,d,e)})}]).service("routeAnalysisRunner",["analysisService",function(a){this.run=function(b,c,d){a.doGeoJsonLineQuery([b.dataSource],{inputGeoJson:b.routeFeature,resolution:b.resolution,color:d.params.fillColor}).then(function(a){_.isUndefined(a.results)?(ccriCorealerter.alerter.errorMsg("Failed to get a response, check route is within raster bounds","Request Error",{timeOut:15e3}),c.removeLayer(d.gsLayer,d)):(d.routeanalysis.response=a,c.showRouteAnalysis(d.routeanalysis))})}}]),angular.module("stealth.routeanalysis.wizard",["ccri.angular-utils","stealth.core.geo.ol3.overlays","stealth.core.geo.ol3.utils","stealth.wizard"]).service("routeAnalysisWizard",["$log","$rootScope","stealth.wizard.wizardManager","owsLayers","stealth.core.wizard.Step","stealth.core.wizard.Wizard","ccri.angular-utils.WidgetDef",function(a,b,c,d,e,f,g){var h="stealth.routeanalysis.wizard.routeAnalysisWizard: ";a.debug(h+"service started");var i;this.setCategoryScope=function(a){i=a},b.$on("routeanalysis:run:analysis",function(a,h){var j=b.$new();angular.extend(j,{type:"route",source:"drawing",route:h.routeLayer,fillColor:h.routeLayer.fillColor,style:{"background-color":h.routeLayer.fillColor},resolution:.001,yAxis:"Intensity level"});var k=new f("Route Analysis","fa-line-chart","fa-ellipsis-h",[new e("Select raster for analysis",new g({tag:"st-ra-wiz-data",scope:j}),null,(!0),function(){if(j.loadError=!1,_.isUndefined(j.layers)){var a=["routeanalysis","data"];d.getLayers(a,!0).then(function(b){j.layers={},_.each(b,function(b){var c=_.cloneDeep(b);c.isSelected=!1,_.each(_.get(c.KeywordConfig,a),function(b,d){c.fieldNames=_.merge({id:"id",dtg:"dtg"},_.get(c.KeywordConfig,a.concat([d,"field"]))),c.workspace=d}),_.isArray(j.layers[c.workspace])?j.layers[c.workspace].push(c):j.layers[c.workspace]=[c]})})}j.toggleLayer=function(a){_.isUndefined(j.dataSource)?(a.isSelected=!0,
j.dataSource=a):(j.dataSource.isSelected=!1,j.dataSource!==a?(a.isSelected=!0,j.dataSource=a):delete j.dataSource)}}),new e("Set options",new g({tag:"st-ra-chart-options-wiz",scope:j}),null,(!0),function(){j.query={derivedLayer:{title:j.dataSource.Title,viewState:{isOnMap:!1,toggledOn:!1,isLoading:!1,isRemovable:!0},params:{arrowColor:j.fillColor,fillColor:j.fillColor}}}},function(a){a&&(j.query.derivedLayer.gsLayer=j.dataSource,b.$emit("routeanalysis:request:route",{name:j.query.derivedLayer.title,routeFeature:j.route,dataSource:j.dataSource,resolution:j.resolution},i,j.query.derivedLayer),i.toggleLayer(j.query.derivedLayer,j.route),i.setYAxisLabel(j.query.derivedLayer,j.yAxis))})],j,(void 0),function(){j=k=null});c.launchWizard(k)})}]).directive("stRaWizData",[function(){return{restrict:"E",replace:!0,templateUrl:"routeanalysis/wizard/templates/data.tpl.html"}}]).directive("stRaChartOptionsWiz",function(){return{restrict:"E",templateUrl:"routeanalysis/wizard/templates/chartOptions.tpl.html"}}),angular.module("stealth.static.geo",["colorpicker.module","stealth.core.geo.ows","stealth.static.wizard","ccri.angular-utils"]).run(["$rootScope","staticWorkspaceManager",function(a,b){a.$on("owsLayers:update",function(a,c){_.contains(c.keywordPrefixes,"static")&&b.refreshLayers()})}]).service("staticWorkspaceManager",["$timeout","owsLayers","ol3Map","stealth.core.geo.ol3.layers.WmsLayer","importHeatmapService","wfs","CONFIG",function(a,b,c,d,e,f,g){var h=this,i="";this.markerShapes=["circle","square","triangle","star","cross","x"],this.colorRamps=["green","blue","orange","purple","red"];var j=function(a){var b=a.wmsUrl||g.geoserver.defaultUrl+"/wms";i=b+"?REQUEST=GetLegendGraphic&FORMAT=image/png&WIDTH=16&HEIGHT=16&TRANSPARENT=TRUE&LEGEND_OPTIONS=forceLabels:off&LAYER="+a.layerName+"&ENV="+h.getRequestEnv(a.viewState.fillColor,a.viewState.size,a.viewState.markerShape,a.viewState.radiusPixels,a.viewState.colorRamp,a.viewState.geom,a.viewState.hashAttr),_.isUndefined(a.style)||(i+="&STYLE="+a.style)};this.getRequestEnv=function(a,b,c,d,e,f,g){var h="color:"+a.slice(1)+";size:"+b+";shape:"+c+";colorRamp:"+e+";geom:"+f;return _.isNumber(d)&&(h+=";radiusPixels:"+d),g&&g.name&&(h+=";hashAttr:"+g.name),h},this.getLayerStyles=function(a){var b=_.object(_.map(a.Style,function(a){return[a.Title||a.Name,a.Name]}));return b},this.workspaces={},this.getIconImgSrc=function(a){return j(a),i},this.findLayer=function(a,b){return _.has(h.workspaces,b)?_.find(h.workspaces[b],{Name:a}):_.isUndefined(b)?_.find(_.flatten(_.values(h.workspaces)),{Name:a}):void 0},this.getHeatMapGradient=function(a){var b={green:["#00441b","#006d2c","#238b45","#41ae76","#66c2a4","#99d8c9","#ccece6","#e5f5f9","#f7fcfd"],blue:["#08306b","#08519c","#2171b5","#4292c6","#6baed6","#9ecae1","#c6dbef","#deebf7","#f7fbff"],orange:["#7f2704","#a63603","#d94801","#f16913","#fd8d3c","#fdae6b","#fdd0a2","#fee6ce","#fff5eb"],purple:["#3f007d","#54278f","#6a51a3","#807dba","#9e9ac8","#bcbddc","#dadaeb","#efedf5","#fcfbfd"],red:["#67000d","#a50f15","#cb181d","#ef3b2c","#fb6a4a","#fc9272","#fcbba1","#fee0d2","#fff5f0"]},c=b[a].toString();return{background:"radial-gradient(circle, "+c+")"}};var k=function(b,e){var f=h.getLayerStyles(b),g=_.keys(f),i={LAYERS:e.layerName,CQL_FILTER:e.cqlFilter,STYLES:e.style,ENV:e.env,unique:_.now()};j(e);var k=new d({id:ccriUtils.uuid.generate(),name:e.title+" - "+(e.layerTitle||e.layerName),requestParams:i,queryable:!0,layerThisBelongsTo:b}),l=function(a){var b=a.viewState.markerStyle;a.staticHeatmap?a.style="stealth_static_heatmap":a.style=f[b],i.STYLES=a.style,i.ENV=h.getRequestEnv(a.viewState.fillColor,a.viewState.size,a.viewState.markerShape,a.viewState.radiusPixels,a.viewState.colorRamp,a.viewState.geom,a.viewState.hashAttr),k.updateRequestParams(i)};l(e);var m=k.getOl3Layer();e.mapLayerId=k.id,e.viewState.isOnMap=!0,e.viewState.toggledOn=m.getVisible(),k.styleDirectiveScope.styleVars.iconClass="fa fa-fw fa-lg fa-database",k.styleDirective="st-static-style-view",k.styleDirectiveScope.filterLayer=e,k.styleDirectiveScope.getIconImgSrc=h.getIconImgSrc,k.styleDirectiveScope.markerStyles=g,k.styleDirectiveScope.markerShapes=h.markerShapes,k.styleDirectiveScope.colorRamps=h.colorRamps,k.styleDirectiveScope.featureAttributes=_.sortBy(e.query.featureTypeData.featureTypes[0].properties,"name"),k.styleDirectiveScope.attrFilterFn=function(a){return"xsd:string"===a.type},k.styleDirectiveScope.labelFn=function(a){return a.name};var n=_.keys(_.get(b.KeywordConfig,"static"))[0];_.has(b.KeywordConfig,"static."+n+".radiusPixels.min")?k.styleDirectiveScope.radiusMin=_.get(b.KeywordConfig,"static."+n+".radiusPixels.min"):k.styleDirectiveScope.radiusMin=1,_.has(b.KeywordConfig,"static."+n+".radiusPixels.max")?k.styleDirectiveScope.radiusMax=_.get(b.KeywordConfig,"static."+n+".radiusPixels.max"):k.styleDirectiveScope.radiusMax=100,(k.styleDirectiveScope.filterLayer.viewState.radiusPixels<k.styleDirectiveScope.radiusMin||k.styleDirectiveScope.filterLayer.viewState.radiusPixels>k.styleDirectiveScope.radiusMax)&&(k.styleDirectiveScope.filterLayer.viewState.radiusPixels=k.styleDirectiveScope.radiusMin),k.styleDirectiveScope.removeLayer=function(a){e.viewState.isOnMap&&h.toggleLayer(a,e);var b=_.findKey(h.workspaces,function(a){return a.filterLayers===_.find(a.filterLayers,{title:e.title})});_.pull(h.workspaces[b][0].filterLayers,e)},c.addLayer(k),k.styleDirectiveScope.getHeatMapGradient=h.getHeatMapGradient,k.styleDirectiveScope.setFillColor=function(a){j(a),l(a)},k.styleDirectiveScope.sizeChanged=function(a){angular.isNumber(a.viewState.size)||(a.viewState.size=1),j(a),l(a)},k.styleDirectiveScope.markerStyleChanged=function(a){j(a),l(a)},k.styleDirectiveScope.markerShapeChanged=function(a){j(a),l(a)},k.styleDirectiveScope.heatmapRadiusChanged=function(a){angular.isNumber(a.viewState.radiusPixels)||(a.viewState.radiusPixels=10),l(a)},k.styleDirectiveScope.colorRampChanged=function(a){j(a),l(a)},k.styleDirectiveScope.hashAttrChanged=function(a){j(a),l(a)},m.on("change:visible",function(){a(function(){e.viewState.toggledOn=m.getVisible()})}),k.styleDirectiveScope.$on(k.id+":isLoading",function(a){e.viewState.isLoading=!0,a.stopPropagation()}),k.styleDirectiveScope.$on(k.id+":finishedLoading",function(a){e.viewState.isLoading=!1,a.stopPropagation()})},l=function(a,b){var c={featureName:b.layerName,radiusPixels:b.viewState.radiusPixels,minX:b.queryParams.minLon,minY:b.queryParams.minLat,maxX:b.queryParams.maxLon,maxY:b.queryParams.maxLat,outputWidth:b.queryParams.outputWidth,outputHeight:b.queryParams.outputHeight,workspace:a.Name.substr(0,a.Name.indexOf(":")),heatmapName:b.title,keywords:g.app.context+".routeanalysis.data.Density Surfaces",xmlFilter:f.cqlToFilterXml(b.cqlFilter)};e.doImportHeatmap(c).then(function(c){b.layerName=c,b.heatmapSaved=!0,k(a,b)})};this.toggleLayer=function(a,b){if(_.isUndefined(b.mapLayerId)||_.isNull(b.mapLayerId))b.staticHeatmap&&!b.heatmapSaved?l(a,b):k(a,b);else{var d=c.getLayerById(b.mapLayerId);delete d.styleDirectiveScope.layer,c.removeLayerById(b.mapLayerId),delete b.mapLayerId,b.viewState.isOnMap=!1,b.viewState.toggledOn=!1,b.env=h.getRequestEnv(b.viewState.fillColor,b.viewState.size,b.viewState.markerShape,b.viewState.radiusPixels,b.viewState.colorRamp,b.viewState.geom)}};var m="static",n=function(){_.each(h.workspaces,function(a){_.each(a,function(a){a.DELETABLE=!0})})},o=function(a){delete a.DELETABLE},p=function(){var a=[];_.each(_.keys(h.workspaces),function(b){var c=_.reject(h.workspaces[b],"DELETABLE");_.each(_.filter(h.workspaces[b],"DELETABLE"),function(a){_.each(a.filterLayers,function(b){h.toggleLayer(a,b)})}),_.each(c,function(a){o(a)}),h.workspaces[b]=c,0===c.length&&a.push(b)}),_.each(a,function(a){delete h.workspaces[a]})};this.refreshLayers=function(a){b.getLayers(m,!a).then(function(a){n(),_.each(a,function(a){var b=_.cloneDeep(a);b.filterLayers=[],_.each(_.keys(_.get(b.KeywordConfig,m)),function(a){_.isArray(h.workspaces[a])||(h.workspaces[a]=[]);var c=_.find(h.workspaces[a],{Name:b.Name});c?o(c):h.workspaces[a].push(b)})}),p()})},this.refreshLayers(!0)}]).run(["$rootScope","staticWorkspaceManager","categoryManager","staticLayerWizard","ol3Map","stealth.core.geo.ol3.manager.Category","ccri.angular-utils.WidgetDef","CONFIG",function(a,b,c,d,e,f,g,h){var i=a.$new();i.workspaces=b.workspaces,i.getIconImgSrc=b.getIconImgSrc,i.toggleLayer=b.toggleLayer,i.getHeatMapGradient=b.getHeatMapGradient,i.toggleVisibility=function(a){var b=e.getLayerById(a.mapLayerId),c=b.getOl3Layer();c.setVisible(!c.getVisible())},i.removeLayer=function(a,b){b.viewState.isOnMap&&i.toggleLayer(a,b),_.pull(a.filterLayers,b)},i.launchLayerFilterWizard=function(a){d.launch(a,i.toggleLayer)};var j=new g({tag:"st-static-geo-category",scope:i,isolateScope:!0}),k=new f(1,_.get(h,"static.categoryName")||"Data","fa-database",j,null,(!0));k.height=500,c.addCategory(0,k),j=k=null}]).directive("stStaticGeoCategory",["$log",function(a){return a.debug("stealth.static.geo.context.stStaticGeoCategory: directive defined"),{templateUrl:"static/geo/category.tpl.html"}}]).directive("stStaticStyleView",["$log",function(a){var b="stealth.static.geo.stStaticStyleView: ";return a.debug(b+"directive defined"),{templateUrl:"static/geo/staticstyleview.tpl.html"}}]),angular.module("stealth.static",["stealth.static.geo","stealth.static.wizard"]),angular.module("stealth.static.wizard",["stealth.core.geo.ows"]).factory("stealth.static.wizard.Query",["wfs","CONFIG",function(a,b){var c=1,d=moment().utc(),e=d.clone().subtract(7,"days");return function(){var f=this;f.layerData={},f.params={title:"Query "+c++,geomField:null,maxLat:90,minLat:-90,maxLon:180,minLon:-180,noDtg:!1,startDtg:null,endDtg:null,cql:null,markerStyle:"point",markerShape:"circle",size:9,fillColor:"#000000",radiusPixels:10,colorRamp:null,hashAttr:null,staticHeatmap:!1,outputWidth:null,outputHeight:null},f.timeData={defaultStartDtg:e,defaultEndDtg:d},this.getFeatureTypeDescription=function(c){return f.layerData.error=null,f.featureTypeData=null,f.params.geomField=null,a.getFeatureTypeDescription(b.geoserver.defaultUrl,c.Name).then(function(a){f.featureTypeData=a,f.featureAttributes=_.sortBy(f.featureTypeData.featureTypes[0].properties,"name"),a.error&&(f.featureTypeData="unavailable")},function(a){f.layerData.error="GetFeatureTypeDescription request failed. Error: "+a.status+" "+a.statusText})}}}]).service("importHeatmapService",["wps","CONFIG",function(a,b){this.doImportHeatmap=function(c){var d=stealth.jst["wps/importHeatmap.xml"],e=d(c);return a.submit(b.geoserver.defaultUrl,e)}}]),angular.module("stealth.static.wizard",["ccri.angular-utils","stealth.wizard"]).service("staticLayerWizard",["$rootScope","stealth.wizard.wizardManager","colors","cqlHelper","stealth.core.wizard.Step","stealth.core.wizard.Wizard","stealth.static.wizard.Query","ccri.angular-utils.WidgetDef","ccri.area-definition.FeatureCreator","staticWorkspaceManager","CONFIG",function(a,b,c,d,e,f,g,h,i,j,k){function l(){return o%=n.length,n[o++]}function m(){return q%=p.length,p[q++]}this.launch=function(o,q,r){function s(){y.featureCreator=y.query=null,y.$destroy(),x=y=A=null}function t(a){y.toolWasOpened=!0,y.selectedTool=a.toolName}function u(){y.selectedTool=null}function v(){y.featureCreator.getFeatures().then(w).then(function(){var a=function(a){var b,c=y.query.params.generatedFeatures;return b=a?d.buildFeatureFilterSwapFeatureAndGeom(c,y.query.params.geomField.name):d.buildFeatureFilter(c,y.query.params.geomField.name),d.combine(d.operator.AND,y.query.params.cql,b)};y.cqlStats.finalCql=a(),y.cqlStats.staticHeatmapFinalCql=a(!0),"include"===y.cqlStats.finalCql.toLowerCase()&&(y.cqlStats.finalCql=""),"include"===y.cqlStats.staticHeatmapFinalCql.toLowerCase()&&(y.cqlStats.staticHeatmapFinalCql="")})}function w(a){y.query.params.generatedFeatures=_.filter(a,function(a){var b=a.getGeometry();return b instanceof ol.geom.Polygon||b instanceof ol.geom.MultiPolygon})}var x,y=a.$new();y.$watch("query.params.noDtg",function(){y.query.params.noDtg&&(y.next=b.nextStep())}),y.layer=o,y.query=new g(r);var z=y.query.getFeatureTypeDescription(y.layer);y.query.layerData.currentLayer=!0,y.labelFn=ccriUtils.strategies.propertyAccessor(),y.layerProperties={dtgField:{label:"Time",labelFn:ccriUtils.strategies.propertyAccessor(),filterFn:ccriUtils.strategies.featurePropertiesFilter(["date-time","date"])},geomField:{label:"Geometry",labelFn:ccriUtils.strategies.propertyAccessor(),filterFn:ccriUtils.strategies.featurePropertiesFilter(["point","linestring"])}},y.getHeatMapGradient=j.getHeatMapGradient,y.steps=[new e("Identify important fields",new h({tag:"st-static-wiz-source",scope:y}),null,(!0),function(){this.getSteps()[0].setCustomValidationFn(function(){return y.query.params.dtgField&&y.query.params.geomField})}),new e("Define search area",new h({tag:"st-static-wiz-spatial-bounds",scope:y}),new h({tag:"st-wiz-draw-toolbar",scope:y}),(!1),function(){y.selectedTool=null,y.toolControlsConfig={radiusCircle:!0,polygon:!0,bufferFeature:!0,mapView:!0,coordRect:!0,wholeEarth:!0},y.featureCreator=y.featureCreator||new i({supportedTools:["coordRect","polygon","radiusCircle","bufferFeature","mapView","wholeEarth"],disableMultiple:!1}),y.cqlStats={finalCql:null,cqlMaxlength:_.get(k,"geoserver.cqlMaxLength",1/0),showBinSortOption:!_.get(k,"timelapse.hideBinSortOption"),appContext:_.get(k,"app.context")},y.toolWasOpened=!1,y.featureCreator.on("toolstarted",t),y.featureCreator.on("toolfinished",u),y.featureCreator.on("featureschanged",v),_.merge(y.query.params,r)},function(){return y.featureCreator.finishActiveTool().then(function(){y.featureCreator.un("toolstarted",t),y.featureCreator.un("toolfinished",u),y.featureCreator.un("featureschanged",v)})}),new e("Define time range",new h({tag:"st-static-wiz-time-bounds",scope:y}),null,(!0)),new e("Set options",new h({tag:"st-static-wiz-options",scope:y}),null,(!0),function(){this.getSteps()[this.getSteps().length-1].setCustomValidationFn(function(){return y.query.params.radiusPixels>=y.radiusMin&&y.query.params.radiusPixels<=y.radiusMax}),y.query.params.hashAttr=y.query.featureAttributes[0]},function(a){if(a){y.query.params.staticHeatmap&&_.merge(y.query.params.dtgField,{isString:!0});var b=y.query.params,c=d.combine(d.operator.AND,b.cql,y.query.params.staticHeatmap?y.cqlStats.staticHeatmapFinalCql:y.cqlStats.finalCql,b.noDtg?null:d.buildDtgFilter(b.dtgField.name,b.startDtg,b.endDtg,b.dtgField.isString,b.dtgField.dtgFormatter));x={title:b.title,query:y.query,layerName:o.Name,layerTitle:o.Title,serverUrl:o.serverUrl,queryable:o.queryable,viewState:{isOnMap:!1,toggledOn:!1,isLoading:!1,isRemovable:!0,markerStyle:b.markerStyle,markerShape:b.markerShape,size:b.size,fillColor:y.style["background-color"],radiusPixels:b.radiusPixels,colorRamp:b.colorRamp,geom:b.geomField.name,hashAttr:b.hashAttr},cqlFilter:_.isEmpty(c)?null:c,style:"stealth_dataPoints",env:y.style["background-color"]?"color:"+y.style["background-color"].substring(1):null,queryParams:b,staticHeatmap:b.staticHeatmap},o.filterLayers.push(x),q(o,x),b=null}})],z.then(function(){var a=_.keys(_.get(y.layer.KeywordConfig,"static"))[0];_.has(y.layer.KeywordConfig,"static."+a+".field.dtg")&&y.query.featureTypeData&&(y.query.params.dtgField=_.find(y.query.featureTypeData.featureTypes[0].properties,function(b){return b.name===_.get(y.layer.KeywordConfig,"static."+a+".field.dtg")})),_.has(y.layer.KeywordConfig,"static."+a+".field.geom")&&y.query.featureTypeData&&(y.query.params.geomField=_.find(y.query.featureTypeData.featureTypes[0].properties,function(b){return b.name===_.get(y.layer.KeywordConfig,"static."+a+".field.geom")})),y.query.params.dtgField&&y.query.params.geomField&&(y.steps=_.drop(y.steps,1)),_.has(y.layer.KeywordConfig,"static."+a+".radiusPixels.min")?y.radiusMin=_.get(y.layer.KeywordConfig,"static."+a+".radiusPixels.min"):y.radiusMin=1,_.has(y.layer.KeywordConfig,"static."+a+".radiusPixels.max")?y.radiusMax=_.get(y.layer.KeywordConfig,"static."+a+".radiusPixels.max"):y.radiusMax=100,(y.query.params.radiusPixels<y.radiusMin||y.query.params.radiusPixels>y.radiusMax)&&(y.query.params.radiusPixels=y.radiusMin),b.launchWizard(new f("Query Data Layer","fa-database","fa-check text-success",y.steps,y,"wizard-dark StaticQueryWizard",function(){y.featureCreator?y.featureCreator.finish().then(s):s()}))});var A=j.getLayerStyles(o);angular.extend(y,{style:{"background-color":c.getColor()},markerStyles:_.keys(A),sld:A,markerShapes:n,colorRamps:p}),y.query.params.markerStyle=Object.keys(A)[0],y.query.params.markerShape=l(),y.query.params.fillColor=y.style["background-color"],y.query.params.colorRamp=m(),y.getIconImgSrc=function(){var a=y.layer.wmsUrl||k.geoserver.defaultUrl+"/wms";return a+"?REQUEST=GetLegendGraphic&FORMAT=image/png&WIDTH=24&HEIGHT=24&TRANSPARENT=TRUE&LEGEND_OPTIONS=forceLabels:off&LAYER="+y.layer.Name+"&ENV="+j.getRequestEnv(y.query.params.fillColor,y.query.params.size,y.query.params.markerShape,y.query.params.radiusPixels,y.query.params.colorRamp,y.query.params.geomField.name,y.query.params.hashAttr)+"&STYLE="+y.sld[y.query.params.markerStyle]}};var n=j.markerShapes,o=0,p=j.colorRamps,q=0}]).directive("stStaticWizSource",function(){return{restrict:"E",templateUrl:"static/wizard/templates/source.tpl.html"}}).directive("stStaticWizSpatialBounds",function(){return{restrict:"E",templateUrl:"static/wizard/templates/spatialbounds.tpl.html"}}).directive("stStaticWizTimeBounds",["CONFIG",function(a){return{restrict:"E",templateUrl:"static/wizard/templates/timebounds.tpl.html",compile:function(){return{pre:function(b){b.storageKeyPrefix=b.storageKeyPrefix||_.get(a,"app.context")}}}}}]).directive("stStaticWizOptions",function(){return{restrict:"E",templateUrl:"static/wizard/templates/options.tpl.html"}}),angular.module("stealth.timelapse").service("arrowGroupBy",[function(){function a(a,b,c,d,e){var f,g,h,i=b.find(function(a){return a.name===c.name}),j=b.find(function(a){return a.name===d.name}),k={},l=a.evaluate(function(a){g=i.getEncoded(a),_.isNumber(g)&&(h=j.getEncoded(a),_.isNumber(h)&&(k[g]||(k[g]=new Set),k[g].add(h)))}).then(function(){var a=[],b=[];_.each(k,function(c,d){a.push(i.decode(parseInt(d,10))),b.push(c.size)});var c=[a,b];for(f=0;f<c[0].length;f++)c[0][f]&&e(f,c)});return l}return a}]),angular.module("stealth.timelapse",["stealth.core.utils"]).directive("stealthTimelapseChart",["$filter","$q","$timeout","CONFIG","ol3Map","viewExtentPredicate",function(a,b,c,d,e,f){return{restrict:"E",require:"^^ccriPopupSizeControl",scope:{store:"="},templateUrl:"timelapse/controls/chart.tpl.html",controller:["$scope",function(g){function h(){var a=g.store.getRenderedTime();return x.timeWindow[0]!==a.start||x.timeWindow[1]!==a.end||x.groupBy!==g.groupByProperty||x.countBy!==g.countByProperty||x.isViewExtentFiltering!==g.vm.isFilteringByView||g.vm.isFilteringByView&&x.viewExtentPredicate!==A}function i(){var a=h(),b=g.store.getRenderedTime();return x.timeWindow[0]=b.start,x.timeWindow[1]=b.end,x.groupBy=g.groupByProperty,x.countBy=g.countByProperty,x.isViewExtentFiltering=g.vm.isFilteringByView,x.viewExtentPredicate=A,a}function j(){J&&(D=F.getState(ccriTimeControls.TIME_CONTROLS_PATH),D.isPaused&&!D.isDragging?k():(g.waiting=g.waiting||h(),_.defer(function(){g.$apply()})))}function k(){J&&(c.cancel(t),t=c(function(){g.waiting=!1,i()?(g.processing=!0,b.when(g.store.groupBy(g.groupByProperty,g.countByProperty===y?null:g.countByProperty,u,A)).then(function(a){return g.processing=!1,H.updateData(a)}).catch(function(){g.processing=!1})):g.waiting=!1},100))}function l(){g.processing=!0,_.delay(function(){u&&g.store.removePredicate(u),H.clearSelections(),H.resetView(),m(),k()},100)}function m(){g.countByProperty===g.groupByProperty&&(g.countByProperty=y);var a=[y];g.properties.forEach(function(b){b!==g.groupByProperty&&a.push(b)}),g.countByProperties=a}function n(){k()}function o(){H&&H.resetView()}function p(){g.vm.isFilteringByView&&g.$apply(function(){q(),j()})}function q(){A=g.vm.isFilteringByView?f.getPredicate(B):null}function r(a){var b=Array.from(a);b.length?(v=u,u=b.map(function(a){return arrow_geo.col(g.groupByProperty).eq(arrow_geo.lit(g.store.encodeDictVal(g.groupByProperty,a)))}).reduce(function(a,b){return a.or(b)}),g.store.addPredicate(u,v),v=null):u&&(g.store.removePredicate(u),u=void 0)}function s(){H&&H.clearSelections()}var t,u,v,w=g.$on("$destroy",function(){w(),w=null,E&&E(),E=null,I&&I(),I=null,K&&K(),K=null,L&&L(),L=null,C&&C.un(["change:center","change:resolution","change:rotation"],p),u&&g.store.removePredicate(u),G.unsubscribe(),G=null,g=t=H=null}),x={timeWindow:[],groupBy:null,countBy:null,isViewExtentFiltering:null,viewExtentPredicate:null};g.properties=_.keys(g.store.dataset().dicts),g.groupByProperty=g.properties[0];var y="(all)";g.countByProperty=y,g.countByProperties=[];var z=a("attributeLabel");g.labelAttribute=function(a){return a===y?a:z(a)},g.processing=!0,g.waiting=!1,g.vm={isFilteringByView:_.get(d,"arrow.chart.viewFilteringEnabledByDefault",!0)};var A,B=g.store.getGeomField();g.vm.isFilteringByView&&(A=f.getPredicate(B));var C=e.getView();C.on(["change:center","change:resolution","change:rotation"],p);var D,E=g.$watch("vm.isFilteringByView",function(a,b){a!==b&&(q(),j())}),F=AppState.StateManager.getInstance(),G=F.getObservable(ccriTimeControls.TIME_CONTROLS_PATH).subscribe({next:function(){_.defer(j)}});m(),g.onGroupByChanged=l,g.onCountByChanged=n;var H,I=g.$watch(function(){return g.store.getFillColorRgbArray().join(",")},function(a,b){a!==b&&H.setDefaultBarColor(g.store.getFillColorRgbArray())}),J=!0,K=g.$on("PopupCollapsed",function(){J=!1}),L=g.$on("PopupExpanded",function(){J=!0,j()});g.chartInitializer=function(a){H=a,H.setDefaultBarColor(g.store.getFillColorRgbArray()),j()},g.selectionChanged=r,g.onResetViewBtn=o,g.onClearBtn=s}]}}]),angular.module("stealth.timelapse",["stealth.core.utils"]).directive("colorByFieldChooser",["$filter",function(a){return{restrict:"E",replace:!0,scope:{store:"="},templateUrl:"timelapse/controls/colorByFieldChooser.tpl.html",link:function(b){var c=a("attributeLabel");b.labelAttribute=function(a){return c(a)}}}}]),angular.module("stealth.timelapse",[]).directive("colorByIdRandomizer",[function(){return{restrict:"E",scope:{store:"="},templateUrl:"timelapse/controls/colorByIdRandomizer.tpl.html"}}]),angular.module("stealth.timelapse",[]).directive("colorModeSingleColorChooser",[function(){return{restrict:"E",scope:{store:"="},templateUrl:"timelapse/controls/colorModeSingleColorChooser.tpl.html"}}]),angular.module("stealth.timelapse",[]).directive("colorModeSwitcher",[function(){return{restrict:"E",replace:!0,scope:{store:"="},templateUrl:"timelapse/controls/colorModeSwitcher.tpl.html"}}]),angular.module("stealth.timelapse",["stealth.core.interaction.lists","stealth.core.utils"]).directive("stPlotlyBarChart",["colors","SelectionHelper",function(a,b){return{restrict:"E",require:"?^^ccriPopupSizeControl",scope:{register:"=registerWith",selectionsHandler:"=",loading:"="},templateUrl:"timelapse/controls/plotlyBarChart.tpl.html",link:function(c,d,e,f){function g(a){if(ea.x.length=0,ca.xaxis.ticktext.length=0,ea.y.length=0,ea.text.length=0,ea.marker.color.length=0,0===a.length)return void(c.noData=!0);c.noData=!1,la=ma=null;var b;return _.forEach(a,function(a){b=a.name.length>12?a.name.substr(0,9)+"...":a.name,ea.x.push(a.name),ca.xaxis.ticktext.push(b),ea.text.push(a.name),ea.y.push(a.count),ea.marker.color.push(T)}),u(),h().then(function(){return F()})}function h(){return I().then(function(){M=ga.find(".draglayer .drag").get(0),N=ga.find(".cartesianlayer .subplot .plot .barlayer").get(0),fa=!0})}function i(){if(la=ma=null,fa)return G({"xaxis.autorange":!0})}function j(){return J()}function k(a,b){o("pointer"),R=null,b.points&&b.points.length&&(R=b.points[0].pointNumber,p(R))}function l(){o("default"),q(R),R=null}function m(a,b){if(b.points&&b.points.length){var c=b.points[0].pointNumber;O.click(c,b.event.ctrlKey,b.event.shiftKey)}}function n(a,b){b&&b.range&&b.range.x[0]&&b.range.x[1]&&y(b.range.x[0],b.range.x[1]).forEach(function(a){B(a)}),oa()}function o(a){M&&(M.style.cursor=a)}function p(a){s(a,Q.has(a)?W:U)}function q(a){s(a,Q.has(a)?V:T)}function r(b){T="rgb("+b[0]+","+b[1]+","+b[2]+")";var c=a.lightenRGB(b[0],b[1],b[2],50),d=a.lightenRGB(b[0],b[1],b[2],80),e=a.lightenRGB(b[0],b[1],b[2],90);U="rgb("+c[0]+","+c[1]+","+c[2]+")",V="rgb("+d[0]+","+d[1]+","+d[2]+")",W="rgb("+e[0]+","+e[1]+","+e[2]+")",fa&&(v(),u(),h())}function s(a,b){ja=N.childNodes[0].childNodes[0],ja&&(ka=ja.childNodes[a])&&(ka.childNodes[0].style.fill=b),ea.marker.color[a]=b,ka=null}function t(){if(R&&q(R),fa)return H({marker:{color:ea.marker.color}})}function u(){Q.clear(),P.forEach(function(a){var b=w(a);Q.add(b),ea.marker.color[b]=V})}function v(){_.forEach(ea.marker.color,function(a,b){ea.marker.color[b]=T})}function w(a){return ea.text.indexOf(a)}function x(a){return ea.text[a]}function y(a,b){var c=ea.x.indexOf(a),d=ea.x.indexOf(b);return z(c,d)}function z(a,b){var c,d;a<=b?(c=a,d=b):(c=b,d=a);var e=ea.x.slice(c,d+1),f=[];return e.forEach(function(a){a&&f.push(ea.x.indexOf(a))}),f}function A(a,b){var c=!Q.has(a);b!==!0&&b!==!1||(c=b),c===!0?B(a):C(a),oa()}function B(a){Q.add(a),P.add(x(a)),s(a,R===a?W:V),na()}function C(a){Q.delete(a),P.delete(x(a)),s(a,R===a?U:T),na()}function D(){Q.clear(),P.clear(),v()}function E(){O.clear(),D(),t(),c.selectionsHandler&&c.selectionsHandler(P)}function F(){if(N){var a=N.getBoundingClientRect().width,b=2*ba,c=a/b,d=Math.floor(ea.x.length/c)||1;if(c!==la||d!==ma){la=c,ma=d,ca.xaxis.tickvals.length=0;for(var e=0;e<=ea.x.length;e+=d)ca.xaxis.tickvals.push(ea.x[e]);return G()}}}function G(a){var b=a||ca;return Plotly.relayout(ga[0],b)}function H(a){var b=a||ea;return Plotly.restyle(ga[0],b)}function I(){return Plotly.newPlot(ga[0],[ea],ca,da)}function J(){return Plotly.Plots.resize(ga[0])}var K=c.$on("$destroy",function(){K(),K=null,ga&&(ga.off("plotly_hover",k),ga.off("plotly_unhover",l),ga.off("plotly_click",m),ga.off("plotly_selected",n),ga.off("plotly_relayout",ha),Plotly.purge(ga[0])),ia&&ia.off("resize",j),L.updateData=L.clearSelections=L=null,ga=M=N=ja=ka=null});c.noData=!1;var L={updateData:g,clearSelections:E,resetView:i,setDefaultBarColor:r};_.defer(function(){c.register(L)});var M,N,O=new b(function(a,b){A(a,b)}),P=new Set,Q=new Set,R=null,S="#333",T="rgb(31, 119, 180)",U="rgb(100, 166, 212)",V="rgb(255, 110, 110)",W="rgb(251, 150, 150)",X="#000",Y="#fff",Z='"Helvetica Neue",Helvetica,Arial,sans-serif',$=12,aa="#808080",ba=12,ca={xaxis:{type:"category",tickvals:[],ticktext:[],tickmode:"array",color:aa,tickangle:-45,tickfont:{size:ba}},yaxis:{color:aa,fixedrange:!0},margin:{t:0,r:10,b:70,l:40},paper_bgcolor:S,plot_bgcolor:S,dragmode:"pan"},da={showLink:!1,scrollZoom:!0,doubleClick:!1,displayModeBar:!1,modeBarButtonsToRemove:["toImage","sendDataToCloud","zoom2d","pan2d","zoomIn2d","zoomOut2d","autoScale2d","resetScale2d","toggleSpikelines","hoverClosestCartesian","hoverCompareCartesian"],displaylogo:!1,showTips:!1,showAxisDragHandles:!1,showAxisRangeEntryBoxes:!1},ea={type:"bar",x:[],y:[],text:[],marker:{color:[]},hoverinfo:"y+text",hoverlabel:{bgcolor:X,bordercolor:X,font:{color:Y,family:Z,size:$}}},fa=!1,ga=d.find(".plotly-timelapse-barchart"),ha=_.debounce(function(){_.defer(function(){F()})},250);ga.on("plotly_hover",k),ga.on("plotly_unhover",l),ga.on("plotly_click",m),ga.on("plotly_selected",n),ga.on("plotly_relayout",ha);var ia=f?f.element:void 0;ia&&ia.on("resize",j);var ja,ka,la,ma,na=_.debounce(t,500),oa=_.debounce(function(){c.selectionsHandler&&c.selectionsHandler(Array.from(P))},1)}}}]),angular.module("stealth.timelapse").service("viewExtentPredicate",["ol3Map",function(a){function b(a){return function(b){return b[a]}}var c,d,e=!1,f=a.getExtent();return a.getView().on(["change:center","change:resolution","change:rotation"],function(){f=a.getExtent(),e=!1}),{getPredicate:function(a){return e&&d===a?c:(c=[arrow_geo.unaryfunc(b(1),arrow_geo.col(a)).gteq(arrow_geo.lit(f[0])),arrow_geo.unaryfunc(b(1),arrow_geo.col(a)).lteq(arrow_geo.lit(f[2])),arrow_geo.unaryfunc(b(0),arrow_geo.col(a)).gteq(arrow_geo.lit(f[1])),arrow_geo.unaryfunc(b(0),arrow_geo.col(a)).lteq(arrow_geo.lit(f[3]))].reduce(function(a,b){return a.and(b)}),e=!0,d=a,c)}}}]),angular.module("stealth.timelapse.geo",["colorpicker.module","ccri.angular-utils","stealth.core.utils","stealth.live","stealth.timelapse.geo.ol3.layers","stealth.timelapse.stores","stealth.timelapse.category","stealth.timelapse.wizard","stealth.timelapse.wizard.live","stealth.geo.timelapse"]).constant("stealth.timelapse.geo.workspaces",{}).run(["$rootScope","categoryManager","summaryExploreMgr","stealth.core.geo.ol3.manager.Category","stealth.timelapse.geo.workspaces","ccri.angular-utils.WidgetDef","stealth.geo.timelapse.manager.Manager",function(a,b,c,d,e,f,g){function h(){return m.getState("layers")}function i(a){a.forEach(function(a){var b={};b[a.idField]=a.id;var d={layerName:a.source,trkIdField:a.idField};c.summaryQuery(a.name,b,d,{zIndexHint:6,dataSource:DataSourceManager.getDataSourceByLayerName(a.source)})})}function j(a){g.createAlertLayers(a)}var k,l=a.$new(),m=AppState.StateManager.getInstance();l.timelapse={isSummaryOn:!0};var n=new f({tag:"st-timelapse-geo-category",scope:l,isolateScope:!0});_.assign(e,{historical:{},summary:c.workspaces});var o="timelapse";DataSourceManager.loadDataSources().then(function(){var a=DataSourceManager.getDataSourcesByKeyword(o).map(function(a){return DataSourceManager.buildLegacyLayer(a)}).toJS();if(_.each(a,function(a){_.each(["summary"],function(b){_.each(_.keys(a.KeywordConfig[o][b]),function(c){var d=_.cloneDeep(a),f=_.get(d.KeywordConfig,[o,b,c,"prefilter"]);d.prefilter=f||null;var g=_.get(d.KeywordConfig,[o,b,c,"title"]);d.Title=g||d.Title,d.hasViewables=function(a){return!_.isEmpty(a)},d.stealthWorkspace=c,d.KeywordConfig[o].summary&&(d.summaries=[]),_.isArray(e[b][c])?e[b][c].push(d):e[b][c]=[d]})})}),k=h())j(k.get("timelapse")),i(k.get("summary"));else var b=m.getObservable("layers").subscribe({next:function(a){j(a.get("timelapse")),i(a.get("summary")),b.unsubscribe()}})});var p=new d(1,"Time-enabled","fa-clock-o",n,null,(!0));p.height=500,b.addCategory(1,p)}]).directive("stTimelapseGeoCategory",["$log","ol3Map","summaryExploreMgr","stealth.timelapse.geo.ol3.layers.visibleLayersCache","stealth.timelapse.geo.workspaces",function(a,b,c,d,e){var f="stealth.core.geo.context.stTimelapseGeoCategory: ";return a.debug(f+"directive defined"),{templateUrl:"timelapse/geo/category.tpl.html",controller:["$scope",function(g){function h(a,b,c){c?i(a,function(a){a.getVisible()&&(d.addTo(b,a),a.setVisible(!1))}):(_.each(d.getAllFrom(b),function(a){a.setVisible(!0)}),d.empty(b))}function i(a,c){_.each(a,function(a){_.each(a,function(a){var d=a.summaries;_.each(d,function(a){var d=a.mapLayerId;if(!_.isUndefined(d)&&!_.isNull(d)){var e=b.getLayerById(d);if(!_.isUndefined(e)){var f=e.getOl3Layer();c(f)}}})})})}var j=g.$on("$destroy",function(){j(),j=null,g.workspaces=g.toggleSummaryVisibility=g.toggleSlideSummary=g.toggleSummaryLayer=g.removeSummaryLayer=g=null});g.workspaces=e,g.toggleSummaryVisibility=function(a){var c=b.getLayerById(a.mapLayerId),d=c.getOl3Layer();d.setVisible(!d.getVisible())};var k="SUMMARY";d.define(k),g.toggleSlideSummary=function(b){a.debug(f+"toggleSlideSummary"),h(g.workspaces.summary,k,b),g.timelapse.isSummaryOn=!b},g.toggleSummaryLayer=c.toggleSummaryLayer,g.removeSummaryLayer=c.removeSummaryLayer}]}}]),angular.module("stealth.timelapse.geo.ol3.layers").constant("stealth.timelapse.geo.ol3.layers.ColorModes",{ONE_COLOR:0,COLOR_BY_ID:1,OPACITY_RAMP:2}),angular.module("stealth.timelapse.geo.ol3.layers",["stealth.core.utils"]).service("DrawingHelpers",["colors",function(a){function b(a,b,c,d,e,f){if(c)for(h=0|b[0],i=0|b[1],j=i*e|0,k=0|c[0],l=0|c[1],m=0|Math.abs(k-h),o=0|(h<k?1:-1),m>=f&&(k-=2*o*f,m=0|Math.abs(k-h),o*=-1),n=0|Math.abs(l-i),p=0|(i<l?1:-1),q=(m>n?m:-n)/2;;){
if(r=q,r>-m&&(q-=n,h+=o),r<n&&(q+=m,i+=p,j=i*e|0),h===k&&i===l)break;a[j+(h<0?h+e:h%e)]=d}}function c(a,b,c,d){var e=(4278190080&a)>>>0,f=16777215&a;return 0===e||f!==d||c>=e?b:a}function d(a,b,d,e,f,g,k){var m=(k&t)>>>0,n=k&u;for(a[e]=c(a[e],k,m,n),i=1;i<f;i=i+1|0)for(l=i*i|0,j=i*d|0,s=e+j|0,s<b&&(a[s]=c(a[s],k,m,n)),s=e-j|0,s>-1&&(a[s]=c(a[s],k,m,n)),s=e+i|0,s<b&&(a[s]=c(a[s],k,m,n)),s=e-i|0,s>-1&&(a[s]=c(a[s],k,m,n)),h=1;h<f;h=h+1|0)h*h+l<g&&(s=e+j+h|0,s<b&&(a[s]=c(a[s],k,m,n)),s=e-j+h|0,s>-1&&s<b&&(a[s]=c(a[s],k,m,n)),s=e+j-h|0,s>-1&&s<b&&(a[s]=c(a[s],k,m,n)),s=e-j-h|0,s>-1&&(a[s]=c(a[s],k,m,n)))}function e(a,b,c,d,e,f,g){for(a[d]=g,i=1;i<e;i=i+1|0)for(l=i*i|0,j=i*c|0,s=d+j|0,s<b&&(a[s]=g),s=d-j|0,s>-1&&(a[s]=g),s=d+i|0,s<b&&(a[s]=g),s=d-i|0,s>-1&&(a[s]=g),h=1;h<e;h=h+1|0)h*h+l<f&&(s=d+j+h|0,s<b&&(a[s]=g),s=d-j+h|0,s>-1&&s<b&&(a[s]=g),s=d+j-h|0,s>-1&&s<b&&(a[s]=g),s=d-j-h|0,s>-1&&(a[s]=g))}function f(a,b,c){var d=c-b>>1;d<1||(a[b+d]=a[b]+(a[c]-a[b]>>1),f(a,b,b+d),f(a,b+d,c))}var g=8;this.nDiv=g,this.radiusRamps=_.map(_.range(1,101),function(a){var b=new Uint32Array(g);return b[0]=1,b[g-1]=a,f(b,0,g-1),b}),this.r2Plus1Ramps=_.map(this.radiusRamps,function(a){return _.map(a,function(a){return(a-1)*(a-1)+1})}),this.alphaRamps=_.map(_.range(1,101),function(a){var b=new Uint8Array(g);return b[0]=2,b[g-1]=a/100*255|0,f(b,0,g-1),b}),this.colorRgbArray=_.map(_.range(0,a.getNumColors()),function(b){var c=a.getColor(b);return a.hexStringToRgbInt(c)}),this.generateContinuousRgbArray=function(b,c){var d=a.rgbToHsl(c[0],c[1],c[2]);return _.map(_.range(0,b),function(b){var c=a.hslToRgb(d[0],d[1],b/a.getNumColors());return c[2]<<16|c[1]<<8|c[0]})},this.generateContinuousOpacityArray=function(a,b,c){var d=[];if(0===a)return d;for(var e=(b<c?c-b:b-c)/(a-1),f=b,g=0;g<a-1;g++,f+=e)d.push(0|f);return d.push(c),d},this.connectPoints=b,this.fillCircle=d,this.fillCircleForce=e;var h,i,j,k,l,m,n,o,p,q,r,s,t=4278190080,u=16777215}]),angular.module("stealth.timelapse.geo.ol3.layers",["stealth.core.utils","stealth.timelapse.stores"]).constant("PixelCacheColors",{maxColors:null,numColors:null}).factory("PixelCache",["colors","getIdHashFunc","DrawingHelpers","PixelCacheColors","stealth.timelapse.geo.ol3.layers.ColorModes",function(a,b,c,d,e){function f(a){this.store=a,this.len=o*p,this.byteLength=4*this.len,this.buffer=new Uint16Array(this.len),this.connectLookup={},this.predicates=a.predicates(),this.recomputeBinMap(a.getFadeRate()),this.startTime=void 0,this.endTime=void 0,this.windowSize=void 0,this.q=void 0,this.qInv=void 0,this.lowestBinStored=void 0}function g(a,b){return a*b%j|0}function h(a,b){return(Math.floor(a*b)+1)%j}var i=7,j=1<<i,k=j-1,l=7,m=1<<l,n=a.getNumColors();n>m&&(n=m),d.numColors=n,d.maxColors=m;var o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V={north:void 0,south:void 0,east:void 0,west:void 0},W={east:void 0,west:void 0,eastLine:void 0,westLine:void 0};return f.prototype.recomputeBinMap=function(a){E=a>=0?1+a:1/(1-a),this.binMap=_.map(_.range(0,j),function(a){return Math.pow(a/(j-1),E)*(j-1)|0}),this.store.computedFadeRate=a},f.prototype.paintAllLatLons=function(a,b,c,d,e){this._fillCache(b,c,d),this._drawCacheToImage(a,e)},f.prototype._drawCacheToImage=function(d,f){L=Math.round(64*this.store.getOpacity()/100),B=this.store.getViewState().colorMode,A=this.store.getViewState().connectById,w=a.hexStringToRgbInt(this.store.getFillColorHexString());var g,h=b(this.store.getViewState(),this.store.getFilters().id);B===e.OPACITY_RAMP&&(g=c.generateContinuousOpacityArray(m,1,64));var i=this.store.getFadeRate();i!==this.store.computedFadeRate&&this.recomputeBinMap(i),x=this.store.getViewState().relativeSizing?Math.max(0,Math.min(100,this.store.getPointRadius()+(Math.round(q)-2)-16)):this.store.getPointRadius()-1,y=c.radiusRamps[x],z=c.r2Plus1Ramps[x];var l;for(u=0,v=this.buffer.length;u<v;u++)l=this.buffer[u],1&l&&(T=l>>1&1,!A&&T||(C=l>>>9,K=l>>2&k,K-=this.lowestBinStored,K=K>=0?K:K+j,K=this.binMap[K],H=B===e.COLOR_BY_ID?c.colorRgbArray[h(C%n*this.store.getColorByMultiplier())]:B===e.OPACITY_RAMP?w:w,B===e.OPACITY_RAMP?(N=g[C],H|=64===L&&64===N?4278190080:L*N>>4<<24):(M=f?j-1:K,H|=64===L?M<<25:M*L>>5<<24),H|=16777216,T?d[u]=H:(D=f?c.nDiv-1:K>>4,c.fillCircle(d,this.byteLength,o,u,y[D],z[D],H))))},f.prototype._fillCacheZero=function(a){R=j-1;var c=b(this.store.getViewState(),this.store.getFilters().id);this._clearCache(),this.store.each(function(a,b,d,e,f){a>V.south&&a<=V.north&&b>=V.west&&b<V.east&&(E=(b-V.west)*r|0,F=(V.north-a)*s|0,G=F*o+E|0,this.buffer[G]=c(f)<<9|R<<2|1),W.west&&b>=W.eastLine&&(b-=360,E=(b-V.west)*r|0,F=(V.north-a)*s|0,G=F*o+E|0,this.buffer[G]=c(f)<<9|R<<2|1),W.east&&b<W.westLine&&(b+=360,E=(b-V.west)*r|0,F=(V.north-a)*s|0,G=F*o+E|0,this.buffer[G]=c(f)<<9|R<<2|1)}.bind(this),a,a),this.startTime=a,this.endTime=a,this.lowestBinStored=0},f.prototype._fillCache=function(a,d,e){if(0===e||a===d)return this._fillCacheZero(a);A=this.store.getViewState().connectById,S=h(a,this.qInv);var f=b(this.store.getViewState(),this.store.getFilters().id);P=e===this.windowSize&&this.startTime<=a&&a<this.endTime&&d>=this.endTime&&this.store.predicates()===this.predicates,A&&_.isUndefined(this.connectLookup)?(this.connectLookup={},P=!1):A||_.isUndefined(this.connectLookup)||(this.connectLookup=void 0),P?(this._clearCache(this.lowestBinStored,S),A&&this._clearConnections(this.lowestBinStored,S),Q=this.endTime):(e!==this.windowSize&&(this.windowSize=e,this.q=e/j,this.qInv=j/e,S=h(a,this.qInv)),this._clearCache(),A&&this._clearConnections(),Q=(Math.floor(a*this.qInv)+1)*this.q),this.store.each(function(a,b,d,e,h){U=!1,a>V.south&&a<=V.north&&b>=V.west&&b<V.east?U=!0:W.west&&b>=W.eastLine?(U=!0,b-=360):W.east&&b<W.westLine&&(U=!0,b+=360),U&&(E=(b-V.west)*r|0,F=(V.north-a)*s|0,G=F*o+E|0,this.buffer[G]=f(h)<<9|g(d,this.qInv)<<2|1,A&&null!==e&&(_.isUndefined(this.connectLookup[e])||c.connectPoints(this.buffer,[E,F],this.connectLookup[e],this.connectLookup[e][2],o,t),this.connectLookup[e]=[E,F,2|this.buffer[G]]))}.bind(this),Q,d),this.startTime=a,this.endTime=d,this.lowestBinStored=S},f.prototype._clearCache=function(a,b){if(_.isUndefined(a)||_.isUndefined(b))for(u=0,v=this.buffer.length;u<v;u+=1)1&this.buffer[u]&&(this.buffer[u]&=4294967294);else if(a<b)for(u=0,v=this.buffer.length;u<v;u++)1&this.buffer[u]&&(K=this.buffer[u]>>2&k,a<=K&&K<b&&(this.buffer[u]&=4294967294));else if(a>b)for(u=0,v=this.buffer.length;u<v;u++)1&this.buffer[u]&&(K=this.buffer[u]>>2&k,(a<=K||K<b)&&(this.buffer[u]&=4294967294))},f.prototype._clearConnections=function(a,b){if(_.isUndefined(a)||_.isUndefined(b))this.connectLookup={};else if(a<b)for(O in this.connectLookup)this.connectLookup.hasOwnProperty(O)&&(K=this.connectLookup[O][2]>>2&k,a<=K&&K<b&&delete this.connectLookup[O]);else if(a>b)for(O in this.connectLookup)this.connectLookup.hasOwnProperty(O)&&(K=this.connectLookup[O][2]>>2&k,(a<=K||K<b)&&delete this.connectLookup[O])},f.prototype.paintAllLatLonsStandard=function(d,f,i,k,l){var p={};L=Math.round(64*this.store.getOpacity()/100),w=a.hexStringToRgbInt(this.store.getFillColorHexString()),I=h(f,this.qInv),J=Math.ceil(f*this.qInv)*this.q;var u=b(this.store.getViewState(),this.store.getFilters().id),v=this.store.getFadeRate();v!==this.store.computedFadeRate&&this.recomputeBinMap(v),x=this.store.getViewState().relativeSizing?Math.max(0,Math.min(100,this.store.getPointRadius()+(Math.round(q)-2)-16)):this.store.getPointRadius()-1,y=c.radiusRamps[x],z=c.r2Plus1Ramps[x],A=this.store.getViewState().connectById,B=this.store.getViewState().colorMode;var C;B===e.OPACITY_RAMP&&(C=c.generateContinuousOpacityArray(m,1,64)),this.store.each(function(a,b,h,m,q){B===e.COLOR_BY_ID&&(w=c.colorRgbArray[u(q%n*this.store.getColorByMultiplier())]),U=!1,0===k||f===i?(K=j-1,D=c.nDiv-1):(h>J?(K=g(h,this.qInv),K-=I,K=K>=0?K:K+j,K=this.binMap[K]):K=0,D=K>>4),l&&(D=c.nDiv-1),a>V.south&&a<=V.north&&b>=V.west&&b<V.east?U=!0:W.west&&b>=W.eastLine?(U=!0,b-=360):W.east&&b<W.westLine&&(U=!0,b+=360),U&&(E=(b-V.west)*r|0,F=(V.north-a)*s|0,G=F*o+E|0,H=w,B===e.OPACITY_RAMP?(N=C[u(q)],H|=64===L&&64===N?4278190080:L*N>>4<<24):(M=l?j-1:K,H|=64===L?M<<25:M*L>>5<<24),H|=16777216,c.fillCircle(d,this.byteLength,o,G,y[D],z[D],H),A&&null!==m&&(_.isUndefined(p[m])||c.connectPoints(d,[E,F],p[m],p[m][2],o,t),p[m]=[E,F,H]))}.bind(this),f,i)},f.viewChanged=function(a,b,c,d){o=a,p=b,V.west=c[0],V.south=c[1],V.east=c[2],V.north=c[3],W.east=V.east>180,W.west=V.west<-180,W.eastLine=V.west+360,W.westLine=V.east-360,q=d,s=p/(V.north-V.south),r=o/(V.east-V.west),t=180*r},f}]),angular.module("stealth.timelapse.geo.ol3.layers",["ccri.time-controls","stealth.core.geo.ol3.layers","stealth.core.geo.ol3.overlays"]).factory("stealth.timelapse.geo.ol3.layers.TimeLapseLayer",["$log","$rootScope","ccri.time-controls.manager","CONFIG","PixelCache","stealth.core.geo.ol3.layers.MapLayer","stealth.core.geo.ol3.map.Events","stealth.core.geo.ol3.overlays.Vector",function(a,b,c,d,e,f,g,h){function i(a,b){return a[0]<b[0]||a[0]>b[0]||a[1]<b[1]||a[1]>b[1]}function j(a,b){return i(a,b)}function k(a,b){return i(a,b)}var l="stealth.timelapse.geo.ol3.layers.TimeLapseLayer: ",m=1;a.debug(l+"factory started");var n=function(i){function n(){clearTimeout(r),o(),r=setTimeout(function(){q(A.data),p(),S.changed()},200)}function o(){_.eachRight(J,function(a){var b=a.getViewState();!b.isError&&b.toggledOn&&b.opacity>0&&M[a.getUid()].paintAllLatLons(B,G,H,I,P)})}function p(){_.eachRight(J,function(a){var b=a.getViewState();!b.isError&&b.toggledOn&&b.opacity>0&&M[a.getUid()].paintAllLatLonsStandard(B,G,H,I,P)})}function q(a){for(var b=3,c=a.length;b<c;b+=4)a[b]=0}var r,s=0,t=0,u={north:null,south:null,east:null,west:null},v="Timelapse"+m++,w=0,x=0,y=document.createElement("canvas"),z=y.getContext("2d"),A=null,B=null,C=[0,0],D=[0,0,0,0],E=0,F=0,G=0,H=0,I=0,J=[],K=!1,L=function(){},M={},N=AppState.StateManager.getInstance(),O=N.getState(ccriTimeControls.TIME_CONTROLS_PATH),P=O.showAll,Q=N.getObservable(ccriTimeControls.TIME_CONTROLS_PATH).subscribe({next:function(a){O.showAll!==a.showAll&&(P=a.showAll,W.redrawCurrent()),O=a}}),R=function(a,b,c,d,f){d=d.map(Math.round);var g=0|_.reduce(J,function(a,b){var c=b.getPointRadius();return c>a?c:a},0),h=a.slice();if(h[0]-=g*b,h[2]+=g*b,j(C,d)||k(D,h)||E!==b||g!==w){w=g;var i=f.getExtent(),l=Math.max(i[2]-i[0],i[3]-i[1]);if(C=d,D=h.slice(),s=0|C[0],x=s+2*w,t=0|C[1],y.setAttribute("width",s),y.setAttribute("height",t),u.west=h[0],u.south=h[1],u.east=h[2],u.north=h[3],E=b,F=Math.log(l/(256*b))/Math.LN2,u.east-u.west<360)A=z.createImageData(x,t),e.viewChanged(x,t,h,F);else{var m=Math.round(360*x/(u.east-u.west));A=z.createImageData(m,t),e.viewChanged(m,t,[u.west,u.south,u.west+360,u.north],F)}B=new Uint32Array(A.data.buffer),_.eachRight(J,function(a){var b=a.getRangePlotter();M[a.getUid()]=new e(a),K&&!_.isUndefined(b)&&b.updateBounds(u)}),n()}return A&&(z.putImageData(A,-w,0,0,0,x,t),A.width<x&&z.putImageData(A,A.width-w,0,0,0,x,t),L(),L=function(){}),y};this.olSourceParameters={ratio:1,canvasFunction:R,projection:d.map.projection};var S=new ol.source.ImageCanvas(this.olSourceParameters);this.olLayerParameters={source:S};var T=new ol.layer.Image(this.olLayerParameters),U=[new ol.style.Style({stroke:new ol.style.Stroke({color:"rgb(255,255,255)",width:4})}),new ol.style.Style({stroke:new ol.style.Stroke({color:"rgb(255,82,64)",width:2})})],V=new h({styleBuilder:function(){return U}});V.addToMap(),a.debug(l+"new TimeLapseLayer("+i+")"),f.apply(this,[v,i,T,!0,7]);var W=this,X={getBaseCapabilities:this.getBaseCapabilities,onDestroy:this.onDestroy};this.onDestroy=function(){X.onDestroy(),X=null,Q&&(Q.unsubscribe(),Q=null),clearTimeout(r),y=z=null,T=S=null,V.removeFromMap(),V=U=null},this.getBaseCapabilities=function(){return _.merge(_.cloneDeep(X.getBaseCapabilities()),{legend:{section:!0,legendKey:"stealth:Timelapse:"+W.id,title:i,pairs:[]}})},this.getStores=function(){return J},this.getName=function(){return i},this.setUpdateHistograms=function(a){a!==K&&_.isBoolean(a)&&(a&&_.eachRight(J,function(a){var b=a.getRangePlotter();_.isUndefined(b)||b.updateBounds(u)}),K=a)},this.storeFinished=function(a){M[a.getUid()]=new e(a),_.isUndefined(a.getRangePlotter())||a.getRangePlotter().updateBounds(u),this.updateTimeBounds(a)},this.updateTimeBounds=function(a){var b=a.getViewState();if(b.isDestroyed())c.removeDataRange(a.getDataRangeId()),a.setDataRangeId(void 0);else if(b.toggledOn&&b.isDataReady()&&_.isUndefined(a.getDataRangeId())){var d=Math.floor(a.getMinTimeInMillis()/1e3),e=Math.ceil(a.getMaxTimeInMillis()/1e3),f=c.addDataRangeSeconds(a.getUid(),d,e);a.setDataRangeId(f)}else b.toggledOn||_.isUndefined(a.getDataRangeId())||(c.removeDataRange(a.getDataRangeId()),a.setDataRangeId(void 0));this.redrawCurrent()},this.addStore=function(a,c){b.$emit(g.addLayer,W,a),a.setLayerBelongsTo(W),_.isNumber(c)||(c=0),J.splice(c,0,a),M[a.getUid()]=new e(a),W.ol3Layer.getVisible()||W.styleDirectiveScope.toggleVisibility()},this.removeStore=function(a){b.$emit(g.removeLayer,W,a),_.pull(J,a),a.removePanel&&a.removePanel(),_.isUndefined(a.getDataRangeId())||c.removeDataRange(a.getDataRangeId()),_.isUndefined(M[a.getUid()])||delete M[a.getUid()],this.redrawCurrent()},this.redrawCurrent=function(){b.$emit("stealth.timelapse.redrawCurrent",G,H),this.redraw(G,H,I),K&&_.forEach(J,function(a){_.isUndefined(a.getRangePlotter())||(a.getRangePlotter().updateBounds(),a.getRangePlotter().replot())})},this.redraw=function(a,b,c,d){H=b,I=c,G=a,H<O.displayEnd_s?G=H-I:H=G+I,null!==A&&(q(A.data),d&&(L=d),n(),S.changed())},this.getRenderedTime=function(){return{start:G,end:H,window:I}},this.searchPoint=function(a,b){var c=_.filter(J,function(a){var b=a.getViewState();return b.toggledOn&&!b.isError&&b.isDataReady()});return a[0]>180?a[0]=(a[0]+180)%360-180:a[0]<-180&&(a[0]=(a[0]-180)%-360+180),_.map(c,function(c,d){return c.searchPointAndTime(a,b,1e3*G,1e3*H).then(function(a){return a.levelSuffix="_"+_.padLeft(d,4,"0"),a})})},this.getImageByteLength=function(){return A.data.length},this.getHighlightLayer=function(){return V},this.styleDirective="st-time-lapse-layer-style",this.styleDirectiveScope.styleVars.iconClass="fa fa-fw fa-lg fa-history",this.styleDirectiveScope.layer=W,this.styleDirectiveScopeAttrs+=" layer='layer'",this.styleDirectiveScope.stores=J,this.styleDirectiveScopeAttrs+=" stores='stores'",this.styleDirectiveScope.sortableOptions={stop:function(){W.redrawCurrent()}},this.styleDirectiveScope.sizeChanged=function(a,b){angular.isNumber(b)||(b=1,a.getViewState().size=b),a.setPointRadius(b)}};return n.prototype=Object.create(f.prototype),n}]),angular.module("stealth.timelapse.geo.ol3.layers",["stealth.core.popup"]).directive("stEventsTab",["TabPopupHelper",function(a){return{templateUrl:"timelapse/geo/ol3/layers/eventsTab.tpl.html",scope:{record:"=",response:"=",properties:"="},controller:["$scope",function(b){var c=function(a){var c=a.headers("content-type");c.indexOf("xml")>-1||a.data.totalFeatures<1||(b.record.events=_.map(a.data.features,function(a){var b=a.properties;return b.coordinates=a.geometry.coordinates,b}))},d=new a(b,c);b.$on("$destroy",function(){d.destroy(),d=null})}]}}]),angular.module("stealth.timelapse.geo.ol3.layers",[]).service("getIdHashFunc",["PixelCacheColors","stealth.timelapse.geo.ol3.layers.ColorModes",function(a,b){return function(c,d){var e=a.numColors,f=a.maxColors;if(c.colorMode===b.OPACITY_RAMP){var g=d[1]-d[0],h=f/g;return function(a){return(a-d[0])*h|0}}return function(a){return a%e}}}]),angular.module("stealth.timelapse.geo.ol3.layers",["ui.slider","stealth.core.geo.ol3.map","stealth.core.geo.ol3.overlays"]).factory("stealth.timelapse.geo.ol3.layers.LiveWmsLayer",["$rootScope","stealth.core.geo.ol3.layers.PollingImageWmsLayer","stealth.core.geo.ol3.overlays.Vector","stealth.timelapse.geo.ol3.layers.liveStyleEnvHolder","ol3Map",function(a,b,c,d,e){var f=function(f,g,h,i,j){function k(){r.setVisible(t.getVisible())}var l=_.merge({},d.env),m=function(a){return _.isEmpty(a)?null:_.map(a,function(a,b){return b+":"+a}).join(";")},n=_.get(i.KeywordConfig,"timelapse.live"),o=function(){var a=_.keys(n);if(!_.isEmpty(a)){var b=_.first(a);return _.get(n,[b,"list","iconClass"],"fa-bolt")}return"fa-bolt"};b.call(this,{id:f,name:g,requestParams:_.merge({},{ENV:m(l)},h),queryable:j,zIndexHint:5,layerThisBelongsTo:i,type:"LiveLayer"});var p,q,r=new c,s=this,t=this.getOl3Layer(),u={onDestroy:this.onDestroy,refresh:this.refresh};if(r.addToMap(),this.styleDirectiveScope.styleVars.iconClass="fa fa-fw fa-lg "+o(),this.styleDirective="stealth.timelapse.geo.ol3.layers.live-style",this.styleDirectiveScope.viewState={},this.styleDirectiveScope.getStyleEnv=function(){return _.merge({},d.env,s.styleDirectiveScope.viewState.thresholdFilter?{thresholdFilterMin:s.styleDirectiveScope.viewState.thresholdFilter.filter[0],thresholdFilterMax:s.styleDirectiveScope.viewState.thresholdFilter.filter[1]}:{})},this.styleDirectiveScope.refreshStyleEnv=function(){l=s.styleDirectiveScope.getStyleEnv(),u.refresh({ENV:m(l)})},a.$on("stealth.timelapse.geo.ol3.layers.LiveWmsLayer.refresh",function(a){a.stopPropagation(),s.styleDirectiveScope.refreshStyleEnv()}),_.has(i.KeywordConfig.timelapse.live,i.stealthWorkspace+".thresholdFilter")){var v=_.cloneDeep(_.get(i.KeywordConfig.timelapse.live,i.stealthWorkspace+".thresholdFilter"));v.min=parseFloat(v.min),v.max=parseFloat(v.max),_.isFinite(v.min)&&_.isFinite(v.max)&&(v.step=parseFloat(v.step),this.styleDirectiveScope.viewState.thresholdFilter={field:v.field,min:v.min,max:v.max,step:_.isFinite(v.step)&&v.step>0?v.step:1,filter:[]},v.defaultMin=parseFloat(v.defaultMin),this.styleDirectiveScope.viewState.thresholdFilter.filter[0]=_.isFinite(v.defaultMin)&&v.defaultMin>v.min?v.defaultMin:v.min,v.defaultMax=parseFloat(v.defaultMax),this.styleDirectiveScope.viewState.thresholdFilter.filter[1]=_.isFinite(v.defaultMax)&&v.defaultMax<v.max?v.defaultMax:v.max,this.styleDirectiveScope.refreshStyleEnv())}t.on("change:visible",k),this.getHighlightLayer=function(){return r},this.activate=function(){s.startPolling();var a=s.getSelectLayer();a&&(a.activate(),a.getMapLayer().setMap(e.getMap()))},this.inactivate=function(){s.cancelPolling();var a=s.getSelectLayer();a&&(a.inactivate(),a.getMapLayer().setMap(null))},this.onDestroy=function(){s.cancelPolling(),u.onDestroy(),u=null,g=h=i=j=null,r.removeFromMap(),r=null,s=null,t.un("change:visible",k),t=null},this.getSelectLayer=function(){return p},this.setSelectLayer=function(a){p=a},this.getSelectSourceLayer=function(){return q},this.setSelectSourceLayer=function(a){q=a}};return f.prototype=Object.create(b.prototype),f}]).directive("stealth.timelapse.geo.ol3.layers.liveStyle",[function(){return{templateUrl:"timelapse/geo/ol3/layers/livestyle.tpl.html"}}]).service("stealth.timelapse.geo.ol3.layers.liveStyleEnvHolder",[function(){this.env={}}]),angular.module("stealth.timelapse.geo.ol3.layers",["ui.slider"]).directive("stTimeLapseLayerStyle",["$log",function(a){return a.debug("stealth.timelapse.geo.ol3.layers.stTimeLapseLayerStyle: directive defined"),{templateUrl:"timelapse/geo/ol3/layers/stTimeLapseLayerStyle.tpl.html"}}]),angular.module("stealth.timelapse.geo.ol3.layers",["ccri.angular-utils","stealth.core.geo.ol3.format","stealth.core.geo.ol3.layers","stealth.core.geo.ol3.style","stealth.core.geo.ows","stealth.core.utils"]).factory("stealth.timelapse.geo.ol3.layers.SummaryLayer",["$q","cqlHelper","ol3Styles","wfs","stealth.core.geo.ol3.format.GeoJson","stealth.core.geo.ol3.layers.UpdatableFeatureLayer","stealth.core.geo.ol3.layers.PollingGeoJsonVectorLayer",function(a,b,c,d,e,f,g){var h=function(h,i){var j=this,k=new e,l=_.get(h.layerThisBelongsTo.KeywordConfig,"capability.poll.ageLimitSeconds",1200),m=_.has(h.layerThisBelongsTo.KeywordConfig,"capability.poll.ageLimitField"),n=_.get(h.layerThisBelongsTo.KeywordConfig,"capability.poll.ageLimitField"),o=_.get(h.layerThisBelongsTo.KeywordConfig,"timelapse.summary."+h.layerThisBelongsTo.stealthWorkspace+".eventsLayerName"),p=_.find(_.keys(_.get(h.layerThisBelongsTo.KeywordConfig,"click.search.customPopup.tab")),function(a){return"events"===a.toLowerCase()}),q=DataSourceManager.getDataSourceByLayerName(o),r=function(a){var b=[];switch(a.getGeometry().getType()){case"LineString":b.push(c.getLineStyle(j.getViewState().size,j.getViewState().fillColor));break;case"Point":if(j.getViewState().showEvents&&b.push(c.getPointStyle(j.getViewState().size,j.getViewState().fillColor)),j.getViewState().showLabels){var d=a.getProperties().index;if(d>4)return[];b.push(c.styleFromConfig({text:{fill:{color:"#e4e4e4"},stroke:{color:"#000000",width:5},font:"bold 11px sans-serif",textBaseline:"top",textAlign:"left",offsetY:j.getViewState().size+5+12*d,text:4===d?"...":a.getProperties().eventType+moment.utc(a.getProperties().dtg).format(" HH:mm:ss[Z]")}}))}}return b},s={id:ccriUtils.uuid.generate(),name:h.Title,layerThisBelongsTo:h.layerThisBelongsTo,geoserverUrl:h.layerThisBelongsTo.wfsUrl,iconClass:"fa fa-fw fa-lg fa-location-arrow",viewState:{hasEvents:!!o,showEvents:!1,showLabels:!1},styleFn:r},t=_.merge({},s,i);_.has(h.layerThisBelongsTo.KeywordConfig,"capability.poll")?(t.interval=parseInt(_.get(h.layerThisBelongsTo.KeywordConfig,"capability.poll.intervalSeconds","300"),10),g.call(this,t)):f.call(this,t);var u={loadFeatures:this.loadFeatures,searchPoint:this.searchPoint};this.loadFeatures=function(a){var b=_(a).sortByOrder([function(a){return a.getGeometry().getCoordinates().length}],["desc"]).uniq(h.trkIdField).value();if(m&&_.isFunction(j.isPolling)&&j.isPolling()){var c=moment().subtract(l,"seconds"),d=_.every(b,function(a){var b=moment(a.get(n));return b.isBefore(c)});d&&j.cancelPolling()}if(o){var e=_.map(b,function(a){return _.get(a.getProperties(),h.trkIdField)});v(e).then(function(a){var c=_.groupBy(a,function(a){return a.get(h.trkIdField)});_.each(c,function(a){_.each(_.groupBy(a,function(a){return a.get("dtg")}),function(a){_.each(a,function(a,c){a.set("index",c),b.push(a)})})}),u.loadFeatures(b)})}else u.loadFeatures(a)},this.searchPoint=function(a,b){var c=u.searchPoint(a,b);return o?c.then(function(a){return 0===a.records.length?a:(a.records=_.filter(a.records,function(b,c){return"LineString"===a.metadata[c].getGeometry().getType()||(a.defaultActiveTab=p,!1)}),a)}):c},this.styleDirective="stealth.timelapse.geo.ol3.layers.summary-style",this.styleDirectiveScope.updateStyle=function(){j.ol3Layer.changed()};var v=function(c){if(!c||!c.length)return a.when([]);var e={CQL_FILTER:b.combine(b.operator.OR,_.map(c,function(a){return h.trkIdField+"='"+a+"'"}))};return a.when(d.getFeature(q.wfsUrl,q.name,e,void 0,!0).then(function(a){var b=a.headers("content-type");return b.indexOf("xml")>-1||a.data.totalFeatures<1?[]:k.readFeatures(a.data)}))}};return h.prototype=Object.create(f.prototype),h}]).directive("stealth.timelapse.geo.ol3.layers.summaryStyle",[function(){return{templateUrl:"timelapse/geo/ol3/layers/summaryStyle.tpl.html"}}]),angular.module("stealth.timelapse.geo.ol3.layers",["stealth.core.popup"]).directive("stSummaryTab",["TabPopupHelper",function(a){return{templateUrl:"timelapse/geo/ol3/layers/summaryTab.tpl.html",scope:{record:"=",response:"=",properties:"="},controller:["$scope",function(b){var c=function(){b.summary.iffMode3=_.words(b.summary.iffMode3,/[^, \[\]]+/g),b.summary.iffMode3StartDate=_.words(b.summary.iffMode3StartDate,/[^,\[\]]+/g),b.summary.iffMode3EndDate=_.words(b.summary.iffMode3EndDate,/[^,\[\]]+/g)},d=function(a){var d=a.headers("content-type");if(!(d.indexOf("xml")>-1||a.data.totalFeatures<1)){var e=_(a.data.features).sortByOrder([function(a){return a.geometry.coordinates.length}],["desc"]).uniq(b.properties.trkIdField).value();b.summary=e[0].properties,c()}};if(_.has(b.properties,"layerName")&&_.has(b.properties,"trkIdField")){var e=new a(b,d);b.$on("$destroy",function(){e.destroy(),e=null})}else b.summary=_.clone(b.record),c()}]}}]),angular.module("stealth.timelapse.geo.ol3.layers",["ccri.time-controls"]).config(["ccri.time-controls.managerProvider",function(a){var b=window.STEALTH.config;_.has(b,"timelapse.defaultSpeed")&&_.isNumber(b.timelapse.defaultSpeed)&&a.setSpeed(b.timelapse.defaultSpeed),_.has(b,"timelapse.defaultStep_s")&&_.isNumber(b.timelapse.defaultStep_s)&&a.setStep_s(b.timelapse.defaultStep_s)}]),angular.module("stealth.timelapse.geo.ol3.layers").service("stealth.timelapse.geo.ol3.layers.visibleLayersCache",[function(){function a(a,b){e[a].push(b)}function b(a){e[a]=e[a]||[]}function c(a){e[a].length=0}function d(a){return e[a]}var e={};this.addTo=a,this.define=b,this.empty=c,this.getAllFrom=d}]),angular.module("stealth.timelapse.stores",["stealth.core.utils"]).factory("stealth.timelapse.stores.ArrowStore",["$filter","$log","$rootScope","$timeout","arrowGroupBy","colors","clickSearchHelper","getIdHashFunc","stealth.core.geo.ol3.map.Events","stealth.timelapse.geo.ol3.layers.ColorModes","CONFIG",function(a,b,c,d,e,f,g,h,i,j,k){var l=0,m=function(m,n,o,p,q,r){function s(a){var b=ja.ds.vectors[ga],c=b.decode(a[0]),d=b.decode(a[1]);return _.isNumber(c)&&_.isNumber(d)?[c,d]:a}function t(a){return arrow_geo.col(a).gteq(arrow_geo.lit(ca.id[0]))}function u(a){return arrow_geo.col(a).lteq(arrow_geo.lit(ca.id[1]))}function v(a){return t(a).and(u(a))}var w,x,y,z=this,A=function(a){y=a,x=f.hexStringToRgbArray(a),_.isUndefined(w)||w.redrawCurrent()};A(n||f.getColor());var B,C=function(a){a>100&&(a=100),B=a,_.isUndefined(w)||w.redrawCurrent()};C(_.find([o,k.timelapse.defaultPointSize,15],function(a){return!(a<1||a!==~~a)}));var D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T=1,U=function(a){T=a||3*T,T=T>81||T<1?1:T,_.isUndefined(w)||w.redrawCurrent()},V=m||"unknown",W="arrow_"+l++,X=p,Y=100,Z=0,$={},aa=!1,ba={toggledOn:!1,isDataPending:function(){return _.isUndefined(D)},isDataReady:function(){return!_.isUndefined(D)},isDestroyed:function(){return aa},isError:!1,errorMsg:"",size:B,fillColor:y,opacity:Y,fadeRate:Z,colorMode:j.ONE_COLOR,connectById:!1,relativeSizing:!0},ca={id:[void 0,void 0]};this.type="arrow",this.destroy=function(){aa=!0,D=void 0,F=void 0,G=void 0,H=void 0,I=void 0,J=void 0,K=void 0,L=void 0,M=void 0,N=void 0,P=void 0,Q=void 0,R=void 0,$=void 0,ca=void 0,ba=void 0,z=void 0},this.getName=function(){return V},this.setName=function(a){V=a,S&&S.updateTitle(a),c.$emit(i.updateLayer,w,this)},this.name=function(a){return arguments.length?this.setName(a):V},this.getUid=function(){return W},this.getFillColorRgbArray=function(){return x},this.getFillColorHexString=function(){return y},this.setFillColorHexString=A,this.getPointRadius=function(){return B},this.setPointRadius=C,this.getColorMode=function(){return X},this.setColorMode=function(a){X=a},this.getOpacity=function(){return Y},this.setOpacity=function(a){Y=0|a,_.isUndefined(w)||w.redrawCurrent()},this.getFadeRate=function(){return Z},this.setFadeRate=function(a){Z=a,_.isUndefined(w)||w.redrawCurrent()},this.getColorByMultiplier=function(){return T},this.setColorByMultiplier=U,this.getViewState=function(){return ba},this.getDataRangeId=function(){return E},this.setDataRangeId=function(a){E=a},this.getId=function(a){return F[a]},this.getTimeInSeconds=function(a){return G[a]},this.getLat=function(a){return H[a]},this.getLon=function(a){return I[a]},this.getIdView=function(){return F},this.getSecondsView=function(){return G},this.getLatView=function(){return H},this.getLonView=function(){return I},this.getFormat=function(){return O},this.getArrayBuffer=function(){return D},this.getStride=function(){return J},this.getMinTimeInMillis=function(){return K},this.getMaxTimeInMillis=function(){return L},this.getNumRecords=function(){return M},this.getNumRecordsString=function(){return N},this.getIdRange=function(a){if(a){var b=s([Q,R]);return{min:b[0],max:b[1]}}return{min:Q,max:R}},this.getGeomField=function(){return la},this.getFilters=function(a){return a?{id:s(ca.id)}:ca},this.updateFilters=function(){Q=$[this.colorByField][0],R=$[this.colorByField][1],d(function(){ca.id=[Q,R],z.updateIdPredicate()},0)},this.boundStartMillis=function(a){return Math.max(K,a)-1e3},this.boundEndMillis=function(a){return Math.min(L,a)+1e3},this.getRangePlotter=function(){return P},this.setLayerBelongsTo=function(a){w=a},this.getRenderedTime=function(){return w.getRenderedTime()},this.toggleVisibility=function(){ba.toggledOn=!ba.toggledOn,w.updateTimeBounds(this)},this.toggleColorMode=function(){ba.colorMode===j.OPACITY_RAMP&&this.updateFilters(),ba.colorMode=(ba.colorMode+1)%3,w.redrawCurrent(),c.$emit(i.updateLayer,w,this)},this.getColorModeStyle=function(){var a=[y,"linear-gradient(to right, red, orange 16%, yellow 32%, green 48%, blue 60%, indigo 76%, violet)","linear-gradient(to left, "+y+", rgba(0,0,0,0))"];return a[ba.colorMode]},this.toggleConnectById=function(){ba.connectById=!ba.connectById,w.redrawCurrent()},this.getIdFieldName=function(){return _.isFunction(this.getQuery)?this.getQuery().params.idField.name:"id"};var da=0,ea=da,fa=0,ga=fa;this.colorByField=null;var ha=null;this.colorByFields=function(){return ha},this.getColorByField=function(){return this.colorByField},this.onColorByFieldChanged=function(){ga=ja.vectorNames.indexOf(this.colorByField),ga===-1&&(ga=fa),this.updateFilters(),w&&w.redrawCurrent()};var ia;this.updateIdPredicate=function(){var a;ca.id[1]!==R&&ca.id[0]!==Q?a=v(this.colorByField):ca.id[1]!==R?a=u(this.colorByField):ca.id[0]!==Q&&(a=t(this.colorByField)),ia!==a&&(this.removePredicate(ia),ia=a,ia&&this.addPredicate(ia))};var ja,ka,la;this.dataset=function(){return ja},this.predicates=function(a,b){var c=ma.filter(function(b){return b!==a});if(b&&(ja.bind(b),c.push(b)),c.length)return c.reduce(function(a,b){return a.and(b)})},this.setArrayBuffer=function(c,d){D=c;var e=null;try{ja=new arrow_geo.ArrowDataSet(new Uint8Array(c)),0===ja.stats.length&&(e="No results")}catch(a){e="Unknown error"}return e?(ba.isError=!0,ba.errorMsg=e,Promise.reject(e)):(ba.toggledOn=!0,M=_.reduce(ja.reader.batches,function(a,b){return a+b.length},0),N=a("number")(M,0),ka=ja.vectorNames[ja.vectorNames.length-2],la=ja.vectorNames[ja.vectorNames.length-1],this.colorByField=_.keys(ja.dicts)[fa],ha=_.keys(ja.dicts),K=1e3*ja.stats[0].min,L=1e3*ja.stats[ja.stats.length-1].max,_.forEach(ja.dicts,function(a,b){$[b]=[0,_.size(a)-1]}),this.updateFilters(),ccriCorealerter.alerter.infoMsg(N+" results",this.getName()),b.info(this.getName()+": "+N+" results"),this.addPanel(),Promise.resolve())},this.groupBy=function(a,b,c,d){function f(a,b){if(b[1][a]){var c={name:b[0][a],count:b[1][a]};k.splice(_.sortedIndex(k,c,"count"),0,c)}}var g,h=w.getRenderedTime(),i=h.start,j=h.end,k=[],l=ja.scanAsync(i,j),m=this.predicates(c,d);return m&&(l=l.filter(m)),g=b?e(l,ja.ds.vectors,arrow_geo.col(a),arrow_geo.col(b),f):l.countBy(arrow_geo.col(a),ja.ds.vectors).evaluate(f),Promise.resolve(g).then(function(){return k.reverse(),k})},_.isUndefined(q)||this.setArrayBuffer(q,r),this.searchForListRecords=function(a){var b=[],c={},d=this.getIdFieldName(),e=_.indexOf(ja.vectorNames,la);if(e<0)return Promise.resolve(b);var f=w.getRenderedTime(),g=_.reduce(_.keys(ja.dicts),function(a,b){return a[b]=_.find(ja.ds.vectors,"name",b),a},{});return ja.scanAsync(f.start,f.end).filter(this.predicates()).evaluate(function(f,h){var i=h[e].get(f).reverse();if(!a||ol.extent.containsCoordinate(a,i)){var j=_.reduce(h,function(a,b){return g[b.name]?a[b.name]=g[b.name].get(f):b.name===la?a[b.name]=i:a[b.name]=b.get(f),a},{}),k=c[j[d]];_.isNumber(k)?b[k]=j:(b.push(j),c[j[d]]=b.length-1)}}).then(function(){return b})},this.searchPointAndTimeForRecords=function(a,b,c,d){var e,f=[],h={fixedPixelBuffer:Math.max(B,4)},i=g.getSearchExtent(a,b,h),j=arrow_geo.col(ka),k=arrow_geo.col(la);ja.bind(j),ja.bind(k);var l=_.reduce(_.keys(ja.dicts),function(a,b){return a[b]=_.find(ja.ds.vectors,"name",b),a},{});return ja.scanAsync(Math.floor(c/1e3),Math.ceil(d/1e3)).filter(this.predicates()).evaluate(function(a,b){var c=b[k.colidx].getItem(a,0),d=b[k.colidx].getItem(a,1);if(ol.extent.containsXY(i,d,c)){
var e=1e3*b[j.colidx].get(a),g=new ol.Feature(_.merge({geometry:new ol.geom.Point([d,c]),lat:c,lon:d,dtg:e},_.reduce(b,function(b,c){return c.name!==la&&c.name!==ka&&(l[c.name]?b[c.name]=l[c.name].get(a):b[c.name]=c.get(a)),b},{})));f.push(g)}}).then(function(){return e=g.sortAndTrimFeatures(a,f),_.map(e,function(a){return _.omit(a.getProperties(),"geometry")})})},this.searchPointAndTime=function(a,b,c,d){var e=this,g=h(ba,ca.id);return this.searchPointAndTimeForRecords(a,b,c,d).then(function(a){return{name:V,isError:!1,getLayerLegendStyle:function(){return ba.colorMode!==j.COLOR_BY_ID?{color:y}:{display:"none"}},records:a,getRecordLegendStyle:function(a){return a&&ba.colorMode===j.COLOR_BY_ID?{color:f.getColor(g(e.encodeDictVal(e.colorByField,a[e.colorByField])*T))}:{display:"none"}},fieldTypes:[{name:"lat",localType:"number"},{name:"lon",localType:"number"},{name:"dtg",localType:"date-time"}]}})};var ma=[];this.addPredicate=function(a,b){b&&_.pull(ma,b),a&&(ja.bind(a),ma.push(a)),w.redrawCurrent()},this.removePredicate=function(a){return!!_.contains(ma,a)&&(_.pull(ma,a),w.redrawCurrent(),!0)},this.each=function(a,b,c){var d=arrow_geo.col(ka),e=arrow_geo.col(la);ja.bind(d),ja.bind(e),ja.scan(b,c).filter(this.predicates()).evaluate(function(b,c){a(c[e.colidx].getItem(b,0),c[e.colidx].getItem(b,1),c[d.colidx].get(b),c[ea].get(b),c[ga].get(b),b)})},this.encodeDictVal=function(a,b){return ja.dicts[a][b]},this.decodeDictVal=function(a,b){var c=_.find(ja.ds.vectors,function(a){return a.name===b});if(!c)throw new Error("No arrow dict for property "+b);return c.decode(a)},this.addPanel=function(){var a=this.getIdFieldName();this.getNumRecords()&&_.contains(_.keys(this.dataset().dicts),a)&&(S&&this.removePanel(),S.showButton())},this.removePanel=function(){S&&(S.hideButton(),S=null)},this.updatePanel=function(a){S&&S.updateList(a)}};return m.prototype.getLowerBoundIdx=function(a){var b,c=a/1e3,d=this.getNumRecords(),e=0,f=0,g=0;if(this.getMinTimeInMillis()>=a)return-1;if(this.getMaxTimeInMillis()<a)return d-1;for(;d>1;)e=d>>1,f=g+e,b=this.getTimeInSeconds(f*this.getStride()),b<c?(g=f,d-=e):d=e;return g},m.prototype.getUpperBoundIdx=function(a){var b,c=a/1e3,d=this.getNumRecords(),e=0,f=0,g=this.getNumRecords();if(this.getMinTimeInMillis()>a)return 0;if(this.getMaxTimeInMillis()<=a)return d;for(;d>1;)e=d>>1,f=g-e,b=this.getTimeInSeconds(f*this.getStride()),c<b?(g=f,d-=e):d=e;return g},m}]),angular.module("stealth.timelapse.stores",["stealth.core.geo.ows","stealth.core.popup.capabilities","stealth.core.popup.components","stealth.core.utils"]).factory("stealth.timelapse.stores.ArrowQueryStore",["$http","$log","$rootScope","$q","cqlHelper","clickSearchHelper","CONFIG","ol3Map","wfs","queryBinStoreExtender","stealth.core.geo.ol3.layers.WmsLayer","stealth.core.popup.components.fieldFormat","stealth.timelapse.stores.ArrowStore","tlLayerManager","viewExtentPredicate",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){var p=function(){m.apply(this,arguments);var p,q=this,r=this.getViewState(),s=/LIKE\s*'[^']*%[^']*'/i,t={source:void 0,geometry:void 0,timeBounds:{start:void 0,end:void 0},cqlParams:void 0};this.getQuery=function(){return p},this.buildCql=function(){var a=this.getQuery(),b=a.buildCql(),c=null,d=q.predicates(o.getPredicate(a.params.geomField.name));return d&&(c=e.fromArrowExpr(d,q.decodeDictVal)),e.combine(e.operator.AND,b,c)},this.customizeGetFeatureOverrides=function(a){var b=this.getQuery(),c=b.params.geomField.name,d=b.params.dtgField.name,e=b.params.idField.name,f=b.layerData.currentLayer.fieldNames.label;return _.merge({},a,{propertyName:_.compact([d,c,e,f]).join()})},this.launchQuery=function(a){this.setQuery(a);var e=a.layerData.currentLayer.Name,f=a.layerData.currentLayer.fadeRate,g=_.uniq(_.compact(_.pluck([].concat(a.params.requiredArrowFields||[],a.params.arrowFields||[]),"name"))),h=_.uniq(g.concat([a.params.dtgField.name,a.params.geomField.name]));OwsUtils.ArrowConversion.submit(a.layerData.currentLayer.wpsUrl,{featuresXml:OwsUtils.WpsManager.chainRequest(OwsUtils.QueryFeatures.compile({dataLayer:e,dataLayerFilter:this.buildCql(),properties:h,workspace:a.featureTypeData.targetPrefix,namespace:a.featureTypeData.targetNamespace})),dictionaryFields:g,sortField:a.params.dtgField.name},{onDownloadProgress:function(a){c.$applyAsync(function(){r.isDownloadActive=!0,r.downloadSize=a.loaded})}}).then(function(b){return q.setArrayBuffer(b,a.params.sortOnServer).then(function(){if(c.$emit("timelapse:querySuccessful",q),q.setFadeRate(f),!q.getNumRecords())return d.reject("No results")})}).catch(function(a){var c=q.getName();r.isError=!0,r.errorMsg=a.message,b.error(a.message),ccriCorealerter.alerter.errorMsg(a.message,"Error: "+c)}).then(function(){c.$applyAsync(function(){r.isDownloadActive=!1})})},this.setQuery=function(a){p=a,_.merge(t,{source:a.layerData.currentLayer.Title,geometry:a.params.generatedFeatures,timeBounds:{start:a.params.startDtg,end:a.params.endDtg},cqlParams:a.params.cqlParams?a.params.cqlParams:{additionalCql:a.params.cql}})},this.getQueryDetails=function(){return t},this.getPopupOptions=function(a,b){var c=q.getQuery().layerData.currentLayer,d=c.KeywordConfig,e=_.get(d,"click.search.customPopup");return _.merge({name:q.getName(),isError:!1,getLayerLegendStyle:function(){return{color:q.getFillColorHexString()}},metadata:_.map(a,function(a){return{source:a,dataSource:c}}),capabilities:b,fieldTypes:q.getQuery().featureTypeData.featureTypes[0].properties,isFilterable:!0,filterHandler:q.filterSingle,popupOptionsOverrides:e,dataSource:c},l.formatFromKeywords(_.pluck(a,"properties"),d))},this.getCapabilities=function(a,b){var c=q.getQuery().layerData.currentLayer.KeywordConfig,d=c.capability||{};return j.extendCapabilities(d,this,{startMillis:a,endMillis:b})},this.searchPointAndTimeWithCql=function(a,b,c,e,g){var h=d.defer(),j={cql_filter:a},k=q.getQuery(),l=k.layerData.currentLayer.Name;return i.getFeature(k.layerData.currentLayer.wfsUrl,l,_.merge({},g,j),void 0,!0).then(function(a){var d=f.sortAndTrimFeatures(c,a.data.features,e);h.resolve(q.getPopupOptions(d,b))},function(a){h.reject({name:q.getName(),isError:!0,reason:a.statusText})}),h.promise},this.searchPointAndTime=function(a,b,c,e){var g=d.defer(),h=this.boundStartMillis(c),i=this.boundEndMillis(e),j=q.getQuery().layerData.currentLayer.KeywordConfig,k={fixedPixelBuffer:Math.max(this.getPointRadius(),4)};_.merge(k,f.getLayerOverrides(j));var l=q.getCapabilities(h,i);if(q.getMinTimeInMillis()>e||q.getMaxTimeInMillis()<c)return g.resolve({name:q.getName(),isError:!1,records:[]}),g.promise;var m={capabilities:l,clickOverrides:k,coordinates:a,resolution:b,timerange:{end:{bounded:i,original:e},start:{bounded:h,original:c}}};return this.searchWithoutLabelStrategy(m)},this.searchWithoutLabelStrategy=function(a){var b=a.capabilities,c=a.coordinates,d=a.resolution,g=a.clickOverrides,h=a.timerange.start.bounded,i=a.timerange.end.bounded,j=f.getSearchExtent(c,d,g),k={params:{geomField:q.getQuery().params.geomField,dtgField:q.getQuery().params.dtgField,minLon:j[0],minLat:j[1],maxLon:j[2],maxLat:j[3],startDtg:moment.utc(h),endDtg:moment.utc(i)}};return this.searchPointAndTimeWithCql(e.combine(e.operator.AND,e.buildSpaceTimeFilter(k.params),q.buildCql()),b,c,g,_.get(this.getQuery(),"layerData.currentLayer.KeywordConfig.click.search.z3")?{viewparams:"QUERY_HINT:z3;STRATEGY:z3"}:null)},this.isFilterable=!0;var u=function(a,b){var d={startDtg:moment(q.getQuery().params.startDtg),endDtg:moment(q.getQuery().params.endDtg),storeName:b,currentLayer:q.getQuery().layerData.currentLayer};q.getQuery().params.cql&&""!==_.trim(q.getQuery().params.cql)?d.cql=_.trim(q.getQuery().params.cql)+" AND "+a:d.cql=a,c.$emit("Launch Timelapse Wizard",d)},v=function(a,b){return a+"="+(angular.isString(b)?"'"+b+"'":b)};this.filterSingle=function(a,b){var c=v(a,b),d=q.getQuery().params.storeName+" ("+c+")";u(c,d)},this.filterMultiple=function(a,b){var c=_.map(b,function(b){return v(a,b)}),d=q.getQuery().params.storeName+"(filtered)";u(e.combine(e.operator.OR,c),d)},this.defaultExportFormats={Arrow:"arrow",CSV:"csv",GML2:"GML2","GML3.1":"text/xml; subtype=gml/3.1.1","GML3.2":"application/gml+xml; version=3.2",GeoJSON:"application/json",KML:"application/vnd.google-earth.kml+xml",Shapefile:"SHAPE-ZIP"},this.getExportFormats=function(){return _.chain(q.defaultExportFormats).merge(_.get(q.getQuery().layerData.currentLayer.KeywordConfig,"timelapse.export.include")).omit(_.keys(_.get(q.getQuery().layerData.currentLayer.KeywordConfig,"timelapse.export.exclude"))).value()},this.exportBin=function(b){b=b||"arrow";var c,e,f=this;if("arrow"===b)c=d.when(new Blob([this.getArrayBuffer()],{type:"application/octet-binary"})),e=this.getName().trim().replace(/\W/g,"_")+".arrow";else{var h=q.buildCql(),i=this.getQuery().layerData.currentLayer.wfsUrl,j=s.test(h),k={service:"WFS",version:"1.0.0",request:"GetFeature",typeName:p.layerData.currentLayer.Name,srsName:"EPSG:4326",outputFormat:b,cql_filter:h};j&&(k.viewparams="QUERY_HINT:z3;STRATEGY:z3");var l,m=$.param(k);l=m.length>g.geoserver.maxGET?a.post(i,m,{headers:{"Content-Type":"application/x-www-form-urlencoded"},responseType:"blob"}):a.get(i,{params:k,responseType:"blob"}),c=l.then(function(a){var c={bin:".bin",csv:".csv",GML2:".gml","text/xml; subtype=gml/3.1.1":".gml","application/gml+xml; version=3.2":".gml","application/json":".json","application/vnd.google-earth.kml+xml":".kml","SHAPE-ZIP":".zip"};return e=f.getName().trim().replace(/\W/g,"_")+(c[b]||""),a.data})}return c.then(function(a){saveAs(a,e)}),c};var w,x,y,z=!1,A=function(){return z},B=function(a){z=a};this.labelsAvailable=function(){return y=_.get(this.getQuery(),"layerData.currentLayer.KeywordConfig.timelapse.labelStyle"),y&&n.pausedTimeWindow},this.labelsOn=!1,this.toggleLabels=function(a){var b=_.isBoolean(a)?a:!this.labelsOn;b!==this.labelsOn&&(this.labelsOn=b,this.labelsOn?(x||(w=new ol.source.ImageWMS({ratio:1,url:this.getQuery().layerData.currentLayer.wmsUrl,params:{VERSION:"1.1.1",TRANSPARENT:"TRUE",LAYERS:this.getQuery().layerData.currentLayer.Name,STYLES:y},imageLoadFunction:_.partialRight(k.loadFunction,!0,A,B)}),x=new ol.layer.Image({source:w}),x.setOpacity(this.getOpacity()/100)),w.updateParams({CQL_FILTER:e.combine(e.operator.AND,e.buildDtgFilter(this.getQuery().params.dtgField.name,moment.utc(1e3*n.pausedTimeWindow.start_s),moment.utc(1e3*n.pausedTimeWindow.end_s)),this.buildCql())}),h.addLayerOverlay(x)):h.removeLayerOverlay(x))};var C=this.setOpacity;this.setOpacity=function(a){C(a),x&&x.setOpacity(a/100)};var D=this.destroy;this.destroy=function(){D(),this.toggleLabels(!1),w=void 0,x=void 0,y=void 0}};return p.prototype=Object.create(m.prototype),p}]),angular.module("stealth.timelapse.stores",["stealth.core.utils"]).factory("stealth.timelapse.stores.BinStore",["$log","$rootScope","$filter","colors","clickSearchHelper","getIdHashFunc","stealth.core.geo.ol3.map.Events","stealth.timelapse.geo.ol3.layers.ColorModes","stealth.timelapse.stores.sorter","CONFIG",function(a,b,c,d,e,f,g,h,i,j){function k(b,c){var d=100,e=1,f=20,g=1e-15,h=16,i=function(a){for(var h=0,i=0,j=0;j<d;j++){var k=j*(a/4),l=Math.abs(b[k]),m=Math.abs(c[k]);if((l<g||m<g)&&i++,(l>90||m>180)&&h++,h>=e||i>=f)return!0}return!1};return i(h)&&(h=24,i(h))?(a.error("Unable to determine bin file record size"),null):(a.debug(l+"Format is "+h+" bytes/record"),h)}var l="stealth.timelapse.stores.BinStore: ";a.debug(l+"factory started");var m=0,n=function(l,n,o,p,q,r){function s(a){var b=D[a];return b<=ba.id[1]&&b>=ba.id[0]}function t(a){var b=D[a];return b<=ba.id[1]}function u(a){var b=D[a];return b>=ba.id[0]}var v,w,x,y=function(a){x=a,w=d.hexStringToRgbArray(a),_.isUndefined(v)||v.redrawCurrent()};y(n||d.getColor());var z,A=function(a){a>100&&(a=100),z=a,_.isUndefined(v)||v.redrawCurrent()};A(_.find([o,j.timelapse.defaultPointSize,15],function(a){return!(a<1||a!==~~a)}));var B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T=1,U=function(a){T=a||3*T,T=T>81||T<1?1:T,_.isUndefined(v)||v.redrawCurrent()},V=l||"unknown",W=m++,X=p,Y=100,Z=0,$=!1,aa={toggledOn:!0,isDataPending:function(){return _.isUndefined(B)},isDataReady:function(){return!_.isUndefined(B)},isDestroyed:function(){return $},isDownloadActive:!1,downloadSize:0,isError:!1,errorMsg:"",size:z,fillColor:x,opacity:Y,fadeRate:Z,colorMode:h.ONE_COLOR,connectById:!1,relativeSizing:!0},ba={id:[void 0,void 0]};this.destroy=function(){$=!0,B=void 0,D=void 0,E=void 0,F=void 0,G=void 0,H=void 0,I=void 0,J=void 0,K=void 0,L=void 0,M=void 0,N=void 0,O=void 0,P=void 0,Q=void 0,R=void 0,S=void 0,ba=void 0},this.getName=function(){return V},this.setName=function(a){V=a,b.$emit(g.updateLayer,v,this)},this.name=function(a){return arguments.length?this.setName(a):V},this.getUid=function(){return W},this.getFillColorRgbArray=function(){return w},this.getFillColorHexString=function(){return x},this.setFillColorHexString=y,this.getPointRadius=function(){return z},this.setPointRadius=A,this.getColorMode=function(){return X},this.setColorMode=function(a){X=a},this.getOpacity=function(){return Y},this.setOpacity=function(a){Y=0|a,_.isUndefined(v)||v.redrawCurrent()},this.getFadeRate=function(){return Z},this.setFadeRate=function(a){Z=a,_.isUndefined(v)||v.redrawCurrent()},this.getColorByMultiplier=function(){return T},this.setColorByMultiplier=U,this.getViewState=function(){return aa},this.getDataRangeId=function(){return C},this.setDataRangeId=function(a){C=a},this.getId=function(a){return D[a]},this.getTimeInSeconds=function(a){return E[a]},this.getLat=function(a){return F[a]},this.getLon=function(a){return G[a]},this.getLabel=function(a){return this.hasLabel()?new dcodeIO.Long(H[a],I[a]):null},this.getLabelString=function(a){var b=this.getLabel(a);return b?b.toString():null},this.getIdView=function(){return D},this.getSecondsView=function(){return E},this.getLatView=function(){return F},this.getLonView=function(){return G},this.hasLabel=function(){return 6===this.getStride()},this.getArrayBuffer=function(){return B},this.getStride=function(){return K},this.getMinTimeInMillis=function(){return M},this.getMaxTimeInMillis=function(){return N},this.getNumRecords=function(){return O},this.getNumRecordsString=function(){return P},this.getIdRange=function(){return{min:R,max:S}},this.getFilters=function(){return ba},this.getRangePlotter=function(){return Q},this.setLayerBelongsTo=function(a){v=a},this.toggleVisibility=function(){aa.toggledOn=!aa.toggledOn,v.updateTimeBounds(this),this.toggleLabels(!1)},this.toggleColorMode=function(){aa.colorMode===h.OPACITY_RAMP&&(ba.id[0]=R,ba.id[1]=S),aa.colorMode=(aa.colorMode+1)%3,v.redrawCurrent(),b.$emit(g.updateLayer,v,this)},this.getColorModeStyle=function(){var a=[x,"linear-gradient(to right, red, orange 16%, yellow 32%, green 48%, blue 60%, indigo 76%, violet)","linear-gradient(to left, "+x+", rgba(0,0,0,0))"];return a[aa.colorMode]},this.toggleConnectById=function(){aa.connectById=!aa.connectById,v.redrawCurrent()},this.getColorByField=function(){return"id"};var ca;this.updateIdPredicate=function(){var a;ba.id[1]!==S&&ba.id[0]!==R?a=s:ba.id[1]!==S?a=t:ba.id[0]!==R&&(a=u),ca!==a&&(this.removePredicate(ca),ca=a,ca&&this.addPredicate(ca)),v.redrawCurrent()},this.setArrayBuffer=function(b,d){var e=this;return new Promise(function(f,g){if(b.byteLength%4!==0)return this.destroy(),a.error("Invalid binary data format"),aa.isError=!0,aa.errorMsg="Invalid data format",void g("Invalid data format");if(D=new Uint32Array(b,0),E=new Uint32Array(b,4),F=new Float32Array(b,8),G=new Float32Array(b,12),J=k(F,G),!J)return void g("Unknown record size");H=new Uint32Array(b,16),J>16&&(I=new Uint32Array(b,20)),K=J/4,L=E.length-(K-1),O=b.byteLength/J,P=c("number")(O,0);var h=function(){if($)return void g();B=b,M=1e3*E[0],N=1e3*E[L],R=S=D[0];for(var c=K;c<O*K;c+=0|K)D[c]>S?S=D[c]:D[c]<R&&(R=D[c]);ba.id[0]=R,ba.id[1]=S,ccriCorealerter.alerter.infoMsg(P+" results",e.getName()),a.info(e.getName()+": "+P+" results"),f()},j=new Int32Array(b);if(_.isBoolean(d)||(d=i.sortedBinRec(j,0,O,1,K/2)),d)h();else{var l=new Float64Array(b),m=new Int32Array(64);m[0]=0,m[1]=O,i.sortBinRec(j,l,m,2,1,K/2,h)}})},_.isUndefined(q)||this.setArrayBuffer(q,r),this.searchPointAndTimeForRecords=function(a,b,c,d){for(var f,g=[],h={fixedPixelBuffer:Math.max(z,4)},i=e.getSearchExtent(a,b,h),j=this.getLowerBoundIdx(c);j<O;j++){var k=F[j*K],l=G[j*K],m=1e3*E[j*K];if(m>d)break;ol.extent.containsXY(i,l,k)&&g.push(new ol.Feature({geometry:new ol.geom.Point([l,k]),lat:k,lon:l,dtg:m,id:D[j*K],label:this.getLabelString(j*K)}))}return f=e.sortAndTrimFeatures(a,g),Promise.resolve(_.map(f,function(a){return _.omit(a.getProperties(),"geometry")}))},this.searchPointAndTime=function(a,b,c,e){var g=f(aa,ba.id);return this.searchPointAndTimeForRecords(a,b,c,e).then(function(a){return{name:V,isError:!1,getLayerLegendStyle:function(){return aa&&aa.colorMode!==h.COLOR_BY_ID?{color:x}:{display:"none"}},records:a,getRecordLegendStyle:function(a){return a&&aa&&aa.colorMode===h.COLOR_BY_ID?{color:d.getColor(g(a.id*T))}:{display:"none"}},fieldTypes:[{name:"lat",localType:"number"},{name:"lon",localType:"number"},{name:"dtg",localType:"date-time"},{name:"id",localType:"string"},{name:"label",localType:"string"}]}})};var da=[];this.predicates=function(){return da},this.checkPredicates=function(a){for(var b=0,c=da.length;b<c;b+=1)if(!da[b](a))return!1;return!0},this.addPredicate=function(a){return!_.contains(da,a)&&(da.push(a),!0)},this.removePredicate=function(a){return!!_.contains(da,a)&&(_.pull(da,a),!0)},this.labelsAvailable=function(){return!1},this.labelsOn=!1,this.toggleLabels=function(a){},this.getLegendItem=function(){return{useColorModeIcon:!0,color:this.getColorModeStyle(),label:V,itemId:W}},this.each=function(a,b,c){for(var d=K*(_.isUndefined(b)?1:this.getLowerBoundIdx(1e3*b)),e=K*O,f=d;f<e&&!(E[f]>c);f+=0|K)this.checkPredicates(f)&&a(F[f],G[f],E[f],D[f],D[f])}};return n.prototype.getLowerBoundIdx=function(a){var b,c=a/1e3,d=this.getNumRecords(),e=0,f=0,g=0;if(this.getMinTimeInMillis()>=a)return-1;if(this.getMaxTimeInMillis()<a)return d-1;for(;d>1;)e=d>>1,f=g+e,b=this.getTimeInSeconds(f*this.getStride()),b<c?(g=f,d-=e):d=e;return g},n.prototype.getUpperBoundIdx=function(a){var b,c=a/1e3,d=this.getNumRecords(),e=0,f=0,g=this.getNumRecords();if(this.getMinTimeInMillis()>a)return 0;if(this.getMaxTimeInMillis()<=a)return d;for(;d>1;)e=d>>1,f=g-e,b=this.getTimeInSeconds(f*this.getStride()),c<b?(g=f,d-=e):d=e;return g},n.determineRecordSize=function(a){if(a.byteLength%4!==0)return null;var b=new Float32Array(a,8),c=new Float32Array(a,12);return k(b,c)},n}]),angular.module("stealth.timelapse.stores",["stealth.core.geo.ows"]).factory("stealth.timelapse.stores.LineQueryBinStore",["$http","$log","$q","$rootScope","stealth.timelapse.stores.BinStore","CONFIG",function(a,b,c,d,e,f){var g=function(){e.apply(this,arguments);var g,h=this,i=this.getViewState(),j=/LIKE\s*'[^']*%[^']*'/i,k={source:void 0,geometry:void 0,timeBounds:{start:void 0,end:void 0},cqlParams:void 0};this.getQuery=function(){return g},this.buildCql=function(){var a=this.getQuery();return a.buildCql()},this.buildGetFeatureOverrides=function(){var a=this.getQuery(),b=a.params.geomField.name,c=a.params.dtgField.name,d=a.params.idField.name,e=a.layerData.currentLayer.fieldNames.label,f=this.buildCql(),g=j.test(f);return this.customizeGetFeatureOverrides({viewparams:g?"QUERY_HINT:z3;STRATEGY:z3":null,outputFormat:"application/vnd.binary-viewer",format_options:"geom:"+b+";dtg:"+c+";trackId:"+d+(e?";label:"+e:"")+(a.params.sortOnServer?";sort=true":""),cql_filter:f})},this.customizeGetFeatureOverrides=function(a){var b=this.getQuery(),c=b.params.geomField.name,d=b.params.dtgField.name,e=b.params.startDtgField.name,f=b.params.endDtgField.name,g=b.params.idField.name,h=b.layerData.currentLayer.fieldNames.label;return _.merge({},a,{propertyName:_.compact([d,e,f,c,g,h]).join()})},this.launchQuery=function(a){this.setQuery(a);var e=a.layerData.currentLayer.Name,f=a.layerData.currentLayer.fadeRate,g="arraybuffer",j=OwsUtils.WfsManager.getDefaultWfsParams("GetFeature",e);j.srsName="EPSG:4326",_.merge(j,this.buildGetFeatureOverrides()),OwsUtils.WfsManager.submitRequest(a.layerData.currentLayer.wfsUrl,j,{responseType:g,onDownloadProgress:function(a){d.$applyAsync(function(){i.isDownloadActive=!0,i.downloadSize=a.loaded})}}).then(function(b){return h.setArrayBuffer(b,a.params.sortOnServer).then(function(){if(d.$emit("timelapse:querySuccessful",h),h.setFadeRate(f),!h.getNumRecords())return c.reject("No results")})}).catch(function(a){var c=h.getName();i.isError=!0,i.errorMsg=a.message,b.error(a.message),ccriCorealerter.alerter.errorMsg(a.error.message,"Error: "+c)}).then(function(){d.$applyAsync(function(){i.isDownloadActive=!1})})},this.setQuery=function(a){g=a,this.setColorByMultiplier(parseInt(_.get(a,["layerData","currentLayer","KeywordConfig","timelapse","colorByMultiplier"]),10)||1),_.merge(k,{source:a.layerData.currentLayer.Title,geometry:a.params.generatedFeatures,timeBounds:{start:a.params.startDtg,end:a.params.endDtg},cqlParams:a.params.cqlParams?a.params.cqlParams:{additionalCql:a.params.cql}})},this.getQueryDetails=function(){return k},this.getColorByField=function(){return _.get(g,["params","idField","name"])},this.defaultExportFormats={Binary:"bin"},this.getExportFormats=function(){return _.chain(h.defaultExportFormats).merge(_.get(h.getQuery().layerData.currentLayer.KeywordConfig,"timelapse.export.include")).omit(_.keys(_.get(h.getQuery().layerData.currentLayer.KeywordConfig,"timelapse.export.exclude"))).value()},this.exportBin=function(b){b=b||"bin";var d,e,i=this;if("bin"===b)d=c.when(new Blob([this.getArrayBuffer()],{type:"application/octet-binary"})),e=this.getName().trim().replace(/\W/g,"_")+".bin";else{var k=this.getQuery().layerData.currentLayer.wfsUrl,l=h.buildCql(),m=j.test(l),n={service:"WFS",version:"1.0.0",request:"GetFeature",typeName:g.layerData.currentLayer.Name,srsName:"EPSG:4326",outputFormat:b,cql_filter:l};m&&(n.viewparams="QUERY_HINT:z3;STRATEGY:z3");var o,p=$.param(n);o=p.length>f.geoserver.maxGET?a.post(k,p,{headers:{"Content-Type":"application/x-www-form-urlencoded"},responseType:"blob"}):a.get(k,{params:n,responseType:"blob"}),d=o.then(function(a){var c={bin:".bin",csv:".csv",GML2:".gml","text/xml; subtype=gml/3.1.1":".gml","application/gml+xml; version=3.2":".gml","application/json":".json","application/vnd.google-earth.kml+xml":".kml","SHAPE-ZIP":".zip"};return e=i.getName().trim().replace(/\W/g,"_")+(c[b]||""),a.data})}return d.then(function(a){saveAs(a,e)}),d}};return g.prototype=Object.create(e.prototype),g}]),angular.module("stealth.timelapse.stores").factory("stealth.timelapse.stores.LocalFirstQueryBinStore",["$log","$q","cqlHelper","stealth.timelapse.stores.QueryBinStore",function(a,b,c,d){function e(){d.apply(this,arguments),a.debug(g+"new LocalFirstQueryBinStore("+this.getName()+")"),this.searchWithoutLabelStrategy=f,this.defaultExportFormats={Binary:"bin"}}function f(a){var d=this,e=a.capabilities,f=a.coordinates,g=a.resolution,h=a.clickOverrides,i=a.timerange.start.original,j=a.timerange.end.original;return this.searchPointAndTimeForRecords(f,g,i,j).then(function(a){var g=_.map(a,function(a){var b=d.getQuery().params.geomField.name,e=a.lon,f=a.lat,g=1e-4,h=1e-4,i=d.getQuery().params.dtgField.name,j=moment.utc(a.dtg).toISOString();return c.buildBboxFilter(b,[e-g,f-h,e+g,f+h])+"AND "+i+"='"+j+"'"}),i=_.map(g,function(a){return d.searchPointAndTimeWithCql(a,e,f,h,{viewparams:"QUERY_HINT:z3;STRATEGY:z3"})});return b.all(i).then(function(a){if(_.isEmpty(a))return b.when({name:d.getName(),isError:!1,records:[]});var c=a[0],e=_(a).map(function(a){return a.records}).flatten().value();return c.records=e,c.metadata={dataSource:d.getQuery().layerData.currentLayer},c.dataSource=d.getQuery().layerData.currentLayer,c},function(a){return b.reject(a)})})}var g="stealth.timelapse.stores.LocalFirstQueryBinStore: ";return a.debug(g+"factory started."),e.prototype=Object.create(d.prototype),e}]),angular.module("stealth.timelapse.stores",["stealth.core.geo.ows","stealth.core.popup.capabilities","stealth.core.popup.components","stealth.core.utils"]).factory("stealth.timelapse.stores.QueryBinStore",["$log","$rootScope","$q","cqlHelper","clickSearchHelper","ol3Map","wfs","queryBinStoreExtender","stealth.core.geo.ol3.layers.WmsLayer","stealth.core.popup.components.fieldFormat","stealth.timelapse.stores.LineQueryBinStore","tlLayerManager",function(a,b,c,d,e,f,g,h,i,j,k,l){var m="stealth.timelapse.stores.QueryBinStore: ";a.debug(m+"factory started.");var n=function(){k.apply(this,arguments),a.debug(m+"new QueryBinStore("+this.getName()+")");var n=this;this.customizeGetFeatureOverrides=function(a){var b=this.getQuery(),c=b.params.geomField.name,d=b.params.dtgField.name,e=b.params.idField.name,f=b.layerData.currentLayer.fieldNames.label;return _.merge({},a,{propertyName:_.compact([d,c,e,f]).join()})},this.boundStartMillis=function(a){return Math.max(n.getMinTimeInMillis(),a)-1e3},this.boundEndMillis=function(a){return Math.min(n.getMaxTimeInMillis(),a)+1e3},this.searchPointAndTimeWithCql=function(a,b,d,f,h){var i=c.defer(),k={cql_filter:a},l=n.getQuery(),m=l.layerData.currentLayer.KeywordConfig,o=_.get(m,"click.search.customPopup"),p=l.layerData.currentLayer.Name;return g.getFeature(l.layerData.currentLayer.wfsUrl,p,_.merge({},h,k,!0),void 0,!0).then(function(a){var c=e.sortAndTrimFeatures(d,a.data.features,f);i.resolve(_.merge({name:n.getName(),isError:!1,getLayerLegendStyle:function(){return{color:n.getFillColorHexString()}},metadata:_.map(c,function(a){return{source:a,dataSource:l.layerData.currentLayer}}),capabilities:b,fieldTypes:l.featureTypeData.featureTypes[0].properties,isFilterable:!0,filterHandler:n.filterSingle,popupOptionsOverrides:o,dataSource:l.layerData.currentLayer},j.formatFromKeywords(_.pluck(c,"properties"),m)))},function(a){i.reject({name:n.getName(),isError:!0,reason:a.statusText})}),i.promise},this.searchPointAndTime=function(a,b,d,f){var g=c.defer(),i=this.boundStartMillis(d),j=this.boundEndMillis(f),k=n.getQuery().layerData.currentLayer.KeywordConfig,l={fixedPixelBuffer:Math.max(this.getPointRadius(),4)};_.merge(l,e.getLayerOverrides(k));var m=k.capability||{};if(m=h.extendCapabilities(m,this,{startMillis:i,endMillis:j}),n.getMinTimeInMillis()>f||n.getMaxTimeInMillis()<d)return g.resolve({name:n.getName(),isError:!1,records:[]}),g.promise;var o={capabilities:m,clickOverrides:l,coordinates:a,resolution:b,timerange:{end:{bounded:j,original:f},start:{bounded:i,original:d}}};return this.hasLabel()?this.searchWithLabelStrategy(o):this.searchWithoutLabelStrategy(o)},this.searchWithLabelStrategy=function(a){var b=a.capabilities,c=a.clickOverrides,d=a.coordinates,e=a.resolution,f=a.timerange.start.original,g=a.timerange.end.original,h=n.getQuery().layerData.currentLayer.fieldNames.label||"label";return this.searchPointAndTimeForRecords(d,e,f,g).then(function(a){var e=_.pluck(a,"label");if(e.length>0){var f=h+" IN ("+e.join()+")";return n.searchPointAndTimeWithCql(f,b,d,c)}return{name:this.getName(),records:[]}})},this.searchWithoutLabelStrategy=function(a){var b=a.capabilities,c=a.coordinates,f=a.resolution,g=a.clickOverrides,h=a.timerange.start.bounded,i=a.timerange.end.bounded,j=e.getSearchExtent(c,f,g),k={params:{geomField:n.getQuery().params.geomField,dtgField:n.getQuery().params.dtgField,minLon:j[0],minLat:j[1],maxLon:j[2],maxLat:j[3],startDtg:moment.utc(h),endDtg:moment.utc(i)}};return this.searchPointAndTimeWithCql(d.combine(d.operator.AND,d.buildSpaceTimeFilter(k.params),n.buildCql()),b,c,g,_.get(this.getQuery(),"layerData.currentLayer.KeywordConfig.click.search.z3")?{viewparams:"QUERY_HINT:z3;STRATEGY:z3"}:null)},this.isFilterable=!0;var o=function(a,c){var d={startDtg:moment(n.getQuery().params.startDtg),endDtg:moment(n.getQuery().params.endDtg),storeName:c,currentLayer:n.getQuery().layerData.currentLayer};n.getQuery().params.cql&&""!==_.trim(n.getQuery().params.cql)?d.cql=_.trim(n.getQuery().params.cql)+" AND "+a:d.cql=a,b.$emit("Launch Timelapse Wizard",d)},p=function(a,b){return a+"="+(angular.isString(b)?"'"+b+"'":b)};this.filterSingle=function(a,b){var c=p(a,b),d=n.getQuery().params.storeName+" ("+c+")";o(c,d)},this.filterMultiple=function(a,b){var c=_.map(b,function(b){return p(a,b)}),e=n.getQuery().params.storeName+"(filtered)";o(d.combine(d.operator.OR,c),e)},this.defaultExportFormats={Binary:"bin",CSV:"csv",GML2:"GML2","GML3.1":"text/xml; subtype=gml/3.1.1","GML3.2":"application/gml+xml; version=3.2",GeoJSON:"application/json",KML:"application/vnd.google-earth.kml+xml",Shapefile:"SHAPE-ZIP"};var q,r,s,t=!1,u=function(){return t},v=function(a){t=a};this.labelsAvailable=function(){return s=_.get(this.getQuery(),"layerData.currentLayer.KeywordConfig.timelapse.labelStyle"),s&&l.pausedTimeWindow},this.labelsOn=!1,this.toggleLabels=function(a){var b=_.isBoolean(a)?a:!this.labelsOn;b!==this.labelsOn&&(this.labelsOn=b,this.labelsOn?(r||(q=new ol.source.ImageWMS({ratio:1,url:this.getQuery().layerData.currentLayer.wmsUrl,params:{VERSION:"1.1.1",TRANSPARENT:"TRUE",LAYERS:this.getQuery().layerData.currentLayer.Name,STYLES:s},imageLoadFunction:_.partialRight(i.loadFunction,!0,u,v)}),r=new ol.layer.Image({source:q}),r.setOpacity(this.getOpacity()/100)),q.updateParams({CQL_FILTER:d.combine(d.operator.AND,d.buildDtgFilter(this.getQuery().params.dtgField.name,moment.utc(1e3*l.pausedTimeWindow.start_s),moment.utc(1e3*l.pausedTimeWindow.end_s)),this.buildCql())}),f.addLayerOverlay(r)):f.removeLayerOverlay(r))};var w=this.setOpacity;this.setOpacity=function(a){w(a),r&&r.setOpacity(a/100)};var x=this.destroy;this.destroy=function(){x(),this.toggleLabels(!1),q=void 0,r=void 0,s=void 0}};return n.prototype=Object.create(k.prototype),n}]).service("queryBinStoreExtender",["coreCapabilitiesExtender","stealth.core.popup.capabilities.Extender",function(a,b){var c=new b;this.addCapabilitiesExtender=c.addCapabilitiesExtender.bind(c),this.extendCapabilities=c.extendCapabilities.bind(c);var d=this.extendCapabilities;this.extendCapabilities=function(b,c,e){return d(a.extendCapabilities(b,c,e),c,e)}}]),angular.module("stealth.timelapse.stores").service("stealth.timelapse.stores.sorter",["$timeout",function(a){var b=this;this.sortedBinRec=function(a,b,c,d,e){b|=0,c|=0,d|=0,e|=0;var f=e<<1|0,g=0,h=0,i=0,j=0;if((c-b|0)<2)return!0;for(g=b*f+d|0,h=c*f+d|0,j=0|a[0|g],g=g+f|0;(0|g)!==(0|h);){if(i=0|a[0|g],(0|i)<(0|j))return!1;g=g+f|0}return!0},this.sortBinRec=function(c,d,e,f,g,h,i,j){f|=0,g|=0,h|=0;var k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=0,u=0,v=0,w=0,x=0,y=0,z=0;if(z=Date.now(),(0|f)<2)return i(j),null;for(f=f-1|0,l=0|e[0|f],f=f-1|0,k=0|e[0|f],n=h<<1|0;;){if(o=k*n+g|0,p=l*n+g|0,v=l-k|0,(0|v)<3){if((0|v)>1&&(0|c[0|o])>(0|c[o+n]))for(w=o-g>>1|0,x=w+h|0,v=0|h;0!==(0|v);v=v-1|0,w=w+1|0,x=x+1|0)y=d[0|w],d[0|w]=d[0|x],d[0|x]=y;if((0|f)<2)return i(j),null;f=f-1|0,l=0|e[0|f],f=f-1|0,k=0|e[0|f]}else{for(q=o+(l-k>>1|0)*n|0,s=0|c[0|o],t=0|c[0|q],u=0|c[p-n|0],(0|s)<(0|t)?(0|t)<(0|u)||(t=(0|s)<(0|u)?u:s):(0|s)<(0|u)?t=s:(0|t)<(0|u)&&(t=u),m=0|k,q=0|o,r=0|p;;){for(;(0|c[0|q])<(0|t);)q=q+n|0,m=m+1|0;for(r=r-n|0;(0|t)<(0|c[0|r]);)r=r-n|0;if((0|q)>=(0|r))break;if((0|c[0|q])!==(0|c[0|r]))for(w=q-g>>1|0,x=r-g>>1|0,v=0|h;0!==(0|v);v=v-1|0,w=w+1|0,x=x+1|0)y=d[0|w],d[0|w]=d[0|x],d[0|x]=y;q=q+n|0,m=m+1|0}(q-o|0)<(p-q|0)?(e[0|f]=0|k,f=f+1|0,e[0|f]=0|m,f=f+1|0,k=m):(e[0|f]=0|m,f=f+1|0,e[0|f]=0|l,f=f+1|0,l=m)}if((l-k|0)>5e4&&Date.now()-z>50)return e[0|f]=0|k,f=f+1|0,e[0|f]=0|l,f=f+1|0,a(b.sortBinRec,0,!1,c,d,e,f,g,h,i,j),0|f}}}]),angular.module("stealth.timelapse",["stealth.core.geo.ol3.layers","stealth.core.popup.capabilities"]).service("summaryExploreMgr",["$timeout","ol3Map","stealth.timelapse.geo.ol3.layers.SummaryLayer","coreCapabilitiesExtender",function(a,b,c,d){var e=this;this.toggleSummaryLayer=function(d,f){if(_.isUndefined(d.mapLayerId)||_.isNull(d.mapLayerId)){var g=new c(d,f);g.query({CQL_FILTER:d.cqlFilter}),d.summaryLayer=g,d.mapLayerId=g.id,d.viewState.isOnMap=!0;
var h=g.getOl3Layer();d.viewState.toggledOn=h.getVisible(),g.styleDirectiveScope.removeLayer=function(){e.removeSummaryLayer(d)},b.addLayer(g),h.on("change:visible",function(){a(function(){g.getViewState().toggledOn=h.getVisible(),h.getVisible()&&g.query({CQL_FILTER:d.cqlFilter})})})}else b.removeLayerById(d.mapLayerId),d.viewState.isOnMap=!1,d.summaryLayer.onDestroy(),delete d.mapLayerId,delete d.summaryLayer},this.removeSummaryLayer=function(a){a.viewState.isOnMap&&e.toggleSummaryLayer(a),_.pull(a.layerThisBelongsTo.summaries,a)},this.workspaces={},this.summaryQuery=function(a,b,c,d){if(_.isEmpty(c.layerName)||_.isEmpty(c.trkIdField)||_.isEmpty(b[c.trkIdField])||_.isUndefined(d.dataSource))return void ccriCorealerter.alerter.errorMsg(a+" is missing information required to perform summary search.","Summary Error");var f,g=c.layerName,h=g.split(":");h.length>2?(g=h.slice(1).join(":"),f=h[0]):f=d.dataSource.ogcId;var i=_.find(_.flatten(_.values(e.workspaces)),{Name:g,ogcId:f});if(i){var j={layerThisBelongsTo:i,Name:c.layerName,trkIdField:c.trkIdField,Title:a,viewState:{isOnMap:!1,toggledOn:!1,isLoading:!1,isExpanded:!0,isRemovable:!0},cqlFilter:"("+c.trkIdField+"='"+b[c.trkIdField]+"')"};i.summaries.push(j),e.toggleSummaryLayer(j,d)}else ccriCorealerter.alerter.errorMsg("No matching data source found for "+f+": "+g,"Summary Error")},d.addCapabilitiesExtender(function(a){return _.isUndefined(a.summary)||(a.summary.toolTipText="Get summary",a.summary.iconClass="fa-location-arrow",a.summary.onClick=e.summaryQuery),a})}]),angular.module("stealth.timelapse",["ccri.angular-utils","ccri.bars","ccri.popup","ccri.time-controls","ccri.time-range-slider","stealth.core.geo.ol3.map","stealth.core.interaction","stealth.timelapse.geo","stealth.timelapse.wizard","stealth.timelapse.category","stealth.timelapse.edit"]).service("tlLayerManager",["$log",function(a){a.debug("tlLayerManager has been deprecated")}]),angular.module("stealth.timelapse.wizard",[]).directive("stTlWizAreaStep",[function(){return{restrict:"E",templateUrl:"timelapse/wizard/area_step.tpl.html",link:function(a){a.toolControlsConfig={radiusCircle:!0,polygon:!0,bufferFeature:!0,mapView:!0,coordRect:!0,wholeEarth:!0}}}}]),angular.module("stealth.timelapse.wizard.bounds",["ccri.angular-utils","stealth.core.geo.ol3.map","stealth.core.utils","stealth.core.wizard","stealth.timelapse.wizard","stealth.wizard"]).factory("boundTlWizFactory",["ccri.angular-utils.WidgetDef","stealth.core.wizard.Step","stealth.core.wizard.Wizard","stealth.timelapse.wizard.Query",function(a,b,c,d){var e={createBoundWiz:function(e){return e.query||(e.query=new d),new c(null,null,null,[new b("Define search area",new a({tag:"st-tl-wiz-bounds",scope:e}))])}};return e}]).controller("boundWizController",["$scope","ol3Map","stealth.wizard.wizardManager",function(a,b,c){var d=new ol.interaction.DragBox;d.on("boxend",function(){a.$apply(function(){a.query.checkAndSetBounds(d.getGeometry().getExtent()),b.removeInteraction(d),a.boundWiz.drawing=!1,c.showFooter()})}),a.boundWiz||(a.boundWiz={drawing:!1,setWholeEarth:function(){a.query.checkAndSetBounds([-180,-90,180,90])},setMapExtent:function(){a.query.checkAndSetBounds(b.getExtent())},drawExtent:function(){a.boundWiz.drawing=!0,c.hideFooter(),b.addInteraction(d)}}),a.$on("$destroy",function(){b.removeInteraction(d)})}]).directive("stTlWizBounds",function(){return{restrict:"E",templateUrl:"timelapse/wizard/templates/bounds.tpl.html",controller:"boundWizController"}}),angular.module("stealth.timelapse.wizard.live",["ccri.angular-utils","ccri.area-definition","stealth.core.geo.ol3.interaction","stealth.core.geo.ol3.overlays","stealth.core.startmenu","stealth.core.wizard","stealth.timelapse.wizard.options","stealth.wizard","stealth.live"]).run(["startMenuManager","liveWizard",function(a,b){a.addButton("Live Query","fa-bolt",b.launchWizard,"timeenabled",110)}]).service("liveWizard",["$q","$rootScope","ccri.angular-utils.WidgetDef","ccri.area-definition.FeatureCreator","CONFIG","stealth.core.wizard.Step","stealth.core.wizard.Wizard","stealth.live.manager.Manager","stealth.timelapse.wizard.live.Query","stealth.wizard.wizardManager",function(a,b,c,d,e,f,g,h,i,j){this.launchWizard=function(k){function l(){t.toolWasOpened=!0}function m(){var a=r.buildCql();if(r.runOnCompletion){var b=r.params.storeName,c=_.keys(r.layerData.currentLayer.KeywordConfig.timelapse.live)[0],d=h.buildView(c,ccriUtils.uuid.generate(),DataSourceManager.getDataSourcesById(r.layerData.currentLayer.id).first(),b,{cql:{value:a}});h.updateViewDisplayStatus(c,d.id,{isExpanded:!0}),h.toggleView(c,d.id)}r.isSaveable&&r.save(a)}function n(){s.getFeatures().then(o).then(function(){q.dot.finalCql=r.buildCql(),"include"===q.dot.finalCql.toLowerCase()&&(q.dot.finalCql="")})}function o(a){var b=_.filter(a,function(a){var b=a.getGeometry();return b instanceof ol.geom.Polygon||b instanceof ol.geom.MultiPolygon});r.params.generatedFeatures=b}function p(){r=null,s.un("featureschanged",n),s.un("toolstarted",l),s=null,q.$destroy(),q.query=q.dot=null,q=null,t.$destroy(),t.query=t.cqlStats=t.featureCreator=t.hasShapes=null,t=null,u.$destroy(),u.featureCreator=null,u=null,w=null,x=null}var q=b.$new(),r=new i(k);q.query=r,q.dot={finalCql:null,cqlMaxlength:_.get(e,"geoserver.cqlMaxLength",1/0)};var s=new d({supportedTools:["coordRect","polygon","radiusCircle","bufferFeature","mapView","wholeEarth"],disableMultiple:!1}),t=q.$new();t.query=r,t.cqlStats=q.dot,t.featureCreator=s,t.hasShapes=function(){if(!arguments.length)return!!s.hasFeatures()||null};var u=q.$new();u.featureCreator=s,s.on("featureschanged",n),t.toolWasOpened=!1,s.on("toolstarted",l),_.get(r,"params.generatedFeatures")&&s.addFeatures(r.params.generatedFeatures);var v,w,x=new g("Live Data Query","fa-bolt","fa-check text-success",[new f("Select data and area",new c({tag:"st-live-wiz-source-and-area-step",scope:t}),new c({tag:"st-wiz-draw-toolbar",scope:u}),(!1),function(){var a=_.get(q,"query.layerData.currentLayer",null);v=q.$watch("query.layerData.currentLayer",function(b){b&&b!==a&&(a=b,r.getFeatureTypeDescription())}),w=q.query.params.cql,r.params.cql=""},function(b){if(v(),v=null,b===!0)return r.params.cql=w,s.finishActiveTool().then(function(){return s.getFeatures()}).then(function(b){return b.length&&r.layerData.layers.length?void o(b):a.reject()})}),new f("Set Options",new c({tag:"st-tl-wiz-options",scope:q}),null,(!0),null,function(a){a===!0&&m()})],q,"wizard-dark AreaDefinitionWizard",function(){s.finish().finally(p)});j.launchWizard(x)}}]),angular.module("stealth.timelapse.wizard.live",["stealth.core.utils","stealth.core.utils.cookies"]).factory("stealth.timelapse.wizard.live.Query",["$q","cqlHelper","wfs","stealth.core.geo.ol3.format.GeoJson",function(a,b,c){var d=1;return function(e){function f(){var a=j.params.generatedFeatures,c=b.buildFeatureFilter(a,j.params.geomField);return b.combine(b.operator.AND,j.params.cql,c)}function g(){return j.layerData.error=null,j.featureTypeData=null,j.params.geomField=null,i(),c.getFeatureTypeDescription(j.layerData.currentLayer.wfsUrl,j.layerData.currentLayer.Name,!1,!0).then(function(b){return j.featureTypeData=b,b.error?(j.featureTypeData="unavailable",a.reject("GetFeatureTypeDescription found no description")):(c.getDefaultGeometryFieldName(j.layerData.currentLayer.wfsUrl,j.layerData.currentLayer.Name,!1,!0).then(function(a){j.params.geomField=a}),b)},function(b){return j.layerData.error="GetFeatureTypeDescription request failed. Error: "+b.status+" "+b.statusText,a.reject(j.layerData.error)})}function h(){var a=DataSourceManager.getDataSourcesByKeyword("timelapse.live"),b=a.filter(function(a){return!a.keywordConfig.hasIn(["timelapse","hideRoot"])}).map(DataSourceManager.buildLegacyLayer).toJS();return j.layerData.layers=_.sortBy(b,function(a){return a.serverUrl+_.keys(a.KeywordConfig.timelapse.live)[0]+a.Title}),_.isEmpty(j.layerData.layers)||(e.source&&(j.params.currentLayer=_.find(j.layerData.layers,{Name:e.source})),j.params.currentLayer&&(j.layerData.currentLayer=_.find(j.layerData.layers,{Name:j.params.currentLayer.Name})),j.layerData.currentLayer=j.layerData.currentLayer||j.layerData.layers[0],j.getFeatureTypeDescription()),j.layerData.layers}function i(){if(e.title)return void(j.params.storeName=e.title);var a=_.get(j,"layerData.currentLayer.Title");return a?void(j.params.storeName=a+" ("+k+")"):void(j.params.storeName="Live ("+k+")")}e=e||{};var j=this;this.buildCql=f,this.getFeatureTypeDescription=g;var k=d++;this.type="live",this.isSaveable=!!this.isSaveable,this.shouldBeSaved=_.get(e,"shouldBeSaved",!!this.shouldBeSaved),this.shouldBeShared=_.get(e,"shouldBeShared",!!this.shouldBeShared),this.classifications=this.classifications,this.classification=_.get(e,"classification",this.classification),this.editMode=!!e.id,this.id=e.id,this.showOnStartup=e.showOnStartup,this.runOnCompletion=e.runOnCompletion!==!1,this.layerData={},this.params={storeName:null,geomField:null,generatedFeatures:[],cql:_.get(e,"cql",null),cqlParams:_.get(e,"cqlParams",null)},i(),e.bounds&&(j.params.generatedFeatures=(new ol.format.WKT).readFeatures(e.bounds)||[]),this.liveLayers=DataSourceManager.loadDataSources().then(h)}}]),angular.module("stealth.timelapse.wizard.live",[]).directive("stLiveWizSourceAndAreaStep",[function(){return{restrict:"E",templateUrl:"timelapse/wizard/live/source_area_step.tpl.html",link:function(a){a.toolControlsConfig={radiusCircle:!0,polygon:!0,bufferFeature:!0,mapView:!0,coordRect:!0,wholeEarth:!0}}}}]),angular.module("stealth.timelapse.wizard.options",["ccri.angular-utils","stealth.core.wizard","stealth.timelapse.wizard"]).directive("stTlWizOptions",["ccri.angular-utils.WidgetDef",function(a){return{restrict:"E",templateUrl:"timelapse/wizard/templates/options.tpl.html",link:function(b){if(b.cqlTotalLength=function(){if(!arguments.length){var a=b.query.params.cql?b.query.params.cql.length:0,c=b.dot.finalCql?b.dot.finalCql.length:0;return a+c}},_.has(b.query.layerData.currentLayer.KeywordConfig,"query.customWizardOptions")){var c=_.get(b.query.layerData.currentLayer.KeywordConfig,["query","customWizardOptions"]);b.customOptionsWidget=new a({tag:c,scope:b,attrs:'query="query" cql-max-length="dot.cqlMaxlength" cql-total-length="cqlTotalLength"'})}}}}]),angular.module("stealth.timelapse.wizard",[]).directive("stWizAreaDefinition",[function(){return{restrict:"E",templateUrl:"timelapse/wizard/templates/area_definition.tpl.html",link:function(a){function b(b){a.selectedTool=b.toolName}function c(){a.selectedTool=null}a.selectedTool=null;var d=a.featureCreator;d.on("toolstarted",b),d.on("toolfinished",c),a.$on("$destroy",function(){d.un("toolstarted",b),d.un("toolfinished",c),a=d=null})}}}]),angular.module("stealth.timelapse.wizard",[]).directive("stWizCqlLength",function(){return{require:"ngModel",restrict:"E",scope:{maxlength:"@cqlMaxlength"},templateUrl:"timelapse/wizard/templates/cql_length.tpl.html",link:function(a,b,c,d){function e(){var b=Number(a.length),c=Number(a.maxlength);return a.isValid=f(b,c),a.showMessage=!a.isValid||g(b,c),a.isValid}function f(a,b){return!(!isNaN(a)&&!isNaN(b))||a<=b}function g(a,b){return!isNaN(a)&&!isNaN(b)&&b-a<b/10}a.length=0,a.isValid=!0,a.showMessage=!1,d.$validators.cqlLength=e,a.$watch("length",e),a.$watch("maxlength",e),d.$render=function(){a.length=d.$modelValue}}}}),angular.module("stealth.timelapse.wizard",["stealth.core.utils"]).directive("stWizDataProps",["$filter",function(a){return{restrict:"E",scope:{query:"="},templateUrl:"timelapse/wizard/templates/data_props.tpl.html",link:function(b){function c(a){return!(b.query.params.dtgField&&_.get(a,"name")===b.query.params.dtgField.name||b.query.params.geomField&&_.get(a,"name")===b.query.params.geomField.name||_.find(b.query.params.requiredArrowFields,{name:_.get(a,"name")}))}function d(){_.each(b.query.params.arrowFields,function(a,d){c(a)||b.query.params.arrowFields.splice(d,1)})}var e,f=a("attributeLabel");b.labelFn=function(a){return f(a.name)},b.selectFn=function(a){return _.contains(b.query.featureTypeData.featureTypes[0].properties,a)?a:_.find(b.query.featureTypeData.featureTypes[0].properties,{name:a.name})},b.dateTimeFilter=function(a){return"date-time"===a.localType},b.geomFilter=function(a){return"Point"===a.localType},b.isUnusedAttribute=c,b.colorByFilter=function(a){var b=["boolean","string","int"];return _.includes(b,a.localType.toLowerCase())},b.arrowFieldOptions=null,b.vm={nextAdditionalField:null},b.addNextAdditional=function(){b.query.params.arrowFields.push(b.vm.nextAdditionalField),b.vm.nextAdditionalField=null},b.options={useArrow:!b.query.preferBin},b.$watch("query.params.dtgField",function(a,b){a!==b&&d()}),b.$watch("query.params.geomField",function(a,b){a!==b&&d()}),b.$watch("options.useArrow",function(a,c){a!==c&&(b.query.preferBin=!a)}),b.query.onceHistoricalLayers.then(function(){null!==b.query.params.arrowFields&&(b.query.params.arrowFields=_.map(b.query.params.arrowFields,function(a){return _.find(b.query.featureTypeData.featureTypes[0].properties,{name:_.get(a,"name")})})),b.$watch("query.featureTypeData",function(){var a=b.query.layerData.currentLayer;if(a)if(b.query.layerSupportsArrow="true"===_.get(a,"KeywordConfig.timelapse.arrow","").toString().toLowerCase(),b.query.layerSupportsArrow&&_.isArray(_.get(b.query,"featureTypeData.featureTypes"))){e||(e=a);var c=_.compact(_.get(a,"KeywordConfig.timelapse.whitelistedArrowFields","").split(","));b.query.params.requiredArrowFields=_((_.get(a,"KeywordConfig.timelapse.requiredArrowFields")||"").split(",")).thru(function(a){return c.length?_.intersection(a,c):a}).map(function(a){return _.find(b.query.featureTypeData.featureTypes[0].properties,{name:a})}).compact().value();var f=_((_.get(a,"KeywordConfig.timelapse.arrowFields")||"").split(",")).thru(function(a){return c.length?_.intersection(a,c):a}).map(function(a){return _.find(b.query.featureTypeData.featureTypes[0].properties,{name:a})}).compact().value();null!==b.query.params.arrowFields&&a===e||(b.query.params.arrowFields=f),c.length?b.arrowFieldOptions=_(c).map(function(a){return _.find(b.query.featureTypeData.featureTypes[0].properties,{name:a})}).compact().value():b.arrowFieldOptions=b.query.featureTypeData.featureTypes[0].properties,d(),e=a}else b.arrowFieldOptions=null,b.query.params.requiredArrowFields=null})})}}}]),angular.module("stealth.timelapse.wizard",[]).directive("stWizDataSource",[function(){return{restrict:"E",scope:{query:"=",filterFn:"=?"},templateUrl:"timelapse/wizard/templates/data_source.tpl.html",require:"^form",link:function(a,b,c,d){a.labelFn=function(a){return a.Title},a.$watch("query.layerData.currentLayer",function(b,c){b!==c&&(d.$setValidity("featureTypeDescription",!1),a.query.getFeatureTypeDescription().then(function(a){return d.$setValidity("featureTypeDescription",!0),a}))}),a.$watch("query.layerData.layers",function(b,c){b!==c&&(a.layerList=_.filter(a.query.layerData.layers,function(a){return!_.has(a.KeywordConfig,"timelapse.hideRoot")}))})}}}]),angular.module("stealth.timelapse.wizard").directive("stWizDrawToolbar",[function(){return{restrict:"E",templateUrl:"timelapse/wizard/templates/draw_toolbar.tpl.html"}}]),angular.module("stealth.timelapse.wizard",[]).directive("stTlQueryName",[function(){return{restrict:"E",templateUrl:"timelapse/wizard/templates/name.tpl.html",scope:{wizardForm:"=",query:"="},bindToController:!0,controllerAs:"queryNameCtrl",controller:function(){}}}]),angular.module("stealth.timelapse.wizard",[]).directive("stTlSaveQuery",[function(){return{restrict:"E",templateUrl:"timelapse/wizard/templates/saveQuery.tpl.html",scope:{query:"="},bindToController:!0,controllerAs:"saveQueryCtrl",controller:function(){}}}]),angular.module("stealth.timelapse.wizard",[]).directive("stWizSection",[function(){return{replace:!0,restrict:"E",templateUrl:"timelapse/wizard/templates/section.tpl.html",transclude:!0,scope:{dotted:"=?",dotNumber:"=?"}}}]),angular.module("stealth.timelapse.wizard",[]).directive("stWizSubsection",[function(){return{replace:!0,restrict:"E",templateUrl:"timelapse/wizard/templates/subsection.tpl.html",transclude:!0}}]),angular.module("stealth.timelapse.wizard",[]).directive("stWizTimerange",["CONFIG",function(a){return{restrict:"E",templateUrl:"timelapse/wizard/templates/timerange.tpl.html",compile:function(){return{pre:function(b){b.storageKeyPrefix=b.storageKeyPrefix||_.get(a,"app.context")}}}}}]),angular.module("templates-app",["core/clock/clock.tpl.html","core/clock/clockWidget.tpl.html","core/elements/dateRange.tpl.html","core/elements/datetime.tpl.html","core/geo/analysis/analysisCategory.tpl.html","core/geo/controls/inspectToggle.tpl.html","core/geo/controls/modeIndicator.tpl.html","core/geo/controls/mousePosition.tpl.html","core/geo/import/templates/impcat.tpl.html","core/geo/ol3/layers/feature-layerstyleview.tpl.html","core/geo/ol3/layers/layer-fragments.tpl.html","core/geo/ol3/layers/tint.tpl.html","core/geo/ol3/manager/explore.tpl.html","core/geo/ol3/manager/manager.tpl.html","core/geo/ol3/manager/style.tpl.html","core/geo/ol3/zoom.tpl.html","core/header/header.tpl.html","core/measure/measure.tpl.html","core/measure/movingTooltip.tpl.html","core/measure/simpleTable.tpl.html","core/popup/components/edit.tpl.html","core/popup/components/fieldview.tpl.html","core/popup/customTabPopup.tpl.html","core/save/loadModal.tpl.html","core/save/save.tpl.html","core/save/saveModal.tpl.html","core/sidebar/sidebar.tpl.html","core/startmenu/startmenu.tpl.html","core/startmenu/user.tpl.html","core/utils/paging.tpl.html","core/utils/toggleMapLayer.tpl.html","core/utils/upload.tpl.html","core/utils/visibility.tpl.html","drawroute/category/category.tpl.html","drawroute/wizard/templates/draw.tpl.html","drawroute/wizard/templates/routeOptions.tpl.html","drawroute/wizard/templates/routePoints.tpl.html","drawroute/wizard/templates/savedRoutes.tpl.html","histogram/geo/category.tpl.html","histogram/geo/ol3/layers/histostyleview.tpl.html","histogram/popup/container.tpl.html","histogram/popup/popup.tpl.html","histogram/wizard/templates/options.tpl.html","histogram/wizard/templates/source.tpl.html","mediator/air-tfi/toolbar.tpl.html","mediator/savedqueries-timelapse/sourcetimerange.tpl.html","routeanalysis/results/popup.tpl.html","routeanalysis/runner/container.tpl.html","routeanalysis/wizard/templates/chartOptions.tpl.html","routeanalysis/wizard/templates/data.tpl.html","static/geo/category.tpl.html","static/geo/staticstyleview.tpl.html","static/wizard/templates/options.tpl.html","static/wizard/templates/source.tpl.html","static/wizard/templates/spatialbounds.tpl.html","static/wizard/templates/timebounds.tpl.html","timelapse/controls/chart.tpl.html","timelapse/controls/colorByFieldChooser.tpl.html","timelapse/controls/colorByIdRandomizer.tpl.html","timelapse/controls/colorModeSingleColorChooser.tpl.html","timelapse/controls/colorModeSwitcher.tpl.html","timelapse/controls/plotlyBarChart.tpl.html","timelapse/geo/category.tpl.html","timelapse/geo/ol3/layers/eventsTab.tpl.html","timelapse/geo/ol3/layers/livestyle.tpl.html","timelapse/geo/ol3/layers/stTimeLapseLayerStyle.tpl.html","timelapse/geo/ol3/layers/summaryStyle.tpl.html","timelapse/geo/ol3/layers/summaryTab.tpl.html","timelapse/wizard/area_step.tpl.html","timelapse/wizard/live/source_area_step.tpl.html","timelapse/wizard/templates/area_definition.tpl.html","timelapse/wizard/templates/bounds.tpl.html","timelapse/wizard/templates/cql_length.tpl.html","timelapse/wizard/templates/data_props.tpl.html","timelapse/wizard/templates/data_source.tpl.html","timelapse/wizard/templates/draw_toolbar.tpl.html","timelapse/wizard/templates/name.tpl.html","timelapse/wizard/templates/options.tpl.html","timelapse/wizard/templates/saveQuery.tpl.html","timelapse/wizard/templates/section.tpl.html","timelapse/wizard/templates/subsection.tpl.html","timelapse/wizard/templates/timerange.tpl.html"]),angular.module("core/clock/clock.tpl.html",[]).run(["$templateCache",function(a){a.put("core/clock/clock.tpl.html",'<div class="clockDisplay">\n    <div class="clockDate bar-color2">{{formattedDate}}</div>\n    <div class="clockTime">{{formattedTime}}</div>\n</div>\n')}]),angular.module("core/clock/clockWidget.tpl.html",[]).run(["$templateCache",function(a){a.put("core/clock/clockWidget.tpl.html",'<div class="clockHeader pull-left" ng-if="currentState === ClockStates.HEADER">\n    <st-clock></st-clock>\n</div>\n<div class="btn action-btn bar-btn bar-color2 clockButton pull-right" ng-click="changeState()"\n     ng-class="{\'active\': currentState != ClockStates.OFF}"\n     uib-tooltip="Time Display Cycle" tooltip-class="nowrap"\n     tooltip-placement="bottom-right" tooltip-animation="true"\n     tooltip-popup-delay="600" tooltip-trigger="mouseenter"\n     tooltip-class="nowrap">\n    <i class="fa fa-lg fa-clock-o"></i>\n</div>\n')}]),angular.module("core/elements/dateRange.tpl.html",[]).run(["$templateCache",function(a){a.put("core/elements/dateRange.tpl.html",'<span class="st-date-range">\n    <span ng-if="!innerStart && !innerEnd" class="st-date-range-placeholder">{{bothPlaceholder}}</span>\n    <span ng-if="innerStart || innerEnd">\n        <st-datetime date="innerStart"\n            moment-date-format="{{momentDateFormat}}"\n            moment-time-format="{{momentTimeFormat}}"\n            value-placeholder="{{valuePlaceholder}}"\n            utc="utc"\n            sep="{{datetimeSep}}"\n        ></st-datetime>\n        {{sep}}\n        <st-datetime date="innerEnd"\n            moment-date-format="{{momentDateFormat}}"\n            moment-time-format="{{momentTimeFormat}}"\n            value-placeholder="{{maxTimePlaceholder}}"\n            utc="utc"\n            sep="{{datetimeSep}}"\n        ></st-datetime>\n    </span>\n</span>\n\n')}]),angular.module("core/elements/datetime.tpl.html",[]).run(["$templateCache",function(a){a.put("core/elements/datetime.tpl.html",'<span class="st-datetime">\n    <span ng-if="!hasValue" class="st-datetime-placeholder">{{valuePlaceholder}}</span>\n    <span ng-if="hasValue">\n        <span class="st-datetime-date nowrap">{{datePart}}</span><!--\n        --><span class="st-datetime-sep" ng-bind-html="sep"></span><!--\n        --><span class="st-datetime-time nowrap">{{timePart}}</span>\n    </span>\n</span>\n')}]),angular.module("core/geo/analysis/analysisCategory.tpl.html",[]).run(["$templateCache",function(a){a.put("core/geo/analysis/analysisCategory.tpl.html",'<div class="analysisCategoryLayerGroup">\n    <div ng-repeat="layer in layers" class="categoryGrouping">\n        <div class="categoryCell">\n            <st-toggle-visibility visible="layer.viewState.toggledOn"\n                                  toggle="toggleVisibility({layer: layer})">\n            </st-toggle-visibility>\n        </div>\n        <div class="categoryCell">\n            {{::layer.name | characters:35:true}}\n        </div>\n        <div class="categoryCell">\n            <ccri-angular-utils-close-btn\n                  ng-click="removeLayer({layer: layer})">\n            </ccri-angular-utils-close-btn>\n        </div>\n    </div>\n</div>\n')}]),angular.module("core/geo/controls/inspectToggle.tpl.html",[]).run(["$templateCache",function(a){a.put("core/geo/controls/inspectToggle.tpl.html",'<div class="btn action-btn bar-btn bar-color2 bar-btn-toggle"  ng-click="toggle()"\n     ng-class="{\'bar-btn-toggle-on\': isToggledOn}"\n     uib-tooltip="Inspect Map" tooltip-class="nowrap"\n     tooltip-placement="bottom-right" tooltip-animation="true"\n     tooltip-popup-delay="600" tooltip-trigger="mouseenter"\n     tooltip-class="inspect-tooltip">\n    <i class="fa fa-lg fa-crosshairs"></i>\n</div>\n')}]),angular.module("core/geo/controls/modeIndicator.tpl.html",[]).run(["$templateCache",function(a){a.put("core/geo/controls/modeIndicator.tpl.html",'<div class="bar-color2 bar-font-stacked">\n    Map Mode:<br>\n    <i class="fa" ng-class="getIcon()"></i> {{getName()}}\n</div>\n')}]),angular.module("core/geo/controls/mousePosition.tpl.html",[]).run(["$templateCache",function(a){a.put("core/geo/controls/mousePosition.tpl.html",'<div class="bar-color2 ol-mouse-position">\n    <table>\n        <tr>\n            <td style="text-align:right;">DMS:</td>\n            <td style="text-align:right;width:75px;"><span class="stmousepos_dmsh_0"></span></td>\n            <td style="text-align:right;width:75px;"><span class="stmousepos_dmsh_1"></span></td>\n        </tr>\n        <tr>\n            <td style="text-align:right;width:50px;">Lat/Lon:</td>\n            <td style="text-align:right;"><span class="stmousepos_lat"></span>&deg;</td>\n            <td style="text-align:right;"><span class="stmousepos_lon"></span>&deg;</td>\n        </tr>\n    </table>\n</div>\n')}]),angular.module("core/geo/import/templates/impcat.tpl.html",[]).run(["$templateCache",function(a){a.put("core/geo/import/templates/impcat.tpl.html",'<div style="margin-bottom:2px;">\n    <div class="categoryGrouping">\n        <div class="categoryCell"><b>Add File</b></div>\n        <div class="categoryCell">\n            <span class="btn btn-default fa-stack toggleButton"\n                  ng-click="launchImportWiz()"\n                  uib-tooltip="Import new file" tooltip-class="nowrap" tooltip-append-to-body="true"\n                  tooltip-placement="right" tooltip-animation="false" tooltip-popup-delay="500"\n                  tooltip-trigger="mouseenter">\n                <i class="fa fa-fw fa-plus fa-stack-1x text-primary"></i>\n            </span>\n        </div>\n    </div>\n    <div ng-repeat="layer in layers" class="importCategoryGrouping layerGrouping categoryIndent">\n        <div class="categoryCell"\n             ng-if="layer.processing || layer.error">\n            <div class="btn btn-default fa-stack toggleButton">\n                <i class="fa fa-fw fa-stack-1x fa-refresh fa-spin" ng-class="{\'ng-hide\': !layer.processing}"></i>\n                <i class="fa fa-fw fa-stack-1x fa-warning text-danger" ng-class="{\'ng-hide\': !layer.error}"></i>\n            </div>\n        </div>\n        <div class="categoryCell"\n             ng-if="!layer.processing && !layer.error">\n            <st-toggle-map-layer visible="!layer.hidden"\n                                 toggle="toggleVisibility(layer)">\n            </st-toggle-map-layer>\n        </div>\n        <div class="categoryCell importCategoryCell">\n            <span>{{layer.name}}</span>\n        </div>\n        <div class="categoryCell" ng-if="!layer.viewState.isLoading">\n                <ccri-angular-utils-close-btn\n                      ng-click="removeLayer(layer)"\n                      ng-class="{\'ng-hide\': layer.processing}"\n                      uib-tooltip="Remove Layer" tooltip-class="nowrap" tooltip-append-to-body="true"\n                      tooltip-placement="right"\n                      tooltip-animation="false"\n                      tooltip-popup-delay="500"\n                      tooltip-trigger="mouseenter">\n                </ccri-angular-utils-close-btn>\n        </div>\n    </div>\n</div>\n')}]),angular.module("core/geo/ol3/layers/feature-layerstyleview.tpl.html",[]).run(["$templateCache",function(a){a.put("core/geo/ol3/layers/feature-layerstyleview.tpl.html",'<div style="padding:4px;">\n    <ui-include src="\'core/geo/ol3/layers/layer-fragments.tpl.html\'" fragment="\'.visibilityName\'"></ui-include>\n    <ui-include src="\'core/geo/ol3/layers/layer-fragments.tpl.html\'" fragment="\'.opacitySlider\'"></ui-include>\n    <div class="layerStyleRow">\n        <span ng-if="::sizeChanged">\n            <div class="cell">Size</div>\n            <div class="cell">\n                <input type="number" step="1"\n                       class="form-control input-xs"\n                       ng-model="getViewState().size"\n                       ccri-angular-utils-change="sizeChanged(getViewState().size)"\n                       min="1" max="100">\n            </div>\n        </span>\n        <span ng-if="::fillColorChanged">\n            <div class="cell" style="padding-left:5px">Color</div>\n            <div class="cell">\n                <span class="fa fa-lg fa-square clickable colorpickerSquare"\n                      ng-style="{color: getViewState().fillColor}"\n                      colorpicker colorpicker-position="bottom"\n                      ng-model="getViewState().fillColor"\n                      ccri-angular-utils-change="fillColorChanged()"\n                      uib-tooltip="Change color" tooltip-class="nowrap"\n                      tooltip-placement="right" tooltip-animation="false" tooltip-popup-delay="500"\n                      tooltip-trigger="mouseenter">\n                </span>\n            </div>\n        </span>\n    </div>\n</div>\n')}]),angular.module("core/geo/ol3/layers/layer-fragments.tpl.html",[]).run(["$templateCache",function(a){a.put("core/geo/ol3/layers/layer-fragments.tpl.html",'<div class="layerStyleMapLayer" style="padding:4px;">\n    <ui-include src="\'core/geo/ol3/layers/layer-fragments.tpl.html\'" fragment="\'.visibilityName\'"></ui-include>\n    <ui-include src="\'core/geo/ol3/layers/layer-fragments.tpl.html\'" fragment="\'.opacitySlider\'"></ui-include>\n</div>\n\n<div class="visibilityName flex-row">\n    <div class="ellipsis"\n         ng-class="{\'layerNotVisible\': !layerState.visible}"\n         uib-tooltip="{{ol3Layer.get(\'name\') || ol3Layer.get(\'id\')}}"\n         tooltip-class="wrap"\n         tooltip-placement="bottom-left"\n         tooltip-animation="true"\n         tooltip-popup-delay="600"\n         tooltip-trigger="mouseenter"\n         tooltip-enable="false"\n         ccri-angular-utils-tooltip-overflow="watch">\n        {{ol3Layer.get("name") || ol3Layer.get("id")}}\n    </div>\n    <div>\n        <i class="fa fa-fw"\n            ng-class="::styleVars.iconClass"></i>\n    </div>\n    <div class="btn action-btn flex-1"\n          ng-if="::removeLayer"\n          ng-click="removeLayer(ol3Layer)">\n        <i class="fa fa-remove text-danger"></i>\n    </div>\n</div>\n\n<div class="opacitySlider flex-row flex-align-items-center layerStyleRow">\n    <div class="rangeSliderStartLabel">Opacity</div>\n    <div class="flex-1 horizontally-buffered">\n        <div ui-slider ng-model="layerState.opacity" min="0.0" max="1.0" step="0.01" use-decimals>\n        </div>\n    </div>\n    <div class="rangeSliderEndLabel">{{(layerState.opacity * 100) | number : 0}}%</div>\n</div>\n\n<div class="thresholdFilterSlider" style="margin:4px 0">\n    <div class="layerStyleRow flex-row flex-align-items-center">\n        <div class="rangeSliderStartLabel"\n            uib-tooltip="{{::viewState.thresholdFilter.min}}" tooltip-class="nowrap"\n            tooltip-placement="top" tooltip-animation="false" tooltip-popup-delay="500"\n            tooltip-append-to-body="true" tooltip-trigger="mouseenter"\n            tooltip-enable="false" ccri-angular-utils-tooltip-overflow>\n            {{::viewState.thresholdFilter.min}}\n        </div>\n        <div class="flex-1 horizontally-buffered">\n            <div ui-slider="{range: true}"\n                 ng-model="viewState.thresholdFilter.filter" ng-change="refreshStyleEnv()"\n                 min="{{::viewState.thresholdFilter.min}}" max="{{::viewState.thresholdFilter.max}}"\n                 step="{{::viewState.thresholdFilter.step}}">\n            </div>\n        </div>\n        <div class="rangeSliderEndLabel"\n            uib-tooltip="{{::viewState.thresholdFilter.max}}" tooltip-class="nowrap"\n            tooltip-placement="top" tooltip-animation="false" tooltip-popup-delay="500"\n            tooltip-append-to-body="true" tooltip-trigger="mouseenter"\n            tooltip-enable="false" ccri-angular-utils-tooltip-overflow>\n            {{::viewState.thresholdFilter.max}}\n        </div>\n    </div>\n    <div class="layerStyleRow ellipsis" style="padding: 4px 0 0 55px">\n'+"        Range{{::viewState.thresholdFilter.field ? ' (' + viewState.thresholdFilter.field + ')' : ''}}: {{viewState.thresholdFilter.filter[0]}} to {{viewState.thresholdFilter.filter[1]}}\n    </div>\n</div>\n");
}]),angular.module("core/geo/ol3/layers/tint.tpl.html",[]).run(["$templateCache",function(a){a.put("core/geo/ol3/layers/tint.tpl.html",'<div style="padding:4px;">\n    <ui-include src="\'core/geo/ol3/layers/layer-fragments.tpl.html\'" fragment="\'.visibilityName\'"></ui-include>\n    <div class="tintSlider flex-row flex-align-items-center layerStyleRow">\n        <div  class="rangeSliderStartLabel">Light</div>\n        <div class="flex-1 horizontally-buffered">\n            <input type="range" ng-model="layerState.darkness" min="-1.0" max="1.0" step="0.01" st-float-input>\n        </div>\n        <div class="rangeSliderEndLabel">Dark</div>\n    </div>\n</div>')}]),angular.module("core/geo/ol3/manager/explore.tpl.html",[]).run(["$templateCache",function(a){a.put("core/geo/ol3/manager/explore.tpl.html",'<div class="anchorAll">\n    <div ng-repeat="c in catMgr.getCategories()"\n         class="side-panel-content category">\n        <div class="flex-row"\n             style="background-color:#444;padding:2px 2px;color:#e4e4e4;border-top:1px solid black;font-size:12px;">\n            <span class="categoryCell">\n                <span class="fa-stack">\n                    <i class="fa fa-fw fa-lg" ng-class="::c.iconClass"></i>\n                </span>\n            </span>\n            <span class="ellipsis flex-1"\n                  style="padding-top:5px;"\n                  uib-tooltip="{{::c.title | uppercase}}"\n                  tooltip-class="wrap"\n                  tooltip-placement="top"\n                  tooltip-animation="true"\n                  tooltip-popup-delay="600"\n                  tooltip-trigger="mouseenter"\n                  tooltip-enable="false"\n                  ccri-angular-utils-tooltip-overflow="watch">\n                {{::c.title | uppercase}}\n            </span>\n            <span style="white-space:nowrap;">\n                <ccri-angular-utils-close-btn\n                    style="font-size:14px;padding-right:5px;vertical-align:text-top;"\n                    ng-class="{\'ng-hide\': !c.closable}"\n                    ng-click="catMgr.removeCategory(c.id)"\n                ></ccri-angular-utils-close-btn>\n                <span class="clickable"\n                      style="vertical-align:sub;"\n                      ng-click="c.toggledOn=!c.toggledOn">\n                    <i class="fa fa-fw"\n                       ng-class="c.toggledOn ? \'fa-chevron-down\' : \'fa-chevron-right\'" ></i>\n                </span>\n            </span>\n        </div>\n        <!-- category content added via widget compiler -->\n        <div st-category-resizable category="c" class="categoryResizable"\n             ng-class="{\'ng-hide\': !c.toggledOn}">\n            <div style="height:100%;overflow:auto;">\n                <ccri-angular-utils-widget-compiler widget-def="::c.contentDef"\n                                    ng-if="::c.contentDef">\n                </ccri-angular-utils-widget-compiler>\n            </div>\n        </div>\n    </div>\n</div>\n')}]),angular.module("core/geo/ol3/manager/manager.tpl.html",[]).run(["$templateCache",function(a){a.put("core/geo/ol3/manager/manager.tpl.html",'<div class="anchorAll">\n    <div class="anchorAll"\n         ng-if="view === \'explore\'"\n         ng-include="\'core/geo/ol3/manager/explore.tpl.html\'">\n    </div>\n    <div class="anchorAll"\n         ng-if="view === \'style\'"\n         ng-include="\'core/geo/ol3/manager/style.tpl.html\'">\n    </div>\n</div>\n')}]),angular.module("core/geo/ol3/manager/style.tpl.html",[]).run(["$templateCache",function(a){a.put("core/geo/ol3/manager/style.tpl.html",'<div class="anchorAll" style="overflow-x:hidden;">\n    <ul ui-sortable="sortableOptions" ng-model="layers"\n        style="overflow-x:hidden;list-style:none outside none;padding:0;">\n        <li ng-repeat="layer in layers" class="flex-row layerStyleGrouping" style="padding:2px 6px 2px 0;">\n            <div style="padding-left:4px;padding-top:4px;">\n                <st-toggle-map-layer visible="layer.styleDirectiveScope.layerState.visible"\n                                     loading="layer.isLoading()"\n                                     toggle="layer.styleDirectiveScope.toggleVisibility()"\n                ></st-toggle-map-layer>\n            </div>\n            <ccri-angular-utils-widget-compiler widget-def="::layer.getStyleDisplayDef()"\n                                                class="flex-1"\n                                                style="display:inline-block;overflow-x:hidden;"\n            ></ccri-angular-utils-widget-compiler>\n        </li>\n    </ul>\n</div>\n')}]),angular.module("core/geo/ol3/zoom.tpl.html",[]).run(["$templateCache",function(a){a.put("core/geo/ol3/zoom.tpl.html",'<div>\n    <div class="btn action-btn bar-btn bar-color2" ng-click="zoomByDelta(-1)">\n        <i class="fa fa-minus fa-lg"></i>\n    </div>\n    <div class="btn action-btn bar-btn bar-color2" ng-click="zoomByDelta(1)">\n        <i class="fa fa-plus fa-lg"></i>\n    </div>\n</div>\n')}]),angular.module("core/header/header.tpl.html",[]).run(["$templateCache",function(a){a.put("core/header/header.tpl.html",'<div class="flex-row flex-align-items-center">\n    <div class="headerTitle">\n        <img ng-src="{{::logoUrl}}" class="headerLogo">\n        {{::title}}\n    </div>\n    <div class="versionSubTitle bar-color2">\n        <span>{{::version}}</span>\n        <br />\n        <span ng-bind-html="::subTitle"></span>\n    </div>\n</div>\n')}]),angular.module("core/measure/measure.tpl.html",[]).run(["$templateCache",function(a){a.put("core/measure/measure.tpl.html",'<div class="btn action-btn bar-btn bar-color2 bar-btn-toggle" ng-click="measureService.toggleMode()"\n     ng-class="{\'bar-btn-toggle-on\': mode.active}"\n     uib-tooltip="Measure" tooltip-class="nowrap"\n     tooltip-placement="bottom-right" tooltip-animation="true"\n     tooltip-popup-delay="600" tooltip-trigger="mouseenter"\n     tooltip-class="nowrap">\n    <i class="fa fa-lg ccri-icon ccri-icon-ruler"></i>\n</div>\n')}]),angular.module("core/measure/movingTooltip.tpl.html",[]).run(["$templateCache",function(a){a.put("core/measure/movingTooltip.tpl.html",'<div class="movingTooltip {{cssClass}}" style="top:{{y}}px; left:{{x}}px">\n    <div ng-transclude></div>\n</div>\n')}]),angular.module("core/measure/simpleTable.tpl.html",[]).run(["$templateCache",function(a){a.put("core/measure/simpleTable.tpl.html",'<div class="{{cssClass}} simpleTable">\n    <div ng-repeat="(key, value) in object">\n        <div class="clearfix">\n            <label class="pull-left">{{key}}:</label>\n            <span class="pull-right">{{value}}</span>\n        </div>\n    </div>\n</div>\n')}]),angular.module("core/popup/components/edit.tpl.html",[]).run(["$templateCache",function(a){a.put("core/popup/components/edit.tpl.html",'<div class="editor side-panel-content">\n    <div class="editorHeader flex-row">\n        <div class="editorTitle flex-1 ellipsis"></div>\n        <div class=\'btn action-btn\'\n             uib-tooltip="Save" tooltip-class="nowrap"\n             tooltip-placement="left" tooltip-animation="false"\n             tooltip-popup-delay="600" tooltip-trigger="mouseenter"\n             ng-click="save()">\n            <i class="fa fa-lg fa-save"></i>\n        </div>\n    </div>\n    <table class="editableFieldList">\n        <tr ng-repeat="(key, val) in properties">\n            <td>\n                <label class="control-label">{{::key}}</label>\n            </td>\n            <td>\n                <input class="form-control input-xs"\n                       ng-model="properties[key]">\n            </td>\n        </tr>\n    </table>\n</div>\n')}]),angular.module("core/popup/components/fieldview.tpl.html",[]).run(["$templateCache",function(a){a.put("core/popup/components/fieldview.tpl.html",'<div style="color:#b5b5b5;background-color:#333;">\n    <div class="modal-header flex-row" style="padding:5px 10px;border:none;">\n        <strong class="modal-title flex-1 ellipsis">{{::title}}</strong>\n        <ccri-angular-utils-close-btn\n              ng-click="$close()">\n        </ccri-angular-utils-close-btn>\n    </div>\n    <div class="modal-body" style="padding:5px 10px;">\n        <textarea autocomplete="off" spellcheck="false" rows="10"\n                  style="color:#aaa;font-family:monospace;width:100%;resize:vertical;border:none;background-color:#232323;"\n                  readonly\n                  ccri-angular-utils-select-text-on-focus\n        >{{::value}}</textarea>\n    </div>\n</div>\n')}]),angular.module("core/popup/customTabPopup.tpl.html",[]).run(["$templateCache",function(a){a.put("core/popup/customTabPopup.tpl.html",'<div class="customTabPopup" ng-class="{\'lightTheme\': !themeToggle}">\n    <div class="header flex-row flex-align-items-center" ng-style="getBorderStyle()">\n        <ccri-popup-components-capabilities-list\n            capabilities="response.capabilities"\n            name="name"\n            record="record"\n            metadata="metadata"\n            identifier="$parent.$parent.$parent.$parent.popupId"\n            button-limit="8"\n        ></ccri-popup-components-capabilities-list>\n        <div class="title flex-1 ellipsis clickable" ng-click="toggleTheme()"\n            uib-tooltip="Click to toggle style" tooltip-class="nowrap"\n            tooltip-placement="top" tooltip-animation="false" tooltip-popup-delay="600"\n            tooltip-trigger="mouseenter">\n            {{::title}} <span class="track-ended text-warning" ng-class="{\'ng-hide\': !displayState.trackEnded}">(Inactive)</span>\n        </div>\n        <ccri-angular-utils-close-btn\n              ng-if="$parent.$parent.removeTab && $parent.$parent.tabs.length > 1"\n              ng-click="$parent.$parent.removeTab($parent.$parent.tab)">\n        </ccri-angular-utils-close-btn>\n    </div>\n    <div class="outerContent" ng-if="::outerContent">\n        <table>\n            <tr ng-repeat="label in outerContent.labels">\n                <td class="keyColumn">{{label}}</td>\n                <td>{{record[outerContent.fields[$index]]}}</td>\n           </tr>\n        </table>\n    </div>\n    <ccri-angular-utils-tab-bar tab-list="tabs" default-active-tab="response.defaultActiveTab"></ccri-angular-utils-tab-bar>\n</div>\n')}]),angular.module("core/save/loadModal.tpl.html",[]).run(["$templateCache",function(a){a.put("core/save/loadModal.tpl.html",'<div style="background-color: #333; color: #e5e5e5; padding: 10px;">\n    Loading saved state...\n</div>\n')}]),angular.module("core/save/save.tpl.html",[]).run(["$templateCache",function(a){a.put("core/save/save.tpl.html",'<div class="btn action-btn bar-btn bar-color2"\n     ng-click="ctrl.onClick()"\n     uib-tooltip="Shareable Link"\n     uib-dropdown-toggle\n     tooltip-class="nowrap"\n     tooltip-placement="bottom-right"\n     tooltip-animation="true"\n     tooltip-popup-delay="600"\n     tooltip-trigger="mouseenter">\n    <i class="fa fa-lg fa-link"></i>\n</div>\n')}]),angular.module("core/save/saveModal.tpl.html",[]).run(["$templateCache",function(a){a.put("core/save/saveModal.tpl.html",'<div style="width: 100%; padding: 10px; display: flex; flex-direction: column; color: #b5b5b5; background-color: #333">\n    <div style="margin-top: 0; font-size: 18px;">\n        <i class="fa fa-link"></i>\n        <span>Generate Link</span>\n    </div>\n    <div style="flex: 1 1 0%; align-self: stretch; border: 1px #b5b5b5; border-style: solid none; padding: 5px;">\n        <i class="fa fa-info-circle"></i>\n        <span><i>\n            <b>Update:</b> Sharable Link now captures time-lapse layers, user drawn objects, and multi-pane layouts.\n            <ul style="margin-bottom: 0">\n                <li ng-if="::expirationDays">Link will expire in {{::expirationDays}} days</li>\n            </ul>\n        </i></span>\n    </div>\n    <div ng-if="!status.saveStarted" style="margin-top: 5px; flex: 1 1 0%;">\n        <span>Select appropriate classification: </span>\n        <span class="dark-dd" uib-dropdown is-open="status.isOpen">\n            <button uib-dropdown-toggle>\n                <span class="dropdown-toggle-text">{{classification}}</span>\n                <i class="fa fa-caret-down"></i>\n            </button>\n            <div uib-dropdown-menu role="menu" class="dark-dd-menu">\n                <a\n                    ng-repeat="classOption in classOptions"\n                    class="dropdown-menu-list-item"\n                    ng-click="setClassification(classOption)"\n                    role="menuitem"\n                >{{classOption}}</a>\n            </div>\n        </span>\n    </div>\n    <div ng-if="status.saveStarted && !status.saveComplete" style="margin-top: 5px; flex: 1 1 0%; align-self: center">\n        <i class="fa fa-circle-o-notch fa-spin fa-2x fa-fw"></i>\n    </div>\n    <div\n        ng-if="status.saveComplete && (status.saveError | lodash:\'isEmpty\')"\n        style="margin-top: 5px; flex: 1 1 auto; padding: 5px 0 0 5px"\n    >\n        <a target="_blank" class="text-primary text-primary-hover" href="{{::url}}">{{::url}}</a>\n        <ccri-angular-utils-clipboard-copy style="margin-left: 8px" ccri-angular-utils-clipboard-feedback class="control-btn icon-btn text-primary text-primary-hover" data-clipboard-text="{{url}}">\n            <i class="fa fa-clipboard"></i>\n        </ccri-angular-utils-clipboard-copy>\n    </div>\n    <div\n        ng-if="status.saveComplete && !(status.saveError | lodash:\'isEmpty\')"\n        style="margin-top: 5px;"\n    >\n        <span class="text-danger">Link generation failed.</span>\n    </div>\n    <div style="flex: 1 1 0%; margin-top: 5px; display: flex; justify-content: flex-end">\n        <span\n            ng-if="!status.saveStarted"\n            class="btn btn-xs btn-default darkStep"\n            ng-click="$dismiss(\'Cancel\')"\n        >\n            <i class="fa fa-close text-danger"></i>\n            Cancel\n        </span>\n        <span\n            ng-if="!status.saveStarted"\n            class="btn btn-xs btn-default darkStep"\n            ng-click="save()"\n        >\n            <i class="fa fa-link" style="color: white"></i>\n            Generate\n        </span>\n        <span\n            ng-if="status.saveStarted && status.saveComplete"\n            class="btn btn-xs btn-default darkStep"\n            ng-click="$dismiss(\'Done\')"\n        >\n            <i class="fa fa-close text-danger"></i>\n            Done\n        </span>\n    </div>\n</div>\n')}]),angular.module("core/sidebar/sidebar.tpl.html",[]).run(["$templateCache",function(a){a.put("core/sidebar/sidebar.tpl.html",'<div class="sidebarContainer">\n    <div class="sidebar anchorTopBottom anchorLeft">\n        <span class="sidebarText">\n            <i class="fa fa-fw fa-lg" ng-class="manager.getIconClass()"></i>\n            {{manager.getSidebarText()}}\n        </span>\n    </div>\n    <div ng-repeat-start="b in manager.getButtons()" class="btn"\n         uib-tooltip="{{b.panel.title}}"\n         tooltip-placement="right-top" tooltip-animation="false"\n         tooltip-popup-delay="500" tooltip-trigger="mouseenter"\n         ng-click="manager.toggleButton(b.id, !b.panel.open)" ng-class="{active: b.panel.open}"\n         ng-if="!manager.getHideAll()">\n        <i class="fa fa-fw fa-lg" ng-class="::b.iconClass"></i>\n    </div>\n    <div ng-repeat-end class="side-panel glass anchorTopBottom flex-column"\n         ng-style="b.panel.style" ng-if="b.panel.open && !manager.getHideAll()">\n        <div class="side-panel-header flex-row">\n            <div class="buf-sm-mr">\n                <i class="fa fa-fw fa-lg" ng-class="::b.iconClass"></i>\n            </div>\n            <div class="flex-1 ellipsis" ccri-angular-utils-tooltip-overflow\n                 uib-tooltip="{{b.panel.title}}" tooltip-enable="false"\n                 tooltip-placement="bottom-left" tooltip-animation="false"\n                 tooltip-popup-delay="900" tooltip-trigger="mouseenter">\n                {{b.panel.title}}\n            </div>\n            <div class="nav-box">\n                <!-- non-standard header elements added via widget compiler -->\n                <ccri-angular-utils-widget-compiler widget-def="::b.panel.toolDef"\n                                    ng-if="::b.panel.toolDef">\n                </ccri-angular-utils-widget-compiler>\n                <span class="icon-btn control-btn stateful-btn"\n                        ng-class="b.panel.pinned ? \'active\' : \'\'"\n                        uib-tooltip="pin" tooltip-class="nowrap"\n                        tooltip-placement="bottom" tooltip-animation="false" tooltip-popup-delay="600" tooltip-trigger="mouseenter"\n                        ng-model="b.panel.pinned" uib-btn-checkbox>\n                    <i class="fa fa-thumb-tack"></i>\n                </span>\n                <span class="icon-btn control-btn"\n                        uib-tooltip="collapse" tooltip-class="nowrap"\n                        tooltip-placement="bottom" tooltip-animation="false" tooltip-popup-delay="600" tooltip-trigger="mouseenter"\n                        ng-click="manager.toggleButton(b.id, !b.panel.open)">\n                    <i class="fa fa-angle-double-left"></i>\n                </span>\n                <span class="icon-btn" ng-if="::!b.permanent">\n                    <ccri-angular-utils-close-btn\n                            uib-tooltip="close" tooltip-class="nowrap"\n                            tooltip-placement="bottom" tooltip-animation="false" tooltip-popup-delay="600" tooltip-trigger="mouseenter"\n                            ng-click="manager.removeButton(b.id, true)">\n                    </ccri-angular-utils-close-btn>\n                </span>\n            </div>\n        </div>\n        <!-- panel content added via widget compiler -->\n        <ccri-angular-utils-widget-compiler widget-def="::b.panel.contentDef"\n                            class="side-panel-content-container flex-1"\n                            ng-if="::b.panel.contentDef">\n        </ccri-angular-utils-widget-compiler>\n    </div>\n</div>\n')}]),angular.module("core/startmenu/startmenu.tpl.html",[]).run(["$templateCache",function(a){a.put("core/startmenu/startmenu.tpl.html",'<div uib-dropdown>\n    <div uib-dropdown-toggle class="btn action-btn bar-btn"\n        uib-tooltip="Main Menu" tooltip-class="nowrap"\n        tooltip-placement="bottom-right" tooltip-animation="true"\n        tooltip-popup-delay="600" tooltip-trigger="mouseenter">\n        <i class="fa fa-bars fa-lg"></i>\n    </div>\n    <ul uib-dropdown-menu class="dropdown-menu-right bar-dropdown" role="menu">\n        <li ng-repeat="button in manager.buttonList">\n            <a href="" ng-if="!button.menuOptions" ng-click="manager.triggerButton(button)">\n                <i class="fa fa-fw" ng-class="button.iconClass"></i>\n                &nbsp; {{::button.title}}\n            </a>\n\n            <a href="" ng-if="button.menuOptions" ng-click="manager.triggerButton(button)">\n                <ccri-angular-utils-menu-trigger\n                    ng-if="button.menuOptions"\n                    menu-options="button.menuOptions"\n                    trigger="mouseenter" close-delay="0"\n                    menu-placement="left-top"\n                    menu-offset-x="1" menu-offset-y="0"\n                    menu-class="bar-dropdown-sub-menu">\n                    <span class="flex-row flex-align-items-center">\n                        <i class="fa fa-fw" ng-class="button.iconClass"></i>\n                        <span class="flex-1 buf-sm-mh">&nbsp; {{::button.title}}</span>\n                        <span>&nbsp;&#9658;</span>\n                    </span>\n                </ccri-angular-utils-menu-trigger>\n            </a>\n        </li>\n    </ul>\n</div>\n')}]),angular.module("core/startmenu/user.tpl.html",[]).run(["$templateCache",function(a){a.put("core/startmenu/user.tpl.html",'<div uib-dropdown>\n    <div uib-dropdown-toggle\n         class="btn action-btn bar-btn bar-color2"\n         uib-tooltip="User Info" tooltip-class="nowrap"\n         tooltip-placement="bottom-right" tooltip-animation="true"\n         tooltip-popup-delay="600" tooltip-trigger="mouseenter">\n        <i class="fa fa-user fa-lg"></i>\n    </div>\n    <div uib-dropdown-menu\n         class="dropdown-menu-right bar-dropdown">\n        <div class="bar-color2">User:</div>\n        {{::userCn}}\n    </div>\n</div>\n')}]),angular.module("core/utils/paging.tpl.html",[]).run(["$templateCache",function(a){a.put("core/utils/paging.tpl.html",'<span style="font-weight:normal;" ng-if="paging.numberOfPages() > 1">\n    <span class="page-number">Page</span>\n    <form class="form-inline" style="display:inline;">\n        <div class="form-group page-style">\n            <div class="input-group">\n                <div class="btn input-group-addon"\n                     ng-click="paging.previousPage()">\n                    <i class="fa fa-chevron-left page-style-chevron"></i>\n                </div>\n                <input type="number" step="1"\n                       ng-change="paging.checkSuggestedPage()"\n                       ng-blur="paging.suggestedPage = paging.currentPage"\n                       ng-model="paging.suggestedPage"\n                       class="form-control page-input-style">\n                <div class="btn input-group-addon"\n                     ng-click="paging.nextPage()">\n                    <i class="fa fa-chevron-right page-style-chevron"></i>\n                </div>\n            </div>\n        </div>\n    </form>\n    <span class="page-number">/ {{paging.numberOfPages()}}</span>\n</span>\n')}]),angular.module("core/utils/toggleMapLayer.tpl.html",[]).run(["$templateCache",function(a){a.put("core/utils/toggleMapLayer.tpl.html",'<span class="btn btn-default fa-stack toggleButton"\n      ng-click="::toggle()"\n      uib-tooltip="{{visible ? \'Remove from map\' : \'Add to map\'}}" tooltip-class="nowrap"\n      tooltip-placement="right" tooltip-animation="false" tooltip-popup-delay="500"\n      tooltip-trigger="mouseenter">\n    <i class="fa fa-fw fa-spin fa-lg fa-stack-1x fa-refresh" style="color:#98C3EE;"\n       ng-class="{\'ng-hide\': !visible || !loading}"></i>\n    <i class="fa fa-fw fa-stack-1x"\n       ng-class="visible ? \'fa-check-square-o\' : \'fa-square-o\'"></i>\n</span>\n')}]),angular.module("core/utils/upload.tpl.html",[]).run(["$templateCache",function(a){a.put("core/utils/upload.tpl.html",'<span class="btn btn-default fa-stack toggleButton"\n      ng-click="::upload()"\n      uib-tooltip="{{::tooltip || \'Load file\'}}" tooltip-class="nowrap"\n      tooltip-placement="right" tooltip-animation="false" tooltip-popup-delay="500"\n      tooltip-trigger="mouseenter">\n    <i class="fa fa-fw fa-folder-open fa-stack-1x text-primary" style="padding-left:2px;"></i>\n</span>\n<input type="file" class="ng-hide">\n')}]),angular.module("core/utils/visibility.tpl.html",[]).run(["$templateCache",function(a){a.put("core/utils/visibility.tpl.html",'<span class="btn btn-default fa-stack toggleButton"\n      ng-click="toggle()"\n      uib-tooltip="Toggle visibility" tooltip-class="nowrap"\n      tooltip-placement="auto right" tooltip-animation="false" tooltip-popup-delay="500"\n      tooltip-trigger="mouseenter">\n    <i class="fa fa-fw fa-eye fa-stack-1x"\n       ng-class="{\'text-muted\': !visible}"></i>\n    <i class="fa fa-fw fontIconSlash fa-stack-1x text-danger fa-lg"\n       ng-class="{\'ng-hide\': visible}" style="font-weight:bolder;"></i>\n</span>\n')}]),angular.module("drawroute/category/category.tpl.html",[]).run(["$templateCache",function(a){a.put("drawroute/category/category.tpl.html",'<div class="categoryGrouping">\n    <div ng-repeat="(workspace, gsLayers) in workspaces" class="categoryGrouping">\n        <div class="categoryCell"><b>{{::workspace}}</b></div>\n        <div ng-repeat="routeLayer in gsLayers" class="categoryGrouping categoryIndent">\n            <div class="categoryCell">\n                <st-toggle-visibility visible="routeLayer.viewState.toggledOn"\n                                      tooltip-placement="left" tooltip-animation="false" tooltip-popup-delay="500"\n                                      toggle="toggleVisibility(routeLayer)"></st-toggle-visibility>\n            </div>\n            <div class="categoryCell">\n                    <span class="fa-stack"\n                          ng-style="{\'color\': routeLayer.fillColor}">\n                        <i class="fa fa-fw fa-long-arrow-right fa-stack-1x"></i>\n                    </span>\n            </div>\n            <div class="categoryCell">\n                <i>{{::routeLayer.Title || routeLayer.name | characters:35:true}}</i>\n            </div>\n\n            <!-- temporary hack to start Route Analysis\n                 TODO: move this to mediators or something later -->\n            <div class="categoryCell">\n                    <span class="clickable"\n                          ng-click="launchRouteAnalysisWizard(routeLayer)"\n                          uib-tooltip="Start Route Analysis" tooltip-class="nowrap"\n                          tooltip-placement="right" tooltip-animation="false" tooltip-popup-delay="500"\n                          tooltip-trigger="mouseenter">\n                        <i class="fa fa-fw fa-plus text-primary"></i>\n                    </span>\n            </div>\n\n            <div class="categoryCell">\n                    <ccri-angular-utils-close-btn\n                          ng-click="removeRoute(routeLayer)"\n                          uib-tooltip="Remove Route" tooltip-class="nowrap"\n                          tooltip-placement="right" tooltip-animation="false" tooltip-popup-delay="500"\n                          tooltip-trigger="mouseenter">\n                    </ccri-angular-utils-close-btn>\n            </div>\n\n\n            <div ng-repeat="derivedLayer in routeLayer.derivedLayers" class="categoryGrouping">\n                <div class="categoryCell" ng-if="derivedLayer.viewState.isLoading" style="padding-left:2px;">\n                    <div ng-if="derivedLayer.viewState.isLoading">\n                        <i class="fa fa-circle-o-notch fa-spin"></i>\n                    </div>\n                </div>\n                <div class="categoryCell">\n                    <span ng-if="!derivedLayer.viewState.isLoading"\n                          class="btn btn-default fa-stack toggleButton"\n                          ng-click="showRouteAnalysis(derivedLayer.routeanalysis)"\n                          ng-style="{\'background-color\': derivedLayer.params.arrowColor}"\n                          uib-tooltip="Show route analysis" tooltip-class="nowrap"\n                          tooltip-placement="right" tooltip-animation="false" tooltip-popup-delay="500"\n                          tooltip-trigger="mouseenter">\n                        <i class="fa fa-fw fa-chevron-up fa-stack-1x" style="color:white;"></i>\n                    </span>\n                </div>\n                <div class="categoryCell" style="width:80%">\n                    <input type="text"\n                           ng-model="derivedLayer.title"\n                           ng-change="updateRouteAnalysisTitle(derivedLayer)"\n                           style="border-radius:3px;width:100%;">\n                </div>\n                <div class="categoryCell" style="text-align:right;">\n                        <ccri-angular-utils-close-btn\n                              ng-if="derivedLayer.viewState.isRemovable"\n                              ng-click="removeLayer(routeLayer, derivedLayer)">\n                        </ccri-angular-utils-close-btn>\n                </div>\n            </div>\n        </div>\n    </div>\n    <div class="categoryCell"><b>Import saved route</b></div>\n    <div class="categoryCell">\n        <span class="btn btn-default fa-stack toggleButton"\n              ng-click="launchSavedRouteWizard()"\n              uib-tooltip="Load Saved Route" tooltip-class="nowrap"\n              tooltip-placement="right" tooltip-animation="false" tooltip-popup-delay="500"\n              tooltip-trigger="mouseenter">\n            <i class="fa fa-fw fa-plus fa-stack-1x text-primary"></i>\n        </span>\n    </div>\n</div>\n')}]),angular.module("drawroute/wizard/templates/draw.tpl.html",[]).run(["$templateCache",function(a){a.put("drawroute/wizard/templates/draw.tpl.html",'<ng-form name="wizardForm">\n    <input type="hidden" ng-model="geoFeature" required>\n    <ol>\n        <li>Click to draw line segments, SHIFT+click+hold to draw in freehand.</li>\n        <li>Double-click to finish drawing.</li>\n        <li>Click and drag to modify. ALT+SHIFT+click to erase a vertex.</li>\n    </ol>\n</ng-form>\n')}]),angular.module("drawroute/wizard/templates/routeOptions.tpl.html",[]).run(["$templateCache",function(a){a.put("drawroute/wizard/templates/routeOptions.tpl.html",'<ng-form name="wizardForm">\n    <p>\n        Set additional options for Routes\n    </p>\n\n    <div style="text-align:center;">\n        <table style="border-collapse:separate;border-spacing:2px;margin:5px auto;">\n            <tr>\n                <td style="padding-top:2px"><label>Name: </label></td>\n                <td><input type="text" class="form-control" ng-model="name" required></textarea></td>\n            </tr>\n                <td style="padding-top:2px"><label>Category: </label></td>\n                <td><input type="text" class="form-control" ng-model="workspaceName" required></textarea></td>\n            </tr>\n            <tr>\n                <td style="padding-top:2px"><label>Color: </label></td>\n                <td style="text-align: left"><span class="colorpickerBtn" ng-style="style"\n                                                   style="margin-left:2px"\n                                                   colorpicker colorpicker-position="bottom"\n                                                   ng-model="style[\'background-color\']"\n                                                   ng-change="color = style[\'background-color\']"></span></td>\n            </tr>\n        </table>\n    </div>\n\n</ng-form>\n')}]),angular.module("drawroute/wizard/templates/routePoints.tpl.html",[]).run(["$templateCache",function(a){a.put("drawroute/wizard/templates/routePoints.tpl.html",'<div class="glass anchorLeft anchorBottom" style="top:36px;min-width:165px;" ng-show="routeInfo | lodash:\'isObject\'">\n    <div style="border: 1px solid #ccc;background-color:#ddd;border-radius:4px;margin:4px;padding:0 2px;">\n        <strong style="white-space:nowrap;">Distance: {{routeInfo.meters | formatMeters}}</strong>\n    </div>\n</div>\n')}]),angular.module("drawroute/wizard/templates/savedRoutes.tpl.html",[]).run(["$templateCache",function(a){a.put("drawroute/wizard/templates/savedRoutes.tpl.html",'<ng-form name="wizardForm">\n    <p>Select saved route to use.</p>\n    <table class="table" style="display:block; max-height:300px; overflow-y: auto; margin:5px auto;">\n        <tr>\n            <th>Route Name</th>\n            <th>Date Created</th>\n            <th>Created By</th>\n            <th>Add to Map</th>\n        </tr>\n        <tr ng-repeat="route in routes">\n            <td>{{route.getProperties().name | characters:35:true}}</td>\n            <td>{{route.getProperties().date.toLocaleString()}}</td>\n            <td>{{route.getProperties().user}}</td>\n            <td><button class="btn btn-default btn-xs" ng-click="addRouteFromStore(route)"><i class="fa fa-plus"></i></button></td>\n        </tr>\n    </table>\n</ng-form>')}]),angular.module("histogram/geo/category.tpl.html",[]).run(["$templateCache",function(a){a.put("histogram/geo/category.tpl.html",'<div ng-class="{\'ng-hide\': (workspaces | lodash:\'isEmpty\')}" class="categoryGrouping">\n    <div ng-repeat="workspace in workspaces | lodash:\'keys\' | orderBy" class="categoryGrouping">\n        <div class="categoryCell"><b>{{::workspace}}</b></div>\n        <div ng-repeat="gsLayer in workspaces[workspace] | orderBy:\'Name\'" class="categoryGrouping categoryIndent">\n            <div class="categoryCell">\n                <i>{{::gsLayer.Title || gsLayer.Name | characters:35:true}}</i>\n            </div>\n            <div class="categoryCell">\n                    <span class="btn btn-default fa-stack toggleButton"\n                          ng-if="gsLayer.queryable"\n                          ng-click="launchHistogramWizard(gsLayer)"\n                          uib-tooltip="New histogram" tooltip-class="nowrap"\n                          tooltip-placement="right" tooltip-animation="false" tooltip-popup-delay="500"\n                          tooltip-trigger="mouseenter">\n                        <i class="fa fa-fw fa-plus fa-stack-1x text-primary"></i>\n                    </span>\n            </div>\n            <div ng-repeat="derivedLayer in gsLayer.derivedLayers" class="categoryGrouping">\n                <div class="categoryCell" ng-if="derivedLayer.viewState.isLoading" style="padding-left:2px;">\n                    <div ng-if="derivedLayer.viewState.isLoading">\n                        <i class="fa fa-circle-o-notch fa-spin"></i>\n                    </div>\n                </div>\n                <div class="categoryCell">\n                    <span ng-if="!derivedLayer.viewState.isLoading"\n                          class="btn action-btn btn-default fa-stack toggleButton"\n                          ng-click="showHistogram(derivedLayer.histogram)"\n                          ng-style="{\'color\': derivedLayer.viewState.fillColor}"\n                          uib-tooltip="Show histogram" tooltip-class="nowrap"\n                          tooltip-placement="right" tooltip-animation="false" tooltip-popup-delay="500"\n                          tooltip-trigger="mouseenter">\n                        <i class="fa fa-fw fa-bar-chart fa-stack-1x"></i>\n                    </span>\n                </div>\n                <div class="categoryCell">\n                    <st-toggle-visibility ng-if="derivedLayer.viewState.isOnMap"\n                                          visible="derivedLayer.viewState.toggledOn"\n                                          toggle="toggleVisibility(derivedLayer)"></st-toggle-visibility>\n                </div>\n                <div class="categoryCell" style="width:100%">\n                    <input type="text"\n                           ng-model="derivedLayer.title"\n                           ng-change="updateHistogramTitle(derivedLayer)"\n                           class="form-control input-xs"\n                           style="width:100%;">\n                </div>\n                <div class="categoryCell">\n                    <span class="btn action-btn fa-stack toggleButton"\n                          ng-class="{active: !derivedLayer.viewState.isDraggable}"\n                          ng-click="toggleDraggable(derivedLayer)"\n                          uib-tooltip="{{derivedLayer.draggableTooltip}}" tooltip-class="nowrap"\n                          tooltip-placement="left" tooltip-animation="false" tooltip-popup-delay="500"\n                          tooltip-trigger="mouseenter">\n                        <i class="fa fa-fw fa-thumb-tack fa-stack-1x"></i>\n                    </span>\n                </div>\n                <div class="categoryCell" style="text-align:right;">\n                    <ccri-angular-utils-close-btn\n                          ng-if="derivedLayer.viewState.isRemovable"\n                          ng-click="removeLayer(gsLayer, derivedLayer)">\n                    </ccir-angular-utils-close-btn>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n');
}]),angular.module("histogram/geo/ol3/layers/histostyleview.tpl.html",[]).run(["$templateCache",function(a){a.put("histogram/geo/ol3/layers/histostyleview.tpl.html",'<div style="padding:4px;">\n    <ui-include src="\'core/geo/ol3/layers/layer-fragments.tpl.html\'" fragment="\'.visibilityName\'"></ui-include>\n    <ui-include src="\'core/geo/ol3/layers/layer-fragments.tpl.html\'" fragment="\'.opacitySlider\'"></ui-include>\n    <div class="layerStyleRow">\n        <div class="cell">Color</div>\n        <div class="cell">\n            <span class="fa fa-lg fa-square clickable colorpickerSquare"\n                  ng-style="{color: derivedLayer.viewState.fillColor}"\n                  colorpicker colorpicker-position="bottom"\n                  ng-model="derivedLayer.viewState.fillColor"\n                  ng-change="setFillColor(derivedLayer.viewState.fillColor)"\n                  uib-tooltip="Change color" tooltip-class="nowrap"\n                  tooltip-placement="right" tooltip-animation="false" tooltip-popup-delay="500"\n                  tooltip-trigger="mouseenter">\n            </span>\n        </div>\n    </div>\n</div>\n')}]),angular.module("histogram/popup/container.tpl.html",[]).run(["$templateCache",function(a){a.put("histogram/popup/container.tpl.html",'<div class="{{histId}}-container" ng-class="{\'ng-hide\': histogram.viewState.isWizardInProgress}">\n    <st-histogram-popup id="{{histId}}-popup" style="z-index:92;"></st-histogram-popup>\n</div>\n')}]),angular.module("histogram/popup/popup.tpl.html",[]).run(["$templateCache",function(a){a.put("histogram/popup/popup.tpl.html",'<div class="histogramPopupContainer popupFillSpace"\n     ng-mouseover="highlightLayer(histogram.layerId)"\n     ng-mouseleave="unhighlightLayer(histogram.layerId)"\n     ng-mousedown="focus()">\n    <div style="padding:0 4px;">\n        <div class="vertically-buffered labeled-wide-field">\n            <span class="field-label">\n                Time Range:\n            </span>\n            <span class="field">\n                <st-date-range\n                    start-date="histogram.sDateStr" sep="--" end-date="histogram.eDateStr"\n                    moment-time-format="HH:mm[Z]"\n                ></st-date-range>\n                <span class="pull-right">\n                    <span class="btn btn-default fa-stack toggleButton"\n                          style="cursor: default;">\n                        <i class="fa fa-fw fa-circle-o-notch fa-stack-1x"\n                           ng-class="{\'fa-spin\': histogram.viewState.isLoading}"\n                           ng-style="{\'visibility\': histogram.viewState.isLoading ? \'visible\' : \'hidden\'}">\n                        </i>\n                    </span>\n                    <span class="btn btn-default fa-stack toggleButton"\n                          ng-click="histogram.dataQuery(histogram)"\n                          uib-tooltip="Add selected bars as a layer" tooltip-class="nowrap"\n                          tooltip-placement="bottom-right" tooltip-animation="false" tooltip-popup-delay="500"\n                          tooltip-trigger="mouseenter">\n                        <i class="fa fa-fw ccri-icon ccri-icon-layers fa-stack-1x"\n                          style="line-height:inherit;"></i>\n                    </span>\n                    <span class="btn btn-default fa-stack toggleButton"\n                          ng-click="histogram.reset(histogram)"\n                          uib-tooltip="Reset view" tooltip-class="nowrap"\n                          tooltip-placement="bottom-right" tooltip-animation="false" tooltip-popup-delay="500"\n                          tooltip-trigger="mouseenter">\n                        <i class="fa fa-fw fa-reply fa-stack-1x"></i>\n                    </span>\n                    <ccri-angular-utils-clipboard-copy\n                      data-clipboard-text="{{histogram.query.params.originalQuery.params.cqlBounds}}"\n                      class="btn btn-default fa-stack toggleButton clickable"\n                      uib-tooltip="Copy Area Coordinates to clipboard"\n                      tooltip-class="nowrap"\n                      tooltip-placement="bottom-right"\n                      tooltip-animation="true"\n                      tooltip-popup-delay="500"\n                      tooltip-trigger="mouseenter">\n                        <i class="fa fa-clipboard fa-stack-1x"></i>\n                    </ccri-angular-utils-clipboard-copy>\n                    <span class="btn btn-default fa-stack toggleButton"\n                          ng-click="histogram.toggleBinOptions(histogram)"\n                          uib-tooltip="Bin options" tooltip-class="nowrap"\n                          tooltip-placement="bottom-right" tooltip-animation="false" tooltip-popup-delay="500"\n                          tooltip-trigger="mouseenter">\n                        <i class="fa fa-fw fa-cog fa-stack-1x"></i>\n                    </span>\n                </span>\n            </span>\n        </div>\n        <div class="vertically-buffered">\n            <div class="labeled-wide-field">\n                <span class="field-label">CQL:</span>\n                <span class="field">\n                    <div class="labeled-wide-custom">\n                        <span class="field" style="padding-right:6px;">\n                            <form ng-submit="histogram.updateHistogram(histogram.layerId)">\n                                <input type="text"\n                                       ng-model="histogram.query.params.cql"\n                                       style="width:100%;"\n                                       placeholder="Enter CQL filter">\n                            </form>\n                       </span>\n                        <span style="padding-right:4px;">\n                            <span class="field-label">Bins:</span>\n                                <span class="field"\n                                      ng-if="histogram.type === \'int\' || histogram.type === \'number\' || histogram.type === \'date-time\'">\n                                    <ccri-angular-utils-typeahead\n                                        ng-model="histogram.nBinsChoice"\n                                        ccri-angular-utils-typeahead-options="value for value in histogram.nBinsChoices"\n                                        typeahead-append-to-body="false"\n                                        typeahead-editable="true"\n                                        typeahead-min-length="0"\n                                        typeahead-wait-ms="0"\n                                        typeahead-focus-on-select="true"\n                                        typeahead-select-on-exact="false"\n                                        ccri-angular-utils-change="histogram.changedBins(histogram)">\n                                    </ccri-angular-utils-typeahead>\n                                </span>\n                                <span class="field"\n                                      ng-if="histogram.type === \'string\'">\n                                    <input ng-model="histogram.nBinsChoice"\n                                           style="width:45px;background-color:transparent;"\n                                           disabled>\n                                </span>\n                            <span>\n                                <span class="field-label" style="padding-left:4px;">y-scale:</span>\n                                <ccri-angular-utils-select\n                                        ng-model="histogram.yScale"\n                                        from-list="histogram.yScaleChoices"\n                                        ng-change="histogram.rebin(histogram)"></ccri-angular-utils-select>\n                            </span>\n                        </span>\n                    </div>\n                </span>\n            </div>\n        </div>\n        <div class="labeled-wide-field" style="margin-top:4px;">\n            <span class="field-label" style="visibility:{{histogram.showBinOptions}}">Min:</span>\n            <span class="field">\n                <span style="visibility:{{histogram.showBinOptions}}">\n                    <input type="number" step="1"\n                           style="width:40px;"\n                           ng-model="histogram.minBin"\n                           ccri-angular-utils-change="histogram.rebin(histogram)">\n                    <span class="btn btn-default fa-stack toggleButton"\n                          ng-click="histogram.stepLeft(histogram)"\n                          uib-tooltip="Step left" tooltip-class="nowrap"\n                          tooltip-placement="bottom-right" tooltip-animation="false" tooltip-popup-delay="500"\n                          tooltip-trigger="mouseenter">\n                        <i class="fa fa-fw fa-arrow-left fa-stack-1x"></i>\n                    </span>\n                    <span class="btn btn-default fa-stack toggleButton"\n                          ng-click="histogram.stepRight(histogram)"\n                          uib-tooltip="Step right" tooltip-class="nowrap"\n                          tooltip-placement="bottom-right" tooltip-animation="false" tooltip-popup-delay="500"\n                          tooltip-trigger="mouseenter">\n                        <i class="fa fa-fw fa-arrow-right fa-stack-1x"></i>\n                    </span>\n                    <span class="field-label">Max:</span>\n                    <span class="field">\n                      <input type="number" step="1"\n                             style="width:40px;"\n                             ng-model="histogram.maxBin"\n                             ccri-angular-utils-change="histogram.rebin(histogram)">\n                    </span>\n                    <span class="btn btn-default fa-stack toggleButton"\n                          ng-click="histogram.keepView = !histogram.keepView"\n                          style="margin-top:1px;">\n                        <i class="fa fa-fw clickable fa-check-square-o fa-stack-1x"\n                           ng-class="histogram.keepView ? \'fa-check-square-o\' : \'fa-square-o\'"></i>\n                    </span>\n                    <span class="field-label" style="margin:-5px;">Keep min/max</span>\n                    <ccri-list-view-components-sort\n                        ng-if="histogram.type === \'string\'"\n                        class="pull-right"\n                        fields="histogram.fieldList"\n                        sort="histogram.sortList"\n                        sort-fields="histogram.sortFields"\n                        sort-order="histogram.sortOrders"\n                    ></ccri-list-view-components-sort>\n                </span>\n            </span>\n        </div>\n    </div>\n    <div class="vertically-buffered" style="height:82%">\n        <div id="{{histId}}"\n             class="histogramViz"\n             ng-mousedown="$event.stopPropagation()"\n             uib-tooltip-html="\'CTRL + click to select bars and show on map<br>SHIFT + click to select range\'" tooltip-class="wrap custom-tooltip-color"\n             tooltip-placement="bottom" tooltip-animation="false" tooltip-popup-delay="800"\n             tooltip-trigger="mouseenter"></div>\n    </div>\n</div>\n')}]),angular.module("histogram/wizard/templates/options.tpl.html",[]).run(["$templateCache",function(a){a.put("histogram/wizard/templates/options.tpl.html",'<ng-form name="wizardForm">\n    <p class="vertically-buffered">\n        Building histogram of <b>{{::query.params.attribute.name}}</b> for <b>{{::query.layerData.currentLayer.Title}}</b>\n    </p>\n     <div class="vertically-buffered labeled-wide-field">\n        <span class="field-label">Additional filter:</span>\n        <span class="field">\n            <ccri-angular-utils-typeahead\n                ng-model="query.params.cql"\n                memory-num="5"\n                localstorage-prefix="{{::query.layerData.currentLayer.Title}}.cql"\n                placeholder="CQL filter"\n                typeahead-editable="true"\n            ></ccri-angular-utils-typeahead>\n        </span>\n    </div>\n    <div class="vertically-buffered" ng-switch="query.featureTypeData">\n        <div ng-switch-when="unavailable" class="alert alert-warning">\n            <i class="fa fa-warning"></i> There is no feature type description for this layer.\n        </div>\n        <div ng-switch-default>\n            <section class="vertically-buffered section-boxed"\n                     ng-class="{\'ng-hide\': query.featureTypeData === \'unavailable\'}"\n                     ng-repeat="featureType in query.featureTypeData.featureTypes">\n                <div class="section-boxed-top">\n                    Properties for <strong>{{::query.layerData.currentLayer.Title}}</strong>\n                </div>\n                <div class="section-boxed-bottom">\n                    <table class="table-condensed">\n                        <tr ng-repeat="property in featureType.properties">\n                            <td>{{::property.name}}</td>\n                            <td><code>{{::property.localType}}</code></td>\n                        </tr>\n                    </table>\n                </div>\n            </section>\n        </div>\n    </div>\n    <p class="vertically-buffered" ng-class="{\'error-text\': wizardForm.nonDefaultName.$invalid}">\n        Give this query a meaningful name.\n    </p>\n    <div class="vertically-buffered labeled-wide-field">\n        <span class="field-descriptor text-right">Name:</span>\n        <input class="field-input" placeholder="Layer name"  ng-model="query.params.title" required>\n    </div>\n    <div class="vertically-buffered labeled-wide-field">\n        <span class="field-descriptor text-right">Color:</span>\n        <span class="colorpickerBtn"\n              ng-style="style"\n              style="margin-left:2px"\n              colorpicker colorpicker-position="bottom"\n              ng-model="style[\'background-color\']"\n              ccri-angular-utils-change="query.params.fillColor = style[\'background-color\']"></span>\n    </div>\n</ng-form>\n')}]),angular.module("histogram/wizard/templates/source.tpl.html",[]).run(["$templateCache",function(a){a.put("histogram/wizard/templates/source.tpl.html",'<ng-form name="wizardForm" class="AsHistoricalWizard">\n        <st-wiz-section>\n            <div class="buf-lg-pt">\n                <div class="flex-row flex-align-items-center buf-lg-mb">\n                    <span class="field-descriptor text-right buf-lg-mr">Data Source:</span>\n                    <span class="field-input">\n                        <div class="form-control input-xs" style="font-size:12px;">\n                            {{::query.layerData.currentLayer.Title}}\n                        </div>\n                    </span>\n                </div>\n            </div>\n            <div class="buf-lg-pb">\n                <div class="flex-row flex-align-items-center buf-xs-mt"\n                     ng-class="{\'ng-hide\': !query.layerData.currentLayer}">\n                    <span class="field-descriptor text-right buf-lg-mr">Attribute:</span>\n                    <span class="field-input">\n                        <ccri-angular-utils-select\n                            ng-model="query.params.attribute"\n                            from-list="featureAttributes"\n                            label-fn="labelFn"\n                            placeholder="Select attribute"\n                            empty-message="None available"\n                            select-disabled="!featureAttributes"\n                            memory-num="4"\n                            localstorage-prefix="{{::query.layerData.currentLayer.Title}}.attribute"\n                            required\n                        ></ccri-angular-utils-select>\n                    </span>\n                </div>\n                <div class="flex-row flex-align-items-center buf-xs-mt"\n                     ng-if="query.layerData.currentLayer">\n                    <span class="field-descriptor text-right buf-lg-mr">Time:</span>\n                    <span class="field-input">\n                        <ccri-angular-utils-select\n                            ng-model="query.params.dtgField"\n                            from-list="timeAttributes"\n                            label-fn="labelFn"\n                            filter-fn="dateTimeFilter"\n                            placeholder="Select time field"\n                            empty-message="None available"\n                            select-disabled="!timeAttributes"\n                            required\n                        ></ccri-angular-utils-select>\n                    </span>\n                </div>\n                <div class="flex-row flex-align-items-center buf-xs-mt"\n                     ng-if="query.layerData.currentLayer">\n                    <span class="field-descriptor text-right buf-lg-mr">Geometry:</span>\n                    <span class="field-input">\n                        <ccri-angular-utils-select\n                            ng-model="query.params.geomField"\n                            from-list="featureAttributes"\n                            label-fn="labelFn"\n                            filter-fn="geomFilter"\n                            placeholder="Select geom field"\n                            empty-message="None available"\n                            select-disabled="!featureAttributes"\n                            required\n                        ></ccri-angular-utils-select>\n                    </span>\n                </div>\n            </div>\n        </st-wiz-section>\n        <div ng-if="showTimeRange">\n            <st-wiz-section>\n                <div class="buf-lg-pt">\n                    <st-wiz-timerange></st-wiz-timerange>\n                </div>\n            </st-wiz-section>\n        </div>\n</ng-form>\n')}]),angular.module("mediator/air-tfi/toolbar.tpl.html",[]).run(["$templateCache",function(a){a.put("mediator/air-tfi/toolbar.tpl.html",'<div ng-if="totalLength > 200">\n    <i class="fa fa-warning"></i>&nbsp;\n        List/search limited to <strong>200</strong> of\n        <strong>{{totalLength}}</strong> available items.\n</div>\n<!-- Checkbox for filtering list to items visible in the map view extent -->\n<span class="clickable" ng-click="tb.toggleExtentFiltering(!tb.extentFilter.enabled)">\n    <i class="fa fa-fw" ng-class="tb.extentFilter.enabled ? \'fa-check-square-o\' : \'fa-square-o\'"></i>\n    Only list items visible within map extent\n</span>\n\n<div class="clickable" ng-click="tb.toggleTheaterFilter()">\n    <i class="fa fa-fw" ng-class="tb.theaterFilterEnabled ? \'fa-check-square-o\' : \'fa-square-o\'"></i>\n    Only list items in theater and network\n</div>\n')}]),angular.module("mediator/savedqueries-timelapse/sourcetimerange.tpl.html",[]).run(["$templateCache",function(a){a.put("mediator/savedqueries-timelapse/sourcetimerange.tpl.html",'<ng-form name="wizardForm" class="AsHistoricalWizard">\n    <div class="section section--buffer-next">\n        <!-- Metadata -->\n        <div class="info-row">\n            <span class="text-faded">Name: {{ ::query.originalTitle }}</span>\n        </div>\n        <div class="info-row">\n            <span class="text-faded">DataSource: {{ query.originalLayerTitle }}</span>\n        </div>\n        <div class="info-row info-row--buffer-next">\n            <span class="info-descriptor text-faded">Filter:&nbsp;</span>\n            <div class="info-content"\n                 ng-class="expandedCqlCustom ? \'info-content--expanded\' : \'info-content--collapsed\';"\n                 ng-init="expandedCqlCustom = false;"\n                 ng-click="expandedCqlCustom = !expandedCqlCustom;"\n                 ng-if="query.cqlCustom">\n                {{ ::query.cqlCustom }}\n            </div>\n            <div class="info-content" ng-if="!query.cqlCustom">None</div>\n            <span class="info-unit">&nbsp;</span>\n        </div>\n\n        <!-- Data Source -->\n        <div class="field-row field-row--buffer-prev field-row--buffer-next">\n            <span class="field-descriptor text-right buf-lg-mr">Data Source:</span>\n            <span class="field-input">\n                <ccri-angular-utils-select ng-model="query.layerData.currentLayer"\n                                           ng-change="query.getFeatureTypeDescription()"\n                                           from-list="query.layerData.layers"\n                                           label-fn="datasourceLabelFn"\n                                           placeholder="Select a Data Source"\n                                           empty-message="None available"\n                ></ccri-angular-utils-select>\n            </span>\n            <span class="field-unit">&nbsp;</span>\n        </div>\n        <input type="hidden" name="dataSource" ng-model="query.layerData.currentLayer" required>\n\n        <st-wiz-data-props query="query"\n                           ng-if="query.type===\'time-lapse\'"\n                           ng-class="{\'ng-hide\': !query.layerData.currentLayer}"\n        ></st-wiz-data-props>\n\n        <!-- dtg validation  -->\n        <select class="ng-hide"\n                ng-if="query.type===\'time-lapse\'"\n                ng-model="query.params.startDtgField"\n                ng-required="query.isLineQuery()">\n        </select>\n        <select class="ng-hide"\n                ng-if="query.type===\'time-lapse\'"\n                ng-model="query.params.endDtgField"\n                ng-required="query.isLineQuery()">\n        </select>\n    </div>\n\n    <br ng-if="query.type===\'time-lapse\'">\n\n    <!-- Time Range selection -->\n    <div class="section" ng-if="query.type===\'time-lapse\'">\n        <st-wiz-timerange></st-wiz-timerange>\n    </div>\n\n</ng-form>\n')}]),angular.module("routeanalysis/results/popup.tpl.html",[]).run(["$templateCache",function(a){a.put("routeanalysis/results/popup.tpl.html",'<div class="routeanalysisPopupContainer"\n     style="cursor:default;"\n     ng-mousedown="focus()">\n    <div class="routeanalysisPopupHeader">\n        <i class="fa fa-fw fa-line-chart"></i>\n        <span><b>{{routeanalysis.title | characters:60:true}}</b></span>\n        <span class="btn btn-default fa-stack toggleButton pull-right"\n              ng-click="routeanalysis.closePopup(routeanalysis)"\n              ng-style="{\'background-color\': routeanalysis.arrowColor}"\n              uib-tooltip="Hide route analysis" tooltip-class="nowrap"\n              tooltip-placement="left" tooltip-animation="false" tooltip-popup-delay="500"\n              tooltip-trigger="mouseenter">\n            <i class="fa fa-fw fa-chevron-down fa-stack-1x" style="color:white;"></i>\n        </span>\n    </div>\n    <div id="{{routeId}}"\n         class="routeanalysisViz"\n         ng-mousedown="$event.stopPropagation()"></div>\n</div>\n')}]),angular.module("routeanalysis/runner/container.tpl.html",[]).run(["$templateCache",function(a){a.put("routeanalysis/runner/container.tpl.html",'<div class="{{routeId}}-container" ng-class="{\'ng-hide\': routeanalysis.viewState.isWizardInProgress}">\n    <st-route-analysis-popup id="{{routeId}}-popup" style="z-index:92;"></st-route-analysis-popup>\n</div>\n')}]),angular.module("routeanalysis/wizard/templates/chartOptions.tpl.html",[]).run(["$templateCache",function(a){a.put("routeanalysis/wizard/templates/chartOptions.tpl.html",'<ng-form name="wizardForm">\n    <p>\n        Set additional options for route analysis\n    </p>\n\n    <div style="text-align:center;">\n        <table style="border-collapse:separate;border-spacing:2px;margin:5px auto;">\n            <tr>\n                <td style="padding-top:2px"><label>Name: </label></td>\n                <td><input type="text" class="form-control" ng-model="query.derivedLayer.title" required></textarea></td>\n            </tr>\n            <tr>\n                <td style="padding-top:2px; line-height:60%"><label>Maximum degrees per pixel: </label><br>\n                    <label style="font-size:75%; font-style: italic">Only used when up-sampling</label></td>\n                <td><input type="text" class="form-control" ng-model="resolution" required></textarea></td>\n            </tr>\n            <tr>\n                <td style="padding-top:2px"><label>Y-Axis Label: </label></td>\n                <td><input type="text" class="form-control" ng-model="yAxis" required></textarea></td>\n            </tr>\n            <tr>\n                <td style="padding-top:2px"><label>Color: </label></td>\n                <td style="text-align: left"><span class="colorpickerBtn" ng-style="style"\n                          style="margin-left:2px"\n                          colorpicker colorpicker-position="bottom"\n                          ng-model="style[\'background-color\']"\n                          ccri-angular-utils-change="query.params.fillColor = style[\'background-color\']"></span>\n                </td>\n            </tr>\n        </table>\n    </div>\n\n</ng-form>\n')}]),angular.module("routeanalysis/wizard/templates/data.tpl.html",[]).run(["$templateCache",function(a){a.put("routeanalysis/wizard/templates/data.tpl.html",'<ng-form name="wizardForm">\n    <div ng-class="{\'ng-hide\': (layers | lodash:\'isUndefined\')}"\n         style="display:inline-block; max-height: 500px; overflow-y: auto; margin:5px auto;\n         min-width: 300px; max-width: 500px; overflow-x: auto;">\n        <i ng-show="layers | lodash:\'isEmpty\'">No datasources found.</i>\n        <i ng-show="loadError">Error.</i>\n        <div ng-repeat="(workspace, layers) in layers">\n            <div class="categoryCell"><b>{{::workspace}}</b></div>\n            <div ng-repeat="layer in layers"  class="categoryGrouping categoryIndent">\n                <i class="fa fa-fw" ng-class="layer.isSelected ? \'fa-circle\' : \'fa-circle-o\'"\n                   ng-click="toggleLayer(layer)">\n                </i>\n                {{layer.Title || layer.Name | characters:60:true}}\n            </div>\n        </div>\n    </div>\n    <div style="display: none"><input type="text" class="form-control" ng-model="dataSource" required></div>\n    <i ng-class="{\'ng-hide\': (layers | lodash:\'isObject\')}" class="fa fa-spinner fa-spin fa-lg"></i>\n</ng-form>\n')}]),angular.module("static/geo/category.tpl.html",[]).run(["$templateCache",function(a){a.put("static/geo/category.tpl.html",'<div>\n    <div ng-class="{\'ng-hide\': (workspaces | lodash:\'isEmpty\')}" class="categoryGrouping">\n        <div ng-repeat="workspace in workspaces | lodash:\'keys\' | orderBy" class="categoryGrouping">\n            <div ng-repeat="layer in workspaces[workspace] | orderBy:\'Name\'" class="categoryGrouping">\n                <div class="categoryCell">\n                    <i>{{::layer.Title || layer.Name | characters:35:true}}</i>\n                </div>\n                <div class="categoryCell">\n                    <span class="btn btn-default fa-stack toggleButton"\n                          ng-if="layer.queryable"\n                          ng-click="launchLayerFilterWizard(layer)"\n                          uib-tooltip="Add layer" tooltip-class="nowrap"\n                          tooltip-placement="right" tooltip-animation="false" tooltip-popup-delay="500"\n                          tooltip-trigger="mouseenter">\n                        <i class="fa fa-fw fa-plus fa-stack-1x text-primary"></i>\n                    </span>\n                </div>\n\n                <div ng-repeat="filterLayer in layer.filterLayers" class="categoryGrouping">\n                    <div class="flex-row">\n                        <div class="categoryCell">\n                            <div ng-if="layer.queryable && filterLayer.viewState.markerStyle !== \'Heatmap\'" class="legendIconContainer cropIcon" style="line-height:0px">\n                                <img ng-src="{{getIconImgSrc(filterLayer)}}"/>\n                            </div>\n                            <div ng-if="filterLayer.viewState.markerStyle === \'Heatmap\'"\n                                 class="heatmap"\n                                 style="vertical-align:baseline;margin-left:-4px;"\n                                 ng-style="getHeatMapGradient(filterLayer.viewState.colorRamp)">\n                            </div>\n                        </div>\n                        <div class="categoryCell" style="padding-right:2px;">\n                            <st-toggle-map-layer style="vertical-align:text-top;"\n                                                 visible="filterLayer.viewState.isOnMap"\n                                                 loading="filterLayer.viewState.isLoading"\n                                                 toggle="toggleLayer(layer, filterLayer)"></st-toggle-map-layer>\n                        </div>\n                        <div class="categoryCell"\n                             ng-style="{\'visibility\': filterLayer.viewState.isOnMap ? \'visible\' : \'hidden\'}">\n                            <st-toggle-visibility visible="filterLayer.viewState.toggledOn"\n                                                  toggle="toggleVisibility(filterLayer)"></st-toggle-visibility>\n                        </div>\n                        <div class="ellipsis categoryCell"\n                             style="width:100%;"\n                             uib-tooltip="{{::filterLayer.title}}"\n                             tooltip-class="wrap"\n                             tooltip-placement="bottom-left"\n                             tooltip-animation="true"\n                             tooltip-popup-delay="600"\n                             tooltip-trigger="mouseenter"\n                             tooltip-enable="false"\n                             ccri-angular-utils-tooltip-overflow="watch">\n                            {{::filterLayer.title}}\n                        </div>\n                        <div class="categoryCell" style="text-align:right;">\n                            <ccri-angular-utils-close-btn\n                                  ng-if="filterLayer.viewState.isRemovable"\n                                  ng-click="removeLayer(layer, filterLayer)"\n                                  style="margin-right:3px">\n                            </ccri-angular-utils-close-btn>\n                        </div>\n                    </div>\n                    <div ng-if="::filterLayer.cqlFilter">\n                        <div class="categoryIndent" style="padding-right:5px;">\n                            <textarea readonly\n                                      ng-model="::filterLayer.cqlFilter"\n                                      class="form-control input-xs"\n                                      style="resize:vertical;height:2em;">\n                            </textarea>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n')}]),angular.module("static/geo/staticstyleview.tpl.html",[]).run(["$templateCache",function(a){a.put("static/geo/staticstyleview.tpl.html",'<div style="padding:4px;">\n    <ui-include src="\'core/geo/ol3/layers/layer-fragments.tpl.html\'" fragment="\'.visibilityName\'"></ui-include>\n    <ui-include src="\'core/geo/ol3/layers/layer-fragments.tpl.html\'" fragment="\'.opacitySlider\'"></ui-include>\n    <div class="layerStyleRow">\n        <div style="float:left; margin: 5px 5px 0 0;">\n            <div class="cropIcon">\n                <img ng-src="{{getIconImgSrc(filterLayer)}}"\n                    style="padding-right:5px; vertical-align:sub;"\n                    ng-if="filterLayer.queryable && filterLayer.viewState.markerStyle !== \'Heatmap\'"/>\n                <div ng-if="filterLayer.viewState.markerStyle === \'Heatmap\'"\n                    class="heatmap"\n                    style="vertical-align:middle;padding-right:5px;"\n                    ng-style="getHeatMapGradient(filterLayer.viewState.colorRamp)">\n                </div>\n            </div>\n        </div>\n        <div class="cell">Style</div>\n        <div class="cell">\n            <ccri-angular-utils-select class="input-xs-select"\n                    style="vertical-align:baseline;margin-bottom:5px;margin-top:5px;width:150px;"\n                    ng-model="filterLayer.viewState.markerStyle"\n                    from-list="markerStyles"\n                    ng-change="markerStyleChanged(filterLayer)"\n                    dropdown-style="{\'font-size\': \'11px\', \'padding-top\': \'2px\'}">\n            </ccri-angular-utils-select>\n        </div>\n        <div class="cell" ng-if="filterLayer.viewState.markerStyle === \'Heatmap\'">\n            <ccri-angular-utils-select class="input-xs-select"\n                                       style="vertical-align:baseline;margin-bottom:5px;margin-top:5px;width:75px;"\n                                       ng-model="filterLayer.viewState.colorRamp"\n                                       from-list="colorRamps"\n                                       ng-change="colorRampChanged(filterLayer)"\n                                       dropdown-style="{\'font-size\': \'11px\', \'padding-top\': \'2px\'}">\n            </ccri-angular-utils-select>\n        </div>\n    </div>\n    <div class="layerStyleRow">\n        <div class="cell" ng-if="filterLayer.viewState.markerStyle === \'Attribute\'">\n            <ccri-angular-utils-select class="input-xs-select"\n                    style="margin-bottom:6px;margin-top:4px;width:180px;"\n                    ng-model="filterLayer.viewState.hashAttr"\n                    from-list="featureAttributes"\n                    filter-fn="attrFilterFn" label-fn="labelFn"\n                    ng-change="hashAttrChanged(filterLayer)"\n                    dropdown-style="{\'font-size\': \'11px\', \'padding-top\': \'2px\'}">\n            </ccri-angular-utils-select>\n        </div>\n        <div class="cell" ng-if="filterLayer.viewState.markerStyle === \'Data Points\' || filterLayer.viewState.markerStyle === \'stealth_dataPoints\'">\n            <ccri-angular-utils-select class="input-xs-select"\n                    style="vertical-align:baseline;margin-top:5px;width:75px;"\n                    ng-model="filterLayer.viewState.markerShape"\n                    from-list="markerShapes"\n                    ng-change="markerShapeChanged(filterLayer)"\n                    dropdown-style="{\'font-size\': \'11px\', \'padding-top\': \'2px\'}">\n            </ccri-angular-utils-select>\n        </div>\n        <div class="cell" ng-if="filterLayer.viewState.markerStyle === \'Attribute\'" style="padding-left:5px;">Size</div>\n        <div class="cell" ng-if="filterLayer.viewState.markerStyle === \'Attribute\'">\n            <input type="number" step="1"\n                   class="form-control input-xs"\n                   ng-model="filterLayer.viewState.size"\n                   ccri-angular-utils-change="sizeChanged(filterLayer, filterLayer.viewState.size)"\n                   min="1" max="100">\n        </div>\n        <div class="cell" style="vertical-align:bottom;" ng-if="filterLayer.viewState.markerStyle === \'Data Points\' || filterLayer.viewState.markerStyle === \'stealth_dataPoints\'">\n            <span class=""\n                  style="margin:0 2px 0 15px; width:16px; height:16px; cursor:default; border-radius:3px; border:solid 1px #808080; display:inline-block;"\n                  ng-style="{background: filterLayer.viewState.fillColor}"\n                  >\n            </span>\n            <i class="fa fa-lg fa-eyedropper"\n                  style="cursor:pointer; display:inline-block; vertical-align:super;"\n                  colorpicker colorpicker-position="bottom"\n                  ng-model="filterLayer.viewState.fillColor"\n                  ng-change="setFillColor(filterLayer)"\n                  uib-tooltip="Change color" tooltip-class="nowrap"\n                  tooltip-placement="left" tooltip-animation="false" tooltip-popup-delay="500"\n                  tooltip-trigger="mouseenter"\n            />\n        </div>\n    </div>\n    <div class="radiusSlider flex-row flex-align-items-center layerStyleRow"\n         ng-if="filterLayer.viewState.markerStyle === \'Heatmap\'"\n    >\n        <div class="rangeSliderStartLabel">Radius</div>\n        <div class="flex-1 horizontally-buffered">\n            <div ui-slider="{updateOn: \'slidestop\'}"\n                 ng-model="filterLayer.viewState.radiusPixels"\n                 ng-change="heatmapRadiusChanged(filterLayer, filterLayer.viewState.radiusPixels)"\n                 min="{{radiusMin}}"\n                 max="{{radiusMax}}"\n                 step="1"\n            >\n            </div>\n        </div>\n        <div class="rangeSliderEndLabel">\n            <input class="radiusSliderInput"\n                   type="number"\n                   step="1"\n                   min="{{radiusMin}}"\n                   max="{{radiusMax}}"\n                   ng-model="filterLayer.viewState.radiusPixels"\n                   ng-blur="heatmapRadiusChanged(filterLayer, filterLayer.viewState.radiusPixels)"\n                   ccri-angular-utils-change="heatmapRadiusChanged(filterLayer, filterLayer.viewState.radiusPixels)"\n                   ccri-angular-utils-change-delay="1000"\n                   ccri-angular-utils-keypress="heatmapRadiusChanged(filterLayer, filterLayer.viewState.radiusPixels)"\n                   title="Radius (px)"\n            >&nbsp;px\n        </div>\n    </div>\n</div>\n');
}]),angular.module("static/wizard/templates/options.tpl.html",[]).run(["$templateCache",function(a){a.put("static/wizard/templates/options.tpl.html",'<ng-form name="staticOptionsForm">\n    <div class="AreaDefinitionWizard">\n        <div class="vertically-buffered labeled-wide-field">\n            <span class="field-label">Additional filter:</span>\n            <span class="field">\n                <ccri-angular-utils-typeahead\n                    ng-model="query.params.cql"\n                    memory-num="5"\n                    localstorage-prefix="{{::layer.Title}}.cql"\n                    placeholder="CQL filter"\n                    typeahead-editable="true"\n                ></ccri-angular-utils-typeahead>\n            </span>\n        </div>\n        <div class="vertically-buffered" ng-switch="query.featureTypeData">\n            <div ng-switch-when="unavailable" class="alert alert-warning">\n                <i class="fa fa-warning"></i> There is no feature type description for this layer.\n            </div>\n            <div ng-switch-default>\n                <section class="vertically-buffered section-boxed" ng-class="{\'ng-hide\': query.featureTypeData === \'unavailable\'}"\n                    ng-repeat="featureType in query.featureTypeData.featureTypes">\n                    <div class="section-boxed-top">\n                        Properties for <strong>{{::layer.Title}}</strong>\n                    </div>\n                    <div class="section-boxed-bottom">\n                        <table class="table-condensed">\n                            <tr ng-repeat="property in featureType.properties">\n                                <td>{{::property.name }}</td>\n                                <td><code>{{::property.localType }}</code></td>\n                            </tr>\n                        </table>\n                    </div>\n                </section>\n            </div>\n        </div>\n        <div class="flex-row flex-align-items-center buf-sm-mt" style="margin-left:-10px;">\n            <span class="field-label">\n                <div class="cropIcon" style="display:inline-block; margin:-2px 2px 0 0;">\n                    <img ng-src="{{getIconImgSrc(layer)}}" ng-if="layer.queryable && query.params.markerStyle !== \'Heatmap\'" style="width: 16px"/>\n                    <div ng-if="query.params.markerStyle === \'Heatmap\'"\n                        class="heatmap"\n                        style="vertical-align:middle;"\n                        ng-style="getHeatMapGradient(query.params.colorRamp)">\n                    </div>\n                </div>\n                Style:\n            </span>\n            <ccri-angular-utils-select class="field"\n                    style="width:150px;vertical-align:baseline;margin-left:4px"\n                    ng-model="query.params.markerStyle"\n                    from-list="markerStyles">\n            </ccri-angular-utils-select>\n        </div>\n\n        <div class="buf-lg-pt" style="margin-left:-10px;" ng-if="query.params.markerStyle === \'Data Points\' || query.params.markerStyle === \'stealth_dataPoints\'">\n            <div class="flex-row flex-align-items-center buf-sm-mt">\n                <span class="field-label">Marker:</span>\n                <ccri-angular-utils-select class="field"\n                        style="width:92px;vertical-align:baseline;margin-left:4px;margin-right:8px"\n                        ng-model="query.params.markerShape"\n                        from-list="markerShapes"></ccri-angular-utils-select>\n            </div>\n            <div class="flex-row flex-align-items-center buf-sm-mt">\n                <span class="field-label">Size:</span>\n                <input type="number" step="any"\n                    class="field"\n                    style="height:21px;width:25px;margin-left:4px;margin-right:8px"\n                    ng-model="query.params.size"\n                    min="1" max="100">\n            </div>\n            <div class="flex-row flex-align-items-center buf-sm-mt">\n                <span class="field-label">Color:</span>\n                <span class="colorpickerBtn" ng-style="style"\n                    style="margin-left:4px;width:16px;height:16px;border:1px solid #808080;border-radius:4px"\n                    colorpicker colorpicker-position="bottom"\n                    ng-model="style[\'background-color\']"\n                    ccri-angular-utils-change="query.params.fillColor = style[\'background-color\']">\n                </span>\n            </div>\n        </div>\n\n        <div class="buf-lg-pt" style="margin-left:-10px;" ng-if="query.params.markerStyle === \'Attribute\'">\n            <div class="flex-row flex-align-items-center buf-sm-mt">\n                <span class="field-label">Attribute:</span>\n                <ccri-angular-utils-select class="field"\n                        style="width:92px;vertical-align:top;margin-left:4px;margin-right:8px"\n                        ng-model="query.params.hashAttr"\n                        from-list="query.featureAttributes"\n                        filter-fn="attrFilterFn" label-fn="labelFn"></ccri-angular-utils-select>\n            </div>\n            <div class="flex-row flex-align-items-center buf-sm-mt">\n                <span class="field-label">Marker:</span>\n                <ccri-angular-utils-select class="field"\n                        style="width:92px;vertical-align:baseline;margin-left:4px;margin-right:8px"\n                        ng-model="query.params.markerShape"\n                        from-list="markerShapes"></ccri-angular-utils-select>\n\n            </div>\n            <div class="flex-row flex-align-items-center buf-sm-mt">\n                <span class="field-label">Size:</span>\n                <input type="number" step="any"\n                    class="field"\n                    style="height:21px;width:25px;margin-left:4px;margin-right:8px"\n                    ng-model="query.params.size"\n                    min="1" max="100">\n            </div>\n        </div>\n\n        <div class="buf-lg-pt" style="margin-left:-10px;" ng-if="query.params.markerStyle === \'Heatmap\'">\n            <div class="radiusSlider flex-row flex-align-items-center layerStyleRow">\n                <div class="field-label" style="font-size: 13px;">Radius:</div>\n                <div class="flex-1 horizontally-buffered">\n                    <div ui-slider\n                         ng-model="query.params.radiusPixels"\n                         min="{{radiusMin}}"\n                         max="{{radiusMax}}"\n                         step="1"\n                    >\n                    </div>\n                </div>\n                <div class="rangeSliderEndLabel">\n                    <input class="radiusSliderInput"\n                           type="number"\n                           step="1"\n                           min="{{radiusMin}}"\n                           max="{{radiusMax}}"\n                           ng-model="query.params.radiusPixels"\n                           title="Radius (px)"\n                    >&nbsp;px\n                </div>\n            </div>\n            <div class="flex-row flex-align-items-center buf-sm-mt">\n                <span class="field-label">Color Ramp:</span>\n                <ccri-angular-utils-select class="field"\n                        style="width:92px;vertical-align:baseline;margin-left:4px;margin-right:8px"\n                        ng-model="query.params.colorRamp"\n                        from-list="colorRamps"></ccri-angular-utils-select>\n            </div>\n        </div>\n\n        <div style="margin-left:-10px;">\n            <div class="flex-row flex-align-items-center buf-sm-mt" ng-if="query.params.markerStyle === \'Heatmap\'">\n                <span class="field-label">Static Heatmap:</span>\n                <span class="fa-stack field"\n                        ng-click="query.params.staticHeatmap = !query.params.staticHeatmap"\n                        style="margin-left:4px;margin-right:8px;width:30%">\n                    <i class="fa fa-fw clickable fa-check-square-o fa-stack-1x"\n                        ng-class="query.params.staticHeatmap ? \'fa-check-square-o\' : \'fa-square-o\'"\n                        style="text-align:left; margin:1px 0 0 1px"></i>\n                </span>\n            </div>\n            <div class="flex-row flex-align-items-center buf-sm-mt" ng-if="query.params.staticHeatmap">\n                <span class="field-label">Output Width:</span>\n                <input type="text" class="field" ng-model="query.params.outputWidth" style="margin-left:4px;margin-right:8px;width:30%" required>\n            </div>\n            <div class="flex-row flex-align-items-center buf-sm-mt" ng-if="query.params.staticHeatmap">\n                <span class="field-label">Output Height:</span>\n                <input type="text" class="field" ng-model="query.params.outputHeight" style="margin-left:4px;margin-right:8px;width:30%" required>\n            </div>\n        </div>\n\n        <p style="margin-top:20px;">Give this Data Layer a meaningful name.</p>\n        <div>\n            <span class="field-label">Name:</span>\n            <input type="text" class="field" placeholder="Layer name" ng-model="query.params.title" style="margin-left:4px;margin-right:8px" required>\n        </div>\n    </div>\n</ng-form>\n')}]),angular.module("static/wizard/templates/source.tpl.html",[]).run(["$templateCache",function(a){a.put("static/wizard/templates/source.tpl.html",'<ng-form name="staticSourceForm">\n    <div>\n        Identify important fields for layer: {{::(layer.Title || layer.Name)}}\n    </div>\n    <div class="buf-lg-pt">\n        <stealth-wizard-layer-props query="query" properties="layerProperties"></stealth-wizard-layer-props>\n    </div>\n</ng-form>\n')}]),angular.module("static/wizard/templates/spatialbounds.tpl.html",[]).run(["$templateCache",function(a){a.put("static/wizard/templates/spatialbounds.tpl.html",'<div class="AreaDefinitionWizard">\n    <div class="flex-row flex-justify-content-flex-end flex-align-items-center">\n        <span class="field-descriptor text-right buf-lg-mr">Select Area:</span>\n        <ccri-area-definition-drawtool-selector\n            feature-creator="featureCreator"\n            class="field-input"\n        ></ccri-area-definition-drawtool-selector>\n    </div>\n    <span ng-class="{\'ng-hide\' : !selectedTool}">\n        <ccri-area-definition-more-details-toggle class="flex-row flex-justify-content-flex-end"></ccri-area-definition-more-details-toggle>\n    </span>\n    <st-wiz-subsection>\n        <ccri-area-definition-tool-controls-switcher feature-creator="featureCreator" tool-controls="toolControlsConfig"></ccri-area-definition-tool-controls-switcher>\n        <st-wiz-cql-length ng-hide="!toolWasOpened"\n                           ng-model="cqlStats.finalCql.length"\n                           cql-maxlength="{{cqlStats.cqlMaxlength}}">\n        </st-wiz-cql-length>\n    </st-wiz-subsection>\n</div>\n')}]),angular.module("static/wizard/templates/timebounds.tpl.html",[]).run(["$templateCache",function(a){a.put("static/wizard/templates/timebounds.tpl.html",'<div class="text-faded buf-lg-mb">\n    Data available for time range:\n    <st-date-range class="text-faded"\n            start-date="query.timeData.minTime" end-date="query.timeData.maxTime"\n            moment-date-format="YYYY MMM DD" moment-time-format="HH:mm:ss"\n            value-placeholder="UNKNOWN" both-placeholder="UNKNOWN"\n    ></st-date-range>\n</div>\n<ccri-angular-utils-time-range-input start="query.params.startDtg" end="query.params.endDtg" no-time-range="query.params.noDtg"\n        localstorage-prefix="{{::storageKeyPrefix}}"\n        time-range-input-options="{\n            timeRequired: false,\n            startRequired: false,\n            endRequired: false,\n            maxDuration: query.timeData.maxTimeRangeMillis,\n            defaultRange: {\n                start: query.timeData.defaultStartDtg,\n                end: query.timeData.defaultEndDtg\n            },\n            shouldIntersectRange: {\n                start: query.timeData.minTime,\n                end: query.timeData.maxTime,\n                full: true\n            }\n        }"\n></ccri-angular-utils-time-range-input>\n')}]),angular.module("timelapse/controls/chart.tpl.html",[]).run(["$templateCache",function(a){a.put("timelapse/controls/chart.tpl.html",'<div class="popupFillSpace attributeProfile timelapse-chart-view flex-column"\n    uib-tooltip-html="\'CTRL + click to select multiple bars<br>SHIFT + click to select range\'"\n    tooltip-class="st-tooltip nowrap"\n    tooltip-placement="bottom" tooltip-animation="false" tooltip-popup-delay="0"\n>\n    <div class="header flex-row">\n        <ccri-angular-utils-checkbox ng-model="vm.isFilteringByView">\n            Filter by map extent\n        </ccri-angular-utils-checkbox>\n\n        <!-- Color by switcher -->\n        <div class="flex-1" style="margin-left: 20px">\n            <span>Color mode:&nbsp;</span>\n            <color-mode-switcher store="store"></color-mode-switcher>\n            <color-by-id-randomizer store="store"></color-by-id-randomizer>\n            <color-by-field-chooser store="store"></color-by-field-chooser>\n            <color-mode-single-color-chooser store="store"></color-mode-single-color-chooser>\n        </div>\n\n        <!-- Right-side buttons -->\n        <div class="button-list" style="flex: 0 0 auto">\n            <!-- Reset view -->\n            <span class="clickable"\n                    ng-click="onResetViewBtn()"\n                    uib-tooltip="Reset view"\n                    tooltip-class="st-tooltip nowrap"\n                    tooltip-placement="bottom-right"\n                    tooltip-animation="false"\n                    tooltip-popup-delay="200"\n            >\n                <i class="fa fa-arrows-alt"></i>\n            </span>\n            <!-- Clear selection -->\n            <span class="clickable"\n                    ng-click="onClearBtn()"\n                    uib-tooltip="Clear selection"\n                    tooltip-class="st-tooltip nowrap"\n                    tooltip-placement="bottom-right"\n                    tooltip-animation="false"\n                    tooltip-popup-delay="200"\n            >\n                <i class="ccri-icon ccri-icon-filter-1"></i>\n            </span>\n        </div>\n    </div>\n\n    <div class="flex-1 flex-row">\n        <div class="rotated-yaxis-container buf-lg-mt">\n            <div class="rotate-pivot">\n                <div style="display: inline-block; width: 100px">\n                    <ccri-angular-utils-select\n                            ng-model="countByProperty"\n                            from-list="countByProperties"\n                            label-fn="labelAttribute"\n                            ng-change="onCountByChanged()"\n                            vertically-oriented="true"\n                    ></ccri-angular-utils-select>\n                </div>\n            </div>\n        </div>\n        <st-plotly-bar-chart class="flex-1" style="position:relative;"\n            register-with="chartInitializer" selections-handler="selectionChanged"\n            loading="processing"\n        ></st-plotly-bar-chart>\n    </div>\n\n    <div class="text-center">\n        <div style="display:inline-block; width: 150px">\n            <ccri-angular-utils-select\n                    ng-model="groupByProperty"\n                    from-list="::properties"\n                    label-fn="labelAttribute"\n                    ng-change="onGroupByChanged()"\n            ></ccri-angular-utils-select>\n        </div>\n    </div>\n\n    <div class="loading-overlay" ng-class="{\'ng-hide\': !processing}">\n        <i class="fa fa-fw fa-stack-1x fa-circle-o-notch fa-spin"></i>\n    </div>\n    <div class="loading-overlay noselect"\n            ng-class="{\'ng-hide\': !waiting}"\n            style="width: auto; height: auto; margin-left: -135px;"\n    >\n        <span class="timelapse-chart-waiting-message noselect">\n            <i class="fa fa-pause"></i>&nbsp;\n            Pause or release time slider to update chart\n        </span>\n    </div>\n</div>\n')}]),angular.module("timelapse/controls/colorByFieldChooser.tpl.html",[]).run(["$templateCache",function(a){a.put("timelapse/controls/colorByFieldChooser.tpl.html",'<div class="colorByFieldChooser"\n        ng-class="{inactive: !(store.colorByFields && (store.getViewState().colorMode === 1 || store.getViewState().colorMode === 2))}">\n    <ccri-angular-utils-select\n            ng-model="store.colorByField"\n            from-list="store.colorByFields()"\n            label-fn="labelAttribute"\n            ccri-angular-utils-change="store.onColorByFieldChanged()"\n            uib-tooltip="Color by field" tooltip-class="nowrap"\n            tooltip-placement="top" tooltip-animation="false" tooltip-popup-delay="500"\n            tooltip-append-to-body="true" tooltip-trigger="mouseenter"\n    ></ccri-angular-utils-select>\n</div>\n')}]),angular.module("timelapse/controls/colorByIdRandomizer.tpl.html",[]).run(["$templateCache",function(a){a.put("timelapse/controls/colorByIdRandomizer.tpl.html",'<span class="fa fa-lg fa-fw fa-random clickable colorByIdRandomizer"\n        ng-if="store.getViewState().colorMode === 1"\n        ng-click="store.setColorByMultiplier()"\n        uib-tooltip="Randomize colors" tooltip-class="nowrap"\n        tooltip-placement="top" tooltip-animation="false" tooltip-popup-delay="500"\n        tooltip-append-to-body="true" tooltip-trigger="mouseenter"\n></span>\n')}]),angular.module("timelapse/controls/colorModeSingleColorChooser.tpl.html",[]).run(["$templateCache",function(a){a.put("timelapse/controls/colorModeSingleColorChooser.tpl.html",'<span class="fa fa-lg fa-fw fa-eyedropper clickable colorModeSingleColorChooser"\n        ng-if="store.getViewState().colorMode !== 1"\n        colorpicker colorpicker-position="bottom"\n        ng-model="store.getViewState().fillColor"\n        ccri-angular-utils-change="store.setFillColorHexString(store.getViewState().fillColor)"\n        uib-tooltip="Change color" tooltip-class="nowrap"\n        tooltip-placement="top" tooltip-animation="false" tooltip-popup-delay="500"\n        tooltip-append-to-body="true" tooltip-trigger="mouseenter"\n></span>\n')}]),angular.module("timelapse/controls/colorModeSwitcher.tpl.html",[]).run(["$templateCache",function(a){a.put("timelapse/controls/colorModeSwitcher.tpl.html",'<span class="btn btn-default colorModeSwitcher"\n        ng-style="{\'background\': store.getColorModeStyle()}"\n        ng-click="store.toggleColorMode()"\n        uib-tooltip="Change color mode" tooltip-class="nowrap"\n        tooltip-placement="top" tooltip-animation="false" tooltip-popup-delay="500"\n        tooltip-append-to-body="true" tooltip-trigger="mouseenter"\n></span>\n')}]),angular.module("timelapse/controls/plotlyBarChart.tpl.html",[]).run(["$templateCache",function(a){a.put("timelapse/controls/plotlyBarChart.tpl.html","<div>\n    <!-- Use visibility:hidden to hide this element, so it retains its CSS size when hidden,\n         or else Plotly won't render it with the correct size -->\n    <div class=\"anchorAll plotly-timelapse-barchart\"\n            ng-style=\"{'visibility': noData ? 'hidden' : 'visible'}\"\n    ></div>\n    <div class=\"anchorAll flex-row flex-align-items-center flex-justify-content-center plotly-timelapse-barchart-nodata\"\n            ng-class=\"{'ng-hide': !noData || loading}\"\n    >\n        No Data\n    </div>\n</div>\n")}]),angular.module("timelapse/geo/category.tpl.html",[]).run(["$templateCache",function(a){a.put("timelapse/geo/category.tpl.html",'<div class="categoryGrouping">\n    <st-live-category></st-live-category>\n</div>\n<div class="categoryGrouping">\n    <st-geo-timelapse-category></st-geo-timelapse-category>\n</div>\n<div ng-class="{\'ng-hide\': timelapse.hideSummary || (workspaces.summary | lodash:\'isEmpty\')}" class="categoryGrouping">\n    <div class="categoryCell">\n        <i class="fa fa-fw clickable"\n           ng-class="timelapse.isSummaryOn ? \'fa-check-square-o\' : \'fa-square-o\'"\n           ng-click="toggleSlideSummary(timelapse.isSummaryOn)"\n        ></i>\n    </div>\n    <div class="categoryCell"><b>Summary</b></div>\n    <div ng-repeat="workspace in workspaces.summary | lodash:\'keys\' | orderBy"\n         ng-class="{\'ng-hide\': !timelapse.isSummaryOn}">\n        <div ng-repeat="layer in workspaces.summary[workspace] | orderBy:\'Name\'" class="categoryGrouping"\n             ng-class="{\'ng-hide\': (layer.summaries | lodash:\'isEmpty\')}">\n            <div ng-repeat="summary in layer.summaries" class="categoryIndent flex-row buf-sm-mt">\n                <div>\n                    <span ng-if="summary.viewState.isOnMap && summary.summaryLayer.isLoading()"\n                          uib-tooltip="Loading" tooltip-class="nowrap"\n                          tooltip-placement="right" tooltip-animation="false" tooltip-popup-delay="500"\n                          tooltip-trigger="mouseenter">\n                        <i class="fa fa-circle-o-notch fa-spin"></i>\n                    </span>\n                    <div ng-if="summary.summaryLayer.getViewState().isError" class="errorIconWrapper">\n                        <i class="fa fa-warning text-danger"\n                           uib-tooltip="{{summary.summaryLayer.getViewState().errorMsg}}"\n                           tooltip-class="nowrap errorTooltip"\n                           tooltip-placement="right" tooltip-animation="false" tooltip-popup-delay="500"\n                           tooltip-trigger="mouseenter">\n                        </i>\n                    </div>\n                </div>\n                <st-toggle-map-layer ng-if="summary.viewState.isOnMap"\n                                     visible="summary.summaryLayer.getViewState().toggledOn"\n                                     toggle="toggleSummaryVisibility(summary)">\n                </st-toggle-map-layer>\n                <div class="flex-1 buf-sm-mh">\n                    {{::summary.Title}}\n                </div>\n                <div class="categoryCell" ng-if="summary.viewState.isOnMap">\n                    <span class="btn btn-default toggleButton colorMode buf-sm-ml"\n                          style="cursor:auto;"\n                          ng-style="{\'background-color\': summary.summaryLayer.getViewState().fillColor}"\n                    ></span>\n                </div>\n                <div style="width:14px" class="buf-md-ml buf-sm-mr">\n                    <ccri-angular-utils-close-btn ng-if="summary.viewState.isRemovable"\n                                                  class="buf-xs-ml"\n                                                  ng-click="removeSummaryLayer(summary)"\n                    ></ccri-angular-utils-close-btn>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n')}]),angular.module("timelapse/geo/ol3/layers/eventsTab.tpl.html",[]).run(["$templateCache",function(a){a.put("timelapse/geo/ol3/layers/eventsTab.tpl.html",'<div>\n    <div ng-if="loading && !tabHasBeenFocused" style="text-align:center">\n        <b>Loading ...</b>\n    </div>\n    <div class="events" ng-if="!loading || tabHasBeenFocused">\n        <table>\n            <tbody ng-repeat="event in record.events | orderBy:\'dtg\'">\n                <tr>\n                    <td class="keyColumn">Event</td>\n                    <td>{{::event.eventType}}</td>\n                </tr>\n                <tr>\n                    <td class="keyColumn">Classification</td>\n                    <td>{{::event.classification}}</td>\n                </tr>\n                <tr>\n                    <td class="keyColumn">Date/Time</td>\n                    <td>\n                        <span ng-class="{\'ng-hide\' : !event.dtg}">\n                            <st-datetime date="::event.dtg"></st-datetime>\n                        </span>\n                    </td>\n                </tr>\n                <tr>\n                    <td class="keyColumn">Lat/Lon</td>\n                    <td>\n                        <span ng-class="{\'ng-hide\' : !event.coordinates[1]}">\n'+"                            {{::event.coordinates[1] < 0 ? 'S' : 'N'}}&nbsp;{{::event.coordinates[1] | numberTrim:4 | lodash:'trimLeft':'-'}}&deg;\n                        </span>\n                        <span ng-class=\"{'ng-hide' : !event.coordinates[0]}\" style=\"padding-left:10px\">\n                            {{::event.coordinates[0] < 0 ? 'W' : 'E'}}&nbsp;{{::event.coordinates[0] | numberTrim:4 | lodash:'trimLeft':'-'}}&deg;\n                        </span>\n                    </td>\n                </tr>\n                <tr>\n                    <td class=\"keyColumn\">Message</td>\n                    <td ng-bind-html=\"::event.message | trustAsHtml\"></td>\n                </tr>\n            </tbody>\n        </table>\n    </div>\n</div>\n")}]),angular.module("timelapse/geo/ol3/layers/livestyle.tpl.html",[]).run(["$templateCache",function(a){a.put("timelapse/geo/ol3/layers/livestyle.tpl.html",'<div style="padding:4px;">\n    <ui-include src="\'core/geo/ol3/layers/layer-fragments.tpl.html\'" fragment="\'.visibilityName\'"></ui-include>\n    <ui-include src="\'core/geo/ol3/layers/layer-fragments.tpl.html\'" fragment="\'.opacitySlider\'"></ui-include>\n    <div class="layerStyleRow" ng-if="viewState.thresholdFilter">\n        <ui-include src="\'core/geo/ol3/layers/layer-fragments.tpl.html\'" fragment="\'.thresholdFilterSlider\'"></ui-include>\n    </div>\n</div>')}]),angular.module("timelapse/geo/ol3/layers/stTimeLapseLayerStyle.tpl.html",[]).run(["$templateCache",function(a){a.put("timelapse/geo/ol3/layers/stTimeLapseLayerStyle.tpl.html",'<div>\n    <div style="padding-left:4px;padding-top:4px;">\n        <ui-include src="\'core/geo/ol3/layers/layer-fragments.tpl.html\'" fragment="\'.visibilityName\'"></ui-include>\n    </div>\n    <div style="overflow-x:hidden;">\n        <ul ui-sortable="sortableOptions" ng-model="stores"\n            style="overflow-x:hidden;list-style:none outside none;padding:0;">\n            <li ng-repeat="store in stores"\n                class="borderless-bottom-on-last-child"\n                style="background-color:#323232; border-bottom:1px solid black; padding-bottom: 6px"\n                ng-if="store.getViewState().isDataReady() && !store.getViewState().isError"\n                ng-init="store.isHovering = false"\n                ng-mouseenter="store.isHovering = true;"\n                ccri-angular-utils-mouseleave="store.isHovering = false">\n                <!-- Layer title -->\n                <div class="flex-row">\n                    <div style="padding-left:4px;padding-top:4px;">\n                        <i class="clickable fa fa-fw"\n                            ng-click="store.toggleVisibility()"\n                            ng-class="store.getViewState().toggledOn ? \'fa-check-square-o\' : \'fa-square-o\'">\n                        </i>\n                    </div>\n                    <div class="flex-1" style="padding:4px;">\n                        <div class="flex-row visibilityName">\n                            <div class="flex-1 ellipsis" style="padding-bottom:2px"\n                                    ng-class="{\'layerNotVisible\': !store.getViewState().toggledOn}">\n                                {{::store.getName()}}\n                            </div>\n                            <ccri-angular-utils-close-btn\n                                    ng-click="layer.removeStore(store); store.destroy()"\n                                    ng-class="{\'ng-hide\': !store.isHovering}">\n                            </ccri-angular-utils-close-btn>\n                        </div>\n                    </div>\n                </div>\n                <!-- Sliders -->\n                <div class="layerStyleRow flex-row flex-full nested">\n                    <div>\n                        <!-- Opacity slider -->\n                        <div class="flex-row buf-sm-mb">\n                            <div class="rangeSliderStartLabel">Opacity</div>\n                            <div class="flex-1 horizontally-buffered">\n                                <div ui-slider ng-model="store.getViewState().opacity"\n                                        ccri-angular-utils-change="store.setOpacity(store.getViewState().opacity)"\n                                        min="0" max="100" step="1">\n                                </div>\n                            </div>\n                            <div class="rangeSliderEndLabel">{{store.getViewState().opacity}}%</div>\n                        </div>\n                        <!-- Range slider -->\n                        <div ng-if="store.getViewState().colorMode === 2" class="flex-row buf-sm-mb">\n                            <div class="rangeSliderStartLabel"\n                                    uib-tooltip="{{store.getIdRange(true).min | numberTrim:0}}" tooltip-class="nowrap"\n                                    tooltip-placement="top" tooltip-animation="false" tooltip-popup-delay="500"\n                                    tooltip-append-to-body="true" tooltip-trigger="mouseenter"\n                                    tooltip-enable="false" ccri-angular-utils-tooltip-overflow>\n                                {{store.getIdRange(true).min | numberTrim:0}}\n                            </div>\n                            <div class="flex-1 horizontally-buffered">\n                                <div ui-slider="{range: true}" class="filterSlider"\n                                        ng-model="store.getFilters().id" ng-change="store.updateIdPredicate()"\n                                        min="{{store.getIdRange().min}}" max="{{store.getIdRange().max}}">\n                                </div>\n                            </div>\n                            <div class="rangeSliderEndLabel"\n                                    uib-tooltip="{{store.getIdRange(true).max | numberTrim:0}}" tooltip-class="nowrap"\n                                    tooltip-placement="top" tooltip-animation="false" tooltip-popup-delay="500"\n                                    tooltip-append-to-body="true" tooltip-trigger="mouseenter"\n                                    tooltip-enable="false" ccri-angular-utils-tooltip-overflow>\n                                {{store.getIdRange(true).max | numberTrim:0}}\n                            </div>\n                        </div>\n                        <!-- Range slider info -->\n                        <div ng-if="store.getViewState().colorMode === 2" class="flex-row">\n                            <div class="rangeSliderStartLabel">&nbsp;</div>\n                            <div class="cell flex-1 ellipsis horizontally-buffered">\n                                Range ({{ store.getColorByField() }}): {{store.getFilters(true).id[0] | numberTrim:0}} to {{store.getFilters(true).id[1] | numberTrim:0}}\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <!-- Size, Connect, Show labels, Color mode -->\n                <div class="layerStyleRow nested flex-row">\n                    <div class="cell">\n                        Size\n                        <input type="number" step="1"\n                               class="form-control input-xs" style="width: 24px;"\n                               ng-model="store.getViewState().size"\n                               ccri-angular-utils-change="sizeChanged(store, store.getViewState().size)"\n                               min="1" max="100">\n                    </div>\n                    <div class="cell clickable"\n                         ng-click="store.toggleConnectById()">\n                        <i class="fa fa-lg fa-fw"\n                           ng-class="store.getViewState().connectById ? \'fa-check-square-o\' : \'fa-square-o\'"\n                           style="width:10px"\n                        ></i>\n                        Connect\n                    </div>\n                    <div class="cell clickable"\n                         ng-if="store.labelsAvailable()"\n                         ng-click="store.toggleLabels()">\n                        {{store.labelsOn ? \'Hide\' : \'Show\'}} labels\n                    </div>\n                    <!--div class="layerStyleRow flex-row nested">\n                        <input type="range"\n                               min="-8"\n                               max="8"\n                               step="0.1"\n                               ng-model="store.getViewState().fadeRate"\n                               st-float-input\n                               ccri-angular-utils-change="store.setFadeRate(store.getViewState().fadeRate)">\n                    </div-->\n                    <div class="cell">\n                        <color-mode-switcher store="store"></color-mode-switcher>\n                        <color-by-id-randomizer store="store"></color-by-id-randomizer>\n                        <color-mode-single-color-chooser store="store"></color-mode-single-color-chooser>\n                    </div>\n                    <div class="cell" style="flex: 1 1 auto;">\n                        <color-by-field-chooser store="store"></color-by-field-chooser>\n                    </div>\n                </div>\n            </li>\n        </ul>\n    </div>\n</div>\n');
}]),angular.module("timelapse/geo/ol3/layers/summaryStyle.tpl.html",[]).run(["$templateCache",function(a){a.put("timelapse/geo/ol3/layers/summaryStyle.tpl.html",'<div style="padding:4px;">\n    <ui-include src="\'core/geo/ol3/layers/layer-fragments.tpl.html\'" fragment="\'.visibilityName\'"></ui-include>\n    <ui-include src="\'core/geo/ol3/layers/layer-fragments.tpl.html\'" fragment="\'.opacitySlider\'"></ui-include>\n    <div class="layerStyleRow">\n        <div class="cell">Size</div>\n        <div class="cell">\n            <input type="number" step="1"\n                   class="form-control input-xs"\n                   ng-model="getViewState().size"\n                   ccri-angular-utils-change="sizeChanged(getViewState().size)"\n                   min="1" max="100">\n        </div>\n        <div class="cell" style="padding-left:5px">Color</div>\n        <div class="cell">\n            <span class="fa fa-lg fa-square clickable colorpickerSquare"\n                  ng-style="{color: getViewState().fillColor}"\n                  colorpicker colorpicker-position="bottom"\n                  ng-model="getViewState().fillColor"\n                  ccri-angular-utils-change="fillColorChanged()"\n                  uib-tooltip="Change color" tooltip-class="nowrap"\n                  tooltip-placement="right" tooltip-animation="false" tooltip-popup-delay="500"\n                  tooltip-trigger="mouseenter">\n            </span>\n        </div>\n        <div class="cell clickable" style="padding-left:8px" ng-if="getViewState().hasEvents"\n             ng-click="getViewState().showEvents = !getViewState().showEvents; updateStyle();">\n            <i class="fa fa-lg fa-fw"\n               ng-class="getViewState().showEvents ? \'fa-check-square-o\' : \'fa-square-o\'"\n            ></i>\n            Show events\n        </div>\n        <div class="cell clickable" style="padding-left:8px" ng-if="getViewState().hasEvents"\n             ng-click="getViewState().showLabels = !getViewState().showLabels; updateStyle();">\n            <i class="fa fa-lg fa-fw"\n               ng-class="getViewState().showLabels ? \'fa-check-square-o\' : \'fa-square-o\'"\n            ></i>\n            Show labels\n        </div>\n    </div>\n</div>\n')}]),angular.module("timelapse/geo/ol3/layers/summaryTab.tpl.html",[]).run(["$templateCache",function(a){a.put("timelapse/geo/ol3/layers/summaryTab.tpl.html",'<div class="summary">\n    <div ng-if="loading && !tabHasBeenFocused" style="text-align:center">\n        <b>Loading ...</b>\n    </div>\n    <div ng-if="!loading || tabHasBeenFocused">\n        <table>\n            <tr>\n                <td class="keyColumn">{{::\'classification\' | attributeLabel}}</td>\n                <td colspan="3">{{summary.classification}}</td>\n            </tr>\n            <tr>\n                <td class="keyColumn">{{::\'startTime\' | attributeLabel}}</td>\n                <td colspan="3">\n                    <span ng-class="{\'ng-hide\' : !summary.startTime}">\n                        <st-datetime date="summary.startTime"></st-datetime>\n                    </span>\n                </td>\n            </tr>\n            <tr>\n                <td class="keyColumn">{{::\'endTime\' | attributeLabel}}</td>\n                <td colspan="3">\n                    <span ng-class="{\'ng-hide\' : !summary.endTime}">\n                        <st-datetime date="summary.endTime"></st-datetime>\n                    </span>\n                </td>\n            </tr>\n            <tr>\n                <td class="keyColumn">{{::\'affiliation\' | attributeLabel}}</td>\n                <td colspan="3">{{summary.affiliation}}</td>\n            </tr>\n            <tr>\n                <td class="keyColumn">{{::\'nationality\' | attributeLabel}}</td>\n                <td colspan="3">{{summary.nationality}}</td>\n            </tr>\n            <tr>\n                <td class="keyColumn">{{::\'platform\' | attributeLabel}}</td>\n                <td colspan="3">{{summary.platform}}</td>\n            </tr>\n            <tr>\n                <td class="keyColumn">{{::\'aircraftType\' | attributeLabel}}</td>\n                <td colspan="3">{{summary.aircraftType}}</td>\n            </tr>\n            <tr>\n                <td class="keyColumn">{{::\'linkIdentity\' | attributeLabel}}</td>\n                <td colspan="3">{{summary.linkIdentity}}</td>\n            </tr>\n            <tr>\n                <td class="keyColumn">{{::\'callsign\' | attributeLabel}}</td>\n                <td colspan="3">{{summary.callsign}}</td>\n            </tr>\n            <tr>\n                <td class="keyColumn">{{::\'flightNumber\' | attributeLabel}}</td>\n                <td colspan="3">{{summary.flightNumber}}</td>\n            </tr>\n            <tr>\n                <td class="keyColumn">{{::\'modeS\' | attributeLabel}}</td>\n                <td colspan="3">{{summary.modeS}}</td>\n            </tr>\n            <tr>\n                <td class="keyColumn">{{::\'tailNumber\' | attributeLabel}}</td>\n                <td colspan="3">{{summary.tailNumber}}</td>\n            </tr>\n            <tr>\n                <td class="keyColumn">{{::\'airline\' | attributeLabel}}</td>\n                <td colspan="3">{{summary.airline}}</td>\n            </tr>\n            <tr>\n                <td class="keyColumn">{{::\'origin\' | attributeLabel}}</td>\n                <td colspan="3">{{summary.origin}}</td>\n            </tr>\n            <tr>\n                <td class="keyColumn">{{::\'destination\' | attributeLabel}}</td>\n                <td colspan="3">{{summary.destination}}</td>\n            </tr>\n            <tr>\n                <td class="keyColumn">{{::\'thresherId\' | attributeLabel}}</td>\n                <td colspan="3">{{summary.thresherId}}</td>\n            </tr>\n            <tr>\n                <td colspan="4"></td>\n            </tr>\n            <tr>\n                <td class="keyColumn">{{::\'altAvg\' | attributeLabel}}</td>\n                <td>\n                    <span ng-class="{\'ng-hide\' : !summary.altAvg}">\n'+"                        {{summary.altAvg | convertUnit:'m':'ft' | numberTrim:0}}&nbsp;ft\n                    </span>\n                </td>\n                <td class=\"keyColumn\">{{::'speedAvg' | attributeLabel}}</td>\n                <td>\n                    <span ng-class=\"{'ng-hide' : !summary.speedAvg}\">\n                        {{summary.speedAvg | convertUnit:'m/s':'knots' | numberTrim:0}}&nbsp;kts\n                    </span>\n                </td>\n            </tr>\n            <tr>\n                <td class=\"keyColumn\">{{::'altMin' | attributeLabel}}</td>\n                <td>\n                    <span ng-class=\"{'ng-hide' : !summary.altMin}\">\n                        {{summary.altMin | convertUnit:'m':'ft' | numberTrim:0}}&nbsp;ft\n                    </span>\n                </td>\n                <td class=\"keyColumn\">{{::'speedMin' | attributeLabel}}</td>\n                <td>\n                    <span ng-class=\"{'ng-hide' : !summary.speedMin}\">\n                        {{summary.speedMin | convertUnit:'m/s':'knots' | numberTrim:0}}&nbsp;kts\n                    </span>\n                </td>\n            </tr>\n            <tr>\n                <td class=\"keyColumn\">{{::'altMax' | attributeLabel}}</td>\n                <td>\n                    <span ng-class=\"{'ng-hide' : !summary.altMax}\">\n                        {{summary.altMax | convertUnit:'m':'ft' | numberTrim:0}}&nbsp;ft\n                    </span>\n                </td>\n                <td class=\"keyColumn\">{{::'speedMax' | attributeLabel}}</td>\n                <td>\n                    <span ng-class=\"{'ng-hide' : !summary.speedMax}\">\n                        {{summary.speedMax | convertUnit:'m/s':'knots' | numberTrim:0}}&nbsp;kts\n                    </span>\n                </td>\n            </tr>\n            <tr>\n                <td class=\"keyColumn\">{{::'turnRateMax' | attributeLabel}}</td>\n                <td>\n                    <span ng-class=\"{'ng-hide' : !summary.turnRateMax}\">\n                        {{summary.turnRateMax | numberTrim:0}} &deg;&nbsp;/&nbsp;sec\n                    </span>\n                </td>\n                <td class=\"keyColumn\">{{::'climbRateMax' | attributeLabel}}</td>\n                <td>\n                    <span ng-class=\"{'ng-hide' : !summary.climbRateMax }\">\n                        {{summary.climbRateMax | convertUnit:'m/s':'ft/min' | numberTrim:0}} ft&nbsp;/&nbsp;min\n                    </span>\n                </td>\n            </tr>\n            <tr>\n                <td class=\"keyColumn\">{{::'percentOffRoute' | attributeLabel}}</td>\n                <td>\n                    <span ng-class=\"{'ng-hide' : !summary.percentOffRoute}\">\n                        {{summary.percentOffRoute | decimalToPercent | numberTrim:0}}&#37;\n                    </span>\n                </td>\n                <td class=\"keyColumn\">{{::'curviness' | attributeLabel}}</td>\n                <td>{{summary.curviness | numberTrim:2}}</td>\n            </tr>\n            <tr>\n                <td class=\"keyColumn\">{{::'nTotalObs' | attributeLabel}}</td>\n                <td>{{summary.nTotalObs}}</td>\n                <td class=\"keyColumn\">{{::'percentHighDensity' | attributeLabel}}</td>\n                <td>\n                    <span ng-class=\"{'ng-hide' : !summary.percentHighDensity}\">\n                        {{summary.percentHighDensity | decimalToPercent | numberTrim:0}}&#37;\n                    </span>\n                </td>\n            </tr>\n            <tr>\n                <td class=\"keyColumn\">{{::'distFlownStr' | attributeLabel}}</td>\n                <td>{{summary.distFlownStr}}</td>\n                <td class=\"keyColumn\">{{::'flightDurationStr' | attributeLabel}}</td>\n                <td>{{summary.flightDurationStr}}</td>\n            </tr>\n            <tr>\n                <td class=\"keyColumn\">{{::'activity' | attributeLabel}}</td>\n                <td>{{summary.activity}}</td>\n                <td class=\"keyColumn\">{{::'linkPPLI' | attributeLabel}}</td>\n                <td>{{summary.linkPPLI}}</td>\n            </tr>\n            <tr>\n                <td class=\"keyColumn\">{{::'platformScore' | attributeLabel}}</td>\n                <td>{{summary.platformScore}}</td>\n                <td class=\"keyColumn\">{{::'aircraftTypeScore' | attributeLabel}}</td>\n                <td>{{summary.aircraftTypeScore}}</td>\n            </tr>\n            <tr>\n                <td class=\"keyColumn\">{{::'affiliationReason' | attributeLabel}}</td>\n                <td>{{summary.affiliationReason}}</td>\n                <td class=\"keyColumn\">{{::'emergencyAlert' | attributeLabel}}</td>\n                <td>{{summary.emergencyAlert}}</td>\n            </tr>\n            <tr>\n                <td class=\"keyColumn\">{{::'userModified' | attributeLabel}}</td>\n                <td>{{summary.userModified}}</td>\n                <td class=\"keyColumn\">{{::'userComments' | attributeLabel}}</td>\n                <td>{{summary.userComments}}</td>\n            </tr>\n            <tr>\n                <td colspan=\"4\"></td>\n            </tr>\n        </table>\n        <table class=\"iffMode3Table\">\n            <tr>\n                <td class=\"keyColumn\">{{::'iffMode3' | attributeLabel}}</td>\n                <td class=\"keyColumn\">{{::'iffMode3StartDate' | attributeLabel}}</td>\n                <td class=\"keyColumn\">{{::'iffMode3EndDate' | attributeLabel}}</td>\n            </tr>\n            <tr ng-repeat=\"mode in summary.iffMode3 track by $index\">\n                <td>{{mode}}</td>\n                <td>\n                    <span ng-class=\"{'ng-hide' : !summary.iffMode3StartDate[$index]}\">\n                        <st-datetime date=\"summary.iffMode3StartDate[$index]\"></st-datetime>\n                    </span>\n                </td>\n                <td>\n                    <span ng-class=\"{'ng-hide' : !summary.iffMode3EndDate[$index]}\">\n                        <st-datetime date=\"summary.iffMode3EndDate[$index]\"></st-datetime>\n                    </span>\n                </td>\n            </tr>\n        </table>\n    </div>\n</div>\n")}]),angular.module("timelapse/wizard/area_step.tpl.html",[]).run(["$templateCache",function(a){a.put("timelapse/wizard/area_step.tpl.html",'<ng-form name="wizardForm">\n    <div class="AreaDefinitionWizard">\n        <st-wiz-section>\n            <st-wiz-area-definition></st-wiz-area-definition>\n        </st-wiz-section>\n    </div>\n    <!-- hidden input to disable the Next button if nothing has been drawn -->\n    <input type="hidden" name="hasShapes" ng-model="hasShapes" ng-model-options="{getterSetter:true}" required>\n</ng-form>\n')}]),angular.module("timelapse/wizard/live/source_area_step.tpl.html",[]).run(["$templateCache",function(a){a.put("timelapse/wizard/live/source_area_step.tpl.html",'<ng-form name="wizardForm">\n    <div class="AreaDefinitionWizard">\n        <st-wiz-section>\n            <div class="buf-lg-pt">\n                <st-wiz-data-source query="query"></st-wiz-data-source>\n            </div>\n        </st-wiz-section>\n\n        <st-wiz-section>\n            <div class="buf-lg-pt">\n                <st-wiz-area-definition></st-wiz-area-definition>\n            </div>\n        </st-wiz-section>\n    </div>\n\n    <!-- hidden input to disable the Next button if nothing has been drawn -->\n    <input type="hidden" name="hasShapes" ng-model="hasShapes" ng-model-options="{getterSetter:true}" required>\n</ng-form>\n')}]),angular.module("timelapse/wizard/templates/area_definition.tpl.html",[]).run(["$templateCache",function(a){a.put("timelapse/wizard/templates/area_definition.tpl.html",'<div>\n    <div class="flex-row flex-justify-content-flex-end flex-align-items-center">\n        <span class="field-descriptor text-right buf-lg-mr">Select Area:</span>\n        <ccri-area-definition-drawtool-selector\n            feature-creator="featureCreator"\n            class="field-input"\n        ></ccri-area-definition-drawtool-selector>\n    </div>\n    <span ng-class="{\'ng-hide\' : !selectedTool}">\n        <ccri-area-definition-more-details-toggle class="flex-row flex-justify-content-flex-end"></ccri-area-definition-more-details-toggle>\n    </span>\n    <st-wiz-subsection>\n        <ccri-area-definition-tool-controls-switcher feature-creator="featureCreator" tool-controls="toolControlsConfig"></ccri-area-definition-tool-controls-switcher>\n        <st-wiz-cql-length ng-hide="!toolWasOpened"\n                           ng-model="cqlStats.finalCql.length"\n                           cql-maxlength="{{cqlStats.cqlMaxlength}}">\n        </st-wiz-cql-length>\n    </st-wiz-subsection>\n</div>\n')}]),angular.module("timelapse/wizard/templates/bounds.tpl.html",[]).run(["$templateCache",function(a){a.put("timelapse/wizard/templates/bounds.tpl.html",'<ng-form name="wizardForm">\n    <div style="text-align:center;" ng-class="{\'ng-hide\': boundWiz.drawing}">\n        <table style="border-collapse:separate;border-spacing:2px;margin:5px auto;">\n            <tr>\n                <td></td>\n                <td colspan="2">\n                    <input type="number" placeholder="Max Lat (deg)" style="max-width:90px;"\n                           ng-change="query.checkAndSetBounds([query.params.minLon, query.params.minLat, query.params.maxLon, query.params.maxLat])"\n                           min="-90" max="90" step="0.00001" ng-model="query.params.maxLat" required>\n                    </input>\n                </td>\n                <td></td>\n            </tr>\n            <tr>\n                <td colspan="2">\n                    <input type="number" placeholder="Min Lon (deg)" style="max-width:90px;"\n                           ng-change="query.checkAndSetBounds([query.params.minLon, query.params.minLat, query.params.maxLon, query.params.maxLat])"\n                           min="-180" max="180" step="0.00001" ng-model="query.params.minLon" required>\n                    </input>\n                </td>\n                <td colspan="2">\n                    <input type="number" placeholder="Max Lon (deg)" style="max-width:90px;"\n                           ng-change="query.checkAndSetBounds([query.params.minLon, query.params.minLat, query.params.maxLon, query.params.maxLat])"\n                           min="-180" max="180" step="0.00001" ng-model="query.params.maxLon" required>\n                    </input>\n                </td>\n            </tr>\n            <tr>\n                <td></td>\n                <td colspan="2">\n                    <input type="number" placeholder="Min Lat (deg)" style="max-width:90px;"\n                           ng-change="query.checkAndSetBounds([query.params.minLon, query.params.minLat, query.params.maxLon, query.params.maxLat])"\n                           min="-90" max="90" step="0.00001" ng-model="query.params.minLat" required>\n                    </input>\n                </td>\n                <td></td>\n            </tr>\n        </table>\n        <div style="margin-top:10px;">\n            <div class="text-btn" style="display: inline-block" ng-click="boundWiz.setWholeEarth()">Whole Earth</div>\n            <div class="text-btn" style="display: inline-block" ng-click="boundWiz.setMapExtent()">Use Map Extent</div>\n            <div class="text-btn" style="display: inline-block" ng-click="boundWiz.drawExtent()">Draw Bounds</div>\n        </div>\n    </div>\n    <div style="margin-top:2px;" ng-class="{\'ng-hide\': !boundWiz.drawing}">\n        Click and drag on the map to draw bounding box.\n    </div>\n</ng-form>\n')}]),angular.module("timelapse/wizard/templates/cql_length.tpl.html",[]).run(["$templateCache",function(a){a.put("timelapse/wizard/templates/cql_length.tpl.html",'<div class="liveCqlLimit" ng-class="{\'is-error\': !isValid, \'ng-hide\': !showMessage}">\n    <span ng-show="isValid">\n        {{length || \'0\' | number}} of {{maxlength | number}} characters\n    </span>\n    <span ng-show="!isValid">\n        <i class="fa fa-warning text-danger"></i>\n        Error: Resulting CQL query is too long. Character\n        limit is {{maxlength | number}}; this query has {{length | number}} characters.\n    </span>\n</div>\n')}]),angular.module("timelapse/wizard/templates/data_props.tpl.html",[]).run(["$templateCache",function(a){a.put("timelapse/wizard/templates/data_props.tpl.html",'<div ng-if="query.layerData.currentLayer">\n    <div class="flex-row flex-align-items-center buf-xs-mt"\n         ng-if="query.layerSupportsArrow">\n        <span class="field-descriptor text-right buf-lg-mr">&nbsp;</span>\n        <ccri-angular-utils-checkbox ng-model="options.useArrow"\n                class="field-input buf-sm-pl text-muted">\n            Enable charts\n        </ccri-angular-utils-checkbox>\n        <span class="field-unit">&nbsp;</span>\n    </div>\n    <div class="flex-row flex-align-items-center buf-xs-mt data-props-time-field"\n         ng-if="!query.isLineQuery() &&\n                query.featureTypeData.featureTypes[0].properties.filter(dateTimeFilter).length !== 1">\n        <span class="field-descriptor text-right buf-lg-mr">Time:</span>\n        <span class="field-input">\n            <ccri-angular-utils-select ng-model="query.params.dtgField"\n                                       from-list="query.featureTypeData.featureTypes[0].properties"\n                                       label-fn="labelFn"\n                                       filter-fn="dateTimeFilter"\n                                       placeholder="Select time field"\n                                       empty-message="None available"\n            ></ccri-angular-utils-select>\n        </span>\n        <span class="field-unit">&nbsp;</span>\n    </div>\n    <div class="flex-row flex-align-items-center buf-xs-mt data-props-geometry-field"\n         ng-if="!query.isLineQuery() &&\n                query.featureTypeData.featureTypes[0].properties.filter(geomFilter).length !== 1">\n        <span class="field-descriptor text-right buf-lg-mr">Geometry:</span>\n        <span class="field-input">\n            <ccri-angular-utils-select ng-model="query.params.geomField"\n                                       from-list="query.featureTypeData.featureTypes[0].properties"\n                                       label-fn="labelFn"\n                                       filter-fn="geomFilter"\n                                       placeholder="Select geom field"\n                                       empty-message="None available"\n            ></ccri-angular-utils-select>\n        </span>\n        <span class="field-unit">&nbsp;</span>\n    </div>\n    <div class="flex-row flex-align-items-center buf-xs-mt"\n         ng-class="{\'ng-hide\': query.layerSupportsArrow && !query.preferBin}">\n        <span class="field-descriptor text-right buf-lg-mr">Color by:</span>\n        <span class="field-input">\n            <ccri-angular-utils-select ng-model="query.params.idField"\n                                       from-list="query.featureTypeData.featureTypes[0].properties"\n                                       label-fn="labelFn"\n                                       filter-fn="colorByFilter"\n                                       placeholder="Select color-by field"\n                                       empty-message="None available"\n                                       memory-num="4"\n                                       localstorage-prefix="{{query.layerData.currentLayer.Title}}.attribute"\n            ></ccri-angular-utils-select>\n        </span>\n        <span class="field-unit">&nbsp;</span>\n    </div>\n    <div class="flex-row flex-align-items-top buf-xs-mt"\n         ng-if="query.layerSupportsArrow && !query.preferBin">\n        <span class="field-descriptor flex-row flex-justify-content-flex-end buf-lg-mr"\n                style="margin-top:4px">\n            <span style="margin-right: 6px">\n                <span\n                        uib-tooltip="Additional fields can be used as Color By fields,\n                            and for filtering in the chart view"\n                        tooltip-append-to-body="true" tooltip-placement="bottom"\n                        tooltip-animation="true" tooltip-popup-delay="300"\n                >\n                    <i class="fa fa-question-circle"></i>\n                </span>\n            </span>\n            Add\'l fields:\n        </span>\n        <div class="field-input flex-column">\n            <!-- Arrow Required fields -->\n            <div class="buf-xs-mb faux-input disabled-gray data-props-required-addl-field" style="width:100%"\n                    ng-repeat="field in query.params.requiredArrowFields track by $index"\n            >\n                {{query.params.requiredArrowFields[$index].name | attributeLabel}}\n            </div>\n            <!-- Arrow Additional fields -->\n            <div class="flex-row flex-align-items-center buf-xs-mb data-props-addl-fields"\n                    ng-repeat="field in query.params.arrowFields track by $index"\n            >\n                <ccri-angular-utils-select ng-model="query.params.arrowFields[$index]"\n                        from-list="arrowFieldOptions"\n                        filter-fn="isUnusedAttribute"\n                        label-fn="labelFn"\n                        select-fn="selectFn"\n                        placeholder="Select a field"\n                        empty-message="None available"\n                        memory-num="4"\n                        localstorage-prefix="{{query.layerData.currentLayer.Title}}.attribute"\n                        required\n                ></ccri-angular-utils-select>\n                <div class="clickable text-muted buf-sm-mh"\n                        ng-click="query.params.arrowFields.splice($index, 1)">\n                    <i class="fa fa-close"></i>\n                </div>\n            </div>\n            <!-- Persistent empty dropdown -->\n            <div style="padding-right: 17px">\n                <ccri-angular-utils-select ng-model="vm.nextAdditionalField" ng-change="addNextAdditional()"\n                        from-list="arrowFieldOptions"\n                        filter-fn="isUnusedAttribute"\n                        label-fn="labelFn"\n                        select-fn="selectFn"\n                        placeholder="Select a field"\n                        empty-message="None available"\n                        memory-num="4"\n                        localstorage-prefix="{{query.layerData.currentLayer.Title}}.attribute"\n                ></ccri-angular-utils-select>\n            </div>\n        </div>\n    </div>\n    <div class="flex-row flex-align-items-center buf-xs-mt"\n         ng-if="::dot.showBinSortOption">\n        <span class="field-descriptor text-right buf-lg-mr">&nbsp;</span>\n        <span class="field-input"\n              ng-click="query.params.sortOnServer = !query.params.sortOnServer;">\n            <i class="fa fa-fw"\n               ng-class="query.params.sortOnServer ? \'fa-check-square-o\' : \'fa-square-o\'"\n            ></i>&nbsp;Sort on server\n        </span>\n        <span class="field-unit">&nbsp;</span>\n    </div>\n    <select class="ng-hide"\n            ng-model="query.params.startDtgField"\n            ng-required="query.isLineQuery()">\n    </select>\n    <select class="ng-hide"\n            ng-model="query.params.endDtgField"\n            ng-required="query.isLineQuery()">\n    </select>\n</div>\n')}]),angular.module("timelapse/wizard/templates/data_source.tpl.html",[]).run(["$templateCache",function(a){a.put("timelapse/wizard/templates/data_source.tpl.html",'<div class="flex-row flex-align-items-center">\n    <span class="field-descriptor text-right buf-lg-mr">Data Source:</span>\n    <span class="field-input">\n        <ccri-angular-utils-select ng-model="query.layerData.currentLayer"\n                                   from-list="layerList"\n                                   label-fn="labelFn"\n                                   filter-fn="filterFn"\n                                   placeholder="Select a Data Source"\n                                   empty-message="None available"\n        ></ccri-angular-utils-select>\n    </span>\n    <span class="field-unit">&nbsp;</span>\n    <!-- hidden input to disable the Next button if the dropdown is unselected -->\n    <input type="hidden" name="dataSourceSelection" ng-model="query.layerData.currentLayer" required>\n</div>\n')}]),angular.module("timelapse/wizard/templates/draw_toolbar.tpl.html",[]).run(["$templateCache",function(a){a.put("timelapse/wizard/templates/draw_toolbar.tpl.html",'<!-- The toolbar buttons at the top right corner of the wizard -->\n<div class="flex flex-row">\n\n    <!-- Erase all -->\n    <div class="btn-group">\n        <ccri-area-definition-erase-button feature-creator="featureCreator" icon-class="fa-eraser"\n                class="btn btn-default"\n                uib-tooltip="Erase all" tooltip-class="nowrap"\n                tooltip-placement="top" tooltip-animation="false" tooltip-popup-delay="500"\n                tooltip-append-to-body="true" tooltip-trigger="mouseenter"\n        ></ccri-area-definition-erase-button>\n    </div>\n\n    <!-- Enter Select mode -->\n    <div class="btn-group">\n        <ccri-area-definition-select-button feature-creator="featureCreator" icon-class="fa-pencil-square-o"\n                disable-when-empty="true"\n                class="btn btn-default"\n                uib-tooltip="Edit areas" tooltip-class="nowrap"\n                tooltip-placement="top" tooltip-animation="false" tooltip-popup-delay="500"\n                tooltip-append-to-body="true" tooltip-trigger="mouseenter"\n        ></ccri-area-definition-select-button>\n    </div>\n\n    <!-- Save to File -->\n    <div class="btn-group">\n        <ccri-area-definition-save-button feature-creator="featureCreator" icon-class="fa-save"\n                uib-tooltip="Save to file" tooltip-class="nowrap"\n                tooltip-placement="top" tooltip-animation="false" tooltip-popup-delay="500"\n                tooltip-append-to-body="true" tooltip-trigger="mouseenter"\n        ></ccri-area-definition-save-button>\n    </div>\n\n    <!-- Upload -->\n    <div class="btn-group">\n        <ccri-area-definition-upload-button feature-creator="featureCreator" icon-class="fa-folder-open"\n                class="btn btn-default"\n                uib-tooltip="Load from file" tooltip-class="nowrap"\n                tooltip-placement="top" tooltip-animation="false" tooltip-popup-delay="500"\n                tooltip-append-to-body="true" tooltip-trigger="mouseenter"\n        ></ccri-area-definition-upload-button>\n    </div>\n</div>\n')}]),angular.module("timelapse/wizard/templates/name.tpl.html",[]).run(["$templateCache",function(a){a.put("timelapse/wizard/templates/name.tpl.html",'<div class="labeled-wide-field">\n    <span class="field-descriptor">&nbsp;</span>\n    <span ng-class="{\'error-text\': queryNameCtrl.wizardForm.nonDefaultName.$invalid}">\n        Give this a meaningful name.\n    </span>\n</div>\n<div class="vertically-buffered labeled-wide-field"  style="margin-top:4px">\n    <span class="field-descriptor text-right">Name:</span>\n    <input class="field-input"\n           ng-model="queryNameCtrl.query.params.storeName"\n           ng-change="queryNameCtrl.query.nameEdited=true"\n           ng-class="{\'error-field\': queryNameCtrl.wizardForm.nonDefaultName.$invalid}"\n           required\n    >\n</div>\n')}]),angular.module("timelapse/wizard/templates/options.tpl.html",[]).run(["$templateCache",function(a){a.put("timelapse/wizard/templates/options.tpl.html",'<ng-form name="wizardForm">\n    <ccri-angular-utils-widget-compiler widget-def="customOptionsWidget"\n        ng-if="::query.layerData.currentLayer.KeywordConfig.query.customWizardOptions">\n    </ccri-angular-utils-widget-compiler>\n\n    <div ng-if="::!query.layerData.currentLayer.KeywordConfig.query.customWizardOptions">\n        <div class="vertically-buffered labeled-wide-field">\n            <span class="field-label">Additional filter:</span>\n            <span class="field">\n                <ccri-angular-utils-typeahead\n                    ng-model="query.params.cql"\n                    memory-num="5"\n                    localstorage-prefix="{{query.layerData.currentLayer.Title}}.cql"\n                    placeholder="CQL filter"\n                    typeahead-editable="true"\n                ></ccri-angular-utils-typeahead>\n            </span>\n        </div>\n        <div class="vertically-buffered" ng-switch="query.featureTypeData">\n            <div ng-switch-when="unavailable" class="alert alert-warning">\n                <i class="fa fa-warning"></i> There is no feature type description for this layer.\n            </div>\n            <div ng-switch-default>\n                <section class="vertically-buffered section-boxed" ng-class="{\'ng-hide\': query.featureTypeData === \'unavailable\'}"\n                    ng-repeat="featureType in query.featureTypeData.featureTypes">\n                    <div class="section-boxed-top">\n                        Properties for <strong>{{::query.layerData.currentLayer.Title}}</strong>\n                    </div>\n                    <div class="section-boxed-bottom">\n                        <table class="table-condensed">\n                            <tr ng-repeat="property in featureType.properties">\n                                <td>{{::property.name}}</td>\n                                <td><code>{{::property.localType}}</code></td>\n                            </tr>\n                        </table>\n                    </div>\n                </section>\n            </div>\n        </div>\n        <st-tl-query-name query="query" wizard-form="wizardForm"></st-tl-query-name>\n        <st-tl-save-query query="query"></st-tl-save-query>\n        <st-wiz-cql-length name="cqlTotalLength" ng-model="cqlTotalLength" ng-model-options="{getterSetter:true}"\n            cql-maxlength="{{dot.cqlMaxlength}}">\n        </st-wiz-cql-length>\n    </div>\n</ng-form>\n');
}]),angular.module("timelapse/wizard/templates/saveQuery.tpl.html",[]).run(["$templateCache",function(a){a.put("timelapse/wizard/templates/saveQuery.tpl.html",'<div ng-if="saveQueryCtrl.query.isSaveable">\n    <div class="vertically-buffered">\n        <div class="labeled-wide-field buf-sm-mb" ng-if="::!saveQueryCtrl.query.savingIsNotOptional">\n            <span class="field-descriptor">&nbsp;</span>\n            <span class="field-input clickable" ng-click="saveQueryCtrl.query.shouldBeSaved = !saveQueryCtrl.query.shouldBeSaved">\n                <i class="fa fa-fw" ng-class="saveQueryCtrl.query.shouldBeSaved ? \'fa-check-square-o\' : \'fa-square-o\'"></i>\n                Save filter for future use?\n            </span>\n        </div>\n\n        <!-- If the user is saving a new query, make them change the name from the default pre-populated name.\n                This is a hidden field validator, to disable the wizard next button (via form invalidity).\n                It\'s always empty, and when it becomes required, it triggers the validation. -->\n        <input name="nonDefaultName" type="hidden" ng-model="_empty_"\n                ng-required="saveQueryCtrl.query.shouldBeSaved && !saveQueryCtrl.query.editMode && !saveQueryCtrl.query.nameEdited">\n\n        <div class="labeled-wide-field" ng-if="::!saveQueryCtrl.query.sharingIsNotOptional">\n            <span class="field-descriptor">&nbsp;</span>\n            <span class="field-input clickable" ng-click="saveQueryCtrl.query.shouldBeShared = saveQueryCtrl.query.shouldBeSaved ? !saveQueryCtrl.query.shouldBeShared : saveQueryCtrl.query.shouldBeShared"\n                  ng-disabled="!saveQueryCtrl.query.shouldBeSaved">\n                <i class="fa fa-fw" ng-class="saveQueryCtrl.query.shouldBeShared ? \'fa-check-square-o\' : \'fa-square-o\'"></i>\n                Share this filter with others?\n            </span>\n        </div>\n    </div>\n\n    <div class="flex-row labeled-wide-field">\n        <span class="field-descriptor text-right" ng-disabled="!saveQueryCtrl.query.shouldBeSaved">Classification:</span>\n        <span class="field-input">\n            <ccri-angular-utils-select ng-model="saveQueryCtrl.query.classification"\n                                       required\n                                        select-disabled="!saveQueryCtrl.query.shouldBeSaved"\n                                        from-list="saveQueryCtrl.query.classifications"\n                                        label-fn="labelFn"\n                                        placeholder="Select a classification"\n                                        empty-message="None available"\n            ></ccri-angular-utils-select>\n        </span>\n    </div>\n</div>\n')}]),angular.module("timelapse/wizard/templates/section.tpl.html",[]).run(["$templateCache",function(a){a.put("timelapse/wizard/templates/section.tpl.html",'<div class="section">\n    <span class="dot" ng-if="dotted">{{ dotNumber }}</span>\n    <div ng-transclude></div>\n</div>')}]),angular.module("timelapse/wizard/templates/subsection.tpl.html",[]).run(["$templateCache",function(a){a.put("timelapse/wizard/templates/subsection.tpl.html",'<div class="subsection">\n    <div ng-transclude></div>\n</div>')}]),angular.module("timelapse/wizard/templates/timerange.tpl.html",[]).run(["$templateCache",function(a){a.put("timelapse/wizard/templates/timerange.tpl.html",'<div class="text-faded buf-lg-mb">\n    Data available for time range:<br>\n    <st-date-range class="text-faded"\n            start-date="query.timeData.minTime" end-date="query.timeData.maxTime"\n            moment-date-format="YYYY MMM DD" moment-time-format="HH:mm:ss"\n            value-placeholder="UNKNOWN" both-placeholder="UNKNOWN"\n    ></st-date-range>\n</div>\n<ccri-angular-utils-time-range-input start="query.params.startDtg" end="query.params.endDtg"\n        localstorage-prefix="{{::storageKeyPrefix}}"\n        time-range-input-options="{\n            timeRequired: true,\n            startRequired: true,\n            endRequired: true,\n            maxDuration: query.timeData.maxTimeRangeMillis,\n            defaultRange: {\n                start: query.timeData.defaultStartDtg,\n                end: query.timeData.defaultEndDtg\n            },\n            shouldIntersectRange: {\n                start: query.timeData.minTime,\n                end: query.timeData.maxTime,\n                full: true\n            },\n            largeTimeRangeWarning: largeTimeRangeWarning\n        }"\n></ccri-angular-utils-time-range-input>\n')}]),this.stealth=this.stealth||{},this.stealth.jst=this.stealth.jst||{},this.stealth.jst["sld/point_colorBy.xml"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<?xml version="1.0" encoding="ISO-8859-1"?>\n<StyledLayerDescriptor version="1.0.0"\n                       xsi:schemaLocation="http://www.opengis.net/sld StyledLayerDescriptor.xsd"\n                       xmlns="http://www.opengis.net/sld"\n                       xmlns:ogc="http://www.opengis.net/ogc"\n                       xmlns:xlink="http://www.w3.org/1999/xlink"\n                       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">\n    <NamedLayer>\n        <Name>'+(null==(__t=layerName)?"":__t)+'</Name>\n        <UserStyle>\n            <FeatureTypeStyle>\n                <Rule>\n                    <PointSymbolizer>\n                        <Graphic>\n                            <Mark>\n                                <WellKnownName>circle</WellKnownName>\n                                <Fill>\n                                    <CssParameter name="fill">#BEBE40</CssParameter>\n                                    <CssParameter name="fill-opacity">0.6</CssParameter>\n                                </Fill>\n                                <Stroke>\n                                    <CssParameter name="stroke">#000000</CssParameter>\n                                    <CssParameter name="stroke-opacity">1</CssParameter>\n                                    <CssParameter name="stroke-width">0</CssParameter>\n                                </Stroke>\n                            </Mark>\n                            <Size>10</Size>\n                        </Graphic>\n                    </PointSymbolizer>\n                    <PointSymbolizer>\n                        <Graphic>\n                            <Mark>\n                                <WellKnownName>circle</WellKnownName>\n                                <Fill>\n                                    <CssParameter name="fill">\n                                        <ogc:Function name="Recode">\n                                            <ogc:PropertyName>'+(null==(__t=attribute)?"":__t)+"</ogc:PropertyName>"+(null==(__t=valueMap)?"":__t)+'\n                                        </ogc:Function>\n                                    </CssParameter>\n                                    <CssParameter name="fill-opacity">1</CssParameter>\n                                </Fill>\n                            </Mark>\n                            <Size>10</Size>\n                        </Graphic>\n                    </PointSymbolizer>\n                </Rule>\n            </FeatureTypeStyle>\n        </UserStyle>\n    </NamedLayer>\n</StyledLayerDescriptor>\n';return __p},this.stealth.jst["wps/arrowConversion.xml"]=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj){__p+='<?xml version="1.0" encoding="UTF-8"?>\n<wps:Execute version="1.0.0" service="WPS" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.opengis.net/wps/1.0.0" xmlns:wfs="http://www.opengis.net/wfs" xmlns:wps="http://www.opengis.net/wps/1.0.0" xmlns:ows="http://www.opengis.net/ows/1.1" xmlns:gml="http://www.opengis.net/gml" xmlns:ogc="http://www.opengis.net/ogc" xmlns:wcs="http://www.opengis.net/wcs/1.1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd">\n    <ows:Identifier>geomesa:ArrowConversion</ows:Identifier>\n    <wps:DataInputs>\n        <wps:Input>\n            <ows:Identifier>features</ows:Identifier>\n            '+(null==(__t=featuresXml)?"":__t)+"\n        </wps:Input>\n        ";for(var i=0;dictionaryFields&&i<dictionaryFields.length;i++)__p+="\n        <wps:Input>\n            <ows:Identifier>dictionaryFields</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>"+(null==(__t=dictionaryFields[i])?"":__t)+"</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n        ";__p+="\n        <wps:Input>\n            <ows:Identifier>useCachedDictionaries</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>false</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>sortField</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>"+(null==(__t=sortField)?"":__t)+'</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>includeFids</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>false</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>batchSize</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>10000</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n    </wps:DataInputs>\n    <wps:ResponseForm>\n        <wps:RawDataOutput mimeType="application/vnd.arrow">\n            <ows:Identifier>result</ows:Identifier>\n        </wps:RawDataOutput>\n    </wps:ResponseForm>\n</wps:Execute>\n'}return __p},this.stealth.jst["wps/binConversion.xml"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<?xml version="1.0" encoding="UTF-8"?>\n<wps:Execute version="1.0.0" service="WPS" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.opengis.net/wps/1.0.0" xmlns:wfs="http://www.opengis.net/wfs" xmlns:wps="http://www.opengis.net/wps/1.0.0" xmlns:ows="http://www.opengis.net/ows/1.1" xmlns:gml="http://www.opengis.net/gml" xmlns:ogc="http://www.opengis.net/ogc" xmlns:wcs="http://www.opengis.net/wcs/1.1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd">\n    <ows:Identifier>geomesa:BinConversion</ows:Identifier>\n    <wps:DataInputs>\n        <wps:Input>\n            <ows:Identifier>features</ows:Identifier>\n            '+(null==(__t=featuresXml)?"":__t)+"\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>geom</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>"+(null==(__t=geomField)?"":__t)+"</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>dtg</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>"+(null==(__t=dtgField)?"":__t)+"</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>track</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>"+(null==(__t=trackIdField)?"":__t)+"</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>axisOrder</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>"+(null==(__t=axisOrder)?"":__t)+'</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n    </wps:DataInputs>\n    <wps:ResponseForm>\n        <wps:RawDataOutput mimeType="application/vnd.binary-viewer">\n            <ows:Identifier>result</ows:Identifier>\n        </wps:RawDataOutput>\n    </wps:ResponseForm>\n</wps:Execute>';return __p},this.stealth.jst["wps/bounds.xml"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<?xml version="1.0" encoding="UTF-8"?>\n<wps:Execute version="1.0.0" service="WPS"\n             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.opengis.net/wps/1.0.0"\n             xmlns:wfs="http://www.opengis.net/wfs" xmlns:wps="http://www.opengis.net/wps/1.0.0"\n             xmlns:ows="http://www.opengis.net/ows/1.1" xmlns:gml="http://www.opengis.net/gml"\n             xmlns:ogc="http://www.opengis.net/ogc" xmlns:wcs="http://www.opengis.net/wcs/1.1.1"\n             xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://www.opengis.net/wps/1.0.0\n             http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd">\n    <ows:Identifier>gs:Bounds</ows:Identifier>\n    <wps:DataInputs>\n        <wps:Input>\n            <ows:Identifier>features</ows:Identifier>\n            <wps:Reference mimeType="text/xml" xlink:href="http://geoserver/wfs" method="POST">\n                <wps:Body>\n                    <wfs:GetFeature service="WFS" version="1.0.0" outputFormat="GML2" xmlns:'+(null==(__t=workspace)?"":__t)+'="'+(null==(__t=namespace)?"":__t)+'">\n                        <wfs:Query typeName="'+(null==(__t=layerName)?"":__t)+'"/>\n                    </wfs:GetFeature>\n                </wps:Body>\n            </wps:Reference>\n        </wps:Input>\n    </wps:DataInputs>\n    <wps:ResponseForm>\n        <wps:RawDataOutput>\n            <ows:Identifier>bounds</ows:Identifier>\n        </wps:RawDataOutput>\n    </wps:ResponseForm>\n</wps:Execute>';return __p},this.stealth.jst["wps/histogram_geojson.xml"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<?xml version="1.0" encoding="UTF-8"?>\n<wps:Execute version="1.0.0" service="WPS" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n             xmlns="http://www.opengis.net/wps/1.0.0" xmlns:wfs="http://www.opengis.net/wfs"\n             xmlns:wps="http://www.opengis.net/wps/1.0.0" xmlns:ows="http://www.opengis.net/ows/1.1"\n             xmlns:gml="http://www.opengis.net/gml" xmlns:ogc="http://www.opengis.net/ogc"\n             xmlns:wcs="http://www.opengis.net/wcs/1.1.1" xmlns:xlink="http://www.w3.org/1999/xlink"\n             xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd">\n    <ows:Identifier>geomesa:Unique</ows:Identifier>\n    <wps:DataInputs>\n        <wps:Input>\n            <ows:Identifier>features</ows:Identifier>\n            <wps:Reference mimeType="text/xml" xlink:href="http://geoserver/wfs" method="POST">\n                <wps:Body>\n                    <wfs:GetFeature service="WFS" version="1.0.0" outputFormat="GML2" xmlns:'+(null==(__t=workspace)?"":__t)+'="'+(null==(__t=namespace)?"":__t)+'">\n                        <wfs:Query typeName="'+(null==(__t=layer)?"":__t)+'"/>\n                    </wfs:GetFeature>\n                </wps:Body>\n            </wps:Reference>\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>filter</ows:Identifier>\n            <wps:Data>\n                <wps:ComplexData mimeType="text/plain; subtype=cql"><![CDATA['+(null==(__t=filter)?"":__t)+"]]></wps:ComplexData>\n            </wps:Data>\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>attribute</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>"+(null==(__t=attr)?"":__t)+'</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>histogram</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>true</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n    </wps:DataInputs>\n    <wps:ResponseForm>\n        <wps:RawDataOutput mimeType="application/json">\n            <ows:Identifier>result</ows:Identifier>\n        </wps:RawDataOutput>\n    </wps:ResponseForm>\n</wps:Execute>\n';return __p},this.stealth.jst["wps/import.xml"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<?xml version="1.0" encoding="UTF-8"?>\n<wps:Execute version="1.0.0" service="WPS" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n             xmlns="http://www.opengis.net/wps/1.0.0" xmlns:wfs="http://www.opengis.net/wfs"\n             xmlns:wps="http://www.opengis.net/wps/1.0.0" xmlns:ows="http://www.opengis.net/ows/1.1"\n             xmlns:gml="http://www.opengis.net/gml" xmlns:ogc="http://www.opengis.net/ogc"\n             xmlns:wcs="http://www.opengis.net/wcs/1.1.1" xmlns:xlink="http://www.w3.org/1999/xlink"\n             xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd">\n    <ows:Identifier>geomesa:Import</ows:Identifier>\n    <wps:DataInputs>\n        <wps:Input>\n            <ows:Identifier>features</ows:Identifier>\n            '+(null==(__t=featuresXml)?"":__t)+"\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>workspace</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>"+(null==(__t=workspace)?"":__t)+"</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>store</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>"+(null==(__t=store)?"":__t)+"</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>name</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>"+(null==(__t=name)?"":__t)+"</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>keywords</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>"+(null==(__t=keywords)?"":__t)+"</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n    </wps:DataInputs>\n    <wps:ResponseForm>\n        <wps:RawDataOutput>\n            <ows:Identifier>layerName</ows:Identifier>\n        </wps:RawDataOutput>\n    </wps:ResponseForm>\n</wps:Execute>\n";return __p},this.stealth.jst["wps/importHeatmap.xml"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<?xml version="1.0" encoding="UTF-8"?>\n<wps:Execute version="1.0.0" service="WPS" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n             xmlns="http://www.opengis.net/wps/1.0.0" xmlns:wfs="http://www.opengis.net/wfs"\n             xmlns:wps="http://www.opengis.net/wps/1.0.0" xmlns:ows="http://www.opengis.net/ows/1.1"\n             xmlns:gml="http://www.opengis.net/gml"  xmlns:ogc="http://www.opengis.net/ogc"\n             xmlns:wcs="http://www.opengis.net/wcs/1.1.1" xmlns:xlink="http://www.w3.org/1999/xlink"\n             xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd">\n    <ows:Identifier>gs:ImportRaster</ows:Identifier>\n    <wps:DataInputs>\n        <wps:Input>\n            <ows:Identifier>coverage</ows:Identifier>\n            <wps:Reference mimeType="image/tiff" xlink:href="http://geoserver/wps" method="POST">\n                <wps:Body>\n                    <wps:Execute version="1.0.0" service="WPS">\n                        <ows:Identifier>gs:Heatmap</ows:Identifier>\n                        <wps:DataInputs>\n                            <wps:Input>\n                                <ows:Identifier>data</ows:Identifier>\n                                <wps:Reference mimeType="text/xml" xlink:href="http://geoserver/wfs" method="POST">\n                                    <wps:Body>\n                                        <wfs:GetFeature service="WFS" version="1.0.0" outputFormat="GML2">\n                                            <wfs:Query typeName="'+(null==(__t=featureName)?"":__t)+'">\n                                                '+(null==(__t=xmlFilter)?"":__t)+"\n                                            </wfs:Query>\n                                        </wfs:GetFeature>\n                                    </wps:Body>\n                                </wps:Reference>\n                            </wps:Input>\n                            <wps:Input>\n                                <ows:Identifier>radiusPixels</ows:Identifier>\n                                <wps:Data>\n                                    <wps:LiteralData>"+(null==(__t=radiusPixels)?"":__t)+'</wps:LiteralData>\n                                </wps:Data>\n                            </wps:Input>\n                            <wps:Input>\n                                <ows:Identifier>pixelsPerCell</ows:Identifier>\n                                <wps:Data>\n                                    <wps:LiteralData>1</wps:LiteralData>\n                                </wps:Data>\n                            </wps:Input>\n                            <wps:Input>\n                                <ows:Identifier>outputBBOX</ows:Identifier>\n                                <wps:Data>\n                                    <wps:BoundingBoxData crs="EPSG:4326" dimensions="2">\n                                        <ows:LowerCorner>'+(null==(__t=minX)?"":__t)+" "+(null==(__t=minY)?"":__t)+"</ows:LowerCorner>\n                                        <ows:UpperCorner>"+(null==(__t=maxX)?"":__t)+" "+(null==(__t=maxY)?"":__t)+"</ows:UpperCorner>\n                                    </wps:BoundingBoxData>\n                                </wps:Data>\n                            </wps:Input>\n                            <wps:Input>\n                                <ows:Identifier>outputWidth</ows:Identifier>\n                                <wps:Data>\n                                    <wps:LiteralData>"+(null==(__t=outputWidth)?"":__t)+"</wps:LiteralData>\n                                </wps:Data>\n                            </wps:Input>\n                            <wps:Input>\n                                <ows:Identifier>outputHeight</ows:Identifier>\n                                <wps:Data>\n                                    <wps:LiteralData>"+(null==(__t=outputHeight)?"":__t)+'</wps:LiteralData>\n                                </wps:Data>\n                            </wps:Input>\n                        </wps:DataInputs>\n                        <wps:ResponseForm>\n                            <wps:RawDataOutput mimeType="image/tiff">\n                                <ows:Identifier>result</ows:Identifier>\n                            </wps:RawDataOutput>\n                        </wps:ResponseForm>\n                    </wps:Execute>\n                </wps:Body>\n            </wps:Reference>\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>workspace</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>'+(null==(__t=workspace)?"":__t)+"</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>store</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>"+(null==(__t=heatmapName)?"":__t)+"</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>name</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>"+(null==(__t=heatmapName)?"":__t)+"</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>srs</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>EPSG:4326</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>srsHandling</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>FORCE_DECLARED</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>styleName</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>stealth_static_heatmap</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>keywords</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>"+(null==(__t=keywords)?"":__t)+"</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n    </wps:DataInputs>\n    <wps:ResponseForm>\n        <wps:RawDataOutput>\n            <ows:Identifier>result</ows:Identifier>\n        </wps:RawDataOutput>\n    </wps:ResponseForm>\n</wps:Execute>\n";return __p},this.stealth.jst["wps/multiSurfaceRouteAnalysis_geojson.xml"]=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj){__p+='<?xml version="1.0" encoding="UTF-8"?><wps:Execute version="1.0.0" service="WPS" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.opengis.net/wps/1.0.0" xmlns:wfs="http://www.opengis.net/wfs" xmlns:wps="http://www.opengis.net/wps/1.0.0" xmlns:ows="http://www.opengis.net/ows/1.1" xmlns:gml="http://www.opengis.net/gml" xmlns:ogc="http://www.opengis.net/ogc" xmlns:wcs="http://www.opengis.net/wcs/1.1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd">\n    <ows:Identifier>linequery:MultiSurfaceLineQuery</ows:Identifier>\n    <wps:DataInputs>\n        <wps:Input>\n            <ows:Identifier>aggregationMethod</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>'+(null==(__t=aggregationMethod)?"":__t)+'</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>lineString</ows:Identifier>\n            <wps:Reference mimeType="text/xml; subtype=gml/3.1.1" xlink:href="http://geoserver/wps" method="POST">\n                <wps:Body>\n                    <wps:Execute version="1.0.0" service="WPS">\n                        <ows:Identifier>linequery:AddWaypoints</ows:Identifier>\n                        <wps:DataInputs>\n                            <wps:Input>\n                                <ows:Identifier>lineString</ows:Identifier>\n                                <wps:Data>\n                                    <wps:ComplexData mimeType="application/wkt">'+(null==(__t=lineString)?"":__t)+"</wps:ComplexData>\n                                </wps:Data>\n                            </wps:Input>\n                            <wps:Input>\n                                <ows:Identifier>Degrees between points</ows:Identifier>\n                                <wps:Data>\n                                    <wps:LiteralData>"+(null==(__t=resolution)?"":__t)+'</wps:LiteralData>\n                                </wps:Data>\n                            </wps:Input>\n                        </wps:DataInputs>\n                        <wps:ResponseForm>\n                            <wps:RawDataOutput mimeType="application/wkt">\n                                <ows:Identifier>waypoint adder</ows:Identifier>\n                            </wps:RawDataOutput>\n                        </wps:ResponseForm>\n                    </wps:Execute>\n                </wps:Body>\n            </wps:Reference>\n        </wps:Input>\n        ';for(var i=0;i<dataLayers.length;i++){var dataLayer=dataLayers[i];__p+='\n        <wps:Input>\n            <ows:Identifier>rasters</ows:Identifier>\n            <wps:Reference mimeType="image/tiff" xlink:href="http://geoserver/wcs" method="POST">\n                <wps:Body>\n                    <wcs:GetCoverage service="WCS" version="1.1.1">\n                        <ows:Identifier>'+(null==(__t=dataLayer.Name)?"":__t)+'</ows:Identifier>\n                        <wcs:DomainSubset>\n                            <gml:BoundingBox crs="http://www.opengis.net/gml/srs/epsg.xml#4326">\n                                <ows:LowerCorner>'+(null==(__t=dataLayer.lowerCorner)?"":__t)+"</ows:LowerCorner>\n                                <ows:UpperCorner>"+(null==(__t=dataLayer.upperCorner)?"":__t)+'</ows:UpperCorner>\n                            </gml:BoundingBox>\n                        </wcs:DomainSubset>\n                        <wcs:Output format="image/tiff"/>\n                    </wcs:GetCoverage>\n                </wps:Body>\n            </wps:Reference>\n        </wps:Input>\n        '}__p+='\n    </wps:DataInputs>\n    <wps:ResponseForm>\n        <wps:RawDataOutput mimeType="application/json">\n            <ows:Identifier>result</ows:Identifier>\n        </wps:RawDataOutput>\n    </wps:ResponseForm>\n</wps:Execute>\n'}return __p},this.stealth.jst["wps/partials/complexData.xml"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<wps:Data>\n    <wps:ComplexData mimeType="application/json"><![CDATA['+(null==(__t=data)?"":__t)+"]]></wps:ComplexData>\n</wps:Data>";return __p},this.stealth.jst["wps/partials/literalData.xml"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+="<wps:Data>\n    <wps:LiteralData>"+(null==(__t=data)?"":__t)+"</wps:LiteralData>\n</wps:Data>";return __p},this.stealth.jst["wps/partials/reference.xml"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<wps:Reference mimeType="text/xml" xlink:href="http://geoserver/wps" method="POST">\n    <wps:Body>\n        '+(null==(__t=bodyXml)?"":__t)+"\n    </wps:Body>\n</wps:Reference>";return __p},this.stealth.jst["wps/predictionToGeometry.xml"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<?xml version="1.0" encoding="UTF-8"?><wps:Execute version="1.0.0" service="WPS" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.opengis.net/wps/1.0.0" xmlns:wfs="http://www.opengis.net/wfs" xmlns:wps="http://www.opengis.net/wps/1.0.0" xmlns:ows="http://www.opengis.net/ows/1.1" xmlns:gml="http://www.opengis.net/gml" xmlns:ogc="http://www.opengis.net/ogc" xmlns:wcs="http://www.opengis.net/wcs/1.1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd">\n    <ows:Identifier>dcm:PredictionToGeometry</ows:Identifier>\n    <wps:DataInputs>\n        <wps:Input>\n            <ows:Identifier>predictionRaster</ows:Identifier>\n            <wps:Reference mimeType="image/tiff" xlink:href="http://geoserver/wcs" method="POST">\n                <wps:Body>\n                    <wcs:GetCoverage service="WCS" version="1.1.1">\n                        <ows:Identifier>'+(null==(__t=layerName)?"":__t)+'</ows:Identifier>\n                        <wcs:DomainSubset>\n                            <ows:BoundingBox crs="http://www.opengis.net/gml/srs/epsg.xml#4326">\n                                <ows:LowerCorner>'+(null==(__t=lowerCorner)?"":__t)+"</ows:LowerCorner>\n                                <ows:UpperCorner>"+(null==(__t=upperCorner)?"":__t)+'</ows:UpperCorner>\n                            </ows:BoundingBox>\n                        </wcs:DomainSubset>\n                        <wcs:Output format="image/tiff"/>\n                    </wcs:GetCoverage>\n                </wps:Body>\n            </wps:Reference>\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>minThreshold</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>'+(null==(__t=minThreshold)?"":__t)+"</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>maxThreshold</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>"+(null==(__t=maxThreshold)?"":__t)+'</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n    </wps:DataInputs>\n    <wps:ResponseForm>\n        <wps:RawDataOutput mimeType="application/wkt">\n            <ows:Identifier>prediction geometry</ows:Identifier>\n        </wps:RawDataOutput>\n    </wps:ResponseForm>\n</wps:Execute>';return __p},this.stealth.jst["wps/predictionToPolygons.xml"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<?xml version="1.0" encoding="UTF-8"?>\n<wps:Execute version="1.0.0" service="WPS" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n             xmlns="http://www.opengis.net/wps/1.0.0" xmlns:wfs="http://www.opengis.net/wfs"\n             xmlns:wps="http://www.opengis.net/wps/1.0.0" xmlns:ows="http://www.opengis.net/ows/1.1"\n             xmlns:gml="http://www.opengis.net/gml" xmlns:ogc="http://www.opengis.net/ogc"\n             xmlns:wcs="http://www.opengis.net/wcs/1.1.1" xmlns:xlink="http://www.w3.org/1999/xlink"\n             xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd">\n    <ows:Identifier>gs:PredictionToPolygons</ows:Identifier>\n    <wps:DataInputs>\n        '+(null==(__t=predictionCoverageWpsInput)?"":__t)+"\n        <wps:Input>\n            <ows:Identifier>workspace</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>"+(null==(__t=workspace)?"":__t)+"</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>store</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>"+(null==(__t=store)?"":__t)+"</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n        "+(null==(__t=polygonLayerWpsInput)?"":__t)+"\n    </wps:DataInputs>\n    <wps:ResponseForm>\n        <wps:RawDataOutput>\n            <ows:Identifier>result</ows:Identifier>\n        </wps:RawDataOutput>\n    </wps:ResponseForm>\n</wps:Execute>\n";
return __p},this.stealth.jst["wps/queryFeatures.xml"]=function(obj){function print(){__p+=__j.call(arguments,"")}obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;with(obj){__p+='<?xml version="1.0" encoding="UTF-8"?>\n<wps:Execute version="1.0.0" service="WPS" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n             xmlns="http://www.opengis.net/wps/1.0.0" xmlns:wfs="http://www.opengis.net/wfs" xmlns:wps="http://www.opengis.net/wps/1.0.0"\n             xmlns:ows="http://www.opengis.net/ows/1.1" xmlns:gml="http://www.opengis.net/gml" xmlns:ogc="http://www.opengis.net/ogc"\n             xmlns:wcs="http://www.opengis.net/wcs/1.1.1" xmlns:xlink="http://www.w3.org/1999/xlink"\n             xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd">\n    <ows:Identifier>geomesa:Query</ows:Identifier>\n    <wps:DataInputs>\n        <wps:Input>\n            <ows:Identifier>features</ows:Identifier>\n            <wps:Reference mimeType="text/xml" xlink:href="http://geoserver/wfs" method="POST">\n                <wps:Body>\n                    <wfs:GetFeature service="WFS" version="1.0.0" outputFormat="GML2" xmlns:'+(null==(__t=workspace)?"":__t)+'="'+(null==(__t=namespace)?"":__t)+'">\n                        <wfs:Query typeName="'+(null==(__t=dataLayer)?"":__t)+'"/>\n                    </wfs:GetFeature>\n                </wps:Body>\n            </wps:Reference>\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>filter</ows:Identifier>\n            <wps:Data>\n                <wps:ComplexData mimeType="text/plain; subtype=cql"><![CDATA['+(null==(__t=dataLayerFilter)?"":__t)+"]]></wps:ComplexData>\n            </wps:Data>\n        </wps:Input>\n        ";for(var i=0;properties&&i<properties.length;i++)__p+="\n        <wps:Input>\n            <ows:Identifier>properties</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>"+(null==(__t=properties[i])?"":__t)+"</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n        ";__p+='\n    </wps:DataInputs>\n    <wps:ResponseForm>\n        <wps:RawDataOutput mimeType="text/xml; subtype=wfs-collection/1.0">\n            <ows:Identifier>result</ows:Identifier>\n        </wps:RawDataOutput>\n    </wps:ResponseForm>\n</wps:Execute>\n'}return __p},this.stealth.jst["wps/resolutionRecommendation.xml"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<?xml version="1.0" encoding="UTF-8"?><wps:Execute version="1.0.0" service="WPS" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.opengis.net/wps/1.0.0" xmlns:wfs="http://www.opengis.net/wfs" xmlns:wps="http://www.opengis.net/wps/1.0.0" xmlns:ows="http://www.opengis.net/ows/1.1" xmlns:gml="http://www.opengis.net/gml" xmlns:ogc="http://www.opengis.net/ogc" xmlns:wcs="http://www.opengis.net/wcs/1.1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd">\n    <ows:Identifier>dcm:ResolutionRecommendation</ows:Identifier>\n    <wps:DataInputs>\n        <wps:Input>\n            <ows:Identifier>outputBBOX</ows:Identifier>\n            <wps:Data>\n                <wps:BoundingBoxData crs="'+(null==(__t=crs)?"":__t)+'" dimensions="2">\n                    <ows:LowerCorner>'+(null==(__t=minX)?"":__t)+" "+(null==(__t=minY)?"":__t)+"</ows:LowerCorner>\n                    <ows:UpperCorner>"+(null==(__t=maxX)?"":__t)+" "+(null==(__t=maxY)?"":__t)+"</ows:UpperCorner>\n                </wps:BoundingBoxData>\n            </wps:Data>\n        </wps:Input>\n    </wps:DataInputs>\n    <wps:ResponseForm>\n        <wps:RawDataOutput>\n            <ows:Identifier>resolution</ows:Identifier>\n        </wps:RawDataOutput>\n    </wps:ResponseForm>\n</wps:Execute>";return __p},this.stealth.jst["wps/routeAnalysis_geojson.xml"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<?xml version="1.0" encoding="UTF-8"?><wps:Execute version="1.0.0" service="WPS" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.opengis.net/wps/1.0.0" xmlns:wfs="http://www.opengis.net/wfs" xmlns:wps="http://www.opengis.net/wps/1.0.0" xmlns:ows="http://www.opengis.net/ows/1.1" xmlns:gml="http://www.opengis.net/gml" xmlns:ogc="http://www.opengis.net/ogc" xmlns:wcs="http://www.opengis.net/wcs/1.1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd">\n    <ows:Identifier>linequery:LineQuery</ows:Identifier>\n    <wps:DataInputs>\n        <wps:Input>\n            <ows:Identifier>lineString</ows:Identifier>\n            <wps:Reference mimeType="text/xml; subtype=gml/3.1.1" xlink:href="http://geoserver/wps" method="POST">\n                <wps:Body>\n                    <wps:Execute version="1.0.0" service="WPS">\n                        <ows:Identifier>linequery:AddWaypoints</ows:Identifier>\n                        <wps:DataInputs>\n                            <wps:Input>\n                                <ows:Identifier>lineString</ows:Identifier>\n                                <wps:Data>\n                                    <wps:ComplexData mimeType="application/wkt">'+(null==(__t=lineString)?"":__t)+"</wps:ComplexData>\n                                </wps:Data>\n                            </wps:Input>\n                            <wps:Input>\n                                <ows:Identifier>Degrees between points</ows:Identifier>\n                                <wps:Data>\n                                    <wps:LiteralData>"+(null==(__t=resolution)?"":__t)+'</wps:LiteralData>\n                                </wps:Data>\n                            </wps:Input>\n                        </wps:DataInputs>\n                        <wps:ResponseForm>\n                            <wps:RawDataOutput mimeType="application/wkt">\n                                <ows:Identifier>waypoint adder</ows:Identifier>\n                            </wps:RawDataOutput>\n                        </wps:ResponseForm>\n                    </wps:Execute>\n                </wps:Body>\n            </wps:Reference>\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>raster</ows:Identifier>\n            <wps:Reference mimeType="image/tiff" xlink:href="http://geoserver/wcs" method="POST">\n                <wps:Body>\n                    <wcs:GetCoverage service="WCS" version="1.1.1">\n                        <ows:Identifier>'+(null==(__t=dataLayer)?"":__t)+'</ows:Identifier>\n                        <wcs:DomainSubset>\n                            <gml:BoundingBox crs="http://www.opengis.net/gml/srs/epsg.xml#4326">\n                                <ows:LowerCorner>'+(null==(__t=lowerCorner)?"":__t)+"</ows:LowerCorner>\n                                <ows:UpperCorner>"+(null==(__t=upperCorner)?"":__t)+'</ows:UpperCorner>\n                            </gml:BoundingBox>\n                        </wcs:DomainSubset>\n                        <wcs:Output format="image/tiff"/>\n                    </wcs:GetCoverage>\n                </wps:Body>\n            </wps:Reference>\n        </wps:Input>\n    </wps:DataInputs>\n    <wps:ResponseForm>\n        <wps:RawDataOutput mimeType="application/json">\n            <ows:Identifier>result</ows:Identifier>\n        </wps:RawDataOutput>\n    </wps:ResponseForm>\n</wps:Execute>\n\n';return __p},this.stealth.jst["wps/routeSearch.xml"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<?xml version="1.0" encoding="UTF-8"?>\n<wps:Execute version="1.0.0" service="WPS" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n             xmlns="http://www.opengis.net/wps/1.0.0" xmlns:wfs="http://www.opengis.net/wfs" xmlns:wps="http://www.opengis.net/wps/1.0.0"\n             xmlns:ows="http://www.opengis.net/ows/1.1" xmlns:gml="http://www.opengis.net/gml" xmlns:ogc="http://www.opengis.net/ogc"\n             xmlns:wcs="http://www.opengis.net/wcs/1.1.1" xmlns:xlink="http://www.w3.org/1999/xlink"\n             xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd">\n    <ows:Identifier>geomesa:RouteSearch</ows:Identifier>\n    <wps:DataInputs>\n        <wps:Input>\n            <ows:Identifier>routes</ows:Identifier>\n            '+(null==(__t=routesXml)?"":__t)+"\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>bufferSize</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>"+(null==(__t=bufferSize)?"":__t)+"</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>headingThreshold</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>"+(null==(__t=headingThreshold)?"":__t)+"</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>features</ows:Identifier>\n            "+(null==(__t=featuresXml)?"":__t)+"\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>routeGeomField</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>"+(null==(__t=routeGeomField)?"":__t)+"</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>geomField</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>"+(null==(__t=geomField)?"":__t)+"</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>bidirectional</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>"+(null==(__t=bidirectional)?"":__t)+"</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>headingField</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>"+(null==(__t=headingField)?"":__t)+'</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n    </wps:DataInputs>\n    <wps:ResponseForm>\n        <wps:RawDataOutput mimeType="application/json">\n            <ows:Identifier>result</ows:Identifier>\n        </wps:RawDataOutput>\n    </wps:ResponseForm>\n</wps:Execute>';return __p},this.stealth.jst["wps/spatialPrediction.xml"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<?xml version="1.0" encoding="UTF-8"?>\n<wps:Execute version="1.0.0" service="WPS" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n             xmlns="http://www.opengis.net/wps/1.0.0" xmlns:wfs="http://www.opengis.net/wfs"\n             xmlns:wps="http://www.opengis.net/wps/1.0.0" xmlns:ows="http://www.opengis.net/ows/1.1"\n             xmlns:gml="http://www.opengis.net/gml" xmlns:ogc="http://www.opengis.net/ogc"\n             xmlns:wcs="http://www.opengis.net/wcs/1.1.1" xmlns:xlink="http://www.w3.org/1999/xlink"\n             xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd">\n    <ows:Identifier>gs:ImportRaster</ows:Identifier>\n    <wps:DataInputs>\n        <wps:Input>\n            <ows:Identifier>coverage</ows:Identifier>\n            <wps:Reference mimeType="'+(null==(__t=outputType)?"":__t)+'" xlink:href="http://geoserver/wps" method="POST">\n                <wps:Body>\n                    <wps:Execute version="1.0.0" service="WPS">\n                        <ows:Identifier>dcm:MultiBand</ows:Identifier>\n                        <wps:DataInputs>\n                            <wps:Input>\n                                <ows:Identifier>predictionRaster</ows:Identifier>\n                                <wps:Reference mimeType="'+(null==(__t=outputType)?"":__t)+'" xlink:href="http://geoserver/wps" method="POST">\n                                    <wps:Body>\n                                        <wps:Execute version="1.0.0" service="WPS">\n                                            <ows:Identifier>dcm:DCM</ows:Identifier>\n                                            <wps:DataInputs>\n                                                '+(null==(__t=predictiveFeaturesWpsInput)?"":__t)+"\n                                                "+(null==(__t=predictiveCoveragesWpsInput)?"":__t)+"\n                                                "+(null==(__t=eventsWpsInput)?"":__t)+"\n                                                "+(null==(__t=aoWpsInput)?"":__t)+"\n                                                <wps:Input>\n                                                    <ows:Identifier>width</ows:Identifier>\n                                                    <wps:Data>\n                                                        <wps:LiteralData>"+(null==(__t=width)?"":__t)+"</wps:LiteralData>\n                                                    </wps:Data>\n                                                </wps:Input>\n                                                <wps:Input>\n                                                    <ows:Identifier>height</ows:Identifier>\n                                                    <wps:Data>\n                                                        <wps:LiteralData>"+(null==(__t=height)?"":__t)+"</wps:LiteralData>\n                                                    </wps:Data>\n                                                </wps:Input>\n                                                <wps:Input>\n                                                    <ows:Identifier>sampleRatio</ows:Identifier>\n                                                    <wps:Data>\n                                                        <wps:LiteralData>"+(null==(__t=sampleRatio)?"":__t)+"</wps:LiteralData>\n                                                    </wps:Data>\n                                                </wps:Input>\n                                                <wps:Input>\n                                                    <ows:Identifier>CRS</ows:Identifier>\n                                                    <wps:Data>\n                                                        <wps:LiteralData>"+(null==(__t=CRS)?"":__t)+"</wps:LiteralData>\n                                                    </wps:Data>\n                                                </wps:Input>\n                                                <wps:Input>\n                                                    <ows:Identifier>feature selection</ows:Identifier>\n                                                    <wps:Data>\n                                                        <wps:LiteralData>"+(null==(__t=featureSelection)?"":__t)+"</wps:LiteralData>\n                                                    </wps:Data>\n                                                </wps:Input>\n                                                <wps:Input>\n                                                    <ows:Identifier>classifierType</ows:Identifier>\n                                                    <wps:Data>\n                                                        <wps:LiteralData>"+(null==(__t=classifierType)?"":__t)+'</wps:LiteralData>\n                                                    </wps:Data>\n                                                </wps:Input>\n                                            </wps:DataInputs>\n                                            <wps:ResponseForm>\n                                                <wps:RawDataOutput mimeType="'+(null==(__t=outputType)?"":__t)+'">\n                                                    <ows:Identifier>prediction</ows:Identifier>\n                                                </wps:RawDataOutput>\n                                            </wps:ResponseForm>\n                                        </wps:Execute>\n                                    </wps:Body>\n                                </wps:Reference>\n                            </wps:Input>\n                            '+(null==(__t=eventsWpsInput)?"":__t)+"\n                        </wps:DataInputs>\n                    </wps:Execute>\n                </wps:Body>\n            </wps:Reference>\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>workspace</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>"+(null==(__t=workspace)?"":__t)+"</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>store</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>"+(null==(__t=store)?"":__t)+"</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>name</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>"+(null==(__t=name)?"":__t)+"</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>srs</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>"+(null==(__t=CRS)?"":__t)+"</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>srsHandling</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>"+(null==(__t=srsHandling.projectionPolicy)?"":__t)+"</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>keywords</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>"+(null==(__t=keywords)?"":__t)+"</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>styleName</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>"+(null==(__t=sldTemplate)?"":__t)+"</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>description</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>"+(null==(__t=description)?"":__t)+"</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n    </wps:DataInputs>\n    <wps:ResponseForm>\n        <wps:RawDataOutput>\n            <ows:Identifier>result</ows:Identifier>\n        </wps:RawDataOutput>\n    </wps:ResponseForm>\n</wps:Execute>\n";return __p},this.stealth.jst["wps/tubeSelect.xml"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<?xml version="1.0" encoding="UTF-8"?>\n<wps:Execute version="1.0.0" service="WPS" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"\n             xmlns="http://www.opengis.net/wps/1.0.0" xmlns:wfs="http://www.opengis.net/wfs" xmlns:wps="http://www.opengis.net/wps/1.0.0"\n             xmlns:ows="http://www.opengis.net/ows/1.1" xmlns:gml="http://www.opengis.net/gml" xmlns:ogc="http://www.opengis.net/ogc"\n             xmlns:wcs="http://www.opengis.net/wcs/1.1.1" xmlns:xlink="http://www.w3.org/1999/xlink"\n             xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd">\n    <ows:Identifier>geomesa:TubeSelect</ows:Identifier>\n    <wps:DataInputs>\n        <wps:Input>\n            <ows:Identifier>tubeFeatures</ows:Identifier>\n            '+(null==(__t=routesXml)?"":__t)+"\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>featureCollection</ows:Identifier>\n            "+(null==(__t=featuresXml)?"":__t)+"\n        </wps:Input>\n        <wps:Input>\n            <!-- in meters -->\n            <ows:Identifier>bufferSize</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>"+(null==(__t=bufferSize)?"":__t)+"</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n        <wps:Input>\n            <!-- In mps -->\n            <ows:Identifier>maxSpeed</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>"+(null==(__t=maxSpeed)?"":__t)+"</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n        <wps:Input>\n            <!-- in seconds -->\n            <ows:Identifier>maxTime</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>"+(null==(__t=maxTime)?"":__t)+"</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>maxBins</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>"+(null==(__t=maxBins)?"":__t)+'</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n        <wps:Input>\n            <!-- Either "line" or "nofill" -->\n            <ows:Identifier>gapFill</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>'+(null==(__t=gapFill)?"":__t)+'</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n    </wps:DataInputs>\n    <wps:ResponseForm>\n        <wps:RawDataOutput mimeType="text/xml; subtype=wfs-collection/1.0">\n            <ows:Identifier>result</ows:Identifier>\n        </wps:RawDataOutput>\n    </wps:ResponseForm>\n</wps:Execute>';return __p},this.stealth.jst["wps/unique.xml"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj)__p+='<?xml version="1.0" encoding="UTF-8"?><wps:Execute version="1.0.0" service="WPS" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.opengis.net/wps/1.0.0" xmlns:wfs="http://www.opengis.net/wfs" xmlns:wps="http://www.opengis.net/wps/1.0.0" xmlns:ows="http://www.opengis.net/ows/1.1" xmlns:gml="http://www.opengis.net/gml" xmlns:ogc="http://www.opengis.net/ogc" xmlns:wcs="http://www.opengis.net/wcs/1.1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd">\n    <ows:Identifier>geomesa:Unique</ows:Identifier>\n    <wps:DataInputs>\n        <wps:Input>\n            <ows:Identifier>features</ows:Identifier>\n            <wps:Reference mimeType="text/xml" xlink:href="http://geoserver/wfs" method="POST">\n                <wps:Body>\n                    <wfs:GetFeature service="WFS" version="1.0.0" outputFormat="GML2" xmlns:ccri="http://ccri.com">\n                        <wfs:Query typeName="'+(null==(__t=dataLayer)?"":__t)+'"/>\n                    </wfs:GetFeature>\n                </wps:Body>\n            </wps:Reference>\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>filter</ows:Identifier>\n            <wps:Data>\n                <wps:ComplexData mimeType="text/plain; subtype=cql"><![CDATA['+(null==(__t=dataLayerFilter)?"":__t)+"]]></wps:ComplexData>\n            </wps:Data>\n        </wps:Input>\n        <wps:Input>\n            <ows:Identifier>attribute</ows:Identifier>\n            <wps:Data>\n                <wps:LiteralData>"+(null==(__t=attribute)?"":__t)+'</wps:LiteralData>\n            </wps:Data>\n        </wps:Input>\n    </wps:DataInputs>\n    <wps:ResponseForm>\n        <wps:RawDataOutput mimeType="application/json">\n            <ows:Identifier>result</ows:Identifier>\n        </wps:RawDataOutput>\n    </wps:ResponseForm>\n</wps:Execute>';return __p};